(self.webpackChunkvk=self.webpackChunkvk||[]).push([[68069],{95318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},50008:e=>{function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=n=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),n(t)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},57450:(e,n,t)=>{"use strict";t.d(n,{IconSettingsContext:()=>i});var a=t(67294);var i=a.createContext({})},91750:(e,n,t)=>{"use strict";t.d(n,{makeIcon:()=>f});var a=t(67294),i=t(87854),o=t.n(i),r=t(57450),s=t(3389);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function c(){return c=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},c.apply(this,arguments)}function d(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},a=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),a.forEach((function(n){l(e,n,t[n])}))}return e}function u(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})),e}function _(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var v={display:"block"};var p=function(e){var n=e.width,t=e.height,i=e.viewBox,o=e.id,s=e.className,l=void 0===s?"":s,p=e.style,f=void 0===p?{}:p,h=e.fill,g=e.getRootRef,m=e.Component,A=void 0===m?"div":m,C=e.role,E=e["aria-label"],S=e["aria-hidden"],I=_(e,["width","height","viewBox","id","className","style","fill","getRootRef","Component","role","aria-label","aria-hidden"]),T=Math.max(n,t),x=a.useContext(r.IconSettingsContext),y=function(e,n){for(var t=n.classPrefix,a=n.globalClasses,i="",o=0;o<e.length;o++)t&&(i+=" "+(t+e[o])),t&&!a||(i+=" "+e[o]);return i}(["Icon","Icon--".concat(T),"Icon--w-".concat(n),"Icon--h-".concat(t),"Icon--".concat(o)],x);return a.createElement(A,c({role:"presentation"},I,{ref:g,className:"".concat(y," ").concat(l),style:u(d({},f),{width:n,height:t})}),a.createElement("svg",{viewBox:i,width:n,height:t,style:v,role:C,"aria-label":E,"aria-hidden":S},a.createElement("use",{xlinkHref:"#".concat(o),style:{fill:"currentColor",color:h}})))};function f(e,n,t,i,r,l){var d=!1;function u(){d||((0,s.addSpriteSymbol)(new(o())({id:n,viewBox:t,content:i})),d=!0)}var _=function(e){return(0,s.useIsomorphicLayoutEffect)(u,[]),a.createElement(p,c({},e,{viewBox:t,id:n,width:isNaN(e.width)?r:+e.width,height:isNaN(e.height)?l:+e.height}))};return _.mountIcon=u,_.displayName=e,_}},3389:(e,n,t)=>{"use strict";t.d(n,{addSpriteSymbol:()=>d,useIsomorphicLayoutEffect:()=>u});var a,i=t(62548),o=t.n(i),r=t(67294),s=!("undefined"==typeof window||!window.document||!window.document.createElement);if(s){var l="__SVG_SPRITE_NODE__";a=new(o())({attrs:{id:l}});var c=function(){var e=document.getElementById(l);e?a.attach(e):a.mount(),document.removeEventListener("DOMContentLoaded",c)};document.querySelector("body")?c():document.addEventListener("DOMContentLoaded",c)}else a=null;function d(e){a&&a.add(e)}var u=s?r.useLayoutEffect:r.useEffect},47934:(e,n,t)=>{"use strict";t.d(n,{default:()=>a});const a=(0,t(63192).makeIcon)("Icon20Add","add_20","0 0 20 20",'<symbol fill="none" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="add_20"><path clip-rule="evenodd" d="M10 2a.75.75 0 0 1 .75.75v6.499h6.499a.75.75 0 0 1 0 1.5H10.75v6.499a.75.75 0 0 1-1.5 0v-6.5H2.751a.75.75 0 0 1 0-1.5H9.25V2.75A.75.75 0 0 1 10 2z" fill="currentColor" fill-rule="evenodd" /></symbol>',20,20,!1,void 0)},11099:(e,n,t)=>{"use strict";var a=t(95318);n.classNames=function(){for(var e=[],n=arguments.length,t=new Array(n),a=0;a<n;a++)t[a]=arguments[a];return t.forEach((function(n){if(n)switch((0,i.default)(n)){case"string":e.push(n);break;case"object":Object.keys(n).forEach((function(t){n[t]&&e.push(t)}));break;default:e.push("".concat(n))}})),e.join(" ")};var i=a(t(50008))},37441:(e,n,t)=>{"use strict";t.d(n,{ENavigateToConvoDirection:()=>a,isFastChatMounted:()=>s,useBoxLayerObserver:()=>c,useNavGoListener:()=>l});var a,i=t(70655),o=t(67294),r=function(){var e;return!(!(null===(e=window.reforgedME)||void 0===e?void 0:e.selectPeer)||!document.querySelector(".FCApp"))},s=function(){return e=window.location,n=e.host,t=e.pathname,!/calls\.vk\.(com|ru)/.test(n)&&!t.startsWith("/calls-standalone")&&r();var e,n,t};!function(e){e[e.Messenger=0]="Messenger",e[e.FastChat=1]="FastChat"}(a||(a={}));var l=function(e,n){(0,o.useEffect)((function(){if(!n&&r()){var t=function(e){function n(n,t,a,i){return e(n,t,a,i),!0}function t(){var e,n;return null===(n=null===(e=window.nav)||void 0===e?void 0:e.subscribeOnModuleEvaluated)||void 0===n||n.call(e,a),!0}function a(){var e,a,i,o,r,s;null===(i=null===(a=null===(e=window.cur)||void 0===e?void 0:e.nav)||void 0===a?void 0:a.push)||void 0===i||i.call(a,n),null===(s=null===(r=null===(o=window.cur)||void 0===o?void 0:o.destroy)||void 0===r?void 0:r.push)||void 0===s||s.call(r,t)}return{init:a,destroy:function(){var e,i,o,r,s,l;null===(i=null===(e=window.nav)||void 0===e?void 0:e.unsubscribeOnModuleEvaluated)||void 0===i||i.call(e,a),(null===(o=window.cur)||void 0===o?void 0:o.nav)&&Array.isArray(null===(r=window.cur)||void 0===r?void 0:r.nav)&&(window.cur.nav=window.cur.nav.filter((function(e){return e!==n}))),(null===(s=window.cur)||void 0===s?void 0:s.destroy)&&Array.isArray(null===(l=window.cur)||void 0===l?void 0:l.destroy)&&(window.cur.destroy=window.cur.destroy.filter((function(e){return e!==t})))}}}(e);return t.init(),function(){t.destroy()}}}),[e,n])},c=function(e,n){(0,o.useEffect)((function(){if(!n&&r()&&window.hasOwnProperty("MutationObserver")&&window.hasOwnProperty("boxLayer")){var t=new MutationObserver((function(n){var t,a,o=!1;try{for(var r=(0,i.__values)(n),s=r.next();!s.done;s=r.next()){var l=s.value;if("childList"===l.type)l.addedNodes.length&&(e(),o=!0);if(o)break}}catch(e){t={error:e}}finally{try{s&&!s.done&&(a=r.return)&&a.call(r)}finally{if(t)throw t.error}}}));return t.observe(window.boxLayer,{childList:!0}),function(){t.disconnect()}}}),[e,n])}},60351:(e,n,t)=>{"use strict";t.d(n,{init:()=>xv});var a,i=t(70655),o=t(85893),r=t(73935),s=t(59397),l=t(67294),c=t(35886),d=t(73674),u=function(){return(0,c.useDispatch)()};!function(e){e.POSITIVE="positive",e.NEGATIVE="negative",e.REGULAR="regular",e.ON="on",e.OFF="off",e.CLEAR="clear",e.DISABLED="disabled"}(a||(a={}));var _=(0,l.forwardRef)((function(e,n){var t=e.icon,r=e.text,l=e.type,c=e.className,d=(0,i.__rest)(e,["icon","text","type","className"]),u=(0,s.classNames)("CallButton","CallButton--"+l,c,{"CallButton--withText":!!r},"CallButton--withAnimation"),_=(0,s.classNames)("CallButton__icon","CallButton__icon--withAnimation"),v=(0,i.__assign)((0,i.__assign)({},d),{onMouseDown:function(e){e.preventDefault(),d.onMouseDown&&d.onMouseDown(e)}});return(0,o.jsxs)("button",(0,i.__assign)({className:u},v,{disabled:l===a.DISABLED,ref:n},{children:[(0,o.jsx)("figure",(0,i.__assign)({className:_},{children:t}),void 0),r]}),void 0)})),v=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"14",width:"21",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M11.154 0c1.337 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31v6.31c0 1.336-.14 1.821-.4 2.31a2.726 2.726 0 01-1.135 1.134c-.489.262-.974.401-2.31.401h-7.31c-1.336 0-1.821-.14-2.31-.4A2.726 2.726 0 01.4 12.464C.139 11.976 0 11.491 0 10.155v-6.31c0-1.336.14-1.821.4-2.31A2.726 2.726 0 011.536.4C2.024.139 2.509 0 3.845 0zM20.8 2.897a1 1 0 01.2.6v7.006a1 1 0 01-1.6.8L17.2 9.65a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652a1 1 0 011.4.199z"},void 0)}),void 0)},p=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"18",width:"18",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M11.112 12.259c1.354-1.354 3.486-1.48 4.903-.287l1.025.863c1.168.983 1.287 2.757.263 3.96a3.318 3.318 0 01-2.195 1.133c-3.273.44-6.707-1.137-10.303-4.733C1.21 9.6-.369 6.165.072 2.892a3.25 3.25 0 01.159-.752c.19-.56.527-1.058.974-1.443C2.41-.327 4.181-.21 5.165.96l.862 1.024c1.194 1.416 1.07 3.55-.284 4.903l-.736.735a.712.712 0 00-.164.748c.267.732.95 1.645 2.046 2.74 1.096 1.097 2.01 1.78 2.74 2.048.26.095.553.03.749-.166z"},void 0)}),void 0)},f=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"14",width:"14",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M13.3.7a.99.99 0 00-1.4 0L7 5.6 2.1.7A.99.99 0 00.7 2.1L5.6 7 .7 11.9a.99.99 0 001.4 1.4L7 8.4l4.9 4.9a.99.99 0 001.4-1.4L8.4 7l4.9-4.9a.99.99 0 000-1.4z"},void 0)}),void 0)},h=function(e){var n=e.id,t=e.className,a=e.children,r=(0,l.useMemo)((function(){return"radial-gradient(circle, rgb("+(48+Math.abs(n)%3*4)+","+(48+Math.abs(n)%4*5)+","+(52+Math.abs(n)%5*6)+") 40%, #0a0a0a 100%)"}),[]),c=(0,s.classNames)("BlurredBackground",t);return(0,o.jsx)("div",(0,i.__assign)({className:c,style:{background:r}},{children:a}),void 0)},g=t(3065);function m(e){var n=e.title,t=e.description,a=e.className;return(0,o.jsxs)("header",(0,i.__assign)({className:(0,s.classNames)("IncomingCallHeader",a)},{children:[(0,o.jsx)("h1",(0,i.__assign)({className:"IncomingCallHeader__title"},{children:n}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"IncomingCallHeader__description"},{children:t}),void 0)]}),void 0)}var A=(0,l.forwardRef)((function(e,n){var t,a=e.type,r=e.isActive,l=e.icon,c=e.className,d=e.disabled,u=void 0!==d&&d,_=(0,i.__rest)(e,["type","isActive","icon","className","disabled"]),v=(0,s.classNames)("CallIconButton",c,"CallIconButton--withAnimation",((t={"CallIconButton--active":r,"CallIconButton--disabled":u})["CallIconButton--"+a]=!!a,t)),p=(0,i.__assign)((0,i.__assign)({},_),{onMouseDown:function(e){e.preventDefault(),_.onMouseDown&&_.onMouseDown(e)}});return(0,o.jsx)("button",(0,i.__assign)({},p,{className:v,ref:n},{children:l}),void 0)})),C=t(97404),E=t(71192);function S(e){var n=e.id,t=e.photo,a=e.title,r=e.description,s=e.onCollapseCall,c=e.children,d=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("section",(0,i.__assign)({className:"IncomingCall"},{children:[(0,o.jsx)(h,{id:n},void 0),(0,o.jsx)(C.default,(0,i.__assign)({position:"b",text:d("calls_collapse"),marginTop:-6},{children:(0,o.jsx)(A,{type:"collapse",className:"IncomingCall__collapse",onClick:s},void 0)}),void 0),(0,o.jsx)(m,{title:a,description:r},void 0),(0,o.jsx)(g.CallPhoto,{id:n,waves:!0,photo:t,alt:a||"",className:"IncomingCall__photo"},void 0),(0,o.jsx)("footer",(0,i.__assign)({className:"IncomingCall__footer"},{children:c}),void 0)]}),void 0)}var I=t(30365),T=function(){function e(e,n,t){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=t||function(){},this.prepareFunc=n||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),n=this.iterCur;n<e;n++){var t=this.list[n];try{t._order=n}catch(e){}this.add(t)}this.iterCur=n,n>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var n,t={},a=(n=e,n.replace(/&#(\d\d+);/g,(function(e,n){return(n=!0===(t=n)?1:parseInt(t)||0)>=32?String.fromCharCode(n):e;var t})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),i=a.length;i--;){var o=a[i],r="";if(o){for(var s=0;s<6;s++){var l=o.charCodeAt(s);if(l){var c=this.toTranslit[l],d=o.substr(s,1);r+=null!=c?c:d}}t[r]=1}}return t},e.prototype.strToSearchPrefixes=function(e){for(var n=[],t=e.toLowerCase().split(this.delimiter),a=t.length;a--;){var i={},o=t[a],r="",s="",l="",c=o.length>1;if(o){for(var d=0;d<6;d++){var u=o.charCodeAt(d);if(u){var _=this.toTranslit[u],v=o.substr(d,1);if(r+=null!=_?_:v,c){var p=this.toLocalCase[v],f=this.toLocalTranslit[u];s+=null!=p?p:v,l+=null!=f?f:v}}}i[r]=1,c&&(i[s]=2,i[l]=3),n.push(i)}}return n},e.prototype.toIndexTree=function(e,n){for(var t=this.index,a=0;a<6;a++){var i=e.substr(a,1)||-1;t=t[i]?t[i]:t[i]=5==a?[]:{}}t.push(n)},e.prototype.remove=function(e){var n=this.prepareFunc(e),t=this.strToPrefixes(n);for(var a in t)if(t.hasOwnProperty(a)){for(var i=this.index,o=0;o<6;o++){var r=a.substr(o,1)||-1;if(!i[r])break;i=i[r]}if(i.length)for(var o in i)if(this.equals(i[o],e)){i.splice(o,1);break}}},e.prototype.equals=function(e,n){for(var t in e)if(e.hasOwnProperty(t))switch(typeof e[t]){case"object":if(!this.equals(e[t],n[t]))return!1;break;case"function":if(void 0===e[t]||e[t].toString()!=n[t].toString())return!1;break;default:if(e[t]!=n[t])return!1}for(var t in n)if(void 0===n[t])return!1;return!0},e.prototype.intersect=function(e,n){var t=[];if(x(e[0])||x(n[0]))return e.filter((function(e){return-1!==n.indexOf(e)}));for(;e.length>0&&n.length>0;)if(e[0]._order<n[0]._order)e.shift();else if(e[0]._order>n[0]._order)n.shift();else{if(this.equals(e[0],n[0])){var a=e.shift();a&&t.push(a)}n.shift()}return t},e.prototype.add=function(e){var n=this.prepareFunc(e),t=this.strToPrefixes(n);for(var a in t)t.hasOwnProperty(a)&&this.toIndexTree(a,e)},e.prototype.search=function(e){var n=this.index,t=this.strToSearchPrefixes(e),a=[],i=!1;for(var o in t)if(t.hasOwnProperty(o)){if(i&&!a)break;var r=this.localSearch(t[o],0,n);r.sort((function(e,n){return e._order-n._order})),a=i?this.intersect(a,r):r,i=!0}for(var s=a[0],l=a.length+1,c=[],d=1;d<l;d++){var u=a[d];u!=s&&(c.push(s),s=u)}return c},e.prototype.localSearch=function(e,n,t){if(!t)return[];var a={};for(var i in e)e.hasOwnProperty(i)&&(a[r=i.substr(n,1)||-1]||(a[r]={}),a[r][i]=1);if(6==n++)return t;var o=[];for(var r in a)if("-1"===r)for(var s in t)t.hasOwnProperty(s)&&o.push.apply(o,this.localSearch(a[r],n,t[s]));else{var l=this.localSearch(a[r],n,t[r]);o.push.apply(o,l)}return o},e}();function x(e){return!isNaN(e)}var y=function(e,n,t){var a=(0,l.useRef)(null);a.current=a.current?a.current:new T(e,n);var o=a.current,r=(0,l.useCallback)((function(e){return e.reduce((function(e,n){return e[t(n)]=!0,e}),{})}),[]),s=(0,i.__read)((0,l.useState)(e),2),c=s[0],d=s[1],u=(0,i.__read)((0,l.useState)(r(e)),2),_=u[0],v=u[1];return(0,l.useEffect)((function(){var n=r(e),a=e.filter((function(e){return!_[t(e)]})),i=c.filter((function(e){return!n[t(e)]}));(a.length||i.length)&&(a.forEach((function(e){o.add(e)})),i.forEach((function(e){o.remove(e)})),d(e),v(n))}),[e]),o};var N=t(10930),b=function(e){var n=e.onClose,t=e.onBackdropClick,a=e.isIncoming,r=void 0!==a&&a,c=e.isCautionBoxShown,_=void 0!==c&&c,v=e.children,p=u(),f=(0,l.useContext)(N.ConfigContext).withAnimation,h=(0,s.classNames)("CallModal",{"CallModal--withAnimation":f,"CallModal--isIncoming":r});(0,l.useEffect)((function(){return document.body.classList.add("layers_shown"),function(){document.body.classList.remove("layers_shown")}}),[]);var g=(0,l.useCallback)((function(){return _?void p({type:d.E_ACTION.SHOW_CAUTION_BOX,isOpen:!0,isIncoming:r||!1}):n()}),[_]);return(0,o.jsx)(I.default,(0,i.__assign)({className:h,disableBodyScroll:!0,onClose:g,onBackdropClick:t},{children:v}),void 0)},M=t(67921),w=t(73294);function O(e){var n=e.SDK,t=e.bridge,r=(0,c.useSelector)((function(e){return e})),s=r.peer,h=r.callData,g=r.participants,m=r.caller,A=u(),C=(0,l.useContext)(E.LangContext).getLang,I=m;I||(I=(0,M.isGroupCallByPeer)(s)?h.conversation:g[s]);var T=h.type===d.CallType.VIDEO,x=C(T?"calls_incoming_videocall":"calls_incoming_audiocall"),y=C(T?"calls_reply_with_audio":"calls_reply"),N=C(T?"calls_reject_call":"calls_reject"),O=function(){n.declineCall(),w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:h.callId,peer_id:s,is_group_call:(0,M.isGroupCallByPeer)(s),reason:"none"})};return(0,o.jsx)(b,(0,i.__assign)({onClose:O,isIncoming:!0,isCautionBoxShown:!0},{children:(0,o.jsx)(S,(0,i.__assign)({id:s,title:(null==I?void 0:I.tab)||"",description:x,photo:(null==I?void 0:I.photo)||"",onCollapseCall:function(){A({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.COLLAPSED})}},{children:(0,o.jsxs)(o.Fragment,{children:[T&&(0,o.jsx)(_,{text:C("calls_reply_with_video"),type:a.POSITIVE,icon:(0,o.jsx)(v,{},void 0),onClick:function(){return t.acceptCall(!0,!0)}},void 0),(0,o.jsx)(_,{text:y,type:T?a.REGULAR:a.POSITIVE,icon:(0,o.jsx)(p,{},void 0),onClick:function(){return t.acceptCall(!1,!0)}},void 0),(0,o.jsx)(_,{text:N,type:a.NEGATIVE,icon:(0,o.jsx)(f,{},void 0),onClick:O},void 0)]},void 0)}),void 0)}),void 0)}var P=c.useSelector,k=t(15464);function L(){var e=P((0,l.useCallback)((function(e){return e.devices}),[])),n=P((0,l.useCallback)((function(e){return e.participantsChunk}),[]));return(0,l.useMemo)(k.getActiveDevicesCount,[e,n])}function D(e,n){return"/video"+e+"_"+n}function R(e){var n=document.createElement("video"),t=function(){n.classList.add("Video--visible"),n.removeEventListener("loadeddata",t)};return n.addEventListener("loadeddata",t),n.autoplay=!0,n.controls=!1,n.crossOrigin="anonymous",n.playsInline=!0,n.preload="metadata",n.srcObject=e,n.volume=0,n}var j=new WeakMap,B=(0,l.memo)((function(e){var n=e.stream,t=e.participantId,a=e.isMirrored,i=void 0!==a&&a,r=e.isContained,c=void 0!==r&&r,d=e.isStartWithVisible,u=void 0!==d&&d,_=e.isLocalSchreenShare,v=void 0!==_&&_,p=e.className,f=(0,l.useRef)(null),h=(0,l.useRef)(null),g=(0,l.useRef)(n);return(0,l.useEffect)((function(){var e,a,o,r;if(!(null===(e=f.current)||void 0===e?void 0:e.lastElementChild)||g.current!==n){var l=u;if(n&&(j.has(n)?null===(null===(a=j.get(n))||void 0===a?void 0:a.closest("body"))?(h.current=null!==(o=j.get(n))&&void 0!==o?o:null,l=!0):(h.current=R(n),h.current.dataset.participantId=t):(h.current=R(n),h.current.dataset.participantId=t,j.set(n,h.current))),h.current&&h.current.dataset.participantId!==t){var d=h.current;d.dataset.participantId=t,d.srcObject=null,d.srcObject=n;var _=function(){d.classList.add("Video--visible"),d.removeEventListener("loadeddata",_)};d.addEventListener("loadeddata",_),l=!1,d.classList.remove("Video--visible")}if(h.current&&f.current&&f.current.lastElementChild!==h.current){var p=(0,s.classNames)("Video",{"Video--contain":c,"Video--mirrored":i,"Video--visible":l||(null===(r=h.current)||void 0===r?void 0:r.classList.contains("Video--visible"))});f.current.lastElementChild&&(f.current.innerHTML=""),h.current.className=p,f.current.appendChild(h.current),h.current.play()}var m=function(){if(!v)return function(){return null};var e=n.getVideoTracks()[0],t=function(){h.current&&(h.current.srcObject=h.current.srcObject)};return null==e||e.addEventListener("mute",t),function(){return null==e?void 0:e.removeEventListener("mute",t)}}();return function(){m(),h.current&&h.current!==j.get(n)&&(h.current.srcObject=null,h.current.src="",h.current.pause(),h.current.removeAttribute("src"),h.current.load()),f.current&&(f.current.innerHTML="")}}}),[n,f.current,t]),(0,l.useEffect)((function(){h.current&&h.current.classList.toggle("Video--mirrored",i)}),[i]),(0,o.jsx)("div",{ref:f,className:p},void 0)})),U=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 21 24"},n,{children:(0,o.jsx)("path",{d:"M21.442 10.058c.513.77.588 1.831.192 2.663l-2.679 5.625C17.435 21.538 13.54 24 9.998 24H9c-4.422 0-8-3.58-8-8.009V8.128a2.746 2.746 0 013.5-2.642v-.732a2.75 2.75 0 013.571-2.629A2.749 2.749 0 0110.75 0c1.47 0 2.67 1.15 2.746 2.604A2.748 2.748 0 0117 5.254v4.264c1.299-1.278 3.357-1.087 4.442.54zM3.75 7.383a.746.746 0 00-.75.745v7.863A5.998 5.998 0 009 22h.998c2.773 0 5.964-2.02 7.152-4.514l2.678-5.625a.787.787 0 00-.05-.694c-.428-.642-1.123-.65-1.55-.01l-2.177 3.267c-.576.864-1.051.726-1.051-.323V5.255a.748.748 0 00-.75-.755.746.746 0 00-.75.747v5.757c0 .55-.448.996-1 .996-.556 0-1-.446-1-.995V2.752a.75.75 0 10-1.5 0v8.253c0 .54-.448.995-1 .995-.556 0-1-.446-1-.997v-6.25A.756.756 0 007.25 4a.75.75 0 00-.75.754v6.738c0 .551-.448 1.008-1 1.008-.556 0-1-.447-1-.999V8.138a.751.751 0 00-.75-.755z"},void 0)}),void 0)},H=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"56",height:"56",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("path",{d:"M28.5 37.5A1.5 1.5 0 0030 36V22.622l4.94 4.939a1.5 1.5 0 002.007.103l.114-.103a1.5 1.5 0 000-2.122l-7.5-7.5a1.5 1.5 0 00-2.122 0l-7.5 7.5a1.5 1.5 0 002.122 2.122l4.938-4.939L27 36a1.5 1.5 0 001.355 1.493l.145.007z"},void 0),(0,o.jsx)("path",{d:"M19.883 8c-5.019 0-7.117.465-9.244 1.603a10.924 10.924 0 00-4.536 4.536C4.965 16.266 4.5 18.364 4.5 23.383v9.234c0 5.019.465 7.117 1.603 9.244a10.924 10.924 0 004.536 4.536C12.766 47.535 14.864 48 19.883 48h17.234c5.019 0 7.117-.465 9.244-1.603a10.924 10.924 0 004.536-4.536c1.138-2.127 1.603-4.225 1.603-9.244v-9.234c0-5.019-.465-7.117-1.603-9.244a10.924 10.924 0 00-4.536-4.536C44.234 8.465 42.136 8 37.117 8H19.883zm-7.83 4.248c1.486-.794 3-1.248 7.83-1.248h17.234c4.83 0 6.344.454 7.83 1.248a7.925 7.925 0 013.305 3.306c.794 1.485 1.248 3 1.248 7.83v9.233c0 4.83-.454 6.344-1.248 7.83a7.925 7.925 0 01-3.306 3.305c-1.485.794-3 1.248-7.83 1.248H19.884c-4.83 0-6.344-.454-7.83-1.248a7.925 7.925 0 01-3.305-3.306c-.794-1.485-1.248-3-1.248-7.83v-9.233c0-4.83.454-6.344 1.248-7.83a7.925 7.925 0 013.306-3.305z"},void 0)]}),void 0)};function V(e){var n=e.isInverted,t=(0,s.classNames)("CallingStatus",{"CallingStatus--inverted":!!n}),a=(0,s.classNames)("CallingStatus__part","CallingStatus__part--withAnimation");return(0,o.jsxs)("div",(0,i.__assign)({className:t},{children:[(0,o.jsx)("span",{className:a},void 0),(0,o.jsx)("span",{className:a},void 0),(0,o.jsx)("span",{className:a},void 0)]}),void 0)}var G=t(53996),F=t(63192);const Z=(0,F.makeIcon)("Icon16MicrophoneSlash","microphone_slash_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="microphone_slash_16"><path d="M5.498 7.06v.44a2.501 2.501 0 0 0 2.909 2.467l1.2 1.198a4.005 4.005 0 0 1-5.521-2.822.75.75 0 0 0-1.47.314A5.508 5.508 0 0 0 7.25 12.95v1.301a.75.75 0 0 0 1.502 0v-1.3a5.473 5.473 0 0 0 1.972-.669l1.25 1.25a.751.751 0 0 0 1.062-1.061L3.88 3.32a.75.75 0 1 0-1.06 1.06l2.678 2.68Zm6.356 1.529c-.089.314-.03.66.2.89.37.37.993.284 1.16-.211a5.44 5.44 0 0 0 .17-.61.75.75 0 1 0-1.469-.315 3.945 3.945 0 0 1-.061.246ZM6.303 2.662c-.332.307-.254.818.066 1.138l3.428 3.424a.4.4 0 0 0 .683-.279l.022-2.445a2.501 2.501 0 0 0-4.199-1.838Z" /></symbol>',16,16,!1,void 0),W=(0,F.makeIcon)("Icon16Connection","connection_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="connection_16"><path d="M12 2a1 1 0 0 0-1 1v10a1 1 0 1 0 2 0V3a1 1 0 0 0-1-1ZM7 5.5a1 1 0 0 1 2 0V13a1 1 0 1 1-2 0V5.5ZM3 8a1 1 0 0 1 2 0v5a1 1 0 1 1-2 0V8Z" /></symbol>',16,16,!1,void 0);var z,K;!function(e){e.VkCalls="vkcalls",e.Sferum="sferum"}(K||(K={}));var Q=function(){function e(){}return e.setAppType=function(n){e._appType=n},e.getAppType=function(){return e._appType},e.getLsKeys=function(){return e._lsKeysMap[e._appType]},e._appType=K.VkCalls,e._lsKeysMap=((z={})[K.VkCalls]=d.LS_KEYS,z[K.Sferum]=d.LS_SFERUM_KEYS,z),e}(),Y={queryOption:function(e){return Y.getOptions()[e]},getOptions:function(){try{var e=Q.getLsKeys(),n=localStorage.getItem(e.VIDEO_OPTIONS);if("string"!=typeof n)throw new Error("no value stored");return JSON.parse(n)}catch(e){return Y.getDefaultOptions()}},saveOption:function(e,n){var t,a=(0,i.__assign)((0,i.__assign)({},Y.getOptions()),((t={})[e]=n,t)),o=Q.getLsKeys();return localStorage.setItem(o.VIDEO_OPTIONS,JSON.stringify(a)),a},saveOptions:function(e){var n=Q.getLsKeys();return localStorage.setItem(n.VIDEO_OPTIONS,JSON.stringify(e)),e},getDefaultOptions:function(){return{calls_is_video_mirrored:!0}}},J=function(){var e=Q.getLsKeys(),n=localStorage.getItem(e.VIRTUAL_BACKGROUND_EFFECT);return"string"!=typeof n?d.EVideoEffectType.NONE:/^\d+$/.test(n)?+n:n},X=function(e){var n=Q.getLsKeys();localStorage.setItem(n.VIRTUAL_BACKGROUND_EFFECT,""+e)},q=function(){var e=Q.getLsKeys(),n=localStorage.getItem(e.VIRTUAL_BACKGROUND_EFFECT_SELECTED_TS);return"string"!=typeof n?0:+n},$=function(e){var n=Q.getLsKeys();localStorage.setItem(n.VIRTUAL_BACKGROUND_EFFECT_SELECTED_TS,""+e)},ee=function(){var e=Q.getLsKeys();localStorage.removeItem(e.VIRTUAL_BACKGROUND_EFFECT_SELECTED_TS)},ne=function(){var e=(0,c.useSelector)((function(e){return e.virtualBackgroundSettings.videoOptions})),n=u(),t=(0,i.__read)((0,l.useState)(Y.getOptions),2),a=t[0],o=t[1],r=(0,l.useCallback)((function(){o(Y.getOptions())}),[]),_=(0,l.useCallback)((function(){Y.saveOptions(a),n({type:d.E_ACTION.VB_SET_VIDEO_OPTIONS,videoOptions:a})}),[a]),v=(0,l.useCallback)((function(e,n){o((function(t){var a;return(0,i.__assign)((0,i.__assign)({},t),((a={})[e]=n,a))}))}),[]);return(0,l.useEffect)((function(){(0,s.isEqual)(e,a)||n({type:d.E_ACTION.VB_SET_VIDEO_OPTIONS,videoOptions:a})}),[]),{videoOptions:a,storedVideoOptions:e,setVideoOptions:o,onRestoreSettings:r,onSaveSettings:_,onChangeVideoOption:v}},te=t(4495),ae=t(13984),ie=t(70226),oe=function(e){var n=e.item,t=e.setOpen,a=n.disabled,r=void 0!==a&&a,l=(0,s.classNames)("CallsDropdown__button",{"CallsDropdown__button--disabled":r});return"href"in n?(0,o.jsx)("a",(0,i.__assign)({href:n.href,rel:"noopener noreferrer",target:"_blank",onClick:r?void 0:function(e){e.stopPropagation(),"onClick"in n&&void 0!==n.onClick&&n.onClick(e),t(!1)},className:l},{children:n.text}),void 0):"onClick"in n?(0,o.jsxs)("button",(0,i.__assign)({onClick:r?void 0:function(e){e.stopPropagation(),n.onClick(e),t(!1)},className:l},{children:[(0,o.jsx)(ae.default,(0,i.__assign)({className:"CallsDropdown__row-title"},{children:String(n.text)}),void 0),void 0!==n.isEnabled&&(0,o.jsx)(ie.default,{className:"CallsDropdown__switch",checked:n.isEnabled},void 0)]}),void 0):null},re=function(e){var n=e.isListEdge;return(0,o.jsx)("div",{className:(0,s.classNames)({CallsDropdown__separator:!n})},void 0)},se=function(e){var n=e.children,t=e.items,a=e.open,r=void 0!==a&&a,c=e.setOpen,d=e.placement,u=e.className;return(0,o.jsx)(te.Dropdown,(0,i.__assign)({placement:d,onShownChange:c,content:(0,o.jsx)("ul",(0,i.__assign)({className:(0,s.classNames)("CallsDropdown",u)},{children:t.map((function(e,n,t){return(0,o.jsx)("li",(0,i.__assign)({className:"CallsDropdown__item"},{children:"separator"in e?(0,o.jsx)(re,{isListEdge:!n||t.length-1===n},void 0):(0,o.jsx)(oe,{item:e,setOpen:c},void 0)}),e.key||n)}))}),void 0),shown:r},{children:(0,l.cloneElement)(n,(0,i.__assign)((0,i.__assign)({},n.props),{"data-active":r}))}),void 0)},le=t(11099);const ce=(0,F.makeIcon)("Icon16LogoVkVideo","logo_vk_video_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="logo_vk_video_16"><path fill-rule="evenodd" d="M12.96 12.025c.04-.543.04-1.201.04-1.972V5.947c0-.77 0-1.43-.04-1.972-.042-.57-.133-1.13-.379-1.674a4.75 4.75 0 0 0-.838-1.27c.64.038 1.095.126 1.482.323a3.25 3.25 0 0 1 1.42 1.42C15 3.47 15 4.38 15 6.2v3.6c0 1.82 0 2.73-.354 3.425a3.25 3.25 0 0 1-1.42 1.42c-.388.198-.842.286-1.483.324.343-.372.627-.8.838-1.27.246-.544.337-1.104.38-1.674Zm-7.802-5.68a.056.056 0 0 1 .01-.025.05.05 0 0 1 .016-.013.051.051 0 0 1 .02-.007c.004 0 .013 0 .028.005A8.29 8.29 0 0 1 7.98 7.961c.01.01.014.017.016.02a.049.049 0 0 1 .004.02.049.049 0 0 1-.004.02.061.061 0 0 1-.016.02 8.29 8.29 0 0 1-2.741 1.654.063.063 0 0 1-.028.005.052.052 0 0 1-.02-.007.05.05 0 0 1-.017-.013.056.056 0 0 1-.01-.024 8.506 8.506 0 0 1-.006-3.312Zm-3.804-3.57C1 3.47 1 4.38 1 6.2v3.6c0 1.82 0 2.73.354 3.425a3.25 3.25 0 0 0 1.42 1.42C3.47 15 4.397 15 6.25 15c1.854 0 2.78 0 3.475-.354a3.25 3.25 0 0 0 1.42-1.42c.355-.696.355-1.606.355-3.426V6.2c0-1.82 0-2.73-.354-3.425a3.25 3.25 0 0 0-1.42-1.42C9.03 1 8.102 1 6.25 1c-1.854 0-2.78 0-3.475.354a3.25 3.25 0 0 0-1.42 1.42Zm2.333 3.28a1.55 1.55 0 0 1 2.055-1.16 9.79 9.79 0 0 1 3.245 1.954 1.55 1.55 0 0 1 0 2.304 9.79 9.79 0 0 1-3.237 1.952c-.9.326-1.869-.22-2.056-1.155a10.006 10.006 0 0 1-.007-3.894Z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0),de=(0,F.makeIcon)("Icon16ArrowUpRectangle","arrow_up_rectangle_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="arrow_up_rectangle_16"><path fill-rule="evenodd" d="M10.281 2H5.72c-.674 0-1.225 0-1.672.037-.463.037-.882.118-1.272.317a3.25 3.25 0 0 0-1.42 1.42c-.2.391-.28.81-.318 1.273C1 5.494 1 6.045 1 6.719V9.28c0 .674 0 1.224.037 1.672.037.463.118.882.317 1.273a3.25 3.25 0 0 0 1.42 1.42c.391.199.81.28 1.273.317.447.037.998.037 1.672.037h4.562c.674 0 1.224 0 1.672-.037.463-.037.882-.118 1.273-.317a3.25 3.25 0 0 0 1.42-1.42c.199-.391.28-.81.317-1.273C15 10.505 15 9.954 15 9.28V6.72c0-.674 0-1.225-.037-1.672-.037-.463-.118-.882-.317-1.272a3.25 3.25 0 0 0-1.42-1.42c-.391-.2-.81-.28-1.273-.318C11.506 2 10.955 2 10.281 2ZM7.78 4.1l-2.2 2.398A.3.3 0 0 0 5.8 7h1.45v4.25a.75.75 0 0 0 1.5 0V7h1.448a.3.3 0 0 0 .221-.503L8.221 4.101a.3.3 0 0 0-.442 0Z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0),ue=(0,F.makeIcon)("Icon16Videocam","videocam_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="videocam_16"><path fill-rule="evenodd" d="M1.772 4.865C1.5 5.4 1.5 6.1 1.5 7.5v1c0 1.4 0 2.1.272 2.635a2.5 2.5 0 0 0 1.093 1.092C3.4 12.5 4.1 12.5 5.5 12.5h2c1.4 0 2.1 0 2.635-.273a2.5 2.5 0 0 0 1.092-1.092C11.5 10.6 11.5 9.9 11.5 8.5v-1c0-1.4 0-2.1-.273-2.635a2.5 2.5 0 0 0-1.092-1.093C9.6 3.5 8.9 3.5 7.5 3.5h-2c-1.4 0-2.1 0-2.635.272a2.5 2.5 0 0 0-1.093 1.093Zm10.95 1.487 1.876-1.25a.58.58 0 0 1 .902.482v4.832a.58.58 0 0 1-.902.483l-1.875-1.25a.5.5 0 0 1-.223-.417V6.768a.5.5 0 0 1 .223-.416Z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0);var _e=function(e){switch(e){case G.MediaType.STREAM:case G.MediaType.MOVIE:return(0,o.jsx)(ce,{},void 0);case G.MediaType.SCREEN:return(0,o.jsx)(de,{},void 0);case G.MediaType.CAMERA:default:return(0,o.jsx)(ue,{},void 0)}};const ve=(0,F.makeIcon)("Icon16PinDot","pin_dot_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="pin_dot_16"><path d="M6.25 4a1.25 1.25 0 1 0 0-2.5 1.25 1.25 0 0 0 0 2.5Z" /><path d="m13.892 5.77-3.657-3.664c-.231-.232-.634-.057-.634.263v.526a.896.896 0 0 1-.263.634L7.623 5.244a.895.895 0 0 1-.633.262H3.995c-.565 0-.847.71-.455 1.102l2.29 2.29-3.569 3.574a.894.894 0 0 0 1.263 1.264l3.57-3.572 2.301 2.301c.402.402 1.101.098 1.101-.456V9.013a.9.9 0 0 1 .262-.633l1.715-1.715a.895.895 0 0 1 .633-.263h.523c.327 0 .488-.407.263-.633Z" /></symbol>',16,16,!1,void 0),pe=(0,F.makeIcon)("Icon16Pin","pin_16","0 0 16 16",'<symbol fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" id="pin_16"><path d="m10.235 2.106 3.657 3.663c.225.226.064.633-.263.633h-.523a.895.895 0 0 0-.633.263L10.758 8.38a.896.896 0 0 0-.262.633v2.996c0 .554-.7.858-1.1.456l-2.301-2.3-3.57 3.57a.893.893 0 1 1-1.264-1.263L5.83 8.898l-2.29-2.29c-.391-.392-.109-1.102.456-1.102H6.99a.895.895 0 0 0 .633-.262L9.338 3.53a.896.896 0 0 0 .263-.634V2.37c0-.32.403-.495.634-.263z" fill="currentColor" /></symbol>',16,16,!1,void 0),fe=(0,F.makeIcon)("Icon16MoreVertical","more_vertical_16","0 0 8 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 8 16" id="more_vertical_16"><path fill="currentColor" d="M4 4.5c.825 0 1.5-.675 1.5-1.5S4.825 1.5 4 1.5 2.5 2.175 2.5 3 3.175 4.5 4 4.5Zm0 2c-.825 0-1.5.675-1.5 1.5S3.175 9.5 4 9.5 5.5 8.825 5.5 8 4.825 6.5 4 6.5Zm0 5c-.825 0-1.5.675-1.5 1.5s.675 1.5 1.5 1.5 1.5-.675 1.5-1.5-.675-1.5-1.5-1.5Z" /></symbol>',8,16,!1,void 0);const he=function(e){var n=e.isPinned,t=e.isPinnedByAdmin,a=e.isActionsAvailable,r=e.actions,s=e.availableStreamModes,c=(0,l.useContext)(E.LangContext).getLang,d=(0,l.useContext)(N.ConfigContext).withAnimation,u=(0,i.__read)((0,l.useState)(!1),2),_=u[0],v=u[1],p=(0,le.classNames)("Participant__more",{"Participant__more--withAnimation":d}),f=s&&s.filter((function(e){return e!==G.MediaType.CAMERA})),h=n||t,g=a&&r&&r.length>0,m=!!f&&!!f.length;return h||g||t||m?(0,o.jsxs)("header",(0,i.__assign)({className:"Participant__header"},{children:[m&&(0,o.jsx)("div",(0,i.__assign)({className:"Participant__streamModes"},{children:f.map((function(e){return(0,l.cloneElement)(_e(e),{key:e})}))}),void 0),h&&(t?(0,o.jsx)(ve,{className:"Participant__pin"},void 0):(0,o.jsx)(pe,{className:"Participant__pin"},void 0)),g&&(0,o.jsx)(se,(0,i.__assign)({className:"Participant__Dropdown",items:r,open:_,setOpen:v},{children:(0,o.jsx)("button",(0,i.__assign)({className:p,"aria-label":c("calls_actions")},{children:(0,o.jsx)(fe,{},void 0)}),void 0)}),void 0)]}),void 0):null};var ge=(0,l.memo)((function(e){var n=e.externalId,t=e.isVisible,a=void 0===t||t,r=e.isOrator,c=void 0!==r&&r,u=e.isInfoShown,_=e.isPinned,v=e.isPinnedByAdmin,p=e.isHandRaised,f=e.photo,m=e.hasVideo,A=e.hasAudio,C=e.hasMovieStream,S=e.isSharingScreen,I=e.isSpeaking,T=void 0!==I&&I,x=e.streamData,y=e.isMe,b=void 0!==y&&y,M=e.name,w=e.letter,O=e.status,P=void 0===O?G.ParticipantStatus.CONNECTED:O,L=e.wasConnected,D=void 0===L||L,R=e.networkStatus,j=void 0===R?1:R,F=e.onClickParticipant,z=e.onDblClickParticipant,K=e.onStopScreenShare,Q=e.allowContain,Y=e.actions,J=e.availableStreamModes,X=e.streamMode,q=e.className,$=(0,l.useContext)(E.LangContext).getLang,ee=(0,l.useContext)(N.ConfigContext),te=ee.withAnimation,ae=ee.anonymPhoto,ie=(0,l.useRef)(null),oe=(0,k.isParticipantAnonym)(n),re=ne().storedVideoOptions,se=(0,k.externalIdToString)(n),le=!!F||!!z,ce=c&&S&&b,de=m&&(!ce||X===G.MediaType.CAMERA),ue=x&&x.data&&(de||C),_e=(0,s.classNames)("Participant",{"Participant--isInteractive":le,"Participant--isPinned":_,"Participant--isSpeaking":T,"Participant--isOrator":c,"Participant--withAnimation":te},q),ve=(0,l.useCallback)((function(e){F&&F(e,n)}),[F]),pe=(0,l.useCallback)((function(e){z&&z(e,n)}),[z]),fe=(0,s.classNames)({Participant__offsetCard:u,Participant__oratorPhoto:c}),ge=(0,s.classNames)("Participant__main",{"Participant__main--video":!c});return(0,o.jsxs)("div",(0,i.__assign)({className:"Participant__wrapper"},{children:[(0,o.jsx)(he,{isPinnedByAdmin:v,isPinned:_,isActionsAvailable:a,actions:Y,availableStreamModes:J},void 0),(0,o.jsxs)("article",(0,i.__assign)({ref:ie,className:_e,onClick:ve,onDoubleClick:pe,"participant-id":se},{children:[!a&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(h,(0,i.__assign)({id:+n.id,className:"Participant__main"},{children:(0,o.jsx)(g.CallPhoto,{id:+n.id,photo:!ae&&oe?"":f,alt:M||"",letter:w,className:fe},void 0)}),void 0),u&&(0,o.jsxs)("footer",(0,i.__assign)({className:"Participant__footer"},{children:[(0,o.jsx)("span",(0,i.__assign)({className:"Participant__name"},{children:M}),void 0),(D||b)&&!A&&(0,o.jsx)(Z,{className:"Participant__statusIcon--mic"},void 0)]}),void 0)]},void 0),a&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(h,(0,i.__assign)({id:+n.id,className:"Participant__main"},{children:(0,o.jsx)(g.CallPhoto,{id:+n.id,photo:!ae&&oe?"":f,alt:M||"",className:fe},void 0)}),void 0),p&&(0,o.jsx)("div",(0,i.__assign)({className:"Participant__handIndicator"},{children:(0,o.jsx)(U,{className:"Participant__handIcon"},void 0)}),void 0),ce&&X===G.MediaType.SCREEN&&(0,o.jsxs)("div",(0,i.__assign)({className:"Participant__screenSharer"},{children:[(0,o.jsx)(H,{},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"Participant__screenSharerText"},{children:$("calls_you_are_screen_sharer")}),void 0),(0,o.jsx)("button",(0,i.__assign)({className:"Participant__screenSharerButton",onClick:K},{children:$("calls_screen_share_stop")}),void 0)]}),void 0),x&&x.data&&ue&&(0,o.jsx)(B,{className:ge,participantId:se,stream:x.data,isMirrored:b&&x.type===G.MediaType.CAMERA&&re[d.EVideoOptionType.IS_VIDEO_MIRRORED],isContained:Q||S,isStartWithVisible:b,isLocalSchreenShare:b&&S},void 0),P!==G.ParticipantStatus.CONNECTED&&!b&&(0,o.jsx)("div",(0,i.__assign)({className:"Participant__status"},{children:(0,o.jsx)(V,{isInverted:!0},void 0)}),void 0),!c&&u&&(0,o.jsxs)("footer",(0,i.__assign)({className:"Participant__footer"},{children:[(A||x&&x.data||S)&&j<.6&&(0,o.jsx)(W,{fill:j<=.3?"#ff5c5c":"#FECE00"},void 0),(0,o.jsx)("span",(0,i.__assign)({className:"Participant__name"},{children:M}),void 0),(D||b)&&!A&&(0,o.jsx)(Z,{className:"Participant__statusIcon--mic"},void 0)]}),void 0)]},void 0)]}),void 0)]}),void 0)})),me=(0,l.memo)((function(e){var n=(0,k.externalIdToString)(e.externalId),t=P((0,l.useCallback)((function(e){var t;return null===(t=e.speakers)||void 0===t?void 0:t[n]}),[n])),a=e.hasAudio&&t&&e.isVisible;return(0,o.jsx)(ge,(0,i.__assign)({},e,{isSpeaking:a}),void 0)})),Ae=t(25685),Ce=function(){var e,n,t,a,r=(0,Ae.useLang)().getLang,l=P((function(e){var n=e.localDevice,t=e.externalId,a=e.me,i=e.peer,o=e.devices,r=e.participants;return{localDevice:n,peerDevice:(0,k.getPeerIdDeviceInfo)(i,o),meParticipant:t&&r[a],peerParticipant:r[i],externalId:t}})),c=l.externalId,d=l.localDevice,u=l.meParticipant,_=l.peerDevice,v=l.peerParticipant,p=(0,k.isParticipantWithVideo)(d)||(0,k.isParticipantWithMovie)(d),f=!(!_||!(0,k.isParticipantWithVideo)(_)&&!(0,k.isParticipantWithMovie)(_)),h=(0,s.classNames)("OneToOne",{"OneToOne--hasVideo":p,"OneToOne--opponentHasVideo":f});return(0,o.jsxs)("div",(0,i.__assign)({className:h},{children:[(0,o.jsx)("aside",(0,i.__assign)({className:"OneToOne__local"},{children:c&&u&&(0,o.jsx)(ge,{externalId:c,hasVideo:p,hasAudio:!!(null===(e=d.mediaSettings)||void 0===e?void 0:e.isAudioEnabled),isSharingScreen:!!(null===(n=d.mediaSettings)||void 0===n?void 0:n.isScreenSharingEnabled),streamData:(0,k.getStream)(d),isMe:!0,name:r("calls_own_label"),letter:null==u?void 0:u.name.slice(0,1),wasConnected:d.wasConnected,allowContain:!0,networkStatus:d.networkStatus},void 0)}),void 0),(0,o.jsx)("main",(0,i.__assign)({className:"OneToOne__remote"},{children:v&&_&&(0,o.jsx)(ge,{externalId:_.externalId,hasVideo:f,hasAudio:!!(null===(t=_.mediaSettings)||void 0===t?void 0:t.isAudioEnabled),isSharingScreen:!!(null===(a=_.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled),streamData:(0,k.getStream)(_),photo:v.photo,name:v.name,allowContain:!0,wasConnected:_.wasConnected,networkStatus:_.networkStatus},void 0)}),void 0)]}),void 0)},Ee=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M4.3 4.3a1 1 0 011.4 0l6.3 6.29 6.3-6.3a1 1 0 111.4 1.42L13.42 12l6.3 6.3a1 1 0 01-1.42 1.4L12 13.42l-6.3 6.3a1 1 0 01-1.4-1.42L10.58 12l-6.3-6.3a1 1 0 010-1.4z"},void 0)}),void 0)},Se=(0,l.forwardRef)((function(e,n){var t=e.unreadCount,a=void 0===t?0:t,r=(0,i.__rest)(e,["unreadCount"]),c=(0,l.useContext)(N.ConfigContext).withAnimation,d="",u="";switch(!0){case!a:d="none";break;case a<=9:d="single",u=a.toString();break;case a<=99:d="double",u=a.toString();break;case a>99:d="max",u="99+"}var _=(0,s.classNames)("ChatIconButton","ChatIconButton--"+d,{"ChatIconButton--withAnimation":c});return(0,o.jsx)("button",(0,i.__assign)({className:_},r,{ref:n},{children:u&&(0,o.jsx)("div",(0,i.__assign)({className:"ChatIconButton__count "},{children:u}),void 0)}),void 0)})),Ie=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M20.465 4.4c-.489-.26-.974-.4-2.31-.4H5.844c-1.336 0-1.821.14-2.31.4A2.726 2.726 0 002.4 5.536C2.139 6.024 2 6.509 2 7.845v8.31c0 1.336.14 1.821.4 2.31.262.49.646.873 1.135 1.134.489.262.974.401 2.31.401h12.31c1.336 0 1.821-.14 2.31-.4a2.726 2.726 0 001.134-1.135c.262-.489.401-.974.401-2.31v-8.31c0-1.336-.14-1.821-.4-2.31A2.726 2.726 0 0020.464 4.4zm-11.81 5.728l2.97-2.978c.207-.2.543-.2.75 0l2.97 2.978c.33.318.077.872-.376.872H13v4.979c0 .564-.442 1.021-1 1.021s-1-.457-1-1.021V11H9.031c-.44 0-.715-.545-.375-.872z"},void 0)}),void 0)},Te=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M6 5.18c.65 0 1 .54 1 1.2v5.48c0 .22.26.4.47.4.23 0 .52-.18.52-.4V4c0-.66.33-1.2.99-1.2.65 0 1.02.54 1.02 1.2v7.08c0 .22.29.4.5.4.22 0 .5-.18.5-.4V3.19c0-.66.31-1.2.97-1.2.66 0 1.04.54 1.04 1.2v7.88c0 .22.24.4.46.4.22 0 .52-.18.52-.4V4.79c0-.67.32-1.18.98-1.18.66 0 1.02.51 1.02 1.17v10.73l2.29-2.67c.33-.45 1-.68 1.65-.26.34.2.86.81.2 1.68 0 0-2.45 3.09-3.81 4.74-1.3 1.65-3.81 2.5-5.51 2.5C5.25 21.5 5 17.71 5 16.43V6.37c0-.65.33-1.19 1-1.19z"},void 0)}),void 0)},xe=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M6.1 9a.9.9 0 01.9.9v4.2a.9.9 0 11-1.8 0v-2.027l-3.664 3.663a.9.9 0 11-1.272-1.272L3.927 10.8H1.9a.9.9 0 110-1.8zM15.736.264a.9.9 0 010 1.272L12.073 5.2h2.025a.9.9 0 010 1.8H9.9a.9.9 0 01-.9-.9V1.9a.9.9 0 111.8 0v2.027L14.464.264a.9.9 0 011.272 0z"},void 0)}),void 0)},ye=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M6.5 15a1 1 0 01-1 1H1a1 1 0 01-1-1v-4.5a1 1 0 012 0v2.071l3.363-3.364a1 1 0 011.414 0l.016.016a1 1 0 010 1.414L3.428 14H5.5a1 1 0 011 1zM14 3.428l-3.363 3.365a1 1 0 01-1.414 0l-.016-.016a1 1 0 010-1.414L12.571 2H10.5a1 1 0 010-2H15a1 1 0 011 1v4.5a1 1 0 01-2 0z"},void 0)}),void 0)},Ne=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"16",width:"22",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M1.514.242A.9.9 0 00.286 1.558l1.092 1.02C1.13 3.053 1 3.548 1 4.846v6.308c0 1.338.14 1.822.4 2.311.262.49.646.873 1.135 1.134.489.262.974.401 2.31.401h7.31c1.207 0 1.72-.114 2.168-.328l1.163 1.086a.9.9 0 001.228-1.316L1.514.242zM15.999 11.346L4.924 1h7.23c1.338 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31 0 2.167.023 4.335-.001 6.501zM22 4.497v7.006c0 .815-.964 1.277-1.6.8l-2.2-1.653a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652c.651-.49 1.6.003 1.6.8z"},void 0)}),void 0)},be=t(51013),Me=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13.49 4.293a4.402 4.402 0 116.225 6.225l-1.072 1.072a.9.9 0 01-1.273-1.273l1.071-1.072a2.601 2.601 0 10-3.678-3.678l-3.537 3.537a2.601 2.601 0 000 3.678.9.9 0 01-1.274 1.273 4.402 4.402 0 010-6.225l3.537-3.537zm-.708 5.66a.9.9 0 011.273 0 4.402 4.402 0 010 6.225l-3.537 3.537a4.402 4.402 0 11-6.225-6.226l1.122-1.121a.9.9 0 111.273 1.273l-1.121 1.122a2.601 2.601 0 103.678 3.678l3.537-3.537a2.601 2.601 0 000-3.678.9.9 0 010-1.274z",fill:"#fff"},void 0)}),void 0)};const we=(0,F.makeIcon)("Icon24Live","live_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="live_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M12 22.5C6.201 22.5 1.5 17.799 1.5 12S6.201 1.5 12 1.5 22.5 6.201 22.5 12 17.799 22.5 12 22.5Zm0-2a8.5 8.5 0 1 0 0-17 8.5 8.5 0 0 0 0 17Zm0-2a6.5 6.5 0 1 1 0-13 6.5 6.5 0 0 1 0 13Zm0-2a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9Zm0-2a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0);var Oe=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M17 12.5c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714h-6.09c.158-.488.237-1.062.237-1.714 0-1.723-.631-3.067-1.672-4.062.783-.16 1.548-.224 2.172-.224zm-9 0c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714H2.647c-.765 0-1.147-.214-1.147-1.714C1.5 13.357 5.706 12.5 8 12.5zM8 5a3 3 0 110 6 3 3 0 110-6zm9 0a3 3 0 110 6 3 3 0 110-6z"},void 0)}),void 0)},Pe=(0,l.forwardRef)((function(e,n){var t=e.participantCount,r=e.onClick,l=e.isParticipantControlActive,c=(0,o.jsx)(Oe,{},void 0);if(t&&t>0){var d="";(d=t>99?"99+":null==t?void 0:t.toString())&&(c=(0,o.jsxs)("div",{children:[(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)({ParticipantIconButton__count:!0,"ParticipantIconButton__count--lt99":t<=99})},{children:d}),void 0),c]},void 0))}return(0,o.jsx)(_,{type:l?a.OFF:a.ON,icon:c,onClick:r,className:"Call__footerButton",ref:n},void 0)})),ke=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:[(0,o.jsx)("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"},void 0),(0,o.jsx)("path",{d:"M1.1 10c-.551 0-.982.486-.843 1.02A8.007 8.007 0 007.1 16.95v2.15a.9.9 0 101.8 0v-2.15a8.007 8.007 0 006.843-5.93c.139-.534-.292-1.02-.843-1.02-.45 0-.826.329-.953.76a6.203 6.203 0 01-11.894 0C1.926 10.33 1.55 10 1.1 10z"},void 0)]}),void 0)},Le=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M1.721 2.307L4 4.586v-.002l7.029 7.029 4.693 4.695a1 1 0 01-1.414 1.414l-1.938-1.937A8.482 8.482 0 019 16.941V19a1 1 0 01-1.993.117L7.001 19v-2.06c-3.234-.384-5.995-2.611-6.955-5.646a.995.995 0 01.681-1.25 1.035 1.035 0 011.287.662C2.808 13.216 5.257 15 7.999 15c1.03 0 2.016-.25 2.89-.695l-1.538-1.539A4 4 0 014 9V7.414L.307 3.721a1 1 0 011.414-1.414zm13.55 7.737c.544.162.85.72.684 1.249a7.825 7.825 0 01-.75 1.666l-1.51-1.51c.113-.239.21-.487.29-.742a1.035 1.035 0 011.287-.663zM8 0a4 4 0 014 4v5c0 .237-.02.468-.06.694L4.433 2.188A4 4 0 018 0z"},void 0)}),void 0)},De=function(){var e=(0,le.classNames)({MicIconWithSpeakingIndicator__scale:!0});return(0,o.jsxs)("svg",(0,i.__assign)({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",className:"MicIconWithSpeakingIndicator"},{children:[(0,o.jsx)("mask",(0,i.__assign)({id:"MicIconWithSpeakingIndicatorMask"},{children:(0,o.jsx)("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"},void 0)}),void 0),(0,o.jsx)("path",{d:"M1.1 10c-.55 0-.98.49-.84 1.02a8 8 0 006.84 5.93v2.15a.9.9 0 101.8 0v-2.15a8 8 0 006.84-5.93c.14-.53-.29-1.02-.84-1.02-.45 0-.83.33-.95.76a6.2 6.2 0 01-11.9 0c-.12-.43-.5-.76-.95-.76z"},void 0),(0,o.jsx)("g",(0,i.__assign)({mask:"url(#MicIconWithSpeakingIndicatorMask)"},{children:(0,o.jsxs)("g",(0,i.__assign)({className:e},{children:[(0,o.jsx)("path",{d:"M8 0a4 4 0 00-4 4v7h8V4a4 4 0 00-4-4z"},void 0),(0,o.jsx)("path",{d:"M8 7a4 4 0 00-4 4v5a4 4 0 008 0v-5a4 4 0 00-4-4z",className:"MicIconWithSpeakingIndicator__filled"},void 0)]}),void 0)}),void 0)]}),void 0)},Re=(0,l.forwardRef)((function(e,n){var t=e.isAudioAllowed,i=e.isAudioEnabled,r=e.onToggleAudio,s=P((function(e){return!(!e.externalId||!e.speakers[(0,k.externalIdToString)(e.externalId)])})),l=i?s?(0,o.jsx)(De,{},void 0):(0,o.jsx)(ke,{},void 0):(0,o.jsx)(Le,{},void 0),c=t?i?a.ON:a.OFF:a.DISABLED;return(0,o.jsx)(_,{type:c,icon:l,onClick:r,className:"Call__footerButton",ref:n},void 0)})),je=t(91750);const Be=(0,je.makeIcon)("Icon24LogoVkVideo","logo_vk_video_24","0 0 24 24",'<symbol fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="logo_vk_video_24"><path clip-rule="evenodd" d="M16.93 20.97c.885-.058 1.442-.208 2.007-.51a3.681 3.681 0 0 0 1.526-1.526c.412-.77.54-1.526.54-3.115V8.181c0-1.59-.128-2.346-.54-3.115a3.681 3.681 0 0 0-1.526-1.527c-.565-.301-1.123-.45-2.007-.509a7 7 0 0 1 1.537 2.291c.287.694.413 1.44.474 2.328.059.87.059 1.948.059 3.314v2.074c0 1.367 0 2.443-.06 3.314-.06.888-.186 1.634-.473 2.328a6.998 6.998 0 0 1-1.537 2.29zm-8.99.029c-1.426-.013-2.144-.149-2.874-.539a3.681 3.681 0 0 1-1.526-1.526c-.412-.77-.54-1.526-.54-3.115V8.181c0-1.59.128-2.346.54-3.115.35-.656.87-1.176 1.526-1.527.724-.386 1.436-.523 2.84-.538L9 3c1.411 0 2.42 0 3.215.055.786.053 1.29.156 1.698.326a5 5 0 0 1 2.706 2.706c.17.409.273.912.326 1.698C17 8.58 17 9.588 17 11v2c0 1.412 0 2.42-.055 3.215-.053.786-.156 1.29-.326 1.698a5 5 0 0 1-2.706 2.706c-.409.17-.912.273-1.698.326-.702.048-1.57.054-2.737.055h-.956l-.582-.001zm.33-11.436a.18.18 0 0 0-.247.137 11.663 11.663 0 0 0-.223 2.278c0 .796.08 1.573.232 2.322a.18.18 0 0 0 .247.137 11.64 11.64 0 0 0 3.855-2.296.181.181 0 0 0 0-.279A11.64 11.64 0 0 0 8.27 9.563zm.602-1.696A1.98 1.98 0 0 0 6.258 9.35c-.17.85-.258 1.73-.258 2.629 0 .917.092 1.814.268 2.68a1.98 1.98 0 0 0 2.615 1.474 13.44 13.44 0 0 0 4.453-2.65 1.981 1.981 0 0 0 0-2.96 13.44 13.44 0 0 0-4.464-2.655z" fill="currentColor" fill-rule="evenodd" /></symbol>',24,24),Ue=(0,F.makeIcon)("Icon24Settings","settings_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="settings_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M9.127 5.052c1.256-.72 1.473-1.469 1.623-2.219.167-.833.417-.833.833-.833h.834c.416 0 .583 0 .833.833.225.751.383 1.502 1.631 2.223 1.397.379 2.08.002 2.717-.422.707-.471.884-.294 1.178 0l.59.59c.294.294.412.412 0 1.178-.372.69-.791 1.333-.418 2.725.72 1.256 1.469 1.473 2.219 1.623.833.167.833.417.833.833v.834c0 .416 0 .583-.833.833-.751.225-1.502.383-2.223 1.631-.379 1.397-.002 2.08.422 2.717.471.707.294.884 0 1.178l-.59.59c-.294.294-.412.412-1.178 0-.69-.372-1.333-.791-2.725-.418-1.256.72-1.473 1.469-1.623 2.219-.167.833-.417.833-.833.833h-.834c-.416 0-.583 0-.833-.833-.225-.751-.383-1.502-1.631-2.223-1.397-.379-2.08-.002-2.717.422-.707.471-.884.294-1.178 0l-.59-.59c-.294-.294-.412-.412 0-1.178.372-.69.791-1.333.418-2.725-.72-1.256-1.469-1.473-2.219-1.623C2 13.083 2 12.833 2 12.417v-.834c0-.416 0-.583.833-.833.751-.225 1.502-.383 2.223-1.631.379-1.397.002-2.08-.422-2.717-.471-.707-.294-.884 0-1.178l.59-.59c.294-.294.412-.412 1.178 0 .69.372 1.333.791 2.725.418ZM12 16.75a4.75 4.75 0 1 0 0-9.5 4.75 4.75 0 0 0 0 9.5Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0);var He=function(e){var n=e.tooltips,t=e.onTooltipChange,a=e.getRootRef,r=e.isDropdownOpen,s=e.tooltipTitle,l=(0,i.__rest)(e,["tooltips","onTooltipChange","getRootRef","isDropdownOpen","tooltipTitle"]);return(0,o.jsx)(be.TooltipNew,(0,i.__assign)({content:s,open:n.settings,delay:300,onOpen:function(){return t("settings",!0)},onClose:function(){return t("settings",!1)},forceClose:r},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallSettingsButton__outer"},{children:(0,o.jsx)("div",(0,i.__assign)({},l,{ref:a,className:"CallSettingsButton__inner"},{children:(0,o.jsx)(A,{icon:(0,o.jsx)(Ue,{},void 0)},void 0)}),void 0)}),void 0)}),void 0)};function Ve(e){var n,t=e.info,r=e.chatUnreadCount,c=void 0===r?0:r,d=e.callMenuActions,u=e.isAudioAllowed,p=void 0!==u&&u,f=e.isVideoAllowed,h=void 0!==f&&f,g=e.isVideoEnabled,m=void 0!==g&&g,C=e.isAudioEnabled,S=void 0!==C&&C,I=e.isScreenSharingEnabled,T=void 0!==I&&I,x=e.isMovieStreamEnabled,y=void 0!==x&&x,b=e.isOratorMode,M=void 0===b||b,w=e.isFullScreen,O=void 0!==w&&w,P=e.onToggleVideo,k=e.onToggleAudio,L=e.onLeaveCall,D=e.onCollapseCall,R=e.onToggleOratorMode,j=e.onChat,B=e.onHandClick,U=e.onToggleScreenShare,H=e.onFullScreenToggle,V=e.onDeferredStreamStart,G=e.isParticipantControlActive,F=void 0!==G&&G,Z=e.isLayoutSwitchShown,W=void 0!==Z&&Z,z=e.isScreenShareControlShown,K=void 0!==z&&z,Q=e.isHandRaised,Y=void 0!==Q&&Q,J=e.isHandControlShown,X=void 0!==J&&J,q=e.isChatControlShown,$=void 0!==q&&q,ee=e.isStreamingControlShown,ne=void 0!==ee&&ee,te=e.isChainControlShown,ae=void 0!==te&&te,ie=e.onParticipantsClick,oe=e.onTooltipChange,re=e.tooltips,le=e.onChainClick,ce=e.notificationWithButton,de=e.isWaitingHall,ue=void 0!==de&&de,_e=e.participantCount,ve=void 0===_e?0:_e,pe=e.children,fe=e.isMovieChooseShown,he=e.isMovieChooseDisabled,ge=void 0!==he&&he,me=e.onMovieChooseClick,Ae=e.callControlsVisibilityController,Ce=(0,l.useContext)(N.ConfigContext).isModalView,Oe=(0,l.useContext)(E.LangContext).getLang,ke=(0,s.classNames)("Call",{"Call--fullscreen":O||!Ce}),Le=(0,s.classNames)("Call__content",{"Call__content--waitingHall":ue}),De=(0,s.classNames)("Call__controlPanelButtonsGroup","Call__controlPanelButtonsGroup--left"),je=(0,s.classNames)(((n={Call__controlPanelButtonsGroup:!0})["Call__controlPanelButtonsGroup--right"]=!0,n["Call__controlPanelButtonsGroup--rightFullScreen"]=O,n)),Ue=300,Ve=(0,l.useRef)(null),Ge=(0,l.useRef)(null),Fe=(0,i.__read)((0,l.useState)(!1),2),Ze=Fe[0],We=Fe[1],ze="boolean"!=typeof(null==Ae?void 0:Ae.isShowControls)||Ae.isShowControls;return(0,o.jsxs)("section",(0,i.__assign)({className:ke,ref:Ve,onMouseOver:null==Ae?void 0:Ae.handleMouseOver,onMouseLeave:null==Ae?void 0:Ae.handleMouseLeave,onMouseMove:null==Ae?void 0:Ae.handleMouseMove},{children:[t,(0,o.jsx)("div",(0,i.__assign)({className:Le,"data-calls-id":"content"},{children:pe}),void 0),(0,o.jsx)("footer",(0,i.__assign)({className:"Call__footer",ref:Ge},{children:ze&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",(0,i.__assign)({className:De},{children:[$&&(0,o.jsx)(be.TooltipNew,(0,i.__assign)({content:Oe("calls_chat"),open:re.chat,delay:Ue,onOpen:function(){return oe("chat",!0)},onClose:function(){return oe("chat",!1)}},{children:(0,o.jsx)(Se,{unreadCount:c,onClick:j},void 0)}),void 0),X&&(0,o.jsx)(be.TooltipNew,(0,i.__assign)({content:Oe(Y?"calls_tooltip_lower_hand":"calls_tooltip_raise_hand"),open:re.hand,delay:Ue,onOpen:function(){return oe("hand",!0)},onClose:function(){return oe("hand",!1)}},{children:(0,o.jsx)(A,{icon:(0,o.jsx)(Te,{},void 0),type:"hand",isActive:Y,onClick:B},void 0)}),void 0),K&&(0,o.jsx)(be.TooltipNew,(0,i.__assign)({content:Oe(T?"calls_stop_screen_share":"calls_start_screen_share"),open:re.screenShare,delay:Ue,onOpen:function(){return oe("screenShare",!0)},onClose:function(){return oe("screenShare",!1)}},{children:(0,o.jsx)(A,{icon:(0,o.jsx)(Ie,{},void 0),isActive:T,onClick:U},void 0)}),void 0),fe&&(0,o.jsx)(be.TooltipNew,(0,i.__assign)({content:Oe(ge?"calls_movie_already_started":"calls_watch_movie_together"),open:re.movieChoose,delay:Ue,onOpen:function(){return oe("movieChoose",!0)},onClose:function(){return oe("movieChoose",!1)}},{children:(0,o.jsx)(A,{icon:(0,o.jsx)(Be,{},void 0),onClick:me,isActive:y&&!ge,disabled:ge},void 0)}),void 0),ne&&(0,o.jsx)(be.TooltipNew,(0,i.__assign)({content:Oe("calls_call_menu_translation"),open:re.streaming,delay:Ue,onOpen:function(){return oe("streaming",!0)},onClose:function(){return oe("streaming",!1)}},{children:(0,o.jsx)(A,{icon:(0,o.jsx)(we,{},void 0),isActive:ne,onClick:V},void 0)}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"Call__buttons"},{children:[ae&&le&&(0,o.jsx)(be.TooltipNew,(0,i.__assign)({content:Oe("calls_menu_link"),open:re.chainlink,delay:Ue,onOpen:function(){return oe("chainlink",!0)},onClose:function(){return oe("chainlink",!1)},tooltipClassName:"Call__footerButton__tooltip"},{children:(0,o.jsx)(_,{type:a.ON,icon:(0,o.jsx)(Me,{},void 0),onClick:le,className:"Call__footerButton"},void 0)}),void 0),ie&&(0,o.jsx)(be.TooltipNew,(0,i.__assign)({content:Oe("calls_participants"),open:re.participants,delay:Ue,onOpen:function(){return oe("participants",!0)},onClose:function(){return oe("participants",!1)},tooltipClassName:"Call__footerButton__tooltip"},{children:(0,o.jsx)(Pe,{isParticipantControlActive:F,onClick:ie,participantCount:ve},void 0)}),void 0),(0,o.jsx)(be.TooltipNew,(0,i.__assign)({content:Oe(m?"calls_camera_turn_off":"calls_camera_turn_on"),open:re.video,delay:Ue,onOpen:function(){return oe("video",!0)},onClose:function(){return oe("video",!1)},tooltipClassName:"Call__footerButton__tooltip",preferPointerEvents:!0},{children:(0,o.jsx)(_,{type:h?m?a.ON:a.OFF:a.DISABLED,icon:m?(0,o.jsx)(v,{},void 0):(0,o.jsx)(Ne,{},void 0),onClick:P,className:"Call__footerButton"},void 0)}),void 0),k&&(0,o.jsx)(be.TooltipNew,(0,i.__assign)({content:Oe(S?"calls_mic_turn_off":"calls_mic_turn_on"),open:re.audio,delay:Ue,onOpen:function(){return oe("audio",!0)},onClose:function(){return oe("audio",!1)},tooltipClassName:"Call__footerButton__tooltip",preferPointerEvents:!0},{children:(0,o.jsx)(Re,{isAudioAllowed:p,isAudioEnabled:S,onToggleAudio:k},void 0)}),void 0),(0,o.jsx)(be.TooltipNew,(0,i.__assign)({content:Oe("calls_exit"),open:re.leaveCall,delay:Ue,onOpen:function(){return oe("leaveCall",!0)},onClose:function(){return oe("leaveCall",!1)},tooltipClassName:"Call__footerButton__tooltip"},{children:(0,o.jsx)(_,{type:a.NEGATIVE,icon:(0,o.jsx)(Ee,{},void 0),onClick:L,className:"Call__footerButton"},void 0)}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:je},{children:[W&&(0,o.jsx)(be.TooltipNew,(0,i.__assign)({content:Oe(M?"calls_show_grid":"calls_show_orator"),open:re.layout,delay:Ue,onOpen:function(){return oe("layout",!0)},onClose:function(){return oe("layout",!1)}},{children:(0,o.jsx)(A,{type:M?"changeToGrid":"changeToOrator",onClick:R},void 0)}),void 0),d&&(0,o.jsx)(se,(0,i.__assign)({items:d,open:Ze,setOpen:We,placement:"top-end",className:"Call__dropdown"},{children:(0,o.jsx)(He,{onTooltipChange:oe,tooltips:re,isDropdownOpen:Ze,tooltipTitle:Oe("calls_settings")},void 0)}),void 0),D&&(0,o.jsx)(be.TooltipNew,(0,i.__assign)({content:Oe("calls_collapse"),open:re.collapse,delay:Ue,onOpen:function(){return oe("collapse",!0)},onClose:function(){return oe("collapse",!1)}},{children:(0,o.jsx)(A,{type:"collapse",onClick:D},void 0)}),void 0),H&&(0,o.jsx)(be.TooltipNew,(0,i.__assign)({content:Oe(O?"calls_tooltip_fullscreen_off":"calls_tooltip_fullscreen_on"),open:re.fullscreen,delay:Ue,onOpen:function(){return oe("fullscreen",!0)},onClose:function(){return oe("fullscreen",!1)}},{children:(0,o.jsx)(A,{onClick:H,icon:O?(0,o.jsx)(xe,{},void 0):(0,o.jsx)(ye,{},void 0)},void 0)}),void 0)]}),void 0)]},void 0)}),void 0),ce&&ce]}),void 0)}var Ge=t(39664),Fe=function(e){var n=e.onScroll,t=e.scrollPosition,a=e.participantsCount,r=e.participantsShiftCount,c=e.children,u=l.Children.toArray(c),_=(0,s.classNames)("CallGridNew","CallGridNew--c"+a),v=(0,l.useRef)(null);(0,l.useEffect)((function(){var e=function(){null!==v.current&&n(v.current.scrollTop)};return null!==v.current&&v.current.addEventListener("scroll",e),function(){v.current&&v.current.removeEventListener("scroll",e)}}),[]),(0,l.useEffect)((function(){var e;n(t),null===(e=v.current)||void 0===e||e.scrollTo(0,t)}),[v.current]);var p=(0,l.useMemo)((function(){return new Array(r).fill(0).map((function(e,n){return(0,o.jsx)("article",{className:"CallGridNew__item CallGridNew__item--empty"},-n)}))}),[r]),f=a-r-u.length>0;return(0,o.jsxs)("section",(0,i.__assign)({className:_,id:d.ID_CALLS_PARTICIPANTS_BOX,ref:v},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CallGridNew__in"},{children:[p,u.map((function(e,n){return(0,o.jsx)("article",(0,i.__assign)({className:"CallGridNew__item","data-calls-id":"grid-item"},{children:e}),e.key||n)}))]}),void 0),f&&(0,o.jsx)(Ge.default,{color:"white",size:64,duration:1,className:"CallGridNew__spinner"},void 0)]}),void 0)},Ze=t(44801),We=(0,l.memo)((function(e){var n=e.icon,t=e.label,a=e.modeType,r=e.currentMode;return(0,o.jsxs)("div",(0,i.__assign)({className:"StreamModeSwitcher__item"},{children:[n,a===r&&(0,o.jsx)("span",(0,i.__assign)({className:"StreamModeSwitcher__item-label"},{children:t}),void 0)]}),void 0)})),ze=function(){return(0,l.useContext)(E.LangContext)},Ke=function(e){var n=e.availableModes,t=e.currentMode,a=e.setMode,i=ze().getLang,r=function(e){switch(e){case G.MediaType.STREAM:case G.MediaType.MOVIE:return i("calls_stream_mode_movie");case G.MediaType.SCREEN:return i("calls_stream_mode_screen");case G.MediaType.CAMERA:return i("calls_stream_mode_camera");default:return e}},s=(0,l.useMemo)((function(){return n.map((function(e){return{label:(0,o.jsx)(We,{icon:_e(e),label:r(e),modeType:e,currentMode:t},void 0),value:e,"aria-label":r(e)}}))}),[t,n]);return(0,o.jsx)(Ze.SegmentedControl,{onChange:a,className:"StreamModeSwitcher",options:s,value:t},void 0)},Qe=t(78658),Ye=t(17179);function Je(e,n){return(e&n)===n}function Xe(e){for(var n={},t=0;t<e.length;++t)n[e[t]]=1<<t;return n}var qe=t(71618),$e=t(93385);function en(e){return new Promise((function(n,t){var a=new Image;a.src=e,a.onload=n,a.onerror=t}))}function nn(e){return Promise.resolve(e)}function tn(e,n,t){if(e.authorizedGroupId)return Promise.resolve();if((0,Qe.unpackState)(n).friends.length>0)return Promise.resolve();if(e.getFriends){var a=e.getFriends();if(null!==a)return t({type:d.E_ACTION.SET_FRIENDS,data:a}),Promise.resolve()}return(0,qe.loadFriends)().then((function(e){var n=e.items,t=e.count;return{friends:n.map($e.normalizeUser),count:t}})).then((function(e){var n=e.count,a=e.friends;t({type:d.E_ACTION.SET_FRIENDS,data:a,friendsCount:n})}))}function an(e,n,t,a){return(0,qe.loadChatMembers)(t).then((function(t){t.profiles&&n({type:d.E_ACTION.SET_CHAT_INFO,data:on(t).sort((function(n,t){var a=(0,Qe.unpackState)(e).me;return n.peerId===a?-1:t.peerId===a?1:0})),conversation:a})}))}function on(e){var n,t,a=function(e){var n,t,a={};if(!e)return a;try{for(var o=(0,i.__values)(e),r=o.next();!r.done;r=o.next()){var s=r.value;a[s.id]=s}}catch(e){n={error:e}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(n)throw n.error}}return a}(e.profiles),o=[];try{for(var r=(0,i.__values)(e.items),s=r.next();!s.done;s=r.next()){var l=a[s.value.member_id];l&&o.push((0,$e.normalizeUser)(l))}}catch(e){n={error:e}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(n)throw n.error}}return o}function rn(e,n,t){return e.authorizedGroupId?n.groupMembers.length>0?Promise.resolve():(0,qe.getGroupMembers)(-e.authorizedGroupId,0,d.COUNT_OF_GROUP_MEMBERS_TO_LOAD).then((function(e){var n=e.items,t=e.count,a=[],i=[];return n.forEach((function(e){e.deactivated||(a.push((0,$e.normalizeUser)(e)),e.can_call_from_group||i.push(e.id))})),{groupMembers:a,unableToCallGroupMembersIds:i,count:t}})).then((function(e){var n=e.groupMembers,a=e.unableToCallGroupMembersIds,i=e.count;return t({type:d.E_ACTION.SET_GROUP_MEMBERS,groupMembersCount:i,groupMembers:n,unableToCallGroupMembersIds:a}),Promise.resolve()})):Promise.resolve()}function sn(e,n,t){return(0,qe.retryLoadCallPeers)(t).then((function(e){var t=(0,i.__read)((0,Qe.convertServerData)(e),3),a=t[0],o=t[1],r=t[2];return pn(n,r),nn({conversation:a,members:o})})).then((function(e){var a=e.conversation,i=e.members;n({type:d.E_ACTION.LOAD_PEERS,conversation:a,members:i,peerId:t})}))}function ln(e,n,t){return t?(0,qe.loadCallPeers)(t).then((function(e){var t=e.items,a=(0,i.__read)(t,1)[0];pn(n,a)})):Promise.resolve()}var cn,dn,un={acc:[],timer:0,promise:null,promiseResolve:null,tasks:0,timeout:300};function _n(e,n,t,a,o,r){var s,l;return(s=un.acc).push.apply(s,(0,i.__spreadArray)([],(0,i.__read)(o),!1)),un.timer&&clearTimeout(un.timer),un.timer=window.setTimeout((function(){var o=un.acc,s=un.promiseResolve;un.promise=null,un.promiseResolve=null,un.acc=[],function(e,n,t,a,o,r){var s=(0,Qe.unpackState)(e).me,l=(0,Qe.unpackState)(e).anonymSecret,c=s<0?s:void 0;return(0,qe.getCallParticipants)(a,o,c,s<0,l).then((function(e){var s=e.profiles,l=void 0===s?[]:s,c=e.anonyms,u=void 0===c?[]:c,_=e.secret,v=e.groups,p=void 0===v?[]:v;_&&n({type:d.E_ACTION.UPDATE_ANON_SECRET,secret:_});var f=(0,i.__spreadArray)((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(l),!1),(0,i.__read)(u),!1),(0,i.__read)(p),!1),h=o.filter((function(e){var n=f.find((function(n){return n&&n.id===e}));return!n}));h.length>0&&t.eventHandlers.onError&&t.eventHandlers.onError(new Error("callId: "+a+", timestamp: "+Date.now()+", cant find in participants: "+h.join(", ")));var g=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(u),!1),(0,i.__read)(l),!1).map($e.normalizeUser);(null==p?void 0:p.length)>0&&(g=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(g),!1),(0,i.__read)(p.map($e.normalizeGroup)),!1));var m=nn([{},g]);return r.awaitImages?m.then((function(){return[null,g]})):[null,g]})).then((function(e){var t=(0,i.__read)(e,2)[1];t.length>0&&n({type:d.E_ACTION.LOAD_PEERS,members:t})})).catch((function(e){t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),(0,G.debugMessage)(G.DebugMessageType.ERROR,e),console.error(e)}))}(e,n,t,a,o,r).catch((function(e){t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),(0,G.debugMessage)(G.DebugMessageType.ERROR,e),console.error(e)})).finally(s)}),un.timeout),un.promise=null!==(l=un.promise)&&void 0!==l?l:new Promise((function(e){un.promiseResolve=e}))}function vn(e,n,t,a){return void 0===a&&(a=0),(0,qe.getCallUrlLink)(n,t,a).then((function(n){var t=n.join_link;return e({type:d.E_ACTION.CALL_STATE,callData:{callUrlLink:t}}),t}))}function pn(e,n){if(n&&n.call_in_progress){var t=n.unread_count,a=n.last_message_id,i=n.call_in_progress.has_link,o=n.call_in_progress.can_finish_call;e({type:d.E_ACTION.CALL_STATE,callData:{canFinishCall:o,hasUrlLink:i}}),(t||a)&&e({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:t,chatUpToMsgId:a})}}function fn(e,n){return void 0===n&&(n=!1),(0,G.startStream)(n,null,e).catch((function(e){(0,G.debugMessage)(G.DebugMessageType.ERROR,e),console.error(e)}))}function hn(e,n,t){void 0===t&&(t=0),vn(e,n,!1,t).then((function(n){(0,s.copyTextToClipboard)(n).then((function(n){n&&e({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.LINK_COPIED_TO_CLIPBOARD}})}))})).catch(console.log)}function gn(e,n,t,a){n(t),wn(e)&&Pn(a,n,t)}!function(e){e.CONTAIN="cn",e.COVER="cv"}(cn||(cn={})),function(e){e[e.P2P=0]="P2P",e[e.Collapsed=1]="Collapsed",e[e.Orator=2]="Orator",e[e.Grid=3]="Grid"}(dn||(dn={}));function mn(e){return(0,M.isGroupCallByPeer)(e.peer)?e.uiMode===d.UIMode.COLLAPSED?dn.Collapsed:e.isOratorMode?dn.Orator:dn.Grid:dn.P2P}function An(e,n){switch(mn(e)){case dn.P2P:return function(e,n,t){var a=new Map,o=e.config,r=o.enableScreenTrack,s=o.enableProducerScreenTrack,l=e.uiMode===d.UIMode.FULLSCREEN,c=e.uiMode===d.UIMode.COLLAPSED,u=(0,k.getPeerIdDeviceInfo)(e.peer,e.devices),_=function(i){var o=i.movieStreamInfo,r=i.movieStreamStoppedInfo,s=i.externalId,c=(0,k.externalIdToString)(s);o&&e.callData.topology===G.TransportTopology.SERVER&&a.set(Nn(c,o.source,o.movieId),Tn(i,l,!1,n,t,o.source,String(o.movieId))),r&&a.set(Nn(c,r.source,r.movieId),En(i,r.source,String(r.movieId)))};if(_((0,i.__assign)((0,i.__assign)({},e.localDevice),{externalId:e.externalId||(0,k.getDefaultExternalId)()})),!u)return a;var v=u.externalId,p=u.mediaSettings;if((0,k.isSameExternalId)(v,e.externalId))return a;var f=(0,k.externalIdToString)(v);if(r||s){var h=!!(null==p?void 0:p.isScreenSharingEnabled),g=!!(null==p?void 0:p.isVideoEnabled);if(_(u),h&&g&&(a.set(Nn(f,G.MediaType.SCREEN),Tn(u,l,c,n,t,G.MediaType.SCREEN)),a.set(Nn(f,G.MediaType.CAMERA),xn(u,G.MediaType.CAMERA))),h!==g){var m=h?G.MediaType.SCREEN:G.MediaType.CAMERA,A=h?G.MediaType.CAMERA:G.MediaType.SCREEN;a.set(Nn(f,m),Tn(u,l,c,n,t,m)),a.set(Nn(f,A),En(u,A))}return h||g||(a.set(Nn(f,G.MediaType.SCREEN),En(u,G.MediaType.SCREEN)),a.set(Nn(f,G.MediaType.CAMERA),En(u,G.MediaType.CAMERA))),a}return a.set(f,yn(p)?Tn(u,l,c,n,t):En(u)),a}(e,n.ww,n.wh);case dn.Collapsed:return function(e){var n=(0,Qe.isAnyoneWithVideo)(e),t=(0,k.getCallVisibleParticipant)(e,n),a=(0,k.getActiveDevices)(e).activeDevices,i=e.config,o=i.enableScreenTrack,r=i.enableProducerScreenTrack;return a.reduce((function(n,a){var i=function(t){var a=t.movieStreamInfo,i=t.movieStreamStoppedInfo,o=t.externalId,r=(0,k.externalIdToString)(o);a&&e.callData.topology===G.TransportTopology.SERVER&&n.set(Nn(r,a.source,a.movieId),Sn(t,a.source,String(a.movieId))),i&&n.set(Nn(r,i.source,i.movieId),En(t,i.source,String(i.movieId)))},s=a.externalId,l=a.mediaSettings;if((0,k.isSameExternalId)(s,e.externalId))return(0,k.isSameExternalId)(s,null==t?void 0:t.externalId)&&i(t),n;var c=(0,k.externalIdToString)(s);if(o||r){var d=!!(null==l?void 0:l.isScreenSharingEnabled),u=!!(null==l?void 0:l.isVideoEnabled),_=(0,k.isSameExternalId)(s,null==t?void 0:t.externalId);i(t),_&&d&&(n.set(Nn(c,G.MediaType.SCREEN),Sn(t,G.MediaType.SCREEN)),n.set(Nn(c,G.MediaType.CAMERA),En(a,G.MediaType.CAMERA))),_&&!d&&u&&(n.set(Nn(c,G.MediaType.CAMERA),Sn(t,G.MediaType.CAMERA)),n.set(Nn(c,G.MediaType.SCREEN),En(a,G.MediaType.SCREEN))),_&&(d||u)||(n.set(Nn(c,G.MediaType.SCREEN),En(a,G.MediaType.SCREEN)),n.set(Nn(c,G.MediaType.CAMERA),En(a,G.MediaType.CAMERA)))}else(0,k.isSameExternalId)(null==t?void 0:t.externalId,s)&&yn(l)?n.set(c,Sn(t)):n.set(c,En(a));return n}),new Map)}(e);case dn.Orator:return function(e,n,t){var a,i,o=(0,k.getSelectedDevice)(e),r=o.externalId,s=(0,k.externalIdToString)(r),l=(0,k.getActiveDevices)(e).activeDevices,c=0,u=e.config,_=u.enableScreenTrack,v=u.enableProducerScreenTrack;if((_||v)&&s){var p=new Map,f=!!(null===(a=null==o?void 0:o.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled),h=!!(null===(i=null==o?void 0:o.mediaSettings)||void 0===i?void 0:i.isVideoEnabled),g=null==o?void 0:o.streamMode,m=e.uiMode===d.UIMode.FULLSCREEN,A=!(0,k.isSameExternalId)(r,e.externalId),C=o.movieStreamInfo,E=o.movieStreamStoppedInfo;return C&&e.callData.topology===G.TransportTopology.SERVER&&(c++,p.set(Nn(s,C.source,C.movieId),Tn(o,m,!1,n,t,C.source,String(C.movieId)))),E&&p.set(Nn(s,E.source,E.movieId),En(o,E.source,String(E.movieId))),f&&A&&(c++,p.set(Nn(s,G.MediaType.SCREEN),Tn(o,m,!1,n,t,G.MediaType.SCREEN))),f&&h&&A&&(c++,p.set(Nn(s,G.MediaType.CAMERA),g===G.MediaType.CAMERA?Tn(o,m,!1,n,t,G.MediaType.CAMERA):xn(o,G.MediaType.CAMERA))),f&&!h&&A&&p.set(Nn(s,G.MediaType.CAMERA),En(o,G.MediaType.CAMERA)),!f&&h&&A&&(c++,p.set(Nn(s,G.MediaType.CAMERA),Tn(o,m,!1,n,t,G.MediaType.CAMERA)),p.set(Nn(s,G.MediaType.SCREEN),En(o,G.MediaType.SCREEN))),f||h||!A||(p.set(Nn(s,G.MediaType.CAMERA),En(o,G.MediaType.CAMERA)),p.set(Nn(s,G.MediaType.SCREEN),En(o,G.MediaType.SCREEN))),l.reduce((function(n,t){var a=t.externalId,i=t.mediaSettings;if((0,k.isSameExternalId)(a,e.externalId)||(0,k.isSameExternalId)(a,r))return n;var o=(0,k.externalIdToString)(a),s=!!(null==i?void 0:i.isScreenSharingEnabled),l=!!(null==i?void 0:i.isVideoEnabled),d=t.visible&&c<e.config.videoSlotsCount;return d&&l&&(c++,n.set(Nn(o,G.MediaType.CAMERA),xn(t,G.MediaType.CAMERA)),n.set(Nn(o,G.MediaType.SCREEN),En(t,G.MediaType.SCREEN))),d&&!l&&s&&(c++,n.set(Nn(o,G.MediaType.SCREEN),xn(t,G.MediaType.SCREEN)),n.set(Nn(o,G.MediaType.CAMERA),En(t,G.MediaType.CAMERA))),d&&(l||s)||(n.set(Nn(o,G.MediaType.SCREEN),En(t,G.MediaType.SCREEN)),n.set(Nn(o,G.MediaType.CAMERA),En(t,G.MediaType.CAMERA))),n}),p),p}return l.reduce((function(a,i){var o=i.externalId,s=i.mediaSettings;if((0,k.isSameExternalId)(o,e.externalId))return a;var l=(0,k.externalIdToString)(o);if((0,k.isSameExternalId)(r,o)&&yn(s)){var u=Tn(i,e.uiMode===d.UIMode.FULLSCREEN,!1,n,t);a.set(l,u)}else yn(s)&&i.visible&&c<e.config.videoSlotsCount?(c++,a.set(l,xn(i))):a.set(l,En(i));return a}),new Map)}(e,n.ww,n.wh);default:return function(e,n){var t=e.uiMode===d.UIMode.FULLSCREEN,a=t?n.ww:n.gw,i=t?n.wh:n.gh;if(!a||!i)return new Map;var o=(0,k.getActiveDevices)(e).activeDevices,r=function(e,n,t){var a;switch(!0){case 1===t:a=1;break;case 2===t:a=2;break;case(0,Qe.minmax)(t,3,4):var i=Math.round(n/2-4);return[Math.round(1.77*i),i];case(0,Qe.minmax)(t,5,6):a=3;break;case(0,Qe.minmax)(t,7,12):a=4;break;default:a=5}var o=Math.round(e/a-4),r=Math.round(o/1.77);return[o,r]}(a,i,o.length),s=r[1]<200?1:2,l=0,c=e.config,u=c.enableScreenTrack,_=c.enableProducerScreenTrack;function v(n,t){var a=(0,k.externalIdToString)(n.externalId),i=n.movieStreamInfo,o=n.movieStreamStoppedInfo;i&&e.callData.topology===G.TransportTopology.SERVER&&(l++,t.set(Nn(a,i.source,i.movieId),In(n,r,s,i.source,String(i.movieId)))),o&&t.set(Nn(a,o.source,String(o.movieId)),En(n,o.source,String(o.movieId)))}return o.reduce((function(n,t){if((0,k.isSameExternalId)(t.externalId,e.externalId))return v(t,n),n;var a=t.externalId,i=t.mediaSettings,o=(0,k.externalIdToString)(a);if(v(t,n),u||_){var c=!!(null==i?void 0:i.isScreenSharingEnabled),d=!!(null==i?void 0:i.isVideoEnabled),p=t.visible&&l<e.config.videoSlotsCount;return p&&c&&(l++,n.set(Nn(o,G.MediaType.SCREEN),In(t,r,s,G.MediaType.SCREEN)),n.set(Nn(o,G.MediaType.CAMERA),En(t,G.MediaType.CAMERA))),p&&!c&&d&&(l++,n.set(Nn(o,G.MediaType.CAMERA),In(t,r,s,G.MediaType.CAMERA)),n.set(Nn(o,G.MediaType.SCREEN),En(t,G.MediaType.SCREEN))),p&&(c||d)||(n.set(Nn(o,G.MediaType.CAMERA),En(t,G.MediaType.CAMERA)),n.set(Nn(o,G.MediaType.SCREEN),En(t,G.MediaType.SCREEN))),n}return yn(i)&&t.visible&&l<e.config.videoSlotsCount?(n.set(o,In(t,r,s)),l++):n.set(o,En(t)),n}),new Map)}(e,n)}}function Cn(e){return e&&!e.stopStream}function En(e,n,t){void 0===n&&(n=null);var a={stopStream:!0,uid:e.externalId,mediaType:n};return t&&(a.streamName=t),a}function Sn(e,n,t){void 0===n&&(n=null);var a={fit:cn.CONTAIN,width:265,height:200,priority:2,uid:e.externalId,mediaType:n};return t&&(a.streamName=t),a}function In(e,n,t,a,i){void 0===a&&(a=null);var o={fit:cn.COVER,width:n[0],height:n[1],priority:t,uid:e.externalId,mediaType:a};return i&&(o.streamName=i),o}function Tn(e,n,t,a,i,o,r){void 0===o&&(o=null);var s={fit:cn.CONTAIN,width:n?a:t?265:900,height:n?i:t?200:504,priority:3,uid:e.externalId,mediaType:o};return r&&(s.streamName=r),s}function xn(e,n,t){void 0===n&&(n=null);var a=e.mediaSettings,i={fit:(null==a?void 0:a.isScreenSharingEnabled)?cn.CONTAIN:cn.COVER,width:140,height:140,priority:1,uid:e.externalId,mediaType:n};return t&&(i.streamName=t),i}function yn(e){var n;return null!==(n=!!(null==e?void 0:e.isVideoEnabled)||!!(null==e?void 0:e.isScreenSharingEnabled))&&void 0!==n&&n}function Nn(e,n,t){return void 0===n&&(n=null),""+e+(n?":"+n:"")+(t?":"+t:"")}var bn="GRID";function Mn(e){var n=1*e;return Math.min(n+e+n,128)}function wn(e){var n;return Boolean(null===(n=e.config)||void 0===n?void 0:n.enableParticipantListChunk)}function On(e,n,t,a){var i=a.externalId,o=a.markers,r=e.participantsChunk;if(wn(e)&&r){var s=(0,k.externalIdToString)(i),l=Yn(e,s),c=Vn(Fn(o),e),d=c>-1,u=-1===c;if(Kn(n,i,!1),d){var _=at(c,r),v={countBefore:r.countBefore,ids:_,countAfter:r.countAfter};it(n,v),function(e,n,t,a){if(0===a.countAfter&&0===a.countBefore||pt(a,e))return Promise.resolve();ht(e,n,t)}(e,n,t,v)}else u?(it(n,{countBefore:r.countBefore-1}),gt(e,n,t)):it(n,{countAfter:r.countAfter-1});l&&Qn(e,n,s)}}function Pn(e,n,t){var a=t.numberOfVisible,o=t.firstVisible;return(0,i.__awaiter)(this,void 0,void 0,(function(){var t;return(0,i.__generator)(this,(function(i){return t=Ye.GlobalStore.getCallsState(),o=lt(Math.max(0,o)),a=Math.ceil(a),function(e,n,t){var a=e.participantsChunk;if(!a)return!0;var i=a.countBefore,o=a.countAfter,r=i,s=r+a.ids.length,l=n+t,c=Math.ceil(1*t*.2);if((0===i||n-r>=c)&&(0===o||s-l>=c))return!1;return!0}(t,o,a)?[2,ht(t,n,e,{firstVisible:o,numberOfVisible:a})]:[2]}))}))}function kn(e,n,t,a,o){var r=o.externalId,s=o.markers,l=o.mediaSettings,c=o.permissionsOnce,d=l.isScreenSharingEnabled,u=e.participantsChunk,_=nt(u,et(e,s)),v=(0,k.externalIdToString)(r);d||_?(!function(e,n,t){t&&qn(e,n,{markers:t})}(n,r,s),jn(e,n,a,r,(0,i.__assign)((0,i.__assign)({},(0,k.getMediaSettingsWithStreamMode)(l,Jn(e,v))),{permissionsOnce:c}))):Qn(e,n,v);var p=0===(null==u?void 0:u.countBefore);(0,k.getOrator)(e).device!==e.localDevice||p||function(e,n,t){(0,i.__awaiter)(this,void 0,void 0,(function(){var a,o;return(0,i.__generator)(this,(function(r){switch(r.label){case 0:return[4,Dn(e,{count:1,fromIdx:0})];case 1:return a=i.__read.apply(void 0,[r.sent().participants,1]),(o=a[0])?((0,k.toggleScreenSharing)(n,t,o.mediaSettings.isScreenSharingEnabled,o.uid),[2]):[2]}}))}))}(t,e,n),Wn(e,n,t,a,{externalId:r,markers:s})}var Ln=[];function Dn(e,n,t){var a=n.count,o=n.fromIdx,r=void 0===o?0:o,s=n.fromMarker,l=(void 0===t?{}:t).signal,c=void 0===l?null:l;return(0,i.__awaiter)(this,void 0,void 0,(function(){var n,t;return(0,i.__generator)(this,(function(i){return n=!1,t=function(){return n=!0},c&&c.addEventListener("abort",t,{once:!0}),[2,e.getParticipantListChunk({count:a,fromIdx:s?void 0:r,fromMarker:s,listType:bn}).then((function(e){return n?Promise.reject(new Error("aborted")):e})).finally((function(){c&&c.removeEventListener("abort",t)}))]}))}))}function Rn(e,n,t,a){var i=Xn(e,n,t,a.map((function(e){return e.externalId})));return Hn(n,a),i}function jn(e,n,t,a,o){Rn(e,n,t,[(0,i.__assign)({externalId:a},o)])}function Bn(e){var n;if(e){var t=null!==(n=e.countBefore)&&void 0!==n?n:0;return t?ct(t,1):t}return 0}function Un(e,n){var t=st(e),a=ut(e),i=t+a,o=n.countBefore;return n.ids.reduce((function(e,n,a){var r=o+a,s=r>=t&&r<i;return e.push({externalId:n,visible:s}),e}),[])}function Hn(e,n){var t=n.reduce((function(e,n){return e[(0,k.externalIdToString)(n.externalId)]=n,e}),{});e({type:d.E_ACTION.UPDATE_PARTICIPANTS_BATCH,data:t})}function Vn(e,n){var t=n.participantsChunk,a=(null==t?void 0:t.ids)||[];return(0,Qe.binarySearch)(a,(function(t){var a=(0,k.externalIdToString)(t),i=Jn(n,a);if(!i)return 1;var o=Fn(i.markers);return G.Utils.participantMarkerCompare(e,o)}))}function Gn(e,n,t){var a;!function(e,n,t){var a,i,o=null!==(i=null===(a=e.participantsChunk)||void 0===a?void 0:a.ids)&&void 0!==i?i:[];if(!o.length)return;var r=t.participants.reduce((function(e,n){return e[(0,k.externalIdToString)(n.uid)]=!0,e}),{});_t(e,n,o.filter((function(e){var n=(0,k.externalIdToString)(e);return!r[n]})))}(e,n,t);var i=null!==(a=null==t?void 0:t.participants)&&void 0!==a?a:[],o={countBefore:t.countBefore,ids:i.map((function(e){return e.uid})),countAfter:t.countAfter};it(n,o);var r=i.map((function(e){return{externalId:e.uid,markers:e.markers}}));Hn(n,r),bt(e,n,i),Un(e,o).forEach((function(e){Nt(n,e.externalId,e)}))}function Fn(e){return null==e?void 0:e.GRID}function Zn(e,n,t,a){var i=a.externalId,o=a.markers,r=e.participantsChunk;if(r){var s=$n(e,i),l=et(e,o),c=s>-1,d=nt(r,l);if(d&&!c){var u=0===r.countBefore&&r.countAfter?r.countAfter-1:r.countAfter;vt(e,n,t,{externalId:i,markers:o,countBefore:0===r.countAfter&&r.countBefore?r.countBefore-1:r.countBefore,countAfter:u})}else{if(c&&!d)!function(e,n,t,a){if(!a)return;var i=at(n,a),o=0===t;function r(e,n){return e?n+1:n}it(e,{countBefore:r(o,a.countBefore),ids:i,countAfter:r(!o,a.countAfter)})}(n,s,l,r);else c&&d&&s!==l&&function(e,n,t,a,i){var o=Array.from(i);o.splice(t,0,a);var r=n+(t<=n?1:0);o.splice(r,1),it(e,{ids:o})}(n,s,l,i,r.ids)}}}function Wn(e,n,t,a,i){Zn(e,n,a,{externalId:i.externalId,markers:i.markers}),gt(e,n,t)}function zn(e,n,t){(null==t?void 0:t.hand)&&Kn(e,n,t.hand.state)}function Kn(e,n,t){e({type:d.E_ACTION.SET_PARTICIPANT_HAND_STATE,key:(0,k.externalIdToString)(n),value:t})}function Qn(e,n,t){Yn(e,t)&&n({type:d.E_ACTION.REMOVE_DEVICE_FROM_CACHE,id:t})}function Yn(e,n){return Boolean(Jn(e,n))}function Jn(e,n){return e.devices[n]}function Xn(e,n,t,a){return(0,i.__awaiter)(this,void 0,Promise,(function(){var o,r,s;return(0,i.__generator)(this,(function(i){return(o=a.reduce((function(n,t){var a=Number(t.id);return e.participants[a]||n.push(a),n}),[])).length?(r=e.callData.callId||"",s={withConversation:!e.callData.conversation,awaitImages:!1},[2,_n(e,n,t,r,o,s)]):[2,Promise.resolve()]}))}))}function qn(e,n,t){Hn(e,[(0,i.__assign)({externalId:n},t)])}function $n(e,n){var t=(0,k.externalIdToString)(n),a=e.participantsChunk;return((null==a?void 0:a.ids)||[]).findIndex((function(e){return(0,k.externalIdToString)(e)===t}))}function et(e,n){var t=Vn(Fn(n),e);return t>-1?t:-(t+1)}function nt(e,n){if(!e)return!1;var t=e.ids;return 0===n&&0===e.countBefore||n===t.length&&0===e.countAfter||n>0&&n<t.length}function tt(e,n,t,a,o){var r=o.externalId,s=o.marker;return(0,i.__awaiter)(this,void 0,void 0,(function(){var o;return(0,i.__generator)(this,(function(i){return o=(0,k.externalIdToString)(r),[2,Dn(t,{count:1,fromMarker:s}).then((function(t){var i=t.participants[0];(0,k.externalIdToString)(i.uid)===o&&jn(e,n,a,i.uid,{markers:i.markers,mediaSettings:i.mediaSettings})}))]}))}))}function at(e,n){if(!n)return[];var t=n.ids,a=Array.from(t);return a.splice(e,1),a}function it(e,n){e({type:d.E_ACTION.SET_PARTICIPANTS_CHUNK,data:n})}function ot(e,n,t,a){var i=(0,k.externalIdToString)(t);(a.stream||a.screenSharingStream||Yn(e,i))&&Nt(n,t,a)}function rt(e,n){var t=1*n;return Math.max(0,e-t)}function st(e){return lt(dt(e))}function lt(e){return ct(e,-1)}function ct(e,n){return Math.max(e+n,0)}function dt(e){var n;return null!==(n=e.isOratorMode?e.oratorScrollFirstVisible:e.gridScrollFirstVisible)&&void 0!==n?n:0}function ut(e){return e.isOratorMode?Math.ceil(e.oratorScrollNumberOfVisible):d.GRID_SCROLL_NUMBER_OF_VISIBLE}function _t(e,n,t){var a=[e.adminPinnedParticipant,e.screenSharingPinnedParticipant,e.pinnedParticipant].filter(Boolean).map((function(e){return(0,k.externalIdToString)(e)})).reduce((function(e,n){return e[n]=!0,e}),{});t.filter((function(e){var n=(0,k.externalIdToString)(e);return!a[n]})).forEach((function(t){var a=(0,k.externalIdToString)(t);Qn(e,n,a)}))}function vt(e,n,t,a){var o=a.externalId,r=a.markers,s=a.countBefore,l=a.countAfter,c=e.participantsChunk;if(c){s=null!=s?s:c.countBefore,l=null!=l?l:c.countAfter;var d=mt(Fn(r),e),u=ft(e),_=rt(st(e),ut(e)),v=Math.max(_-s,0),p=c.ids,f=Array.from(p);f.splice(d,0,o);var h=f.splice(0,v),g=f.splice(u),m={countBefore:s+h.length,ids:f,countAfter:l+g.length};jn(e,n,t,o,{markers:r,status:G.ParticipantStatus.CONNECTED}),it(n,m),function(e,n,t){t&&Hn(n,Un(e,t))}(e,n,m),_t(e,n,(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(h),!1),(0,i.__read)(g),!1))}}function pt(e,n){var t=ft(n);return e.ids.length>=t}function ft(e){return Mn(ut(e))}function ht(e,n,t,a){var i=void 0===a?{}:a,o=i.firstVisible,r=void 0===o?st(e):o,s=i.numberOfVisible,l=void 0===s?ut(e):s,c=Mn(l),d=function(e,n,t){return e.participantsChunk?rt(n,t):0}(e,r,l);return Dn(t,{count:c,fromIdx:d}).then((function(t){Gn(Ye.GlobalStore.isSet()?Ye.GlobalStore.getCallsState():e,n,t)}))}function gt(e,n,t){return Pn(t,n,{firstVisible:dt(e),numberOfVisible:ut(e)})}function mt(e,n){return-(Vn(e,n)+1)}function At(e,n,t){var a=e.participantsChunk;return ht(e,n,t,{firstVisible:null==a?void 0:a.countBefore,numberOfVisible:null==a?void 0:a.ids.length})}var Ct,Et,St,It=function(){function e(){}return e.getParticipantsMuteStates=function(n){e.abortGetParticipants();var t=new AbortController;e._lastController=t;var a=Ye.GlobalStore.getCallsStore(),o=a.getState(),r=a.dispatch,s=(0,Qe.objectMap)(o.devices,(function(e){return e.externalId}));s.length&&n.getParticipants({externalIds:s}).then((function(e){var n,a;if(!t.signal.aborted)try{for(var o=(0,i.__values)(e),s=o.next();!s.done;s=o.next()){var l=s.value;l.muteStates&&Nt(r,l.uid,{permissions:xt.mapParticipantPermissions(l.muteStates)})}}catch(e){n={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}}))},e.abortGetParticipants=function(){e._lastController&&(e._lastController.abort(),e._lastController=null)},e._lastController=null,e}();!function(e){e[e.None=0]="None",e[e.Muted=1]="Muted",e[e.MutedPermanent=2]="MutedPermanent",e[e.UnmutedWithoutAttraction=3]="UnmutedWithoutAttraction",e[e.CanTurnOnOnce=4]="CanTurnOnOnce",e[e.CanTurnOnOnceWithoutAttraction=5]="CanTurnOnOnceWithoutAttraction",e[e.UnmutedWithAttraction=6]="UnmutedWithAttraction"}(Et||(Et={})),function(e){e[e.Increase=0]="Increase",e[e.Clear=1]="Clear",e[e.Reset=2]="Reset"}(St||(St={}));var Tt=((Ct={})[G.MediaOption.AUDIO]="audio",Ct[G.MediaOption.VIDEO]="video",Ct[G.MediaOption.SCREEN_SHARING]="screenSharing",Ct[G.MediaOption.MOVIE_SHARING]="movieSharing",Ct),xt=function(){function e(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];this._params=e.mapArgs.apply(null,n),this._store=Ye.GlobalStore.getCallsStore(),this._dispatch=this._store.dispatch}return e.prototype.updateCallMuteState=function(e){var n=this._params,t=this._dispatch,a=this._store.getState();(0,Qe.isBoolean)(n.stateUpdated)&&!n.stateUpdated||n.muteAll&&(t({type:d.E_ACTION.SET_CALL_PERMISSIONS,data:n.muteStates}),((0,k.isAdmin)(a.localDevice)||(0,k.isCreator)(a.localDevice))&&n.mediaOptions.some((function(e){var t=a.permissions[e],i=n.muteStates[e];return t===G.MuteState.MUTE_PERMANENT&&i===G.MuteState.MUTE||t===G.MuteState.MUTE&&i===G.MuteState.MUTE_PERMANENT}))&&(a.config.enableParticipantListChunk?At(a,t,e):It.getParticipantsMuteStates(e)))},e.prototype.updatePersonalMuteState=function(){var e=this._params,n=this._store.getState(),t=this._dispatch;if((!e.userId||(0,k.isSameExternalId)(e.userId,n.externalId))&&(!e.adminId||!(0,k.isSameExternalId)(e.adminId,n.externalId))&&e.stateUpdated&&(e.muteAll||!e.requestedMedia)){var a=Et.None,o=Et.None,r=(0,i.__assign)({},n.localDevice.permissions);if(e.mediaOptions.includes(G.MediaOption.AUDIO)){var l=r.audio,c=e.muteStates[G.MediaOption.AUDIO]||G.MuteState.UNMUTE;l!==G.MuteState.MUTE_PERMANENT&&c===G.MuteState.MUTE_PERMANENT?a=Et.MutedPermanent:l===G.MuteState.MUTE_PERMANENT&&c!==G.MuteState.MUTE_PERMANENT?a=Et.UnmutedWithoutAttraction:c===G.MuteState.MUTE&&(a=Et.Muted),r.audio=c}if(e.mediaOptions.includes(G.MediaOption.VIDEO)){l=r.video,c=e.muteStates[G.MediaOption.VIDEO]||G.MuteState.UNMUTE;l!==G.MuteState.MUTE_PERMANENT&&c===G.MuteState.MUTE_PERMANENT?o=Et.MutedPermanent:l===G.MuteState.MUTE_PERMANENT&&c!==G.MuteState.MUTE_PERMANENT?o=Et.UnmutedWithoutAttraction:c===G.MuteState.MUTE&&(o=Et.Muted),r.video=c,r.screenSharing=c}var u=[],_=Et.None;if(e.mediaOptions.length)if(a!==Et.None&&o!==Et.None){if(u.push(G.MediaOption.AUDIO,G.MediaOption.VIDEO,G.MediaOption.SCREEN_SHARING),_=a,a!==o)return void(0,G.debugMessage)(G.DebugMessageType.ERROR,{error:"unexpected mute feedbacks pair audio="+a+" video="+o})}else o!==Et.None?(u.push(G.MediaOption.VIDEO,G.MediaOption.SCREEN_SHARING),_=o):a!==Et.None&&(u.push(G.MediaOption.AUDIO),_=a);_!==Et.None&&u.length&&this._handleFeedbackEvent({didReceiveEvent:_,forMedia:u}),(0,s.isEqual)(r,n.localDevice.permissions)||t({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{permissions:r}})}},e.prototype.updateExternalMuteState=function(){var e,n,t=this._params,a=this._store.getState(),o=this._dispatch;if(t.userId&&!(0,k.isSameExternalId)(t.userId,a.externalId)&&t.stateUpdated){var r,s,l=(0,k.externalIdToString)(t.userId),c={externalId:t.userId},u=null===(n=a.devices[l])||void 0===n?void 0:n.permissions,_=(r=t.muteStates,s=t.mediaOptions,(0,Qe.objectReduce)(r,(function(e,n,t){return s.includes(t)&&(e[Tt[t]]=n),e}),{}));c.permissions=(0,i.__assign)((0,i.__assign)({},u),_),t.unmuteOptions.length?c.permissionsOnce=new Set(t.unmuteOptions):(0,Qe.objectSome)(t.muteStates,(function(e){return e===G.MuteState.MUTE_PERMANENT}))&&(c.permissionsOnce=void 0),o({type:d.E_ACTION.UPDATE_PARTICIPANTS_BATCH,data:(e={},e[l]=c,e)})}},e.prototype.updatePersonalPermissionsOnce=function(){var e,n=this._params,t=this._store.getState(),a=!(0,Qe.isBoolean)(n.stateUpdated)||n.stateUpdated;n.userId&&!(0,k.isSameExternalId)(n.userId,t.externalId)||n.adminId&&(0,k.isSameExternalId)(n.adminId,t.externalId)||(null===(e=n.requestedMedia)||void 0===e?void 0:e.length)||a&&n.unmuteOptions.length&&this._handleFeedbackEvent({didReceiveEvent:Et.CanTurnOnOnceWithoutAttraction,forMedia:(0,i.__spreadArray)([],(0,i.__read)(n.unmuteOptions),!1)})},e.prototype.attractAttentionIfNeeded=function(){var e=this._params,n=this._store.getState();if((!e.userId||(0,k.isSameExternalId)(e.userId,n.externalId))&&(!e.adminId||!(0,k.isSameExternalId)(e.adminId,n.externalId))&&e.requestedMedia&&e.requestedMedia.length){var t=Et.None,a=Et.None;if(e.requestedMedia.includes(G.MediaOption.AUDIO)&&(e.muteAll&&n.localDevice.permissions.audio===G.MuteState.MUTE_PERMANENT||n.localDevice.mediaSettings.isAudioEnabled||(t=n.permissions[G.MediaOption.AUDIO]===G.MuteState.MUTE_PERMANENT||n.localDevice.permissions.audio===G.MuteState.MUTE_PERMANENT?Et.CanTurnOnOnce:Et.UnmutedWithAttraction)),e.requestedMedia.includes(G.MediaOption.VIDEO)&&(e.muteAll&&n.localDevice.permissions.video===G.MuteState.MUTE_PERMANENT||n.localDevice.mediaSettings.isVideoEnabled||(a=n.permissions[G.MediaOption.VIDEO]===G.MuteState.MUTE_PERMANENT||n.localDevice.permissions.video===G.MuteState.MUTE_PERMANENT?Et.CanTurnOnOnce:Et.UnmutedWithAttraction)),t!==Et.None&&a!==Et.None){var i=Et.None;i=t!=a?Et.CanTurnOnOnce:t,this._handleFeedbackEvent({didReceiveEvent:i,forMedia:[G.MediaOption.AUDIO,G.MediaOption.VIDEO,G.MediaOption.SCREEN_SHARING]})}else t!==Et.None?this._handleFeedbackEvent({didReceiveEvent:t,forMedia:[G.MediaOption.AUDIO]}):a!==Et.None&&this._handleFeedbackEvent({didReceiveEvent:a,forMedia:[G.MediaOption.VIDEO,G.MediaOption.SCREEN_SHARING]})}},e.prototype._handleFeedbackEvent=function(e){var n=e.didReceiveEvent,t=e.forMedia;switch(n){case Et.CanTurnOnOnce:this._lowerHandIfRaised(),this._updatePermissionsOnce(t,St.Increase),this._openUnmuteRequestPopup(t);break;case Et.CanTurnOnOnceWithoutAttraction:this._updatePermissionsOnce(t,St.Reset);break;case Et.UnmutedWithAttraction:this._lowerHandIfRaised(),this._openUnmuteRequestPopup(t);break;case Et.Muted:this._notificationMuted(t);break;case Et.MutedPermanent:this._closeUnmuteRequestPopupIfOpened(),this._updatePermissionsOnce(t,St.Clear),this._notificationMutedPermanent(t);break;case Et.UnmutedWithoutAttraction:this._lowerHandIfRaised(),this._notificationUnmuted(t)}},e.prototype._notificationUnmuted=function(e){var n=null;3===e.length?n=d.NotificationType.ADMIN_UNMUTE_PERMANENT:e.includes(G.MediaOption.AUDIO)?n=d.NotificationType.ADMIN_UNMUTE_PERMANENT_AUDIO:e.includes(G.MediaOption.VIDEO)&&(n=d.NotificationType.ADMIN_UNMUTE_PERMANENT_VIDEO),this._showNotification(n)},e.prototype._notificationMuted=function(e){var n=null;3===e.length?n=d.NotificationType.ADMIN_MUTE:e.includes(G.MediaOption.AUDIO)?n=d.NotificationType.ADMIN_MUTE_AUDIO:e.includes(G.MediaOption.VIDEO)&&(n=d.NotificationType.ADMIN_MUTE_VIDEO),this._showNotification(n)},e.prototype._notificationMutedPermanent=function(e){var n=null;3===e.length?n=d.NotificationType.ADMIN_MUTE_PERMANENT:e.includes(G.MediaOption.AUDIO)?n=d.NotificationType.ADMIN_MUTE_PERMANENT_AUDIO:e.includes(G.MediaOption.VIDEO)&&(n=d.NotificationType.ADMIN_MUTE_PERMANENT_VIDEO),this._showNotification(n)},e.prototype._showNotification=function(e){var n;if(e){var t=null===(n=this._store.getState().notification)||void 0===n?void 0:n.ts;if((0,s.isUndefined)(t)||!(Date.now()-t<1e3))(0,this._dispatch)({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:e}})}},e.prototype._lowerHandIfRaised=function(){var e,n,t=this._store.getState(),a=this._dispatch;(null===(n=null===(e=t.localDevice.statusData)||void 0===e?void 0:e.hand)||void 0===n?void 0:n.state)&&(0,G.changeParticipantState)({hand:d.SdkHandType.LOWERED}).then((function(){a({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{statusData:(0,i.__assign)((0,i.__assign)({},t.localDevice.statusData),{hand:{ts:Date.now(),state:!1}})}})})).catch((function(e){(0,G.debugMessage)(G.DebugMessageType.ERROR,e)}))},e.prototype._openUnmuteRequestPopup=function(e){var n=this._dispatch,t=Xe(Object.values(G.MediaOption)),a=function(e,n){return n.reduce((function(n,t){return n|e[t]}),0)}(t,e),i="";Je(a,t.AUDIO|t.VIDEO|t.SCREEN_SHARING)?i=d.POPUP_UNMUTE_REQUEST:Je(a,t.VIDEO|t.SCREEN_SHARING)?i=d.POPUP_UNMUTE_VIDEO_REQUEST:Je(a,t.AUDIO)&&(i=d.POPUP_UNMUTE_AUDIO_REQUEST),i&&n({type:d.E_ACTION.TOGGLE_POPUP,data:i})},e.prototype._closeUnmuteRequestPopupIfOpened=function(){var e=this._store.getState(),n=this._dispatch;(0,Qe.hasIn)(e.popup,d.POPUP_UNMUTE_REQUEST,d.POPUP_UNMUTE_AUDIO_REQUEST)&&n({type:d.E_ACTION.TOGGLE_POPUP})},e.prototype._updatePermissionsOnce=function(e,n){var t=this._dispatch,a=this._store.getState(),i=new Set(a.localDevice.permissionsOnce);switch(n){case St.Increase:e.forEach((function(e){return i.add(e)}));break;case St.Clear:e.forEach((function(e){return i.delete(e)}));break;case St.Reset:i.clear(),e.forEach((function(e){return i.add(e)}))}t({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{permissionsOnce:i}})},e.getDecreasedPermissionsOnce=function(e,n,t){if(null==t?void 0:t.size){var a=new Set(t);return e.isAudioEnabled&&!n.isAudioEnabled&&a.delete(G.MediaOption.AUDIO),e.isVideoEnabled&&!n.isVideoEnabled&&a.delete(G.MediaOption.VIDEO),e.isScreenSharingEnabled&&!n.isScreenSharingEnabled&&a.delete(G.MediaOption.SCREEN_SHARING),a}},e.getUnmutedPermissions=function(){return{audio:G.MuteState.UNMUTE,video:G.MuteState.UNMUTE,screenSharing:G.MuteState.UNMUTE,movieSharing:G.MuteState.UNMUTE}},e.isMediaAllowed=function(e,n,t){if(!n)return!1;var a=Ye.GlobalStore.getCallsState(),i=a.permissions,o=!("externalId"in n)?n:a.participants[n.externalId.id];if((0,k.isAdmin)(o)||(0,k.isCreator)(o))return!0;var r,s=n.permissions,l=n.permissionsOnce;switch(e){case"audio":r=G.MediaOption.AUDIO;break;case"video":r=G.MediaOption.VIDEO;break;case"screenSharing":r=G.MediaOption.SCREEN_SHARING;break;case"movieSharing":r=G.MediaOption.MOVIE_SHARING}return(null==s?void 0:s[e])===G.MuteState.MUTE||(i[r]!==G.MuteState.MUTE_PERMANENT&&(null==s?void 0:s[e])!==G.MuteState.MUTE_PERMANENT||!t&&!!(null==l?void 0:l.has(r)))},e.mapParticipantPermissions=function(n){var t,a;if(n){var o=e.getUnmutedPermissions();try{for(var r=(0,i.__values)(Object.entries(n)),s=r.next();!s.done;s=r.next()){var l=(0,i.__read)(s.value,2),c=l[0],d=l[1];switch(c){case G.MediaOption.AUDIO:o.audio=d;break;case G.MediaOption.SCREEN_SHARING:o.screenSharing=d;break;case G.MediaOption.VIDEO:o.video=d}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(a=r.return)&&a.call(r)}finally{if(t)throw t.error}}return o}},e.decreasePermissionsOnce=function(n,t,a){var o=n.localDevice,r=o.mediaSettings,s=e.getDecreasedPermissionsOnce(r,a,o.permissionsOnce),l=o.streamMode&&(0,k.isStreamModeAvailable)(o.streamMode,o,a)?o.streamMode:(0,k.getPreviousAvailableStreamMode)((0,i.__assign)((0,i.__assign)({},o),{mediaSettings:a}));t({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{mediaSettings:a,permissionsOnce:s,streamMode:l}})},e.mapArgs=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return{muteStates:e[0],unmuteOptions:e[1],mediaOptions:e[2],muteAll:e[3],unmute:e[4],userId:e[5],adminId:e[6],stateUpdated:e[7],requestedMedia:e[8]}},e}();var yt={acc:{},timer:0,tasks:0};function Nt(e,n,t,a){!function(e,n,t,a,o){void 0===a&&(a=100);var r=(0,k.externalIdToString)(e),s=(0,i.__assign)((0,i.__assign)({},n),{externalId:e});o.acc[r]=o.acc[r]&&"object"==typeof o.acc[r]?(0,i.__assign)((0,i.__assign)({},o.acc[r]),s):s,o.tasks++,o.timer&&clearTimeout(o.timer);o.timer=window.setTimeout((function(){o.tasks>0&&(t(o.acc),o.acc={},o.tasks=0),o.timer=0}),a)}(n,t,(function(n){e({type:d.E_ACTION.UPDATE_PARTICIPANTS_BATCH,data:n})}),a,yt)}function bt(e,n,t){var a,o,r,s,l;if(t)try{for(var c=(0,i.__values)(t),d=c.next();!d.done;d=c.next()){var u=d.value,_=u.mediaSettings,v=u.status,p=u.participantState,f=u.markers,h=u.movieShareInfos,g={mediaSettings:_,markers:f,status:v||G.ParticipantStatus.CONNECTING,statusData:p?(0,k.convertParticipantStateFromSDK)(p):void 0,wasConnected:!1,permissions:xt.mapParticipantPermissions(u.muteStates)};(null==h?void 0:h.length)&&(Mt({externalId:u.uid,sharedMovieInfo:h[0]},n,e),g.movieStreamInfo=h[0]),Nt(n,u.uid,g);var m=e.devices[(0,k.externalIdToString)(u.uid)],A=(null===(r=null==m?void 0:m.mediaSettings)||void 0===r?void 0:r.isScreenSharingEnabled)||!1;(null===(s=null==u?void 0:u.mediaSettings)||void 0===s?void 0:s.isScreenSharingEnabled)!==A&&(0,k.toggleScreenSharing)(e,n,null===(l=null==u?void 0:u.mediaSettings)||void 0===l?void 0:l.isScreenSharingEnabled,u.uid,!0)}}catch(e){a={error:e}}finally{try{d&&!d.done&&(o=c.return)&&o.call(c)}finally{if(a)throw a.error}}}function Mt(e,n,t){var a=e.sharedMovieInfo,i=e.externalId;i&&t.screenSharingPinnedParticipant&&n({type:d.E_ACTION.SET_SCREEN_SHARING_PINNED_PARTICIPANT,screenSharingPinnedParticipant:null}),n({type:d.E_ACTION.SET_MOVIE_SHARING_PINNED_PARTICIPANT,data:i}),n({type:d.E_ACTION.SET_COMMON_SHARED_MOVIE_INFO,data:a}),n({type:d.E_ACTION.SET_SHARED_MOVIE_OWNER,data:i})}var wt=function(e){var n=u(),t=P((function(e){return e.externalId}));return(0,l.useCallback)((function(a){var i;i=a,(0,k.isSameExternalId)(t,e)?n({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{streamMode:i}}):Nt(n,e,{streamMode:i})}),[e])},Ot=t(40249),Pt=t(74140),kt=new Intl.NumberFormat("ru-RU",{minimumIntegerDigits:2}),Lt=function(e){return Math.floor(e/60/60)},Dt=function(e){var n=Lt(e),t=Math.floor((e-60*n*60)/60),a=e-60*t-60*n*60;return""+(n?kt.format(n)+":":"")+kt.format(t)+":"+kt.format(a)},Rt=function(e){var n=e.current,t=e.total,a=Lt(n),r=Lt(t),l=Dt(n),c=Dt(t),d=(0,s.classNames)("CallsMoviePlayerPlayTime__current","CallsMoviePlayerPlayTime__value",{"CallsMoviePlayerPlayTime__value--withHours":!!a}),u=(0,s.classNames)("CallsMoviePlayerPlayTime__total","CallsMoviePlayerPlayTime__value",{"CallsMoviePlayerPlayTime__value--withHours":!!r});return(0,o.jsxs)("div",(0,i.__assign)({className:"CallsMoviePlayerPlayTime"},{children:[(0,o.jsx)("span",(0,i.__assign)({className:d},{children:l}),void 0)," / ",(0,o.jsx)("span",(0,i.__assign)({className:u},{children:c}),void 0)]}),void 0)},jt=function(e){return Math.round(e)+"%"};function Bt(e,n,t){return e<n&&(e=n),e>t&&(e=t),100*(e-n)/(t-n)}var Ut=function(e){var n=e.current,t=e.total,a=e.onRewind,r=e.isEditable,c=e.className,d=e.vkMovieId,u=e.isLive,_=e.isRewindButtonPushed,v=e.setIsRewindButtonPushed,p=e.isPlayed,f=(0,i.__read)((0,l.useState)(n),2),h=f[0],g=f[1],m=(0,i.__read)((0,l.useState)(!1),2),A=m[0],C=m[1],E=(0,l.useRef)(null),S=(0,i.__read)((0,l.useState)(0),2),I=S[0],T=S[1],x=(0,i.__read)((0,l.useState)(""),2),y=x[0],N=x[1],b=(0,l.useCallback)((function(e){return Math.round(t*e/100)}),[t]),M=(0,l.useCallback)((function(e,n){return Promise.resolve(null==a?void 0:a(e,n))}),[a,d]),w=(0,l.useCallback)((function(e){var n=(0,s.getOffsetRect)(E.current),t=n.left,a=n.width,i=Bt(e.clientX-t,0,a),o=b(i);N(Dt(o)),T(i)}),[b]);(0,l.useEffect)((function(){var e;if(!u)return null===(e=E.current)||void 0===e||e.addEventListener("mousemove",w),function(){var e;null===(e=E.current)||void 0===e||e.removeEventListener("mousemove",w)}}),[w,u]);var O=(0,l.useCallback)((function(e){var n=e.clientX,t=(0,s.getOffsetRect)(E.current),a=t.left,i=t.width;if(!(n<a||n>a+i)&&_){var o=Bt(n-a,0,i),r=b(o);g(r)}}),[_,b]);(0,l.useEffect)((function(){return window.addEventListener("mousemove",O),function(){window.removeEventListener("mousemove",O)}}),[O]);var P=(0,l.useCallback)((function(e){e.target.classList.contains("CallsMoviePlayerPlayTimeProgress__button")&&v(!0)}),[v]);(0,l.useEffect)((function(){return window.addEventListener("mousedown",P),function(){window.removeEventListener("mousedown",P)}}),[P]);var k=(0,l.useCallback)((function(){_&&M(d,h).finally((function(){v(!1)}))}),[_,d,h,M]);(0,l.useEffect)((function(){return window.addEventListener("mouseup",k),function(){window.removeEventListener("mouseup",k)}}),[k]),(0,l.useLayoutEffect)((function(){g((function(e){return A||_||!p?e:n}))}),[n,_,A,p]),(0,l.useLayoutEffect)((function(){p||0!==n||g(n)}),[p,n]);var L={width:u?"100%":100*h/t+"%",transition:A||_||h===t||0===h?"none":"width 1s ease-out"},D={left:I+"%"},R=(0,s.classNames)("CallsMoviePlayerPlayTimeProgress",{"CallsMoviePlayerPlayTimeProgress--live":u},c),j=(0,s.classNames)("CallsMoviePlayerPlayTimeProgress__progress",{"CallsMoviePlayerPlayTimeProgress__progress--live":u}),B=(0,s.classNames)("CallsMoviePlayerPlayTimeProgress__button",{"CallsMoviePlayerPlayTimeProgress__button--visible":_});return(0,o.jsxs)("div",(0,i.__assign)({className:R,ref:E,onClick:function(){if(a&&r&&!u&&!_){var e=b(I);g(e),C(!0),M(d,e).finally((function(){C(!1)}))}}},{children:[(0,o.jsx)("div",(0,i.__assign)({className:j,style:L},{children:(0,o.jsx)("div",{className:B},void 0)}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsMoviePlayerPlayTimeProgress__hint",style:D},{children:y}),void 0)]}),void 0)},Ht=function(e){function n(t){var a,i=e.call(this,t)||this;return i.onMouseDown=function(e){0===e.button&&(i.update(e),i.setState({isActive:!0}),window.addEventListener("mouseup",i.onMouseUp),window.addEventListener("mousemove",i.onMouseMove))},i.onMouseMove=function(e){requestAnimationFrame((function(){return i.update(e)}))},i.onMouseUp=function(){i.setState({isActive:!1}),window.removeEventListener("mousemove",i.onMouseMove),window.removeEventListener("mouseup",i.onMouseUp)},i.onMouseEnter=function(){window.addEventListener("mousemove",i.updateHint)},i.onMouseLeave=function(){window.removeEventListener("mousemove",i.updateHint)},i.update=function(e){var t=i.props,a=t.min,o=t.max,r=t.gravity,s=i.getOffset(e),l=s.offset,c=s.width,d=i.getZeroPosition(),u=n.valueToPercent(l,0,c);r&&r>0&&u>=d-r&&u<=d+r&&(u=d),i.state.percentValue!==u&&(i.setState({hintPosition:u}),i.props.onChange(n.percentToValue(u,a,o)),i.isControlledOutside||i.setState({percentValue:u}))},i.updateHint=function(e){var t=i.getOffset(e),a=t.offset,o=t.width;i.setState({hintPosition:n.valueToPercent(a,0,o)})},a=t.value?n.valueToPercent(t.value,t.min,t.max):t.defaultValue?n.valueToPercent(t.defaultValue,t.min,t.max):i.getZeroPosition(),i.state={percentValue:a,hintPosition:0,isActive:!1},i.isControlledOutside=i.props.hasOwnProperty("value"),i.slider=(0,l.createRef)(),i}return(0,i.__extends)(n,e),n.prototype.componentDidMount=function(){this.slider.current&&this.slider.current.addEventListener("mousedown",this.onMouseDown),this.slider.current&&this.slider.current.addEventListener("mouseenter",this.onMouseEnter),this.slider.current&&this.slider.current.addEventListener("mouseleave",this.onMouseLeave)},n.prototype.componentWillUnmount=function(){this.slider.current&&this.slider.current.removeEventListener("mousedown",this.onMouseDown),this.slider.current&&this.slider.current.removeEventListener("mouseenter",this.onMouseEnter),this.slider.current&&this.slider.current.removeEventListener("mouseleave",this.onMouseLeave)},n.prototype.componentDidUpdate=function(e){var t=this.props.value;if(this.isControlledOutside&&void 0!==t&&t!==e.value){var a=this.props,i=a.min,o=a.max;this.setState({percentValue:n.valueToPercent(t,i,o)})}},n.valueToPercent=function(e,n,t){return e<n&&(e=n),e>t&&(e=t),100*(e-n)/(t-n)},n.percentToValue=function(e,n,t){return Math.round(100*(e*(t-n)/100+n))/100},n.getFillPosition=function(e,n){var t,a;return e<n?(t=e,a=n-e):(t=n,a=e-n),{left:t,width:a}},n.prototype.getZeroPosition=function(){var e=this.props,t=e.min,a=e.max;return n.valueToPercent(0,t,a)},n.prototype.getOffset=function(e){var n=this.props,t=n.min,a=n.max,i=n.step,o=(0,s.getOffsetRect)(this.slider.current),r=o.left,l=o.width,c=e.clientX-r;if(i>0){var d=l/((a-t)/i);c=Math.round(c/d)*d}return{offset:c,left:r,width:l}},n.prototype.render=function(){var e=this.props,t=e.min,a=e.max,r=e.isShowZero,l=e.isShowHandle,c=e.appearance,d=this.state,u=d.percentValue,_=d.hintPosition,v=d.isActive,p=this.getZeroPosition(),f=n.getFillPosition(u,p),h=f.left,g=f.width,m=u!==p,A=this.props.formatHint(n.percentToValue(_,t,a)),C=(0,s.classNames)("CallsSlider","CallsSlider--"+c,{CallsSlider__active:v}),E=(0,s.classNames)("CallsSlider__handle",{"CallsSlider__handle--active":m,"CallsSlider__handle--show":l});return(0,o.jsxs)("div",(0,i.__assign)({className:C,ref:this.slider},{children:[(0,o.jsx)("input",{type:"hidden",value:u},void 0),r&&m&&(0,o.jsx)("div",{className:"CallsSlider__middletick",style:{left:p+"%"}},void 0),(0,o.jsx)("span",(0,i.__assign)({className:(0,s.classNames)("CallsSlider__hint",this.props.hintClass),style:{left:_+"%"}},{children:A}),void 0),(0,o.jsx)("div",{className:"CallsSlider__fill",style:{left:h+"%",width:g+"%"}},void 0),(0,o.jsx)("div",{className:E,style:{left:u+"%"}},void 0)]}),void 0)},n.defaultProps={min:0,max:100,step:0,gravity:0,isShowZero:!1,isShowHandle:!1,defaultValue:0,appearance:"blue",name:"value",onChange:function(){},formatHint:function(e){return e}},n}(l.Component);const Vt=Ht;var Gt=t(23326);const Ft=(0,F.makeIcon)("Icon24Mute","mute_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="mute_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M8.695 8.105 5.301 4.71a1 1 0 0 1 1.414-1.415L20.7 17.285a1 1 0 0 1-1.414 1.415L16 15.41V20a1 1 0 0 1-1 1c-.641 0-1.258-.25-1.72-.695L7.79 15H5a2 2 0 0 1-2-2v-2a2 2 0 0 1 2-2h2.765l.93-.895Zm2.88-2.77 1.704-1.642A2.481 2.481 0 0 1 15 3a1 1 0 0 1 1 1v5.76l-4.426-4.426Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0),Zt=(0,F.makeIcon)("Icon24Volume","volume_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="volume_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M21.657 17.657a.9.9 0 1 1-1.273-1.273 6.2 6.2 0 0 0 0-8.768.9.9 0 1 1 1.273-1.273 8 8 0 0 1 0 11.314ZM19.11 15.11a.9.9 0 0 1-1.273-1.273 2.6 2.6 0 0 0 0-3.676.9.9 0 1 1 1.273-1.273 4.4 4.4 0 0 1 0 6.222ZM5 15a2 2 0 0 1-2-2v-2a2 2 0 0 1 2-2h2.765l5.514-5.307A2.481 2.481 0 0 1 15 3a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1c-.641 0-1.258-.25-1.72-.695L7.79 15H5Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',24,24,!1,void 0);var Wt=function(e){var n=e.onChange,t=e.value,a=void 0===t?0:t,r=e.className,c=e.vkMovieId,d=e.isMuted,u=e.onMute,_=e.onUnMute,v=(0,l.useContext)(E.LangContext).getLang,p=(0,Gt.useIsMounted)(),f=(0,i.__read)((0,l.useState)((function(){return(0,s.isNumber)(a)?a:1})),2),h=f[0],g=f[1],m=(0,i.__read)((0,l.useState)(!1),2),A=m[0],S=m[1],I=(0,l.useRef)(null),T=(0,l.useRef)(h),x=(0,l.useCallback)((function(e){S(!0),g(e/100)}),[]);(0,l.useEffect)((function(){(0,s.isNumber)(a)&&(g(a),T.current=a)}),[a]),(0,l.useEffect)((function(){return n&&(I.current=setTimeout((function(){p()&&h!==T.current&&Promise.resolve(null==n?void 0:n(c,h,d)).finally((function(){S(!1)}))}),300)),function(){I.current&&clearTimeout(I.current)}}),[h,n,d]);var y=(0,l.useCallback)((function(){!d&&a?u(c,a):_(c,a||.1)}),[d,u,_,c,a]),N=v(h?"calls_movie_player_sound_off":"calls_movie_player_sound_on"),b=d&&!A?0:100*h;return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("CallsMovieVolumeSlider",r)},{children:[(0,o.jsx)(C.default,(0,i.__assign)({appearance:"dark",text:N,position:"t",marginTop:-5},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallsMovieVolumeSlider__icon",onClick:y},{children:b?(0,o.jsx)(Zt,{},void 0):(0,o.jsx)(Ft,{},void 0)}),void 0)}),void 0),(0,o.jsx)(Vt,{min:0,max:100,onChange:x,value:b,formatHint:jt,appearance:"white",hintClass:"CallsMovieVolumeSlider__sliderHint"},void 0)]}),void 0)};const zt=(0,F.makeIcon)("Icon24Pause","pause_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="pause_24"><path d="M6 6.6c0-.56 0-.84.109-1.054a1 1 0 0 1 .437-.437C6.76 5 7.04 5 7.6 5h.8c.56 0 .84 0 1.054.109a1 1 0 0 1 .437.437C10 5.76 10 6.04 10 6.6v10.8c0 .56 0 .84-.109 1.054a1 1 0 0 1-.437.437C9.24 19 8.96 19 8.4 19h-.8c-.56 0-.84 0-1.054-.109a1 1 0 0 1-.437-.437C6 18.24 6 17.96 6 17.4V6.6Zm8 0c0-.56 0-.84.109-1.054a1 1 0 0 1 .437-.437C14.76 5 15.04 5 15.6 5h.8c.56 0 .84 0 1.054.109a1 1 0 0 1 .437.437C18 5.76 18 6.04 18 6.6v10.8c0 .56 0 .84-.109 1.054a1 1 0 0 1-.437.437C17.24 19 16.96 19 16.4 19h-.8c-.56 0-.84 0-1.054-.109a1 1 0 0 1-.437-.437C14 18.24 14 17.96 14 17.4V6.6Z" /></symbol>',24,24,!1,void 0),Kt=(0,F.makeIcon)("Icon24Play","play_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="play_24"><path d="M18.5 11.134a1 1 0 0 1 0 1.732l-9 5.196a1 1 0 0 1-1.5-.866V6.804a1 1 0 0 1 1.5-.866l9 5.196Z" /></symbol>',24,24,!1,void 0);var Qt=t(64107);const Yt=(0,je.makeIcon)("Icon64PauseButton","pause_button_64","0 0 64 64",'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" id="pause_button_64"><path opacity=".4" fill-rule="evenodd" clip-rule="evenodd" d="M32 64c17.673 0 32-14.327 32-32C64 14.327 49.673 0 32 0 14.327 0 0 14.327 0 32c0 17.673 14.327 32 32 32z" fill="#000" /><path fill-rule="evenodd" clip-rule="evenodd" d="M22.183 20.915C22 21.273 22 21.742 22 22.68v18.64c0 .938 0 1.407.183 1.765.16.316.416.572.732.732.358.183.827.183 1.765.183h2.14c.938 0 1.407 0 1.765-.183a1.66 1.66 0 0 0 .732-.732c.183-.358.183-.827.183-1.765V22.68c0-.938 0-1.407-.183-1.765a1.675 1.675 0 0 0-.732-.732C28.227 20 27.758 20 26.82 20h-2.14c-.938 0-1.407 0-1.765.183a1.66 1.66 0 0 0-.732.732zm13 0C35 21.273 35 21.742 35 22.68v18.64c0 .938 0 1.407.183 1.765.16.316.416.572.732.732.358.183.827.183 1.765.183h2.14c.938 0 1.407 0 1.765-.183a1.66 1.66 0 0 0 .732-.732c.183-.358.183-.827.183-1.765V22.68c0-.938 0-1.407-.183-1.765a1.675 1.675 0 0 0-.732-.732C41.227 20 40.758 20 39.82 20h-2.14c-.938 0-1.407 0-1.765.183a1.66 1.66 0 0 0-.732.732z" fill="#fff" /></symbol>',64,64),Jt=(0,je.makeIcon)("Icon64PlayButton","play_button_64","0 0 64 64",'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" id="play_button_64"><path opacity=".4" fill-rule="evenodd" clip-rule="evenodd" d="M32 64c17.673 0 32-14.327 32-32C64 14.327 49.673 0 32 0 14.327 0 0 14.327 0 32c0 17.673 14.327 32 32 32z" fill="#000" /><path fill-rule="evenodd" clip-rule="evenodd" d="M24 22.023a1.5 1.5 0 0 1 2.267-1.29L43.023 30.7a1.5 1.5 0 0 1 .001 2.578l-16.756 9.987A1.5 1.5 0 0 1 24 41.976V22.023z" fill="#fff" /></symbol>',64,64),Xt=(0,je.makeIcon)("Icon20LiveBadge","live_badge_20","0 0 42 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 42 20" id="live_badge_20"><path fill="#FF3347" d="M0 8c0-2.8 0-4.2.545-5.27A5 5 0 0 1 2.73.545C3.8 0 5.2 0 8 0h26c2.8 0 4.2 0 5.27.545a5 5 0 0 1 2.185 2.185C42 3.8 42 5.2 42 8v4c0 2.8 0 4.2-.545 5.27a5 5 0 0 1-2.185 2.185C38.2 20 36.8 20 34 20H8c-2.8 0-4.2 0-5.27-.545A5 5 0 0 1 .545 17.27C0 16.2 0 14.8 0 12V8Z" /><path fill="#F2F3F5" d="M8 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4a1 1 0 1 0 0-2H9V6a1 1 0 0 0-1-1Zm7 1a1 1 0 1 1 2 0v8a1 1 0 1 1-2 0V6Zm15-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4a1 1 0 1 0 0-2h-3v-2h3a1 1 0 1 0 0-2h-3V7h3a1 1 0 1 0 0-2h-4Zm-8.325 9.31-2.55-7.824a.993.993 0 0 1-.117-.363L19 6.1h.005a1 1 0 1 1 1.99-.199L21 5.9l2 6.4 2-6.4h.005a1 1 0 0 1 1.99.2H27l-.008.023a.993.993 0 0 1-.118.363l-2.55 7.824a1 1 0 0 1-.95.69h-.748a1 1 0 0 1-.95-.69Z" /></symbol>',42,20);var qt=function(e){var n=e||{},t=n.hideTime,a=void 0===t?3e3:t,o=n.onAsyncHide,r=n.onMouseMove,c=n.onMouseLeave,d=n.onMouseOver,u=n.isHardStop,_=void 0!==u&&u,v=(0,i.__read)((0,l.useState)(!1),2),p=v[0],f=v[1],h=(0,i.__read)((0,l.useState)(!1),2),g=h[0],m=h[1],A=(0,l.useRef)(null),C=(0,l.useCallback)((function(){m(!1)}),[]),E=(0,l.useCallback)((function(){m(!0)}),[]),S=function(){A.current&&(clearTimeout(A.current),A.current=null)},I=(0,l.useCallback)((function(){S(),A.current=setTimeout((function(){C(),null==o||o(),A.current=null}),a)}),[a,o]);(0,l.useEffect)((function(){if(_)return S(),void E();p||I()}),[g,p,_,I]);var T=(0,l.useCallback)((function(){_||(p||(f(!0),E()),null==d||d(p))}),[p,_,d]),x=(0,l.useCallback)((function(){_||(S(),f(!1),C(),null==c||c())}),[_,c]),y=(0,l.useCallback)((0,s.throttle)((function(){_||(p&&(g?I():E()),null==r||r(p))}),1e3),[p,g,_,r]);return{isShowControls:g,isFocusInElement:p,handleMouseLeave:x,handleMouseMove:y,handleMouseOver:T,handleShowControls:E,handleHideControls:C}},$t=function(e){var n=(0,l.useRef)(null);return(0,l.useEffect)((function(){n.current&&(!function(){var e;if(n.current){var t=null===(e=n.current)||void 0===e?void 0:e.srcObject;t&&(t.getTracks().forEach((function(e){return e.stop()})),n.current.srcObject=null)}}(),n.current.srcObject=e||null,n.current.play())}),[e]),{videoRef:n}},ea=function(){var e=P((function(e){return e.sharedMovieOwner})),n=P((function(e){return e.externalId}));return(0,k.isSameExternalId)(e,n)},na=(0,l.memo)((function(e){var n=e.title,t=e.current,a=e.total,r=e.isEditable,c=e.onRewind,d=e.volumeValue,u=e.onChangeVolume,_=e.vkMovieId,v=e.onPause,p=e.onPlay,f=e.onRemove,h=e.streamData,g=e.isPlayed,m=e.handleShowCallControls,A=e.isMovieStreamEnabled,C=e.mode,E=e.onMute,S=e.onUnMute,I=e.isMuted,T=C===G.MediaType.MOVIE,x=C===G.MediaType.STREAM,y=$t(null==h?void 0:h.data).videoRef,N=(0,i.__read)((0,l.useState)(!1),2),b=N[0],M=N[1],w=qt(),O=w.isShowControls,P=w.handleMouseLeave,k=w.handleMouseMove,L=w.handleMouseOver,D=w.handleShowControls,R=ea(),j=(0,l.useCallback)((function(){r&&(O||(D(),m()),g?null==v||v(_).then((function(){y.current&&y.current.pause()})):null==p||p(_).then((function(){y.current&&y.current.play()})))}),[v,p,g,O,D,m,_,r]),B=(0,l.useCallback)((function(){null==f||f(_)}),[f,_]),U=function(e){var n;"body"===(null===(n=null==e?void 0:e.target)||void 0===n?void 0:n.localName)&&"Space"===e.code&&r&&j()};(0,l.useEffect)((function(){return window.addEventListener("keydown",U),function(){return window.removeEventListener("keydown",U)}}),[r,p,v,g]),(0,l.useEffect)((function(){!A&&R&&B()}),[R,A,B]);var H=(0,s.classNames)("CallsMoviePlayer__playPauseMain","CallsMoviePlayer__opacity"),V=x?100:t,F=x?100:a;return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("CallsMoviePlayer",{"CallsMoviePlayer--rewindNow":b,"CallsMoviePlayer--editable":r,"CallsMoviePlayer__show-controls":O||b}),onMouseOver:L,onMouseLeave:P,onMouseMove:k},{children:[(0,o.jsx)("video",{ref:y,className:"CallsMoviePlayer__video",controls:!1,crossOrigin:"anonymous",playsInline:!0,muted:!0,onClick:j},void 0),g&&r&&(0,o.jsx)(Yt,{className:H,onClick:j},void 0),!g&&r&&(0,o.jsx)(Jt,{className:H,onClick:j},void 0),(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("CallsMoviePlayer__title","CallsMoviePlayer__opacity")},{children:n}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("CallsMoviePlayer__controls","CallsMoviePlayer__opacity")},{children:[!!g&&!!r&&(0,o.jsx)(zt,{className:(0,s.classNames)("CallsMoviePlayer__playPause"),onClick:j},void 0),!g&&!!r&&(0,o.jsx)(Kt,{className:(0,s.classNames)("CallsMoviePlayer__playPause"),onClick:j},void 0),x&&(0,o.jsx)(Xt,{},void 0),(0,o.jsx)(Ut,{current:V,isEditable:r,onRewind:c,vkMovieId:_,total:F,isLive:x,isRewindButtonPushed:b,setIsRewindButtonPushed:M,isPlayed:Boolean(g)},void 0),T&&(0,o.jsx)(Rt,{current:V,total:F},void 0),!!r&&(0,o.jsx)(Wt,{onChange:u,value:d,vkMovieId:_,onMute:E,onUnMute:S,isMuted:I},void 0)]}),void 0),!!r&&(0,o.jsx)(Qt.default,{className:(0,s.classNames)("CallsMoviePlayer__closeMovieIcon","CallsMoviePlayer__opacity"),onClick:B},void 0),(0,o.jsx)("div",{className:(0,s.classNames)({CallsMoviePlayer__overlay:!0,CallsMoviePlayer__opacity:!0})},void 0)]}),void 0)})),ta=function(e){var n=e.SDK,t=e.movieAddCallback,a=e.movieRemoveCallback,i=e.moviePauseCallback,o=e.moviePlayCallback,r=e.movieRewindCallback,s=e.movieSoundChangeCallback,c=(0,l.useCallback)((function(e){return n.updateMovie({movieId:e,pause:!0}).then((function(){null==i||i()})).catch((function(e){(0,G.debugMessage)(G.DebugMessageType.ERROR,e)}))}),[i]),d=(0,l.useCallback)((function(e){if(e.ov_id){var a={movieId:e.ov_id,metadata:{title:e.title,thumbnails:e.image},gain:.5};return n.addMovie(a).then((function(){null==t||t()})).catch((function(e){(0,G.debugMessage)(G.DebugMessageType.ERROR,e)}))}}),[t]),u=(0,l.useCallback)((function(e){return n.updateMovie({movieId:e,pause:!1}).then((function(){null==o||o()})).catch((function(e){(0,G.debugMessage)(G.DebugMessageType.ERROR,e)}))}),[o]),_=(0,l.useCallback)((function(e,t){return n.updateMovie({movieId:e,offset:t}).then((function(){null==r||r()})).catch((function(e){(0,G.debugMessage)(G.DebugMessageType.ERROR,e)}))}),[r]),v=(0,l.useCallback)((function(e,t,a){void 0===a&&(a=!1);var i={movieId:e,gain:t};return a&&(i.mute=!1),n.updateMovie(i).then((function(){null==s||s()})).catch((function(e){(0,G.debugMessage)(G.DebugMessageType.ERROR,e)}))}),[s]),p=(0,l.useCallback)((function(e,t){return n.updateMovie({movieId:e,gain:t,mute:!0}).then((function(){null==s||s()})).catch((function(e){(0,G.debugMessage)(G.DebugMessageType.ERROR,e)}))}),[]),f=(0,l.useCallback)((function(e,t){var a={movieId:e,mute:!1};return t&&(a.gain=t),n.updateMovie(a).then((function(){null==s||s()})).catch((function(e){(0,G.debugMessage)(G.DebugMessageType.ERROR,e)}))}),[]);return{handleAddMovie:d,handleMoviePause:c,handleMoviePlay:u,handleMovieRewind:_,handleMovieSoundChange:v,handleRemoveMovie:(0,l.useCallback)((function(e){return n.removeMovie(e).then((function(){null==a||a()})).catch((function(e){(0,G.debugMessage)(G.DebugMessageType.ERROR,e)}))}),[a]),handleMovieMute:p,handleMovieUnMute:f}},aa=function(e){var n,t,a,i,r,s=e.onToggleScreenShare,c=e.streamMode,d=e.orator,u=e.handleShowCallControls,_=e.streamedMovieState,v=e.localExternalId,p=e.me,f=e.groupId,h=e.meGroup,g=e.localDevice,m=e.SDK,A=ze().getLang,C=d.device,E=d.participant;"externalId"in C?(a=(0,k.isSameExternalId)(C.externalId,v),i=(0,k.externalIdToString)(C.externalId),r=C.externalId):(a=(null==E?void 0:E.peerId)===p,i=null==E?void 0:E.peerId,r=v||(0,k.getDefaultExternalId)()),a&&f&&h&&(E=E&&(0,$e.mergeGroupToParticipant)(h,E));var S=(0,l.useMemo)((function(){return(0,k.getStream)(C)}),[C,c]),I=!(!(0,k.isParticipantWithVideo)(C)||!(null==S?void 0:S.data)),T=ea(),x=ta({SDK:m}),y=x.handleRemoveMovie,N=x.handleMovieSoundChange,b=x.handleMoviePause,M=x.handleMovieRewind,w=x.handleMoviePlay,O=x.handleMovieMute,P=x.handleMovieUnMute,L=C.movieStreamInfo,D=C.movieStream,R=(0,k.participantIsAdmin)(g);return D&&L&&(c===G.MediaType.MOVIE||c===G.MediaType.STREAM)?(0,o.jsx)(na,{title:null==L?void 0:L.title,vkMovieId:String(null==L?void 0:L.movieId),current:(null==_?void 0:_.offset)||0,volumeValue:null==_?void 0:_.gain,isPlayed:!(null==_?void 0:_.pause),isMuted:null==_?void 0:_.mute,total:null==L?void 0:L.duration,streamData:S,onPause:b,onPlay:w,onRewind:M,onChangeVolume:N,onMute:O,onUnMute:P,onRemove:y,isEditable:R||T,handleShowCallControls:u,isMovieStreamEnabled:!0,mode:L.source},void 0):(0,o.jsx)(ge,{externalId:r,isOrator:!0,isMe:a,hasVideo:!!I,hasAudio:!!(null===(n=C.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),isSharingScreen:!!(null===(t=C.mediaSettings)||void 0===t?void 0:t.isScreenSharingEnabled),streamData:S,photo:null==E?void 0:E.photo,name:a?A("calls_own_label"):null==E?void 0:E.name,status:C.status,wasConnected:C.wasConnected,networkStatus:C.networkStatus,allowContain:!0,onStopScreenShare:s,streamMode:c},i)},ia=(0,l.memo)((function(e){var n,t,a,r,s,c=e.orator,d=e.me,u=e.isPinned,_=e.isPinnedByAdmin,v=e.isPinnedByShareScreen,p=e.isUnpinAllowed,f=e.onTooltipChange,h=e.onUnpin,g=e.tooltips,m=e.oratorDevice,A=(0,l.useContext)(E.LangContext).getLang,C=_||v||u,S=(0,l.useCallback)((function(){f("oratorPin",!1),h()}),[h]),I=(0,l.useCallback)((function(){return f("oratorPin",!0)}),[]),T=(0,l.useCallback)((function(){return f("oratorPin",!1)}),[]),x=(m.wasConnected||c.peerId===d)&&!(null===(n=m.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),y=null===(t=m.mediaSettings)||void 0===t?void 0:t.isScreenSharingEnabled,N=c.shortName||c.name,b=c.shortNameGen||c.shortName||c.name,M=((null===(a=m.mediaSettings)||void 0===a?void 0:a.isAudioEnabled)||(null===(r=m.mediaSettings)||void 0===r?void 0:r.isScreenSharingEnabled)||(null===(s=m.mediaSettings)||void 0===s?void 0:s.isVideoEnabled))&&(m.networkStatus||1)<.6,w=(0,o.jsxs)(o.Fragment,{children:[_&&(0,o.jsx)(ve,{},void 0),!_&&(v||u)&&(0,o.jsx)(pe,{},void 0),M&&(0,o.jsx)(W,{fill:(m.networkStatus||1)<=.3?"#ff5c5c":"#FECE00"},void 0),y&&(0,o.jsx)("span",(0,i.__assign)({className:"OratorTitle__additionInfo"},{children:A("calls_orator_screen_sharing")}),void 0),(0,o.jsx)("span",(0,i.__assign)({className:"OratorTitle__name"},{children:y?b:N}),void 0),x&&(0,o.jsx)(Z,{},void 0)]},void 0);return C?(0,o.jsx)(be.TooltipNew,(0,i.__assign)({position:"b",align:"center",content:A(_&&p?"calls_hint_admin_pin_for_admin":_?"calls_hint_admin_pin_for_user":"calls_hint_user_pin"),open:g.oratorPin,delay:300,onOpen:I,onClose:T},{children:(0,o.jsx)("button",(0,i.__assign)({className:"OratorTitle OratorTitle--button",onClick:S,disabled:!p},{children:w}),void 0)}),void 0):(0,o.jsx)("div",(0,i.__assign)({className:"OratorTitle"},{children:w}),void 0)})),oa=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"14",height:"12",fill:"currentColor"},n,{xmlns:"http://www.w3.org/2000/svg"},{children:(0,o.jsx)("path",{d:"M9.574 11.13a.751.751 0 001.061-1.06L1.48.92A.75.75 0 10.42 1.98l.82.82c-.153.282-.24.606-.24.95v4.5a2 2 0 002 2h5a2 2 0 00.601-.092l.973.972zM13.897 3.664A.454.454 0 0114 3.95v4.075c0 .415-.392.602-.825.382-.475-.24-1.572-.789-1.572-.789a.233.233 0 01-.103-.19v-2.88c0-.075.038-.146.103-.19 0 0 1.378-.694 1.572-.79.193-.094.55-.115.722.096zM10 7.425V3.75a2 2 0 00-2-2H4.32L10 7.425z"},void 0)}),void 0)},ra=function(e){var n=e.children,t=e.className,a=(0,s.classNames)("CallNotification",t);return(0,o.jsx)("div",(0,i.__assign)({className:a},{children:n}),void 0)},sa=function(e){var n=e.duration;return(0,o.jsx)("div",{className:"CallTimer","aria-label":n,"data-duration":n},void 0)},la=t(90355),ca=function(e){var n=e.status,t=(0,l.useContext)(E.LangContext).getLang;switch(n){case G.ParticipantStatus.WAITING:return(0,o.jsx)(la.default,{children:t("calls_status_waiting")},void 0);case G.ParticipantStatus.CONNECTING:case G.ParticipantStatus.RECONNECT:return(0,o.jsx)(la.default,{children:t("calls_status_connecting")},void 0);case G.ParticipantStatus.ERROR:return t("calls_error");case G.ParticipantStatus.HANGUP:return(0,o.jsx)(la.default,{children:t("calls_status_hangup")},void 0);case G.ParticipantStatus.PERMISSIONS:return t("calls_status_no_permissions");case G.ParticipantStatus.CONNECTED:default:return null}};function da(e){return e?(0,o.jsx)(sa,{duration:(0,Qe.calculateCallDuration)(e)},void 0):null}function ua(e,n){if(e.hangupType)switch(e.hangupType){case d.HANGUP_TYPE_BUSY:return n("calls_busy");case d.HANGUP_TYPE_CALLEE_IS_OFFLINE:return n("calls_callee_is_offline");case d.HANGUP_TYPE_REJECTED:return n("calls_rejected_status");case d.HANGUP_TYPE_CANCELED:case d.HANGUP_TYPE_MISSED:case d.HANGUP_TYPE_HUNGUP:case d.HANGUP_TYPE_REMOVED:return null;case d.HANGUP_TYPE_CALLER_IS_BLOCKED:case d.HANGUP_TYPE_EXTERNAL_API_ERROR:case d.HANGUP_TYPE_FAILED:case d.HANGUP_TYPE_NOT_FRIENDS:case d.HANGUP_TYPE_OLD_VERSION:case d.HANGUP_TYPE_SERVICE_DISABLED:case d.HANGUP_TYPE_UNKNOWN_ERROR:case d.HANGUP_TYPE_UNSUPPORTED:return n("calls_error")}return null}var _a=function(e,n){return e?ua(e,n)||function(e,n){var t,a=null;return(a=n===e.me?e.localDevice:(0,k.getPeerIdDeviceInfo)(n,e.devices))&&a.status===G.ParticipantStatus.CONNECTED||a&&a.status===G.ParticipantStatus.WAITING_HALL||(0,k.getActiveParticipantsCount)(e)<2?null:(0,o.jsx)(ca,{status:null!==(t=null==a?void 0:a.status)&&void 0!==t?t:G.ParticipantStatus.WAITING},void 0)}(e,(0,M.isGroupCallByPeer)(e.peer)?e.me:e.peer)||function(e,n){return void 0===((0,M.isGroupCallByPeer)(e.peer)?e.callData.ts:e.callData.localTimeStamp)?(0,o.jsx)(la.default,{children:n("calls_status_waiting")},void 0):null}(e,n):""},va=function(e){var n=e.dispatch,t=e.notification,a=e.participant,r=e.className,s=void 0===r?"":r,u=(0,l.useContext)(E.LangContext),_=u.getLang,v=u.langSex,p=(0,c.useSelector)((function(e){return e})),f=(0,l.useMemo)((function(){return function(e,n,t,a){void 0===a&&(a={name:"",sex:"0",shortName:""});if(!e)return null;switch(e.type){case d.NotificationType.SPEAKING_ON_MUTE:return n("calls_notification_mic_is_mute");case d.NotificationType.SCREEN_SHARING_STARTED:if(!a||!a.name)return(0,o.jsx)("span",{children:n("calls_notification_screen_sharing_started")},void 0);var r=t(a.sex,"calls_notification_user_started_screen_sharing",n("calls_notification_user_started_screen_sharing",!0));return(0,o.jsx)("span",{children:r.replace("{user}",a.name)},void 0);case d.NotificationType.RAISED_HAND:if(!a||!a.name)return null;r=t(a.sex,"calls_notification_raised_hand",n("calls_notification_raised_hand",!0));return(0,o.jsx)("span",{children:r.replace("{user}",a.name)},void 0);case d.NotificationType.BAD_NETWORK_CONNECTION:return(0,o.jsx)("span",{children:n("calls_notification_bad_network_connection")},void 0);case d.NotificationType.BAD_NETWORK_CONNECTION_DISABLE_CAMERA:return[(0,o.jsx)(oa,{},"icon"),(0,o.jsx)("span",{children:n("calls_notification_bad_network_connection_disable_camera")},"text")];case d.NotificationType.ADMIN_ROLE_GRANTED:return(0,o.jsx)("span",{children:n("calls_notification_admin_role_granted")},"text");case d.NotificationType.USER_GRANTED_WITH_ADMIN_ROLE:if(!a||!a.name&&!a.shortName)return null;var s=n("calls_notification_user_granted_with_admin_role").replace("{name}",a.shortName||a.name);return(0,o.jsx)("span",{children:s},"text");case d.NotificationType.PINNED_BY_ADMIN:return(0,o.jsx)("span",{children:n("calls_notification_admin_pinned_self")},"text");case d.NotificationType.USER_PINNED_BY_ADMIN:if(!a||!a.name&&!a.shortName)return null;s=n("calls_notification_admin_pinned_user").replace("{name}",a.shortName||a.name);return(0,o.jsx)("span",{children:s},"text");case d.NotificationType.PUSH_TO_TALK:s=n("calls_notification_push_to_talk_enabled");return[e.data?(0,o.jsx)(De,{},"icon"):(0,o.jsx)(ke,{},"icon"),(0,o.jsx)("div",(0,i.__assign)({className:"CallNotification__pushToTalkText"},{children:s}),"text")];case d.NotificationType.LINK_COPIED_TO_CLIPBOARD:s=n("calls_create_call_by_link_copied");return(0,o.jsx)("span",{children:s},"text");case d.NotificationType.ADMIN_MUTE:return(0,o.jsx)("span",{children:n("calls_notification_admin_mute")},"text");case d.NotificationType.ADMIN_MUTE_AUDIO:return(0,o.jsx)("span",{children:n("calls_notification_admin_mute_audio")},"text");case d.NotificationType.ADMIN_MUTE_VIDEO:return(0,o.jsx)("span",{children:n("calls_notification_admin_mute_video")},"text");case d.NotificationType.ADMIN_MUTE_PERMANENT:return(0,o.jsx)("span",{children:n("calls_notification_admin_permanent_mute")},"text");case d.NotificationType.ADMIN_MUTE_PERMANENT_AUDIO:return(0,o.jsx)("span",{children:n("calls_notification_admin_permanent_mute_audio")},"text");case d.NotificationType.ADMIN_MUTE_PERMANENT_VIDEO:return(0,o.jsx)("span",{children:n("calls_notification_admin_permanent_mute_video")},"text");case d.NotificationType.ADMIN_UNMUTE_PERMANENT:return(0,o.jsx)("span",{children:n("calls_notification_admin_unmute")},"text");case d.NotificationType.ADMIN_UNMUTE_PERMANENT_AUDIO:return(0,o.jsx)("span",{children:n("calls_notification_admin_unmute_audio")},"text");case d.NotificationType.ADMIN_UNMUTE_PERMANENT_VIDEO:return(0,o.jsx)("span",{children:n("calls_notification_admin_unmute_video")},"text");default:return null}}(t,_,v,a)}),[t,a]),h=(0,l.useRef)(0);(0,l.useEffect)((function(){return h.current&&window.clearTimeout(h.current),t&&0!==t.timer&&(h.current=window.setTimeout((function(){n({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),h.current=0}),t.timer||d.defaultNotificationLifeSpan)),function(){h.current&&window.clearTimeout(h.current)}}),[t]);var g=(0,le.classNames)(s,{CallNotification__pushToTalk:(null==t?void 0:t.type)===d.NotificationType.PUSH_TO_TALK}),m=p.peer,A=(0,M.isGroupCallByPeer)(m)?p.callData.conversation:(0,k.getPeerIdDeviceInfo)(m,p.devices),C=(0,i.__read)((0,l.useState)(),2),S=C[0],I=C[1],T=(0,i.__read)((0,l.useState)(""),2),x=T[0],y=T[1];return(null==A?void 0:A.status)!==S&&(y(_a(p,_)),I(null==A?void 0:A.status)),(0,l.useEffect)((function(){y(_a(p,_))}),[p]),t||x?(0,o.jsx)(ra,(0,i.__assign)({className:g},{children:x||f}),void 0):null};function pa(e){void 0===e&&(e="");var n=u(),t=P((function(e){return e.notification})),a=P((function(e){return e.participants}));return(0,l.useMemo)((function(){return(0,o.jsx)(va,{dispatch:n,notification:t,participant:a[null==t?void 0:t.data],className:e},void 0)}),[t,a[null==t?void 0:t.data]])}var fa=function(e){var n=e.children,t=e.onToggleParticipantsAside,a=e.isShownParticipantsAside,r=e.onScroll,c=e.scrollPosition,d=e.participantsAsideCount,u=e.firstRenderedParticipantIndex,_=e.isFullScreen,v=e.onToggleScreenShare,p=e.localDevice,f=e.SDK,h=e.orator,g=e.handleShowCallControls,m=e.streamedMovieState,A=e.localExternalId,C=e.me,E=e.groupId,S=e.meGroup,I=e.isPinned,T=e.isPinnedByAdmin,x=e.isPinnedByShareScreen,y=e.isUnpinAllowed,N=e.onUnpin,b=e.tooltips,M=e.onTooltipChange,w=h.device,O=h.externalId,P=wt(O),L=(0,l.useMemo)((function(){return(0,k.getAvailableStreamModes)(w)}),[w]),D=l.Children.toArray(n),R=(0,s.classNames)("CallOrator__toggleIcon","CallOrator__toggleIcon--withAnimation"),j=(0,s.classNames)("CallOrator",{"CallOrator--withoutOthers":!a}),B=(0,s.classNames)("CallOrator__others",{"CallOrator__others--hide":!a}),U=(0,s.classNames)("CallOrator__orator",{"CallOrator__orator--fullScreen":_}),H=(0,s.classNames)("CallOrator__toggleOthers",{"CallOrator__orator--fullScreen":_}),V=(0,l.useRef)(null);(0,l.useEffect)((function(){var e=function(){null!==V.current&&r(V.current.scrollTop)};return null!==V.current&&V.current.addEventListener("scroll",e),function(){V.current&&V.current.removeEventListener("scroll",e)}}),[]),(0,l.useEffect)((function(){var e;r(c),null===(e=V.current)||void 0===e||e.scrollTo(0,c)}),[V.current]);var G=0===u?0:134*u-6,F=pa("CallOrator__notification");return(0,o.jsxs)("article",(0,i.__assign)({className:j,ref:V},{children:[(0,o.jsxs)("main",(0,i.__assign)({className:U},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CallOrator__topControlPanel"},{children:[(0,o.jsx)(ia,{orator:h.participant,oratorDevice:h.device,me:C,isPinned:I,isPinnedByAdmin:T,isPinnedByShareScreen:x,isUnpinAllowed:y,onUnpin:N,tooltips:b,onTooltipChange:M},void 0),F,L.length>1&&w.streamMode&&(0,o.jsx)(Ke,{availableModes:L,currentMode:w.streamMode,setMode:P},void 0)]}),void 0),(0,o.jsx)(aa,{onToggleScreenShare:v,SDK:f,orator:h,handleShowCallControls:g,streamedMovieState:m,localExternalId:A,me:C,groupId:E,meGroup:S,localDevice:p,streamMode:w.streamMode},void 0)]}),void 0),(0,o.jsx)("button",(0,i.__assign)({className:H,onClick:t},{children:a?(0,o.jsx)(Ot.default,{className:R},void 0):(0,o.jsx)(Pt.default,{className:R},void 0)}),void 0),(0,o.jsx)("aside",(0,i.__assign)({className:B},{children:(0,o.jsxs)("ul",(0,i.__assign)({className:"CallOrator__list",style:{height:134*d}},{children:[G>0&&(0,o.jsx)("li",{className:"CallOrator__participant","data-calls-id":"participant",style:{height:G+"px"}},-1),D.map((function(e){return(0,o.jsx)("li",(0,i.__assign)({className:"CallOrator__participant","data-calls-id":"participant"},{children:e}),"key"in e?e.key:void 0)}))]}),void 0)}),void 0)]}),void 0)},ha=t(41118);function ga(e,n){var t=e.browser.hasMicrophonePermission(),a=e.browser.hasCameraPermission(),o=n.includes(G.MediaOption.AUDIO)&&!t,r=n.includes(G.MediaOption.VIDEO)&&!a;return o||r?function(e,n,t){return(0,i.__awaiter)(this,void 0,void 0,(function(){return(0,i.__generator)(this,(function(a){return[2,e.browser.getUserMedia(n,t).then((function(e){e.getTracks().forEach((function(e){return e.stop()}))}))]}))}))}(e,r,o):Promise.resolve()}var ma=t(37441),Aa={},Ca=function(e){var n=e.state,t=e.SDK,a=e.dispatch,i=e.participant,o=e.addProfileLink,r=e.getLang,s=e.navigateToConvo,l=e.navigateToProfile,c=e.separatedList,u=void 0!==c&&c,_=e.device,v=_?(0,k.externalIdToString)(_.externalId):i.peerId,p=n.groupId?i.peerId===n.groupId:i.peerId===n.me,f=_?(0,k.isSameExternalId)(_.externalId,n.externalId):p,h=(0,k.isParticipantAnonym)(i.peerId),g=(0,M.isGroupCallByPeer)(n.peer),m=!!n.groupId,A=[],C=[],E=n.config.isModalView,S=(0,k.isParticipantGroup)(i.peerId);if(f||!o||h||void 0===l||A.push({text:r(S?"calls_go_to_community":"calls_go_to_profile"),onClick:function(e){l(e,i.link)}}),f||h||(0,k.isParticipantAnonym)(n.me)||void 0===s||m||A.push({text:r(S?"calls_go_to_chat_with_community":"calls_go_to_chat_with_participant"),onClick:function(){var e=function(e,n){if(e.peerId)return e.peerId;if(!(null==n?void 0:n.externalId.id))return null;return+(null==n?void 0:n.externalId.id)}(i,_);e?s(e)!==ma.ENavigateToConvoDirection.FastChat&&(E&&a({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.COLLAPSED}),a({type:d.E_ACTION.MANAGEMENT,isOpen:!1})):(0,G.debugMessage)(G.DebugMessageType.ERROR,{text:"[getPeerId] returned id: 0",peerId:e})}}),!p&&g&&!(0,k.isParticipantAnonym)(n.me)&&((0,k.isAdmin)(n.localDevice)||(0,k.isCreator)(n.localDevice))&&!(0,k.isCreator)(i)){var I={negative:!0,text:r("calls_participant_menu_kick"),onClick:function(){a({type:d.E_ACTION.TOGGLE_PARTICIPANTS_KICK,data:{type:d.KickParticipantType.CALL,participant:i}})}};u?C.push(I):A.push(I)}if(!f&&g&&!(0,k.isParticipantAnonym)(n.me)&&(0,k.canMuteParticipants)(n.localDevice)&&_&&(A.push({text:r("calls_participant_menu_mute_audio"),onClick:function(){a({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:d.ParticipantsManagementMode.SINGLE_AUDIO,device:_}})},isEnabled:xt.isMediaAllowed("audio",_,!0)}),A.push({text:r("calls_participant_menu_mute_video"),onClick:function(){a({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:d.ParticipantsManagementMode.SINGLE_VIDEO,device:_}})},isEnabled:xt.isMediaAllowed("video",_,!0)})),f||g||(0,k.isParticipantAnonym)(n.me)||!(0,k.canMuteParticipants)(n.localDevice)||A.push({text:r("calls_participant_menu_mute"),onClick:function(){var e=function(e){var n;t.muteParticipant(e.externalId,(n={},n[G.MediaOption.AUDIO]=G.MuteState.MUTE,n)).catch(console.log)};_?e(_):Ia(i,e)}}),f||!g||(0,k.isParticipantAnonym)(n.me)||!(0,k.canMuteParticipants)(n.localDevice)||function(e){return(0,k.someDeviceByParticipant)(e,(function(e){if((0,Qe.isEmpty)(e.mediaSettings))return!1;var n=e.mediaSettings,t=n.isAudioEnabled,a=n.isVideoEnabled,i=n.isScreenSharingEnabled;return!(!t||!a&&!i)}))}(i)||A.push({text:r("calls_participant_menu_enable_media_request"),onClick:function(){var e=function(e){t.muteParticipant(e.externalId,{},[G.MediaOption.AUDIO,G.MediaOption.VIDEO,G.MediaOption.SCREEN_SHARING]).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ASK_USER_TO_UNMUTE,session_id:n.callData.callId,peer_id:n.peer,is_group_call:(0,M.isGroupCallByPeer)(n.peer)})};_?e(_):Ia(i,e)}}),f||!g||(0,k.isParticipantAnonym)(n.me)||(0,k.isParticipantAnonym)(i.peerId)||!Sa(n.localDevice)||(0,k.isAdmin)(i)||(0,k.isCreator)(i)||!(0,k.someDeviceByParticipant)(i,(function(e){return e.status===G.ParticipantStatus.CONNECTED}))||A.push({text:r("calls_participant_menu_assign_admin_role"),onClick:function(){a({type:d.E_ACTION.TOGGLE_ADMIN_ASSIGNMENT,data:{participant:i}})}}),!p&&g&&!(0,k.isParticipantAnonym)(n.me)&&Sa(n.localDevice)&&(0,k.isAdmin)(i)&&A.push({text:r("calls_participant_menu_revoke_admin_role"),onClick:function(){var e=(0,k.getParticipantExternalId)(i);e&&(t.grantRoles(e,[G.UserRole.ADMIN],!0).then((function(){a({type:d.E_ACTION.CHANGE_PARTICIPANT_ROLES,participantId:i.peerId,data:(i.roles||[]).filter((function(e){return e!==G.UserRole.ADMIN}))})})).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.RETRIEVE_ADMIN,session_id:n.callData.callId,peer_id:n.peer,is_group_call:(0,M.isGroupCallByPeer)(n.peer)}))}}),g&&!(0,k.isParticipantAnonym)(n.me)&&(0,k.canPinParticipants)(n.localDevice)&&!Ea(n.adminPinnedParticipant,_||i)&&A.push({text:r("calls_participant_menu_pin"),onClick:function(){var e=function(e){t.pinParticipant(e.externalId,!1).then((function(){a({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:e.externalId}),a({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0})})).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ADMIN_PIN,session_id:n.callData.callId,peer_id:n.peer,is_group_call:(0,M.isGroupCallByPeer)(n.peer)})};_?e(_):Ia(i,e)}}),g&&!(0,k.isParticipantAnonym)(n.me)&&(0,k.canPinParticipants)(n.localDevice)&&Ea(n.adminPinnedParticipant,_||i)&&A.push({text:r("calls_participant_menu_pin_cancel"),onClick:function(){var e=function(e){t.pinParticipant(e.externalId,!0).then((function(){a({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:null})})).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ADMIN_UNPIN,session_id:n.callData.callId,peer_id:n.peer,is_group_call:(0,M.isGroupCallByPeer)(n.peer)})};_?e(_):Ia(i,e)}}),u&&C.length>0&&(A.push({separator:!0}),A=A.concat(C)),Aa[v]){var T=A.length===Aa[v].length;if(T)for(var x=0;x<A.length;x++)A[x].text===Aa[v][x].text&&A[x].isEnabled===Aa[v][x].isEnabled||(T=!1);T?A=Aa[v]:Aa[v]=A}else Aa[v]=A;return A};function Ea(e,n){return"externalId"in n?(0,k.isSameExternalId)(e,n.externalId):!(null===e||!n.peerId)&&e.id===n.peerId.toString()}function Sa(e){return!!e.roles&&((0,k.isCreator)(e)||(0,k.isAdmin)(e))}function Ia(e,n){var t,a,o=Ye.GlobalStore.getCallsState(),r=o.maps.vkIdToDevices,s=o.devices,l=r.get(e.peerId);if(l)try{for(var c=(0,i.__values)(l),d=c.next();!d.done;d=c.next()){var u=s[d.value];u&&n(u)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(a=c.return)&&a.call(c)}finally{if(t)throw t.error}}}var Ta=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"28px",height:"10px",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 28 10"},n,{children:(0,o.jsx)("path",{fill:"#F2F3F5",fillRule:"evenodd",d:"M1 0a1 1 0 00-1 1v8a1 1 0 001 1h4a1 1 0 100-2H2V1a1 1 0 00-1-1zm7 1a1 1 0 112 0v8a1 1 0 11-2 0V1zm15-1a1 1 0 00-1 1v8a1 1 0 001 1h4a1 1 0 100-2h-3V6h3a1 1 0 100-2h-3V2h3a1 1 0 100-2h-4zm-8.325 9.31l-2.55-7.824a.993.993 0 01-.117-.363L12 1.1h.005A1 1 0 1113.995.9L14 .9l2 6.4 2-6.4h.005a1 1 0 011.99.2H20l-.008.023a.993.993 0 01-.118.363l-2.55 7.824a1 1 0 01-.95.69h-.748a1 1 0 01-.95-.69z",clipRule:"evenodd"},void 0)}),void 0)},xa=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"16",height:"10",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 0C4.546 0 1.596 2.073.4 5c1.196 2.927 4.146 5 7.6 5 3.455 0 6.405-2.073 7.6-5-1.195-2.927-4.145-5-7.6-5zm3.5 5a3.5 3.5 0 11-7 0 3.5 3.5 0 017 0zM8 7a2 2 0 100-4 2 2 0 000 4z",fill:"#F5F5F5"},void 0)}),void 0)},ya=t(53449),Na=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({xmlns:"http://www.w3.org/2000/svg",width:"8",height:"4",viewBox:"0 0 10 5",fill:"currentColor","aria-hidden":"true"},n,{children:(0,o.jsx)("path",{d:"M5 4.8c-.2 0-.3 0-.4-.1l-4.3-3.2c-.3-.3-.4-.8-.2-1.1.2-.3.7-.4 1-.2l3.9 2.9 3.8-2.9c.3-.3.8-.2 1 .1.3.3.2.8-.1 1.1l-4.2 3.2c-.2.1-.3.2-.5.2z"},void 0)}),void 0)};const ba=(0,F.makeIcon)("Icon12Hand","hand_12","0 0 12 12",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 12 12" id="hand_12"><path d="M2.5 2.5A.5.5 0 0 1 3 3v2.5a.5.5 0 0 0 1 0v-4a.5.5 0 0 1 1 0V5a.5.5 0 0 0 1 0V1a.5.5 0 0 1 1 0v4.063a.5.5 0 0 0 1 0V1.938a.5.5 0 0 1 1 0V7.5l-.28-.032 1.774-1.898a.67.67 0 0 1 .995.9c-.677.774-2.013 2.306-2.615 3.029C7.935 10.624 6.56 11 5.526 11 2.15 11 2 8.727 2 7.958V3a.5.5 0 0 1 .5-.5Z" /></symbol>',12,12,!1,void 0),Ma=(0,F.makeIcon)("Icon20RecordingCircleFill","recording_circle_fill_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="recording_circle_fill_20"><path d="M10 14a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" /><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-1.657 0a6.343 6.343 0 1 1-12.686 0 6.343 6.343 0 0 1 12.686 0Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0);var wa=function(e){var n=e.translationTimer,t=e.viewersCount,a=void 0===t?0:t,r=e.isLiveIndicatorOff,l=void 0!==r&&r,c=e.actions,d=void 0===c?[]:c,u=e.tooltipText,_=void 0===u?"":u,v=(0,s.classNames)({TranslationStatus__translationIndicator:!0,"TranslationStatus__translationIndicator--disabled":l}),p=(null==d?void 0:d.length)>0,f=(0,s.classNames)({TranslationStatus__translationTimer:!0,"TranslationStatus__translationTimer--hasIndicator":!l}),h=(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStatus__translation"},{children:[(0,o.jsx)(Ta,{className:v},void 0),(0,o.jsxs)(o.Fragment,{children:[!!n&&(0,o.jsx)("div",(0,i.__assign)({className:f},{children:n}),void 0),!l&&(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStatus__translationViewersCount"},{children:[(0,o.jsx)(xa,{},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__translationViewersCountNumber"},{children:a}),void 0)]}),void 0),p&&(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__translationDropdown"},{children:(0,o.jsx)(Na,{},void 0)}),void 0)]},void 0)]}),"translation");return p?h=(0,o.jsx)(ya.default,(0,i.__assign)({position:"b",align:"center",horizontalPosition:"right",trigger:"hover",marginLeft:-10,data:d,className:"TranslationStatus_dropdown"},{children:h}),void 0):_&&(h=(0,o.jsx)(be.TooltipNew,(0,i.__assign)({content:(0,o.jsx)(o.Fragment,{children:_},void 0)},{children:h}),void 0)),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus"},{children:h}),void 0)},Oa=function(e){var n=e.translationTimer,t=e.hands,a=e.isMeAuthor,r=e.recordStartTimeMs,l=e.recordAuthorDisplayName,c=e.onStopRecord,d=e.isCanStopRecord,u=(0,Ae.useLang)().getLang,_=Date.now()-(r||0)>5e3,v=!!n&&_,p=!!n&&!_,f=!n&&!a&&!!l,h=(t||0)>0,g=!(!a&&!d);return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("TranslationStatus","TranslationStatus--is-record")},{children:[h&&(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__hands"},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHeader__hands CallHeader__hands--visible"},{children:[(0,o.jsx)(ba,{},void 0)," ",t]}),void 0)}),void 0),(0,o.jsx)("div",{className:"TranslationStatus__divider"},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)({TranslationStatus__translation:!0,"TranslationStatus__translation--is-not-author":!g})},{children:[(0,o.jsx)(Ma,{fill:"#FF3347",width:16,height:16},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStatus__translationTimer"},{children:[v&&n,p&&u("calls_recording_in_progress"),f&&u("calls_name_is_recording").replace("{name}",l)]}),void 0),g&&(0,o.jsx)("span",(0,i.__assign)({className:"TranslationStatus__endRecord",onClick:c},{children:u("calls_end_recording")}),void 0)]}),"translation")]}),void 0)},Pa=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"20",height:"20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M9.978 3.423a1.792 1.792 0 00-1.645 1.785v1.765l-.1.021a8.254 8.254 0 00-6.44 8.917.75.75 0 001.343.379l.175-.22a7.577 7.577 0 015.022-2.721v2.08a1.792 1.792 0 002.897 1.41l6.52-5.11a1.792 1.792 0 000-2.82l-6.52-5.11a1.791 1.791 0 00-1.105-.382l-.147.006zm.147 1.494c.065 0 .129.021.18.062l6.52 5.11a.292.292 0 010 .459l-6.52 5.11a.292.292 0 01-.472-.23v-2.873a.75.75 0 00-.767-.75l-.215.005-.305.016a9.065 9.065 0 00-5.162 2.056l-.037.032.004-.027a6.752 6.752 0 015.823-5.533.75.75 0 00.659-.744V5.208c0-.16.13-.291.292-.291z",fill:"#99A2AD"},void 0)}),void 0)},ka=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"20",height:"20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.72 4.72a.75.75 0 011.06 0L10 8.94l4.22-4.22a.75.75 0 111.06 1.06L11.06 10l4.22 4.22a.75.75 0 11-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 01-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 010-1.06z",fill:"#99A2AD"},void 0)}),void 0)},La=t(82280);function Da(e){var n,t,a,i;return!(!(0,k.isAdmin)(e.localDevice)&&!(0,k.isCreator)(e.localDevice))||!!(null===(t=null===(n=e.translation)||void 0===n?void 0:n.host)||void 0===t?void 0:t.id)&&+(null===(i=null===(a=e.translation)||void 0===a?void 0:a.host)||void 0===i?void 0:i.id)===(0,k.getMeId)(e)}function Ra(e){return!(!(0,k.isAdmin)(e.localDevice)&&!(0,k.isCreator)(e.localDevice))||ja(e)}function ja(e){return(0,k.isParticipantGroup)(e.groupId)?e.groupId===e.translation.ownerId:e.me===e.translation.ownerId}var Ba=function(e){var n=e.hands,t=(0,l.useContext)(E.LangContext),a=t.getLang,r=t.langNumeric,c=P((function(e){return e})),_=u(),v=(0,i.__read)((0,l.useState)(null),2),p=v[0],f=v[1],h=(0,i.__read)((0,l.useState)(!1),2),g=h[0],m=h[1],A=(0,i.__read)((0,l.useState)(""),2),C=A[0],S=A[1],I=(0,i.__read)((0,l.useState)(0),2),T=I[0],x=I[1],y=(0,i.__read)((0,l.useState)([]),2),N=y[0],b=y[1],M=(0,i.__read)((0,l.useState)((function(){return Fa(c.translation.startTime)})),2),w=M[0],O=M[1],L=(0,i.__read)((0,l.useState)(Ga(w)),2),D=L[0],R=L[1],j=(0,i.__read)((0,l.useState)(""),2),B=j[0],U=j[1],H=(0,i.__read)((0,l.useState)(!1),2),V=H[0],G=H[1],F=(0,l.useMemo)((function(){return(0,k.isAdmin)(c.localDevice)||(0,k.isCreator)(c.localDevice)}),[c.localDevice]),Z=function(e){var n=(0,i.__read)((0,l.useState)(),2),t=n[0],a=n[1],o=P((function(n){return e.ownerId?n.participants[e.ownerId]:void 0}));(0,l.useEffect)((function(){if(e.isRecord&&e.ownerId&&e.videoId&&!o){var n=new AbortController,t=e.ownerId+"_"+e.videoId;return(0,qe.videoGet)({videos:t},{signal:n.signal}).then(a),function(){n.abort()}}}),[e.ownerId,e.videoId,e.isRecord,o]);var r=(0,l.useMemo)((function(){var e="";if(o)e=o.shortName||o.name||e;else{var n=null==t?void 0:t.items[0].owner_id;if(!(0,s.isUndefined)(n)&&(0,k.isParticipantGroup)(n)&&(null==t?void 0:t.groups)){var a=t.groups.find((function(e){return e.id===-n}));e=(null==a?void 0:a.name)||e}}return e}),[t,o]);return{data:t,recordAuthorDisplayName:r}}({isRecord:c.translation.isRecord,ownerId:c.translation.ownerId,videoId:c.translation.videoId}),W=(0,k.isParticipantGroup)(c.groupId)?c.groupId===c.translation.ownerId:c.me===c.translation.ownerId,z=(0,l.useCallback)((function(){_({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_STOP})}),[]);return(0,l.useEffect)((function(){var e=Da(c);m(e)}),[c.translation,c.localDevice]),(0,l.useEffect)((function(){var e,n;if(null===(e=c.translation.host)||void 0===e?void 0:e.id){var t=c.participants[null===(n=c.translation.host)||void 0===n?void 0:n.id],a=(null==t?void 0:t.shortName)||(null==t?void 0:t.name);a!==p&&f(a)}else p&&f(null)}),[c.translation,c.participants]),(0,l.useEffect)((function(){var e=[];if(g){if(D){var n={text:(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__dropdownItemWillStartSoon"},{children:a("calls_info_translation_will_start_soon")}),void 0)};e.push(n)}e.push(Ua((0,o.jsx)(Pa,{},void 0),a("calls_info_translation_share_menu_item"),(function(){return _({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_SHARE})}))),e.push(Ua((0,o.jsx)(ka,{},void 0),a("calls_translation_stop_menu_item"),z))}b(e)}),[g,D]),(0,l.useEffect)((function(){var e=Ga(w);e&&w>-4&&g&&!V&&(G(!0),_({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_START_COUNTDOWN})),R(e)}),[w]),(0,l.useEffect)((function(){var e=Fa(c.translation.startTime);O(e);var n=setInterval((function(){return O(Fa(c.translation.startTime))}),La.SECOND_JS);return function(){return clearInterval(n)}}),[c.translation.startTime]),(0,l.useEffect)((function(){var e="";if(D){var n=Math.abs(w);if(n>La.DAY){var t=Math.floor(n/La.DAY);e=r(t,"calls_translation_upcoming_time_more_day_short",a("calls_translation_upcoming_time_more_day_short",t)).replace("%s",t)}else e=Ha("-"+Va(n))}else e=Ha(Va(w));S(e)}),[w,D]),(0,l.useEffect)((function(){var e,n=c.translation,t=n.ownerId,a=n.videoId;if(t&&a&&!D){var i=function(){var e={owner_id:t,video_id:a};(0,qe.videoLiveGetSpectators)(e).then((function(e){var n;x(null===(n=e.spectators)||void 0===n?void 0:n.count)}))};i(),e=setInterval(i,15*La.SECOND_JS)}return function(){return clearInterval(e)}}),[D,c.translation.ownerId,c.translation.videoId]),(0,l.useEffect)((function(){if(!g){var e="";e=D?a("calls_info_translation_will_start_soon"):p?a("calls_translation_host_info").replace("{name}",p):a("calls_translation_host_info_unknown"),U(e)}}),[D,p,g]),c.translation.isRecord?W?(0,o.jsx)(Oa,{hands:n,onStopRecord:z,recordStartTimeMs:c.translation.startTime,isMeAuthor:W,translationTimer:C},void 0):(0,o.jsx)(Oa,{hands:n,onStopRecord:z,recordStartTimeMs:c.translation.startTime,isCanStopRecord:F,recordAuthorDisplayName:Z.recordAuthorDisplayName},void 0):(0,o.jsx)(wa,{translationTimer:C,viewersCount:T,isLiveIndicatorOff:D,actions:N,tooltipText:B},void 0)};function Ua(e,n,t){return{text:(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStatus__dropdownItem"},{children:[e,(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStatus__dropdownItemText"},{children:n}),void 0)]}),void 0),onClick:t}}function Ha(e){return(0,o.jsx)(sa,{duration:e},void 0)}function Va(e){return 0===e?"00:00":e<=599?"0"+(0,s.formatDuration)(e):(0,s.formatDuration)(e)}function Ga(e){return e<0}function Fa(e){var n=Date.now();return Math.floor((n-e)/1e3)}var Za=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"10px",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 10 11"},n,{children:(0,o.jsx)("path",{fill:"#F5F5F5",d:"M.5 2.5A.5.5 0 011 3v2.5a.5.5 0 001 0v-4a.5.5 0 011 0V5a.5.5 0 001 0V1a.5.5 0 011 0v4.063a.5.5 0 001 0V1.938a.5.5 0 011 0V7.5l-.28-.032L8.494 5.57a.67.67 0 01.995.9 232.32 232.32 0 00-2.615 3.029C5.935 10.624 4.56 11 3.526 11 .15 11 0 8.727 0 7.958V3a.5.5 0 01.5-.5z"},void 0)}),void 0)},Wa=(0,l.memo)((function(e){var n=e.translation,t=e.speakers,a=e.hands,r=e.time,l=e.network,c=e.networkTooltipText,d=e.isTranslationRecord,u=(0,s.classNames)("CallHeader__hands",{"CallHeader__hands--visible":a>0});return(0,o.jsxs)("div",(0,i.__assign)({className:"CallHeader"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CallHeader__main"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)({CallHeader__timeAndNetwork:!0,"CallHeader__timeAndNetwork--is-record":d})},{children:[l<.6&&(0,o.jsx)(C.default,(0,i.__assign)({text:c,align:"left",className:"Call__oldTooltip"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallHeader__network"},{children:(0,o.jsx)(W,{fill:l<=.3?"#ff5c5c":"#FECE00"},void 0)}),void 0)}),void 0),r]}),void 0),n&&(0,o.jsx)("div",(0,i.__assign)({className:"CallHeader__translation"},{children:n}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallHeader__aside"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallHeader__participants"},{children:t}),void 0),!d&&(0,o.jsxs)("div",(0,i.__assign)({className:u},{children:[(0,o.jsx)(Za,{},void 0)," ",a]}),void 0)]}),void 0)]}),void 0)}));function za(e){var n,t=e.onHandCountChanged,a=(0,c.useSelector)((function(e){return e})),r=(0,M.isGroupCallByPeer)(a.peer),s=(0,l.useContext)(E.LangContext),d=s.getLang,u=s.langNumeric,_=(0,i.__read)((0,l.useState)(null),2),v=_[0],p=_[1],f=(0,i.__read)((0,l.useState)(0),2),h=f[0],g=f[1],m=(0,i.__read)((0,l.useState)(null),2),A=m[0],C=m[1];(0,l.useEffect)((function(){var e=(0,M.isGroupCallByPeer)(a.peer)?a.callData.ts:a.callData.localTimeStamp;C(da(e));var n=setInterval((function(){return C(da(e))}),1e3);return function(){return clearInterval(n)}}),[a.peer,a.callData.localTimeStamp,a.callData.ts]),(0,l.useEffect)((function(){var e=(0,k.getRaisedHands)(a.devices,a.localDevice,a.handState);e!==h&&(g(e),t&&t(e))}),[a.devices,a.localDevice,a.handState]),(0,l.useEffect)((function(){if(r){var e=a.speakersInHeader.reduce((function(e,n){var t=a.devices[n],i=t&&a.participants[t.externalId.id];return i&&(i.shortName||i.name)&&e.push(i),e}),[]);if(e.length>0){var n=d("calls_participants_speak",e.length).split(" ");p((0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",(0,i.__assign)({className:"CallHeader__speak"},{children:[n[0]," "]}),void 0),(0,Qe.getParticipantsListLabel)(e,e.slice(0,2),(function(e){return e.shortName||e.name}),d,u,0,2)]},void 0))}else p(null)}}),[a.participants,a.speakersInHeader,a.devices]);var S=(0,l.useMemo)((function(){return a.translation.isOn&&a.translation.isRecord?(0,o.jsx)(Ba,{hands:h},void 0):a.translation.isOn?(0,o.jsx)(Ba,{},void 0):""}),[a.translation.isOn,h,a.translation.isRecord]);return(0,o.jsx)(Wa,{translation:S,isTranslationRecord:!(!a.translation.isOn||!a.translation.isRecord),speakers:r?v:null,hands:h,time:A,network:null!==(n=a.localDevice.networkStatus)&&void 0!==n?n:1,networkTooltipText:d("calls_status_bad_internet_connection")},void 0)}var Ka=t(74351),Qa=t(27814),Ya=function(e){var n=e.title,t=e.onCloseModal,a=e.hint,r=e.actionButtons,s=e.isWithBackButton,c=e.onBackClick,d=e.children,u=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(Qa.default,(0,i.__assign)({className:"CallManagementModal",onClose:t,actionButtons:r||[],footerHint:a,backText:s?u("calls_back"):void 0,onBack:c,title:n},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallManagementModal__content"},{children:l.Children.toArray(d).map((function(e,n){return(0,o.jsx)("div",(0,i.__assign)({className:"CallManagementModal__section"},{children:e}),n)}))}),void 0)}),void 0)},Ja=t(2291),Xa=t(87255),qa=t(80044),$a=t(48206),ei=t(78981),ni=function(e){var n=e.isLinkBlockShown,t=e.linkBlockTitle,a=e.onLinkBlockClick,r=e.callUrlLink,s=(0,l.useContext)(N.ConfigContext).allowWaitingHall,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(Ja.default,{children:n&&(0,o.jsxs)(Xa.default,(0,i.__assign)({onClick:a,chevron:!0,icon:(0,o.jsx)(qa.ListIcon,{icon:(0,o.jsx)($a.LinkIcon,{},void 0),color:qa.ListIconColors.GREEN},void 0),aside:s?(0,o.jsx)("span",(0,i.__assign)({className:"CallManagementMenu__asideHint"},{children:c("calls_menu_link_setup")}),void 0):""},{children:[t,r&&(0,o.jsx)(ei.ListCopyControl,{value:r,copyText:c("calls_menu_link_copy"),doneText:c("calls_menu_link_copied")},void 0)]}),void 0)},void 0)},ti=t(89366),ai=t(69666),ii=t(25633),oi=t(47560),ri=function(e){var n=e.link,t=void 0===n?"":n,a=e.isLinkLoading,r=e.isCopied,s=e.hideCopiedText,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallLink"},{children:[(0,o.jsx)("p",(0,i.__assign)({className:"CallLink__info"},{children:c("calls_management_link_info_desc")}),void 0),a?(0,o.jsx)(ii.default,(0,i.__assign)({className:"CallLink__input"},{children:(0,o.jsx)(oi.default,{},void 0)}),void 0):(0,o.jsxs)("div",(0,i.__assign)({className:"CallLink__input"},{children:[(0,o.jsx)(ti.default,{readOnly:"readonly",value:t},void 0),(0,o.jsx)("div",{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallLink__hint"},{children:[c("calls_management_add_warning"),(0,o.jsx)(ai.default,(0,i.__assign)({className:"CallLink__copied",shown:r,callback:s},{children:c("calls_link_copied")}),void 0)]}),void 0)},void 0)]}),void 0)]}),void 0)},si=t(78517),li=t(63205),ci=function(e){var n=e.searchQuery,t=e.onSearchChange,a=e.length,r=e.children,s=e.waitingHallList,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallParticipantList"},{children:[(0,o.jsx)(si.BlockSearchInput,{value:n,placeholder:c("calls_search_participants_placeholder"),onChange:t,onInput:t,onPaste:t,className:"CallParticipantList__input"},void 0),!!s&&s,(0,o.jsx)(li.ListHeader,(0,i.__assign)({extra:a||""},{children:c("calls_participant_list_header")}),void 0),(0,o.jsx)(Ja.default,(0,i.__assign)({border:!1,className:"CallParticipantList__list"},{children:r}),void 0)]}),void 0)},di=t(39132),ui=t(19316),_i=t(88420),vi=function(e){var n=e.members,t=void 0===n?[]:n,a=e.totalCount,r=void 0===a?0:a,s=e.navigateToProfile,c=e.onPromote,d=e.onForbid,u=(0,l.useContext)(E.LangContext).getLang;return 0===t.length?(0,o.jsx)(o.Fragment,{},void 0):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(li.ListHeader,(0,i.__assign)({extra:r||""},{children:u("calls_waiting_hall_list_header")}),void 0),(0,o.jsx)(Ja.default,(0,i.__assign)({border:!1,className:"CallParticipantList__list CallParticipantList__list--waitingList"},{children:t.map((function(e){return(0,o.jsx)(Xa.default,(0,i.__assign)({selectable:!1,border:!1,aside:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:function(){return d(e.peerId)},appearance:"secondary"},{children:u("calls_waiting_hall_forbid")}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:function(){return c(e.peerId)}},{children:u("calls_waiting_hall_join")}),void 0)]},void 0)},{children:(0,o.jsx)(ui.default,{onLinkClick:s,photo:(0,o.jsx)(g.CallPhoto,{id:e.peerId,photo:e.photo,alt:e.name||""},void 0),title:e.name,href:e.link,target:"_blank"},void 0)}),e.peerId)}))}),void 0)]},void 0)},pi=t(42194);function fi(e,n,t){var a=(0,$e.getExternalIdByUserId)(e);return(0,G.promoteParticipant)(a).then((function(){hi(e,n,t)}))}function hi(e,n,t){n&&(n.totalCount-=1,n.members.delete(e),t({type:d.E_ACTION.SET_WAITING_HALL,data:n}))}function gi(e,n,t,a){return function(e,n){if(0===n.length)return Promise.resolve([]);if(e>n.length)return(0,G.getWaitingHall)(null,e).then((function(e){return e.participants}));return Promise.resolve(n)}(e,n).then((function(n){var a=t.waitingHall||{members:new Map,hasNew:!1},o=a.members,r=a.hasNew,s=(0,i.__read)(function(e,n){return e.reduce((function(e,t){var a=(0,i.__read)(e,2),o=a[0],r=a[1],s=+t.id;return n.has(s)?r.push(s):o.push(s),[o,r]}),[[],[]])}(n,o),2),l=s[0],c=s[1],d=l.length>0,u=c.reduce((function(e,n){var t=o.get(n);return t&&e.set(n,t),e}),new Map),_={totalCount:e,members:u,hasNew:!!d||r};return d?function(e,n){var t=e.me,a=e.callData,o=e.anonymSecret,r=a.callId||"",s=t<0,l=s?t:0;return(0,qe.getCallParticipantsApiCall)(r,n,s,o,l).then((function(e){var n=e.profiles,t=void 0===n?[]:n,a=e.anonyms,o=void 0===a?[]:a,r=e.groups,s=void 0===r?[]:r;return(0,i.__spreadArray)((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(o.map($e.normalizeUser)),!1),(0,i.__read)(t.map($e.normalizeUser)),!1),(0,i.__read)(s.map($e.normalizeGroup)),!1)}))}(t,l).then((function(e){return e.forEach((function(e){e&&e.peerId&&_.members.set(e.peerId,e)})),_})).catch((function(){return _})):_})).then((function(e){e.members&&a({type:d.E_ACTION.SET_WAITING_HALL,data:e})}))}function mi(e,n){if(!e.waitingHall)return Promise.resolve();var t=e.waitingHall.totalCount;return t>e.waitingHall.members.size?new Promise((function(a){(0,G.getWaitingHall)(null,t).then((function(t){gi(t.totalCount,t.participants,e,n).then((function(){a()}))}))})):Promise.resolve()}var Ai=function(e){var n,t,a,r,s,_=e.isModal,v=e.onMore,p=e.navigateToProfile,f=e.isWithBackButton,h=e.onBackClick,g=f?h:function(){},m=(0,c.useSelector)((function(e){return e})),A=u(),C=(0,l.useContext)(E.LangContext).getLang,S=(0,i.__read)((0,l.useState)(Ci(m,_)),2),I=S[0],T=S[1],x=(0,i.__read)((0,l.useState)(""),2),N=x[0],b=x[1],M=m.waitingHall?Array.from(null===(n=m.waitingHall)||void 0===n?void 0:n.members.values()):[],w=(0,l.useCallback)((function(e){return e.name}),[]),O=(0,l.useCallback)((function(e){return e.peerId}),[]),P=y(_?M:[],w,O),k=(0,l.useCallback)((function(e){b(e.target.value)}),[]),L=_?M:M.slice(0,5);N&&(L=P.search(N)),(0,l.useEffect)((function(){T(Ci(m,_))}),[null===(t=m.waitingHall)||void 0===t?void 0:t.totalCount]);var D=(0,l.useCallback)((function(e){var n,t=null===(n=m.waitingHall)||void 0===n?void 0:n.members.get(e);t&&A({type:d.E_ACTION.TOGGLE_PARTICIPANTS_KICK,data:{type:d.KickParticipantType.WAITING_HALL,participant:t}})}),[null===(a=m.waitingHall)||void 0===a?void 0:a.members,m.participants]),R=(0,l.useCallback)((function(e){m.waitingHall&&fi(e,m.waitingHall,A)}),[null===(r=m.waitingHall)||void 0===r?void 0:r.members]),j=(0,l.useCallback)((function(){v&&v()}),[m.waitingHall]),B=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(vi,{members:L,totalCount:null===(s=m.waitingHall)||void 0===s?void 0:s.totalCount,navigateToProfile:p,onPromote:R,onForbid:D},void 0),I&&(0,o.jsx)(pi.ListMore,(0,i.__assign)({onClick:j},{children:C("calls_waiting_hall_more_text")}),void 0)]},void 0);return _?(0,o.jsx)(Ya,(0,i.__assign)({title:C("calls_waiting_hall_title"),onCloseModal:function(){A({type:d.E_ACTION.GROUP_CALL_SETUP,open:!1,preselectedIds:null}),A({type:d.E_ACTION.MANAGEMENT,isOpen:!1})},isWithBackButton:f,onBackClick:g},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallParticipantList CallParticipantList--waiting-hall"},{children:[M.length>0&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(si.BlockSearchInput,{value:N,placeholder:C("calls_search_participants_placeholder"),onChange:k,onInput:k,onPaste:k,className:"CallParticipantList__input"},void 0),B,N&&0===L.length&&(0,o.jsx)(ha.default,{children:C("calls_participants_not_found")},void 0)]},void 0),0===M.length&&(0,o.jsx)(ha.default,{children:C("calls_waiting_hall_not_users")},void 0)]}),void 0)}),void 0):B};function Ci(e,n){if(n)return!1;var t=e.waitingHall;return!!t&&t.totalCount>5}var Ei,Si=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"13",width:"12",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 13",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M3.497 5.06v.44a2.501 2.501 0 002.91 2.467l1.199 1.198a4.005 4.005 0 01-5.521-2.822.75.75 0 00-1.469.314A5.508 5.508 0 005.25 10.95v1.301a.75.75 0 001.501 0v-1.3a5.472 5.472 0 001.973-.669l1.25 1.25a.751.751 0 001.062-1.061L1.88 1.32A.75.75 0 10.82 2.38l2.677 2.68zM9.672 7.097l1.117 1.117a5.463 5.463 0 00.594-1.557.75.75 0 10-1.468-.314 3.963 3.963 0 01-.243.754zM3.827 1.258l4.644 4.64c.02-.13.031-.263.031-.398v-3a2.502 2.502 0 00-4.675-1.242z"},void 0)}),void 0)},Ii=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"15",height:"15",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M2.75 3a.75.75 0 01.75.75V7.5a.5.5 0 001 0V2A.75.75 0 016 2v4.75a.5.5 0 001 0v-5.5a.75.75 0 011.5 0v5.5a.5.5 0 001 0V2.5a.75.75 0 011.5 0v7.25l1.614-1.796a.9.9 0 011.36 1.177c-.73.873-2.044 2.449-2.809 3.367C9.913 14 8.08 14.5 6.701 14.5 2.2 14.5 2 11.47 2 10.444V3.75A.75.75 0 012.75 3z"},void 0)}),void 0)},Ti=function(){var e=(0,le.classNames)("VolumeMeterAnimation","VolumeMeterAnimation--withAnimation");return(0,o.jsx)("div",{className:e},void 0)},xi=function(e){var n=e.showSpeaking,t=e.showAudioDisabled,a=e.showRaisedHand,r=e.showConnecting,c=e.showRaisedHandTooltip,d=e.onRaisedHandClick,u=(0,l.useContext)(E.LangContext).getLang,_=(0,o.jsx)("span",(0,i.__assign)({className:(0,s.classNames)("ParticipantIndicators__item",{"ParticipantIndicators__item--interactive":void 0!==d}),onClick:null!=d?d:void 0},{children:(0,o.jsx)(Ii,{className:"ParticipantIndicators__hand"},void 0)}),void 0);return(0,o.jsxs)("span",(0,i.__assign)({className:"ParticipantIndicators"},{children:[n&&(0,o.jsx)("span",(0,i.__assign)({className:"ParticipantIndicators__item"},{children:(0,o.jsx)(Ti,{},void 0)}),void 0),t&&(0,o.jsx)("span",(0,i.__assign)({className:"ParticipantIndicators__item"},{children:(0,o.jsx)(Si,{className:"ParticipantIndicators__muted"},void 0)}),void 0),a?c?(0,o.jsx)(C.default,(0,i.__assign)({className:"ParticipantIndicators__tooltip",text:u("calls_participant_menu_enable_media_request"),position:"t",align:"center",appearance:"light"},{children:_}),void 0):_:null,r&&(0,o.jsx)("span",(0,i.__assign)({className:"ParticipantIndicators__item"},{children:(0,o.jsx)(V,{},void 0)}),void 0)]}),void 0)},yi=t(67406),Ni=function(e){var n=e.position,t=e.align,a=e.trigger,r=e.marginTop,s=e.marginLeft,l=e.actions;return l.length>0?(0,o.jsx)(ya.default,(0,i.__assign)({position:n,align:t,trigger:a,marginTop:r,marginLeft:s,className:"ParticipantMenu__dropdown",data:l},{children:(0,o.jsx)(yi.ListActionsControl,{},void 0)}),void 0):null},bi=function(e){var n=e.SDK,t=e.participant,a=e.navigateToConvo,i=e.navigateToProfile,r=e.device,s=(0,c.useSelector)((function(e){return e})),d=u(),_=(0,l.useContext)(E.LangContext).getLang,v=t&&Ca({state:s,SDK:n,dispatch:d,participant:t,addProfileLink:!1,getLang:_,navigateToConvo:a,navigateToProfile:i,separatedList:!0,device:r});return(null==v?void 0:v.length)?(0,o.jsx)(Ni,{position:"b",align:"right",trigger:"hover",marginTop:-8,marginLeft:1,actions:v},void 0):null},Mi=(0,l.memo)((function(e){var n,t,a,r,s=e.device,l=e.canMute,c=e.onUnmuteDevice,d=e.SDK,u=e.navigateToConvo,_=e.navigateToProfile,v=e.deviceId,p=P((function(e){return e.me})),f=P((function(e){return e.participants[s.externalId.id]})),h=P((function(e){return e.externalId})),m=P((function(e){return e.speakers[v]})),A=(0,k.isSameExternalId)(s.externalId,h),C=A?Ye.GlobalStore.getCallsState().localDevice:f,E=(null==f?void 0:f.peerId)!==p&&s.status===G.ParticipantStatus.WAITING,S=!E&&!(null===(n=s.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),I=!E&&!(null===(t=s.mediaSettings)||void 0===t?void 0:t.isVideoEnabled),T=!E&&!!(null===(r=null===(a=s.statusData)||void 0===a?void 0:a.hand)||void 0===r?void 0:r.state),x=E||S||T||m,y=!E&&(S||I)&&l&&!A;return(0,o.jsx)(Xa.default,(0,i.__assign)({selectable:!1,border:!1,aside:(0,o.jsxs)(o.Fragment,{children:[x&&(0,o.jsx)(xi,{showSpeaking:m,showRaisedHand:T,showAudioDisabled:S,showConnecting:E,showRaisedHandTooltip:y,onRaisedHandClick:y?function(){return c(s)}:void 0},"indicators"),(0,o.jsx)(bi,{SDK:d,participant:f,device:s,navigateToConvo:u,navigateToProfile:_},"menu")]},void 0)},{children:(0,o.jsx)(ui.default,{onLinkClick:_,photo:(0,o.jsx)(g.CallPhoto,{id:null==f?void 0:f.peerId,photo:null==f?void 0:f.photo,alt:(null==f?void 0:f.name)||"",showCreatorBadge:(0,k.isCreator)(C),showAdminBadge:(0,k.isAdmin)(C)},void 0),title:null==f?void 0:f.name,href:null==f?void 0:f.link,target:"_blank"},void 0)}),v)})),wi=100,Oi=function(e){var n=e.SDK,t=e.bridge,a=e.onAddClick,r=e.navigateToProfile,s=e.navigateToConvo,d=e.onShowMoreWaitingHall,u=(0,c.useSelector)((function(e){return e})),_=(0,l.useContext)(E.LangContext).getLang,v=(0,i.__read)((0,l.useState)(""),2),p=v[0],f=v[1],h=(0,i.__read)((0,l.useState)(wi),2),g=h[0],m=h[1],A=(0,k.canMuteParticipants)(u.localDevice),C=function(e,n,t,a){var o=P((function(e){return e})),r=wn(o),s=(0,l.useMemo)((function(){return o.externalId?(0,i.__assign)((0,i.__assign)({},o.localDevice),{externalId:o.externalId}):null}),[o.localDevice,o.externalId]);return(r?Pi:ki)(e,n,t,s,{offset:a})}(p,n,t,g-wi),S=C.participants,I=C.isLoading,T=(0,l.useCallback)((function(e){f(e.target.value)}),[]),x=!(0,k.isParticipantAnonym)(u.me),y=L(),N=(0,l.useCallback)((function(e){n.muteParticipant(e.externalId,{},[G.MediaOption.AUDIO,G.MediaOption.VIDEO,G.MediaOption.SCREEN_SHARING]).catch(console.log)}),[]);return(0,o.jsxs)(ci,(0,i.__assign)({searchQuery:p,onSearchChange:T,length:y,waitingHallList:u.waitingHall&&(0,o.jsx)(Ai,{isModal:!1,navigateToProfile:r,onMore:d},void 0)},{children:[!p&&x&&(0,o.jsx)(Xa.default,(0,i.__assign)({selectable:!1,border:!1},{children:(0,o.jsx)(di.ListAddControl,(0,i.__assign)({onClick:a},{children:_("calls_add_participants")}),void 0)}),"add"),!!S.length&&S.slice(0,g).map((function(e){var t=(0,k.externalIdToString)(e.externalId);return(0,o.jsx)(Mi,{deviceId:t,SDK:n,canMute:A,device:e,navigateToConvo:s,navigateToProfile:r,onUnmuteDevice:N},t)})),I&&(0,o.jsx)(Ge.default,{},void 0),!I&&y>g&&(0,o.jsx)(Xa.default,{children:(0,o.jsx)(pi.ListMore,(0,i.__assign)({className:"CallParticipantList__more",onClick:function(){m((function(e){return e+wi}))}},{children:_("calls_participants_show_more").replace("{n}",String(wi))}),void 0)},"limit"),p&&0===S.length&&(0,o.jsx)(ha.default,{children:_("calls_participants_not_found")},void 0)]}),void 0)};function Pi(e,n,t,a,o){var r,s=(void 0===o?{}:o).offset,c=void 0===s?0:s,_=P((function(e){return e.devices})),v=P((function(e){return e.participants})),p=P((function(e){return e.participantsChunk})),f=P((function(e){var n;return null!==(n=e.callData.callId)&&void 0!==n?n:""})),h=u(),g=(0,i.__read)((0,l.useState)([]),2),m=g[0],A=g[1],C=(0,i.__read)((0,l.useState)(!1),2),E=C[0],S=C[1],I=(r=p)?r.countBefore+r.ids.length+r.countAfter:0,T=0===c&&I<=wi?I:null;return(0,l.useEffect)((function(){var a=new AbortController,o=!1;return a.signal.addEventListener("abort",(function(){o=!0}),{once:!0}),S(!0),(e?new Promise((function(t,i){var r=setTimeout((function(){t(function(){function t(e,n){return{id:String(e.id),type:n}}(0,qe.searchCallParticipants)(f,{search:e},{signal:a.signal}).then((function(e){var n=e.profiles,a=void 0===n?[]:n,i=e.anonyms,o=void 0===i?[]:i,r=e.groups,s=void 0===r?[]:r,l=[],c=[];return o.forEach((function(e){l.push((0,$e.normalizeUser)(e)),c.push(t(e,G.ExternalIdType.ANONYM))})),a.forEach((function(e){l.push((0,$e.normalizeUser)(e)),c.push(t(e,G.ExternalIdType.USER))})),s.forEach((function(e){l.push((0,$e.normalizeGroup)(e)),c.push(t(e,G.ExternalIdType.GROUP))})),nn([{},l]),h({type:d.E_ACTION.LOAD_PEERS,members:l}),c})).then((function(e){return n.getParticipants({externalIds:e})})).then((function(e){if(!o){var n=Ye.GlobalStore.getCallsState(),t=e.map((function(e){var n=e.uid;return(0,k.externalIdToString)(n)}));bt(n,h,e),A(t)}}))}())}),1e3);a.signal.addEventListener("abort",(function(){clearTimeout(r),i()}),{once:!0})})):Dn(n,{fromIdx:c,count:100},{signal:a.signal}).then((function(e){var n=Ye.GlobalStore.getCallsState(),a=e.participants.map((function(e){var n=e.uid,t=(0,i.__rest)(e,["uid"]);return(0,i.__assign)({externalId:n},t)})),o=a.map((function(e){var n=e.externalId;return(0,k.externalIdToString)(n)})),r=Rn(n,h,t,a);return A((function(e){return c>=e.length?e.concat(o):o})),r}))).finally((function(){S(!1)})),function(){return a.abort()}}),[f,e,c,T]),{participants:m.reduce((function(e,n){var t=_[n];if(t){var a=t.externalId.id,i=v[a];i&&i.name&&e.push(t)}return e}),e||!a?[]:[a]),isLoading:E}}function ki(e){var n,t,a=(0,i.__read)((n=P((function(e){return e})),t=(0,l.useMemo)((function(){if(n.externalId)return(0,i.__assign)((0,i.__assign)({},n.localDevice),{externalId:n.externalId})}),[n.localDevice,n.externalId]),(0,l.useMemo)((function(){var e=[[],[]],a=function(e,t){var a=n.participants[t.externalId.id];return a&&t.status?(e[0].push(t),a.name&&e[1].push(t),e):e};return t&&a(e,t),(0,Qe.objectReduce)(n.devices,a,e)}),[n.devices,n.participants,n.localDevice,n.externalId])),2),o=a[0],r=a[1],s=(0,l.useCallback)((function(e){var n;return null===(n=Ye.GlobalStore.getCallsState().participants[e.externalId.id])||void 0===n?void 0:n.name}),[]),c=(0,l.useCallback)((function(e){return(0,k.externalIdToString)(e.externalId)}),[]),d=y(r,s,c);return{participants:e?d.search(e):o,isLoading:!1}}!function(e){e.Participants="participants",e.Friends="friends",e.Community="community"}(Ei||(Ei={}));var Li,Di=t(88822),Ri=t(71831);function ji(e,n,t){return t&&t[e]||(0,k.isParticipantInCall)(n,e)}function Bi(e){var n=e.member,t=e.state,a=e.selectedMap,i=(null==n?void 0:n.peerId)||0;if((0,k.isParticipantInCall)(t,i))return!0;if(ji(i,t,a))return!1;if((0,M.isAuthedByGroupId)(t)){if((0,k.isParticipantUnavailableToCallFromGroup)(t,i))return!0}else if(!(null==n?void 0:n.canCall))return!0;return!(0,Ri.isUserPeer)(i)}!function(e){e.Friends="friends",e.CommunityMembers="groupMembers",e.Members="members"}(Li||(Li={}));var Ui=function(e){return e?(0,Di.escape)(e.replace(/\t/g,"\n")):""},Hi=function(e){return e.name},Vi=t(70720),Gi=function(e){var n=e.tokens,t=e.onRemoveToken,a=e.value,i=e.onChange,r=e.onSelect,s=e.renderSuggest,c=e.data,d=e.hideInputWithName,u=(0,l.useRef)((function(){})),_=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(Vi.default,{className:"CallsMultiSelect",tokens:n,removeTokenPlaceholder:_("calls_remove_token"),onRemoveToken:t,placeholder:_("calls_search_participants_placeholder"),value:a,onChange:i,onSelect:r,useInfiniteScroll:!1,hasMore:!1,virtualized:!1,loadMore:u.current,notFoundText:_("calls_participants_not_found"),autoFocus:!0,isSearching:!1,renderSuggest:s,data:c,hideInputWithName:d},void 0)};const Fi=(0,F.makeIcon)("Icon20CheckCircleOn","check_circle_on_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="check_circle_on_20"><path fill-rule="evenodd" d="M10 20c5.523 0 10-4.477 10-10S15.523 0 10 0 0 4.477 0 10s4.477 10 10 10Zm5.35-12.72a.75.75 0 1 0-1.062-1.06l-5.955 5.968L5.81 9.66a.75.75 0 1 0-1.062 1.06l3.054 3.06a.75.75 0 0 0 1.062 0l6.486-6.5Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0),Zi=(0,F.makeIcon)("Icon20CheckCircleOff","check_circle_off_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none" viewBox="0 0 20 20" id="check_circle_off_20"><defs><path id="check_circle_off_20_a" fill="currentColor" fill-rule="evenodd" d="M10 20c5.523 0 10-4.477 10-10S15.523 0 10 0 0 4.477 0 10s4.477 10 10 10Zm0-1a9 9 0 1 0 0-18 9 9 0 0 0 0 18Z" clip-rule="evenodd" /></defs><use xlink:href="#check_circle_off_20_a" fill-rule="evenodd" clip-rule="evenodd" /><use xlink:href="#check_circle_off_20_a" fill-rule="evenodd" clip-rule="evenodd" /></symbol>',20,20,!1,void 0);function Wi(e){var n=e.member,t=e.selected,a=void 0!==t&&t,r=e.disabled,l=void 0!==r&&r,c=(0,s.classNames)("ParticipantSuggest",{"ParticipantSuggest--selected":a,"ParticipantSuggest--disabled":l}),d=a?Fi:Zi;return(0,o.jsxs)("div",(0,i.__assign)({className:c,"data-id":n.id},{children:[(0,o.jsx)(ui.default,{className:"ParticipantSuggest__entity",size:"34",title:n.name,photo:n.photo},void 0),(0,o.jsx)(d,{className:"ParticipantSuggest__checkIcon"},void 0)]}),void 0)}var zi=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"16",height:"16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{d:"M9.3 9.99c.93-.93 2.32-.75 3.63.35.94.79.82 2.85-1.18 3.12s-4.11-.7-6.32-2.9c-2.2-2.2-3.1-4.1-2.9-6.3a1.8 1.8 0 013.12-1.18c1.06 1.25 1.38 2.6.36 3.62-.48.48-.67.6-.56.91.41 1.1 2.19 2.65 2.94 2.93.35.13.46-.1.9-.55z"},void 0)}),void 0)},Ki=(0,l.memo)((function(e){var n=e.data,t=e.onClick,a=e.selected,r=e.disabled;if("type"in n)switch(n.type){case d.SearchResultType.HEADER:return(0,o.jsx)(li.ListHeader,(0,i.__assign)({className:"CallsSearchResult CallsSearchResult--header",extra:n.count},{children:n.text}),void 0);case d.SearchResultType.CALL_ALL_IN_CHAT:return(0,o.jsx)("div",(0,i.__assign)({className:"CallsSearchResult CallsSearchResult--select"},{children:(0,o.jsxs)(_i.default,(0,i.__assign)({appearance:"secondary",wide:!0,onClick:t},{children:[(0,o.jsx)("span",(0,i.__assign)({className:"CallsSearchResult__icon"},{children:(0,o.jsx)(zi,{},void 0)}),void 0),n.text]}),void 0)}),void 0);case d.SearchResultType.MEMBERS_MORE:case d.SearchResultType.FRIENDS_MORE:case d.SearchResultType.GROUP_MEMBERS_MORE:return(0,o.jsx)(pi.ListMore,(0,i.__assign)({onClick:t},{children:n.text}),void 0)}return(0,o.jsx)(Xa.default,(0,i.__assign)({"data-id":n.peerId,onClick:t,selectable:!r},{children:(0,o.jsx)(Wi,{member:n,selected:a,disabled:r},void 0)}),void 0)})),Qi=function(e){var n=e.onChange,t=e.initMembers,a=e.selected,r=e.personCache,s=e.memberType,_=(0,l.useRef)(!1),v=(0,l.useRef)(),p=(0,c.useSelector)((function(e){return e})),f=u(),h=(0,Ae.useLang)().getLang,g=(0,i.__read)((0,l.useState)(t),2),m=g[0],A=g[1],C=(0,i.__read)((0,l.useState)(""),2),E=C[0],S=C[1],I=(0,i.__read)((0,l.useState)(!1),2),x=I[0],y=I[1],N=(0,i.__read)((0,l.useState)(!1),2),b=N[0],M=N[1],w=(0,l.useMemo)((function(){return a.reduce((function(e,n){return e[n]=!0,e}),{})}),[a]),O=p.groupMembersCount>d.COUNT_OF_GROUP_MEMBERS_TO_LOAD,P=(0,l.useMemo)((function(){return new T(m,Hi)}),[]),k=(0,l.useCallback)((function(e){if(e){var n=P.search(e);if(_.current){var t={};return n.forEach((function(e){t[e.id]=e})),Object.values(t)}return n}return function(e){var n=e.getLang,t=e.members,a=e.showMore,o=e.memberType,r={type:d.SearchResultType.MEMBERS_MORE,text:n("calls_show_all_members")},s={type:d.SearchResultType.FRIENDS_MORE,text:n("calls_show_all_friends")},l={type:d.SearchResultType.GROUP_MEMBERS_MORE,text:n("calls_show_all_group_members")},c=[];switch(o){case Li.Members:if(t&&t.length>0)if(a||t.length<=10)c.push.apply(c,(0,i.__spreadArray)([],(0,i.__read)(t),!1));else{for(var u=0;u<10;u++)c.push(t[u]);c.push(r)}break;case Li.Friends:if(t&&t.length>0)if(a||t.length<=10)c.push.apply(c,(0,i.__spreadArray)([],(0,i.__read)(t),!1));else{for(u=0;u<10;u++)c.push(t[u]);c.push(s)}break;case Li.CommunityMembers:if(t&&t.length>0)if(a||t.length<=10)c.push.apply(c,(0,i.__spreadArray)([],(0,i.__read)(t),!1));else{for(u=0;u<10;u++)c.push(t[u]);c.push(l)}}return c}({getLang:h,members:m,showMore:x,memberType:s})}),[m,P,h,x,s]),L=(0,i.__read)((0,l.useState)((function(){return k(E)})),2),D=L[0],R=L[1],j=(0,l.useCallback)((function(e){var t=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(a),!1),[+e],!1);n(t)}),[a,n]),B=(0,l.useCallback)((function(e){var t=a.filter((function(n){return n!==+e}));n(t)}),[a,n]);(0,l.useEffect)((function(){R(k(E))}),[x]),(0,l.useEffect)((function(){var e=E;return O&&(e.length>=3&&!b?v.current=setTimeout((function(){(function(e,n,t,a){return void 0===n&&(n=""),(0,qe.searchGroupMembers)(e,n).then((function(e){var n=e.items,o=[],r=[];return n&&n.forEach((function(e){e.deactivated||e.id in t.groupMembersCache||(o.push((0,$e.normalizeUser)(e)),e.can_call_from_group||r.push(e.id))})),o.length>0&&a({type:d.E_ACTION.SET_GROUP_MEMBERS,groupMembersCount:t.groupMembersCount,groupMembers:(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(t.groupMembers),!1),(0,i.__read)(o),!1),unableToCallGroupMembersIds:(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(t.unableToCallGroupMembersIds),!1),(0,i.__read)(r),!1)}),o}))})(-p.groupId,e,p,f).then((function(n){var t,a;if(M(!1),n.length){_.current=!0;var o=(0,i.__spreadArray)([],(0,i.__read)(m),!1);try{for(var r=(0,i.__values)(n),s=r.next();!s.done;s=r.next()){var l=s.value;o.push(l),P.add(l)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(a=r.return)&&a.call(r)}finally{if(t)throw t.error}}A(o),R(k(e))}}))}),1e3):v.current&&(M(!1),clearTimeout(v.current))),function(){v.current&&clearTimeout(v.current)}}),[E]);var U=(0,l.useCallback)((function(e){S(e.target.value),R(k(e.target.value))}),[k]),H=(0,l.useCallback)((function(e){return B(e),Promise.resolve()}),[B]),V=(0,l.useCallback)((function(e){return ji(e,p,w)?B(e):Bi({member:r.current.get(+e),state:p,selectedMap:w})||(j(e),S(""),R(k(""))),Promise.resolve()}),[p,w,k,j,B]),G=(0,l.useCallback)((function(e,n){return"type"in e?function(){return y(!0)}:n}),[]),F=(0,l.useCallback)((function(e,n){var t="peerId"in e?e.peerId:0;return(0,o.jsx)(Ki,{data:e,onClick:G(e,n),selected:ji(t,p,w),disabled:Bi({member:r.current.get(+t),state:p,selectedMap:w})},t||"text"in e&&e.text||void 0)}),[w,p.groupId,p.participants,p.me,p.unableToCallGroupMembersIds]);return{query:E,found:D,onRemoveToken:H,onChangeHandler:U,onSelect:V,renderSuggest:F}},Yi=function(e){var n=e.tokens,t=e.onChange,a=e.selected,i=e.personCache,r=e.initMembers,s=e.memberType,l=Qi({selected:a,onChange:t,personCache:i,initMembers:r,memberType:s});return(0,o.jsx)(Gi,{tokens:n,onRemoveToken:l.onRemoveToken,value:l.query,onChange:l.onChangeHandler,onSelect:l.onSelect,renderSuggest:l.renderSuggest,data:l.found,hideInputWithName:!0},void 0)},Ji=function(e){var n=e.onChange,t=e.onChangeTab,a=e.tab,r=e.tabs,d=e.selected,u=(0,c.useSelector)((function(e){return e.friends})),_=(0,c.useSelector)((function(e){return e.chatMembers})),v=(0,c.useSelector)((function(e){return e.groupMembers})),p=function(){var e=(0,c.useSelector)((function(e){return e.groupMembers})),n=(0,c.useSelector)((function(e){return e.chatMembers})),t=(0,c.useSelector)((function(e){return e.friends})),a=(0,l.useRef)({}),i=(0,l.useRef)();i.current||(i.current=new Map);var o=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach((function(e){e.forEach((function(e){i.current.set(e.id,e)}))}))};return a.current.chatMembers!==n&&(o(n),a.current.chatMembers=n),a.current.groupMembers!==e&&(o(e),a.current.groupMembers=e),a.current.friends!==t&&(o(t),a.current.friends=t),(0,l.useEffect)((function(){return function(){i.current.clear(),a.current={}}}),[]),{personCache:i}}().personCache,f=function(e){var n=e.selected,t=e.personCache,a=(0,c.useSelector)((function(e){return e})),o=(0,l.useMemo)((function(){var e,o,r,s,l=(0,k.getActiveDevices)(a).activeDevices,c=new Map;try{for(var d=(0,i.__values)(l),u=d.next();!u.done;u=d.next()){var _=u.value,v=a.participants[_.externalId.id];v&&c.set(v.peerId,{id:v.peerId.toString(),text:Ui(v.name),locked:!0})}}catch(n){e={error:n}}finally{try{u&&!u.done&&(o=d.return)&&o.call(d)}finally{if(e)throw e.error}}try{for(var p=(0,i.__values)(n),f=p.next();!f.done;f=p.next()){var h=f.value,g=a.participants[h]||t.current.get(h);c.set(h,{text:Ui(null==g?void 0:g.name),id:h.toString(),locked:!1})}}catch(e){r={error:e}}finally{try{f&&!f.done&&(s=p.return)&&s.call(p)}finally{if(r)throw r.error}}return(0,i.__spreadArray)([],(0,i.__read)(c.values()),!1)}),[n,a.participants,a.me,a.groupId,a.meGroup,a.adminPinnedParticipant,a.isOratorMode,a.oratorScrollFirstVisible,a.gridScrollFirstVisible,a.oratorScrollNumberOfVisible]);return o}({selected:d,personCache:p});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ze.ConfigProvider,(0,i.__assign)({platform:Ze.Platform.VKCOM,scheme:"inherit"},{children:(0,o.jsx)(Ze.Tabs,(0,i.__assign)({className:"AddParticipants__tabs"},{children:r.map((function(e){var n,r=e.id,l=e.label,c=e.counter;return(0,o.jsx)(Ze.TabsItem,(0,i.__assign)({className:"AddParticipants__tabsItem",onClick:function(){return t(r)},selected:r===a,after:(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("AddParticipants__count",(n={},n["AddParticipants__count--inactive"]=r!==a,n))},{children:c}),void 0)},{children:l}),r)}))}),void 0)}),void 0),a===Ei.Participants&&(0,o.jsx)(Yi,{onChange:n,personCache:p,selected:d,tokens:f,initMembers:_,memberType:Li.Members},Ei.Participants),a===Ei.Friends&&(0,o.jsx)(Yi,{onChange:n,personCache:p,selected:d,tokens:f,initMembers:u,memberType:Li.Friends},Ei.Friends),a===Ei.Community&&(0,o.jsx)(Yi,{onChange:n,personCache:p,selected:d,tokens:f,initMembers:v,memberType:Li.CommunityMembers},Ei.Community)]},void 0)};const Xi=(0,F.makeIcon)("Icon16Phone","phone_16","0 0 16 16",'<symbol fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" id="phone_16"><path d="m5.443 2.64.575.684c.796.943.713 2.365-.19 3.268l-.49.49a.475.475 0 0 0-.11.499c.179.487.634 1.096 1.364 1.827.732.731 1.34 1.185 1.827 1.364.174.064.369.02.5-.11l.489-.49c.903-.902 2.324-.985 3.269-.19l.683.574c.779.656.858 1.839.175 2.64-.372.431-.896.702-1.463.756-2.182.294-4.471-.758-6.868-3.155-2.398-2.398-3.45-4.688-3.156-6.87a2.213 2.213 0 0 1 .756-1.464c.802-.68 1.984-.602 2.64.178z" fill="currentColor" /></symbol>',16,16,!1,void 0);var qi=function(e){var n=e.isAddSubmitDisabled,t=e.onAdd,a=e.onAddAll,r=e.tab,s=e.showCallAll,l=(0,Ae.useLang)().getLang;return(0,o.jsxs)(o.Fragment,{children:[r===Ei.Participants&&s&&(0,o.jsxs)(_i.default,(0,i.__assign)({className:"CallManagementModal__callAllButton",appearance:"secondary",onClick:a},{children:[(0,o.jsx)(Xi,{height:15,className:"CallManagementModal__callAllButton__icon"},void 0),(0,o.jsx)("div",{children:l("calls_call_all")},void 0)]}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({disabled:n,onClick:t},{children:l("calls_add")}),void 0)]},void 0)},$i=function(e){var n=e.SDK,t=e.isWithBackButton,a=e.onBackClick,r=(0,c.useSelector)((function(e){return e})),s=(0,c.useSelector)((function(e){return e.me})),_=(0,c.useSelector)((function(e){return e.participants})),v=u(),p=(0,l.useContext)(E.LangContext).getLang,f=(0,i.__read)((0,l.useState)(r.preselectedIds||[]),2),h=f[0],g=f[1],m=(0,c.useSelector)((function(e){return e.chatMembers.length})),A=(0,c.useSelector)((function(e){return e.friendsCount||0})),C=(0,c.useSelector)((function(e){return e.groupMembersCount})),S=(0,c.useSelector)((function(e){return 0!==e.groupId})),I=(0,l.useMemo)((function(){return(0,k.getParticipantsInfo)({me:s,participants:_,excludeAnonymFromCount:!0})}),[_,s]),T=I.creatorPeerId,x=I.membersCount,y=(0,k.isParticipantGroup)(T),N=x+h.length,b=function(e){var n=e.friendsCount,t=e.membersCount,a=e.defaultTab,o=e.groupMembersCount,r=e.displayTabs,s=(0,Ae.useLang)().getLang,c=(0,i.__read)((0,l.useState)(a||Ei.Participants),2),d=c[0],u=c[1],_=function(e){switch(e){case Ei.Participants:return{id:Ei.Participants,label:s("calls_call_patricipants"),counter:t};case Ei.Friends:return{id:Ei.Friends,label:s("calls_call_friends"),counter:n};case Ei.Community:return{id:Ei.Community,label:s("calls_call_community_members"),counter:o}}},v=(0,l.useMemo)((function(){var e,n,t=[];try{for(var a=(0,i.__values)(r),o=a.next();!o.done;o=a.next()){var s=o.value;s&&t.push(_(s))}}catch(n){e={error:n}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return t}),[s,t,n,d,o,r]);return{tab:d,tabs:v,onChangeTab:(0,l.useCallback)((function(e){u(e)}),[])}}({membersCount:x,friendsCount:A,groupMembersCount:C,displayTabs:(0,l.useMemo)((function(){return[!S&&!y&&Ei.Participants,S?Ei.Community:Ei.Friends]}),[S]),defaultTab:S?Ei.Community:y?Ei.Friends:m>1?Ei.Participants:Ei.Friends}),O=b.onChangeTab,P=b.tab,L=b.tabs,D=function(){v({type:d.E_ACTION.GROUP_CALL_SETUP,open:!1,preselectedIds:null}),v({type:d.E_ACTION.MANAGEMENT,isOpen:!1})},R=0===h.length,j=function(e){D(),v({type:d.E_ACTION.MANUAL_ADD_PARTICIPANTS,participants:e});var t=e.map((function(e){return new Promise((function(t){n.addParticipant(String(e)).then(t).catch((function(n){"auth.banned"===n.message?t(e):"vk-participant-is-rejected-error"===n.message?v({type:d.E_ACTION.ERROR,text:p("calls_error_cant_add_because_of_privacy")}):t(null)}))}))}));Promise.all(t).then((function(e){if((e=e.filter((function(e){return void 0!==e}))).length){var n=function(e,n){var t=(0,i.__spreadArray)((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e.friends),!1),(0,i.__read)(e.chatMembers),!1),(0,i.__read)(e.groupMembers),!1),a=[];return t.filter((function(e){var t=e.id;return!(!n.includes(t)||a.includes(t))&&(a.push(t),!0)}))}(r,e);v({type:d.E_ACTION.UNBAN_PARTICIPANTS,data:{members:n}})}}));var a=(0,i.__read)((0,Qe.convertClientData)(function(e,n){var t=e.chatData||e.callData.conversation,a=n.reduce((function(n,t){return e.participants[t]||n.set(t,!0),n}),new Map);if(0===a.size)return[t,[]];var o=e.chatMembers.length<e.friends.length?e.chatMembers:e.friends,r=e.chatMembers.length<e.friends.length?e.friends:e.chatMembers,s=o.reduce((function(e,n){return a.get(n.id)&&(e.smallerListData.push(n),e.smallerListMap.set(n.id,!0)),e}),{smallerListData:[],smallerListMap:new Map}),l=s.smallerListData,c=s.smallerListMap;if(l.length===a.size)return[t,l];var d=r.filter((function(e){return!c.get(e.id)&&a.get(e.id)}));return[t,(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(l),!1),(0,i.__read)(d),!1)]}(r,e)),2),o=a[0],s=a[1];v({type:d.E_ACTION.LOAD_PEERS,conversation:o,members:s}),w.callStats.logEvent({call_event_type:d.CallActionEventType.OUTGOING_CALL_ADD_PARTICIPANTS_SENT,session_id:r.callData.callId,peer_id:r.peer.toString(),is_group_call:(0,M.isGroupCallByPeer)(r.peer),group_call_users_count:h.length})};return(0,o.jsx)(Ya,(0,i.__assign)({title:p("calls_add_participants_to_call"),onCloseModal:D,actionButtons:(0,o.jsx)(qi,{isAddSubmitDisabled:R,onAdd:function(){j(h)},onAddAll:function(){var e=function(e){var n=e.state,t=e.selectedMap,a=(0,k.getActiveDevices)(n).activeDevices.reduce((function(e,n){return e[n.externalId.id]=!0,e}),{});return n.chatMembers.reduce((function(e,i){var o=i.peerId;return a[o]||Bi({member:i,state:n,selectedMap:t})||e.push(o),e}),[])}({state:r});j(e)},tab:P,showCallAll:m>x},void 0),hint:P!==Ei.Participants?eo(N,p):void 0,isWithBackButton:t,onBackClick:t?a:function(){}},{children:(0,o.jsx)(Ji,{onChange:g,tab:P,tabs:L,onChangeTab:O,selected:h},void 0)}),void 0)};function eo(e,n){if(e<2)return n("calls_management_add_warning")}var no=t(63035),to=function(e,n,t){var a=null,i=e;return e===d.EVideoEffectType.BLUR?(a=no.CallActionEventType.VIRTUAL_BACKGROUND_DISABLED,i=d.VIRTUAL_BACKGROUND_BLUR_ID):"number"==typeof e&&(a=e>4e3?no.CallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_DISABLED:no.CallActionEventType.VIRTUAL_BACKGROUND_DISABLED),{prevSendValue:i,disabledActionType:a,effectDuration:Math.round((n-t)/1e3)}},ao=function(e){var n=q();if(n){ee();var t=J(),a=Date.now(),i=e.callData.callId,o=e.peer,r=(0,M.isGroupCallByPeer)(o),s=to(t,a,n),l=s.disabledActionType,c=s.effectDuration,d=s.prevSendValue;null!==l&&w.callStats.logEvent({call_event_type:l,is_group_call:r,peer_id:o,session_id:i,background_duration:c,background_id:d})}};function io(e,n,t,a){var i=n.callData.callId||"";t({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),t({type:d.E_ACTION.SET_LAST_CALL_DATA,data:{isMeEndedCallForAll:!0}}),(0,qe.forceCallFinish)(i).catch((function(e){console.error(e),t({type:d.E_ACTION.ERROR,text:a("calls_error_force_call_finish"),handleType:d.ErrorHandleType.FATAL}),t({type:d.E_ACTION.CLEAN_LAST_CALL_DATA})})).finally((function(){t({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})})),ao(n)}var oo=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#paint0_linear)"},void 0),(0,o.jsx)("path",{d:"M6.746 14.391c-.165-1.078-.204-1.206-.493-1.614-.363-.513-.415-1.1.38-1.255 2.042-.397 4.252-.1 6.265.268a5.546 5.546 0 002.204 0c2.013-.368 4.223-.665 6.264-.268.796.154.744.742.38 1.255-.288.408-.327.536-.492 1.614-.248 1.617-1.607 2.275-3.29 2.276-1.85 0-2.465-1.055-3.04-2.494-.557-1.398-1.29-1.398-1.849 0-.574 1.439-1.19 2.494-3.038 2.494-1.684 0-3.043-.66-3.29-2.276z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"paint0_linear",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#99A2AD"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#99A2AD"},void 0)]}),void 0)},void 0)]}),void 0)},ro=function(e){var n=e.hint,t=e.className,a=e.children,r=(0,i.__rest)(e,["hint","className","children"]),s=!!n,l={"ListItem--withHint":s};return(0,o.jsxs)(Xa.default,(0,i.__assign)({},r,{className:(0,le.classNames)(l,t)},{children:[a,s&&(0,o.jsx)("div",(0,i.__assign)({className:"ListItem--hint"},{children:n}),void 0)]}),void 0)};const so=(0,F.makeIcon)("Icon24DoorArrowLeftOutline","door_arrow_left_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="door_arrow_left_outline_24"><path d="M18.754 20.366c-.763.407-1.512.534-3.082.534H13a.9.9 0 1 1 0-1.8h2.672c1.487 0 1.87-.128 2.233-.322.336-.18.594-.438.773-.773.194-.362.322-.746.322-2.233V8.228c0-1.487-.128-1.871-.322-2.233a1.847 1.847 0 0 0-.773-.774c-.362-.193-.746-.321-2.233-.321H13a.9.9 0 1 1 0-1.8h2.672c1.57 0 2.32.127 3.082.534.65.347 1.164.863 1.512 1.512.407.762.534 1.512.534 3.082v7.544c0 1.57-.127 2.32-.534 3.082a3.647 3.647 0 0 1-1.512 1.512Z" /><path d="m9.364 15.364 2.463-2.464H3.9a.9.9 0 0 1 0-1.8h7.927L9.364 8.636a.9.9 0 1 1 1.272-1.272l4 4a.9.9 0 0 1 0 1.272l-4 4a.9.9 0 0 1-1.272-1.272Z" /></symbol>',24,24,!1,void 0);var lo,co=function(e){var n=e.requireAuthToJoin,t=void 0!==n&&n,a=e.onRequireAuthToJoinChanged,r=e.isWaitingHallBlockShown,s=void 0!==r&&r,c=e.isWaitingHallEnabled,d=void 0!==c&&c,u=e.onWaitingHallEnabledChanged,_=(0,l.useContext)(E.LangContext).getLang,v=(0,i.__read)((0,l.useState)(!t),2),p=v[0],f=v[1],h=(0,i.__read)((0,l.useState)(d),2),g=h[0],m=h[1],A=!1,C=(0,l.useCallback)((function(){if(!A){A=!0;var e=!p;f(e),a&&a(!e)}}),[t]),S=!1,I=(0,l.useCallback)((function(){if(!S){S=!0;var e=!g;m(e),u&&u(e)}}),[d]);return(0,o.jsxs)(Ja.default,{children:[s&&(0,o.jsx)(ro,(0,i.__assign)({onClick:I,canBeHovered:!1,icon:(0,o.jsx)(qa.ListIcon,{icon:(0,o.jsx)(so,{width:20,height:20},void 0),color:qa.ListIconColors.BLUE},void 0),hint:_("calls_menu_waiting_hall_description"),selectable:!0,aside:(0,o.jsx)(ie.default,{onChange:I,checked:g},void 0)},{children:_("calls_menu_waiting_hall_title")}),void 0),(0,o.jsx)(Xa.default,(0,i.__assign)({border:!0,canBeHovered:!1,onClick:C,selectable:!0,icon:(0,o.jsx)(oo,{},void 0),aside:(0,o.jsx)(ie.default,{onChange:C,checked:p},void 0)},{children:_("calls_management_link_allow_anonymous")}),void 0)]},void 0)},uo=t(9670);!function(e){e[e.MAIN=0]="MAIN",e[e.CALL_LINK=1]="CALL_LINK",e[e.ADD_PARTICIPANTS=2]="ADD_PARTICIPANTS",e[e.WAITING_HALL=3]="WAITING_HALL"}(lo||(lo={}));var _o=function(e){var n,t,a=e.bridge,r=e.SDK,s=e.navigateToConvo,_=e.navigateToProfile,v=e.allowAddMembers,p=void 0!==v&&v,f=(0,c.useSelector)((function(e){return e})),h=u(),g=P((function(e){return e.callData.callUrlLink||""})),m=(0,l.useContext)(N.ConfigContext).allowWaitingHall,A=f.managementView||lo.MAIN,C=(0,i.__read)((0,l.useState)(A),2),S=C[0],I=C[1],T=(0,i.__read)((0,l.useState)(!1),2),x=T[0],y=T[1],b=(0,i.__read)((0,l.useState)(!1),2),w=b[0],O=b[1],L=(0,i.__read)((0,l.useState)(!1),2),D=L[0],R=L[1],j=(0,i.__read)((0,l.useState)(!1),2),B=j[0],U=j[1],H=(0,i.__read)((0,l.useState)(!1),2),V=H[0],F=H[1],Z=p||!!(null===(n=f.callData.conversation)||void 0===n?void 0:n.canAddMembers),W=(null===(t=f.callData)||void 0===t?void 0:t.canFinishCall)||0!==f.groupId&&g,z=(0,l.useContext)(E.LangContext).getLang,K=(0,M.isRequireAuthToJoin)(f),Q=(0,M.isWaitingHallEnabled)(f),Y=(0,l.useCallback)((function(){h({type:d.E_ACTION.MANAGEMENT,isOpen:!1})}),[]),J=(0,l.useCallback)((function(){I(lo.MAIN)}),[]),X=function(e){var n=f.callData.callId||"";return y(!0),vn(h,n,e,(0,M.isAuthedByGroupId)(f)?f.groupId:0).catch((function(e){console.error(e),h({type:d.E_ACTION.ERROR,text:z("calls_get_url_link_error_text")})})).finally((function(){y(!1)}))},q=(0,l.useCallback)((function(){I(lo.CALL_LINK),g||X(!1).catch((function(){I(lo.MAIN)}))}),[f.callData.callId,g]),$=(0,l.useCallback)((function(){h({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0});var e=[tn(a,f,h)].concat((0,Ri.isChatPeer)(f.peer)?[an(f,h,f.peer,f.callData.conversation)]:[]).concat(a.authorizedGroupId?[rn(a,f,h)]:[]);return Promise.all(e).then((function(){h({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),I(lo.ADD_PARTICIPANTS)})).catch((function(e){console.error(e),h({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})}))}),[f.peer,f.callData,f.friends,f.groupMembers]),ee=(0,l.useCallback)((function(){h({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0});var e=[mi(f,h)];return Promise.all(e).then((function(){h({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),I(lo.WAITING_HALL)})).catch((function(e){console.error(e),h({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})}))}),[f.waitingHall]),ne=(0,l.useCallback)((function(){h({type:d.E_ACTION.TOGGLE_POPUP}),io(0,f,h,z)}),[f.callData.callId,f.imHash]);(0,l.useEffect)((function(){A===lo.CALL_LINK&&q()}),[]),(0,l.useEffect)((function(){var e=(0,k.participantIsAdmin)(f.localDevice),n=e;R(e),U(n),F(m&&e)}),[f.localDevice,m]);var te=(0,l.useCallback)((function(e){!function(e){var n;(0,G.changeConversationOptions)(((n={})[G.ConversationOption.REQUIRE_AUTH_TO_JOIN]=e,n))}(e)}),[]),ae=(0,l.useCallback)((function(e){!function(e){var n;(0,G.changeConversationOptions)(((n={})[G.ConversationOption.WAITING_HALL]=e,n))}(e)}),[]),ie=(0,l.useCallback)((function(){return O(!0)}),[]),oe=(0,l.useCallback)((function(){return O(!1)}),[]),re=(0,l.useCallback)((function(){X(!0).catch((function(){I(lo.MAIN)}))}),[f.callData.callId,g]);return(0,o.jsxs)(o.Fragment,{children:[S===lo.MAIN&&(0,o.jsxs)(Ya,(0,i.__assign)({title:z("calls_management_participants"),actionButtons:(0,o.jsxs)(o.Fragment,{children:[W&&(0,o.jsx)(_i.default,(0,i.__assign)({onClick:ne,appearance:"secondary"},{children:z("calls_force_call_finish")}),"forceCallFinish"),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:r.hangup},{children:z("calls_leave_call")}),"leave")]},void 0),onCloseModal:Y},{children:[(0,o.jsx)(ni,{isLinkBlockShown:Z,linkBlockTitle:z("calls_menu_link"),onLinkBlockClick:q,callUrlLink:g},void 0),(0,o.jsx)(Oi,{SDK:r,bridge:a,onAddClick:$,onShowMoreWaitingHall:ee,navigateToProfile:_,navigateToConvo:s},void 0)]}),void 0),S===lo.CALL_LINK&&(0,o.jsxs)(Ya,(0,i.__assign)({title:z("calls_management_link"),hint:K?z("calls_management_link_anonymous_disallowed_hint"):"",onCloseModal:Y,isWithBackButton:A!==lo.CALL_LINK,onBackClick:J,actionButtons:(B?[(0,o.jsx)(_i.default,(0,i.__assign)({appearance:"tertiary",onClick:re},{children:z("calls_link_invalidate")}),"invalidate-link")]:[]).concat([(0,o.jsx)(uo.CopyText,(0,i.__assign)({text:g},{children:(0,o.jsx)(_i.default,(0,i.__assign)({className:"CallManagementModal__copyTextButton",disabled:x,onClick:ie},{children:z("calls_link_copy")}),void 0)}),"copy-link")])},{children:[(0,o.jsx)(ri,{link:g,isLinkLoading:x,isCopied:w,hideCopiedText:oe},void 0),D&&(0,o.jsx)(co,{onRequireAuthToJoinChanged:te,requireAuthToJoin:K,isWaitingHallBlockShown:V,onWaitingHallEnabledChanged:ae,isWaitingHallEnabled:Q},void 0)]}),void 0),S===lo.ADD_PARTICIPANTS&&(0,o.jsx)($i,{SDK:r,isWithBackButton:!0,onBackClick:J},void 0),S===lo.WAITING_HALL&&(0,o.jsx)(Ai,{isModal:!0,isWithBackButton:!0,onBackClick:J,navigateToProfile:_},void 0)]},void 0)};const vo=(0,F.makeIcon)("Icon12CancelOutline","cancel_outline_12","0 0 12 12",'<symbol fill="none" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg" id="cancel_outline_12"><path clip-rule="evenodd" d="M9.03 2.97a.75.75 0 0 1 0 1.06L7.06 6l1.97 1.97a.75.75 0 0 1-1.06 1.06L6 7.06 4.03 9.03a.75.75 0 0 1-1.06-1.06L4.94 6 2.97 4.03a.75.75 0 0 1 1.06-1.06L6 4.94l1.97-1.97a.75.75 0 0 1 1.06 0z" fill="currentColor" fill-rule="evenodd" /></symbol>',12,12,!1,void 0);var po=function(e){var n=e.children,t=e.className,a=(0,s.classNames)("NotificationWithButton",t);return(0,o.jsx)("div",(0,i.__assign)({className:a},{children:n}),void 0)};const fo=(0,je.makeIcon)("Icon56LogoSferumColor","logo_sferum_color_56","0 0 56 56",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 56 56" id="logo_sferum_color_56"><path fill="#07F" d="M0 26.623C0 14.073 0 7.798 3.899 3.899 7.798 0 14.073 0 26.623 0h2.754c12.55 0 18.825 0 22.724 3.899C56 7.798 56 14.073 56 26.623v2.754c0 12.55 0 18.825-3.899 22.724C48.202 56 41.927 56 29.377 56h-2.754c-12.55 0-18.825 0-22.724-3.899C0 48.202 0 41.927 0 29.377v-2.754Z" /><path fill="url(#logo_sferum_color_56_a)" d="M0 26.623C0 14.073 0 7.798 3.899 3.899 7.798 0 14.073 0 26.623 0h2.754c12.55 0 18.825 0 22.724 3.899C56 7.798 56 14.073 56 26.623v2.754c0 12.55 0 18.825-3.899 22.724C48.202 56 41.927 56 29.377 56h-2.754c-12.55 0-18.825 0-22.724-3.899C0 48.202 0 41.927 0 29.377v-2.754Z" /><path fill="url(#logo_sferum_color_56_b)" d="M41.468 19.586c-.898-.897-2.067-1.436-3.412-1.643-.206-1.344-.745-2.513-1.642-3.411-6.042-6.043-15.84-6.043-21.882 0-6.043 6.042-6.043 15.84 0 21.882.898.898 2.067 1.436 3.411 1.643.207 1.345.745 2.514 1.643 3.411 6.042 6.043 15.84 6.043 21.882 0 6.043-6.042 6.043-15.84 0-21.882Z" /><path fill="url(#logo_sferum_color_56_c)" d="M24.12 24.12c4.51-4.511 9.98-6.785 13.937-6.177-.206-1.344-.745-2.514-1.642-3.411-3.539-3.539-11.306-1.51-17.348 4.534-6.043 6.042-8.073 13.81-4.534 17.348.898.898 2.067 1.436 3.411 1.643-.609-3.956 1.665-9.427 6.176-13.938Z" /><defs><radialGradient id="logo_sferum_color_56_a" cx="0" cy="0" r="1" gradientTransform="matrix(29.98957 -32.53844 17.18804 15.84163 27.683 27.922)" gradientUnits="userSpaceOnUse"><stop offset=".281" stop-color="#4BF9E8" /><stop offset=".319" stop-color="#41D8D3" /><stop offset=".384" stop-color="#32A4B2" /><stop offset=".451" stop-color="#247696" /><stop offset=".518" stop-color="#19517E" /><stop offset=".584" stop-color="#11356C" /><stop offset=".65" stop-color="#0B205F" /><stop offset=".716" stop-color="#071458" /><stop offset=".779" stop-color="#061055" /></radialGradient><radialGradient id="logo_sferum_color_56_c" cx="0" cy="0" r="1" gradientTransform="rotate(-128.972 23.696 8.511) scale(13.7017 20.209)" gradientUnits="userSpaceOnUse"><stop stop-color="#0B25CE" /><stop offset=".486" stop-color="#2C93DB" /><stop offset=".838" stop-color="#42DCE4" /><stop offset="1" stop-color="#4BF9E8" /></radialGradient><linearGradient id="logo_sferum_color_56_b" x1="16.716" x2="39.042" y1="37.874" y2="18.339" gradientUnits="userSpaceOnUse"><stop stop-color="#0000C9" /><stop offset=".128" stop-color="#2006C9" /><stop offset=".322" stop-color="#4A0EC8" /><stop offset=".511" stop-color="#6B14C8" /><stop offset=".691" stop-color="#8318C7" /><stop offset=".858" stop-color="#911BC7" /><stop offset="1" stop-color="#961CC7" /></linearGradient></defs></symbol>',56,56),ho=(0,je.makeIcon)("Icon96LogoVkCallsColor","logo_vk_calls_color_96","0 0 96 96",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 96 96" id="logo_vk_calls_color_96"><path fill="#07F" d="M62.72 0C89.6 0 96 6.4 96 33.28v29.44C96 89.6 89.6 96 62.72 96H33.28C6.4 96 0 89.6 0 62.72V33.28C0 6.4 6.4 0 33.28 0h29.44Z" /><path fill="#77BEFF" d="M95.999 63.146c-.01 3.725-.146 7.051-.446 10.018a55.994 55.994 0 0 1-20.404 3.823c-10.73 0-20.756-3.01-29.281-8.232a2.563 2.563 0 0 0-2.38-.15c-5.3 2.357-11.26 3.594-17.93 4.13-1.841.148-3.08-1.8-2.29-3.471 2.633-5.574 4.358-10.617 5.41-15.635a2.41 2.41 0 0 0-.365-1.821c-5.877-8.875-9.3-19.516-9.3-30.957 0-7.198 1.355-14.08 3.823-20.404C25.916.135 29.382 0 33.28 0h29.44c26.77 0 33.227 6.348 33.279 32.952V63.146Z" /><path fill="#fff" d="M22.834.447a55.996 55.996 0 0 0-3.821 20.398c0 11.44 3.423 22.082 9.3 30.957a2.41 2.41 0 0 1 .365 1.821c-.758 3.618-1.866 7.25-3.413 11.083l-.004.01a77.91 77.91 0 0 1-.289.706 87.244 87.244 0 0 1-1.705 3.836c-.79 1.67.45 3.619 2.292 3.47a79.068 79.068 0 0 0 5.177-.584l.038-.006c4.605-.69 8.836-1.815 12.715-3.539.77-.342 1.66-.29 2.379.15 8.525 5.222 18.551 8.232 29.28 8.232 7.2 0 14.081-1.355 20.405-3.824-.356 3.523-.945 6.539-1.83 9.111A64.15 64.15 0 0 1 75.149 85c-11.245 0-21.833-2.9-31.036-7.995-5.64 2.12-11.655 3.215-17.913 3.718-8.562.687-13.358-8.176-10.183-14.892 2-4.232 3.376-8.019 4.303-11.659-5.918-9.717-9.326-21.135-9.326-33.327 0-6.448.953-12.683 2.729-18.565 2.572-.886 5.588-1.476 9.11-1.833Z" /><path fill="#fff" fill-rule="evenodd" d="M43.164 15.03c2.618-.308 4.793 1.844 6.05 4.356l1.408 2.817a6.894 6.894 0 0 1-2.664 9.022c-.501.296-.659.952-.333 1.44a56.82 56.82 0 0 0 7.084 8.626 56.826 56.826 0 0 0 8.626 7.084 1.017 1.017 0 0 0 1.44-.333 6.894 6.894 0 0 1 9.022-2.664l2.817 1.409c2.512 1.256 4.664 3.431 4.357 6.05-.165 1.403-.744 2.65-1.81 3.717-2.702 2.701-7.448 3.134-12.984 1.453-5.518-1.675-11.729-5.428-17.242-10.942-5.514-5.513-9.267-11.724-10.942-17.242-1.68-5.536-1.248-10.282 1.453-12.984 1.066-1.066 2.313-1.645 3.718-1.81Z" clip-rule="evenodd" /></symbol>',96,96);var go=t(61108),mo=function(e,n,t){void 0===t&&(t=!1);var a=document.createElement("a");t&&(a.target="_blank"),a.download=n,a.href=e,document.body.appendChild(a),a.click(),a.remove()};function Ao(e){if(e)return function(){switch(go.Platform.OS){case go.OS.MAC:case go.OS.WINDOWS:return{url:d.SFERUM_APP_URL[go.Platform.OS],filename:d.SFERUM_DESKTOP_CALLS_FILENAME[go.Platform.OS]};case go.OS.LINUX:return{url:d.SFERUM_APP_URL[go.Platform.OS].deb[go.ARCH.X64],filename:d.SFERUM_DESKTOP_CALLS_FILENAME[go.Platform.OS].deb[go.ARCH.X64]};default:return null}}();var n=null;return go.Platform.OS===go.OS.MAC?n={url:d.DESKTOP_CALLS_DOWNLOAD[go.OS.MAC],filename:d.DESKTOP_CALLS_FILENAME[go.OS.MAC]}:go.Platform.OS===go.OS.WINDOWS?n={url:d.DESKTOP_CALLS_DOWNLOAD[go.OS.WINDOWS],filename:d.DESKTOP_CALLS_FILENAME[go.OS.WINDOWS]}:go.Platform.OS===go.OS.LINUX&&(n={url:d.DESKTOP_CALLS_DOWNLOAD[go.OS.LINUX].deb[go.ARCH.X64],filename:d.DESKTOP_CALLS_FILENAME[go.OS.LINUX].deb[go.ARCH.X64]}),n}function Co(){s.localStorage.setItem(d.LOCALSTORAGE_IS_CALLS_APP_DOWNLOADED,"true")}var Eo=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"12",height:"13",viewBox:"0 0 12 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.21967 2.96967C4.51256 2.67678 4.98744 2.67678 5.28033 2.96967L8.28033 5.96967C8.57322 6.26256 8.57322 6.73744 8.28033 7.03033L5.28033 10.0303C4.98744 10.3232 4.51256 10.3232 4.21967 10.0303C3.92678 9.73744 3.92678 9.26256 4.21967 8.96967L6.68934 6.5L4.21967 4.03033C3.92678 3.73744 3.92678 3.26256 4.21967 2.96967Z",fill:"white",fillOpacity:"0.64"},void 0)}),void 0)},So=function(e){var n=e.onClose,t=e.isSferum,a=(0,Ae.useLang)().getLang,r=Ao(t),s=go.Platform.OS===go.OS.MAC?"macOS":go.Platform.OS===go.OS.WINDOWS?"Windows":null,l=s?a("calls_notification_native_app_button_for").replace("{name}",s):a("calls_notification_native_app_button");return(0,o.jsxs)("div",(0,i.__assign)({className:"NotificationDesktopApp"},{children:[(0,o.jsx)(vo,{className:"NotificationDesktopApp--close",onClick:n,width:16,height:16},void 0),!!t&&(0,o.jsx)(fo,{className:"NotificationDesktopApp--icon"},void 0),!t&&(0,o.jsx)(ho,{className:"NotificationDesktopApp--icon",width:56,height:56},void 0),(0,o.jsx)("span",(0,i.__assign)({className:"NotificationDesktopApp--text"},{children:a("calls_notification_native_app_text")}),void 0),null!==s&&(0,o.jsxs)(_i.default,(0,i.__assign)({onClick:function(){r&&mo(r.url,r.filename),n()},appearance:"overlay_primary",className:"NotificationDesktopApp--button"},{children:[l," ",(0,o.jsx)(Eo,{className:"NotificationDesktopApp--angleIcon"},void 0)]}),void 0),null===s&&(0,o.jsxs)("a",(0,i.__assign)({href:d.DESKTOP_CALLS_DOWNLOAD_PAGE,rel:"noopener noreferrer",target:"_blank",className:"NotificationDesktopApp--button"},{children:[l," ",(0,o.jsx)(Eo,{className:"NotificationDesktopApp--angleIcon"},void 0)]}),void 0)]}),void 0)};const Io=(0,F.makeIcon)("Icon20ClockOutline","clock_outline_20","0 0 20 20",'<symbol fill="none" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="clock_outline_20"><g fill="currentColor"><path d="M10.25 6.5a.75.75 0 0 0-1.5 0v4a.75.75 0 0 0 .516.713l3.5 1.15a.75.75 0 1 0 .468-1.425l-2.984-.981z" /><path clip-rule="evenodd" d="M18.5 10a8.5 8.5 0 1 0-17 0 8.5 8.5 0 0 0 17 0zM3 10a7 7 0 1 1 14 0 7 7 0 0 1-14 0z" fill-rule="evenodd" /></g></symbol>',20,20,!1,void 0),To=(0,F.makeIcon)("Icon20ChevronRight","chevron_right_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="chevron_right_20"><path fill-rule="evenodd" d="M7.293 4.293a1 1 0 0 1 1.414 0l5 5a1 1 0 0 1 0 1.414l-5 5a1 1 0 0 1-1.414-1.414L11.586 10 7.293 5.707a1 1 0 0 1 0-1.414Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0);var xo=function(e){var n=e.open,t=e.onClose,a=e.onExit,r=(0,Ae.useLang)().getLang,s=(0,l.useRef)(null),c=(0,l.useRef)(null),d=(0,l.useRef)(null);return(0,l.useEffect)((function(){if(n&&t){var e=function(){d.current&&clearTimeout(d.current)};return e(),d.current=setTimeout((function(){t(!0)}),1e4),e}}),[n,t]),(0,l.useEffect)((function(){var e;if(!n)return null===(e=s.current)||void 0===e||e.addEventListener("transitionend",t),c.current=setTimeout(t,600),i;function t(){i(),null==a||a()}function i(){var e;null===(e=s.current)||void 0===e||e.removeEventListener("transitionend",t),c.current&&clearTimeout(c.current)}}),[n,a]),(0,o.jsxs)("div",(0,i.__assign)({ref:s,onClick:function(){return null==t?void 0:t()},className:(0,Ze.classNames)({CallsNotificationRecordEnded:!0,"CallsNotificationRecordEnded--closing":!n})},{children:[(0,o.jsx)(Io,{className:"CallsNotificationRecordEnded--clock",fill:"#529EF4"},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsNotificationRecordEnded--desc"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallsNotificationRecordEnded--desc__title"},{children:r("calls_record_is_processed")}),void 0),(0,o.jsx)("div",{children:r("calls_open_record_list")},void 0)]}),void 0),(0,o.jsx)(To,{className:"CallsNotificationRecordEnded--chevron",fill:"var(--steel_gray_200)"},void 0)]}),void 0)};const yo=(0,F.makeIcon)("Icon24ErrorCircleOutline","error_circle_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="error_circle_outline_24"><path fill-rule="evenodd" d="M4.929 4.929A9.971 9.971 0 0 1 12 2a9.972 9.972 0 0 1 7.071 2.929A9.972 9.972 0 0 1 22 12a9.972 9.972 0 0 1-2.929 7.071A9.972 9.972 0 0 1 12 22a9.972 9.972 0 0 1-7.071-2.929A9.972 9.972 0 0 1 2 12a9.972 9.972 0 0 1 2.929-7.071ZM12 3.8a8.172 8.172 0 0 0-5.798 2.402A8.172 8.172 0 0 0 3.8 12a8.17 8.17 0 0 0 2.402 5.798A8.171 8.171 0 0 0 12 20.2a8.172 8.172 0 0 0 5.798-2.402A8.172 8.172 0 0 0 20.2 12a8.171 8.171 0 0 0-2.402-5.798A8.172 8.172 0 0 0 12 3.8ZM13 16a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-1-9a.9.9 0 0 1 .9.9v5.2a.9.9 0 0 1-1.8 0V7.9A.9.9 0 0 1 12 7Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0);var No=function(e){var n=e.onClose,t=e.onClickJoin,a=(0,l.useContext)(E.LangContext).getLang,r=Ao(),c=go.Platform.OS===go.OS.LINUX?"Linux":go.Platform.OS===go.OS.MAC?"macOS":go.Platform.OS===go.OS.WINDOWS?"Windows":null,u=(0,i.__read)((0,l.useState)(null!==s.localStorage.getItem(d.LOCALSTORAGE_IS_CALLS_APP_DOWNLOADED)),2),_=u[0],v=u[1],p=c?a("calls_warning_native_app_button_for").replace("{name}",c):a("calls_warning_native_app_button"),f=null===c||go.Platform.BROWSER===go.BROWSER.FIREFOX;return(0,o.jsxs)("div",(0,i.__assign)({className:"WarningDesktopApp"},{children:[(0,o.jsx)(yo,{fill:"#FF5C5C"},void 0),(0,o.jsx)("span",(0,i.__assign)({className:"WarningDesktopApp--title"},{children:a("calls_warning_native_app_title")}),void 0),(0,o.jsx)("span",(0,i.__assign)({className:"WarningDesktopApp--text"},{children:a("calls_warning_native_app_text")}),void 0),!_&&!f&&(0,o.jsx)(_i.default,(0,i.__assign)({onClick:function(){r&&(mo(r.url,r.filename),Co(),v(!0))},appearance:"overlay_primary"},{children:p}),void 0),!_&&f&&(0,o.jsxs)("a",(0,i.__assign)({href:d.DESKTOP_CALLS_DOWNLOAD_PAGE,rel:"noopener noreferrer",target:"_blank",className:"WarningDesktopApp--link",onClick:function(){Co(),v(!0)}},{children:[p," ",(0,o.jsx)(Eo,{className:"NotificationDesktopApp--angleIcon"},void 0)]}),void 0),_&&(0,o.jsx)(_i.default,(0,i.__assign)({onClick:t,appearance:"overlay_primary"},{children:a("calls_warning_native_app_join_button")}),void 0),(0,o.jsx)(vo,{className:"WarningDesktopApp--close",onClick:n,width:16,height:16},void 0)]}),void 0)};function bo(e){return new Promise((function(n,t){if(go.Platform.isMobile)t("is_mobile");else if(document.body.focus(),"hidden"===document.visibilityState||document.hidden)t("hidden_page");else{var a,i=function(){a&&clearTimeout(a),window.removeEventListener("blur",i),n(!0)};if(window.addEventListener("blur",i),a=setTimeout((function(){window.removeEventListener("blur",i),t("timed_out")}),3e3),go.Platform.BROWSER===go.BROWSER.SAFARI||go.Platform.BROWSER===go.BROWSER.FIREFOX){var o=document.createElement("iframe");o.style.display="none",document.body.appendChild(o);var r=o.contentWindow;r?(r.location.href=e,setTimeout((function(){o.parentNode&&o.parentNode.removeChild(o)}),100)):window.location.href=e}else window.location.href=e}}))}var Mo=function(e){var n=e.joinLink,t=e.vkJoinLink,a=e.userId,i=""+d.DESKTOP_CALLS_SCHEME+d.DESKTOP_CALLS_HOST+"/join?joinLink="+n+"&userId="+a;return 0!==a&&a||(i=""+d.DESKTOP_CALLS_SCHEME+d.DESKTOP_CALLS_HOST+"/join?callId="+t+"&joinLink="+n),console.log("deeplink: ",i),i},wo=navigator.userAgent.toLowerCase(),Oo={version:(wo.match(/.+(?:me|ox|on|rv|it|era|opr|ie|edge)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:!/chrome/i.test(wo)&&/webkit|safari|khtml/i.test(wo),edge:/(edge)\/(\d+)\.(\d+)/.test(wo),chrome:/(chrome)\/(\d+)\.(\d+)/.test(wo),firefox:/(firefox)\/(\d+)\.(\d+)/.test(wo)};function Po(e){var n,t=null==e?void 0:e.find((function(e){return Oo[e.browser]&&void 0===e.version})),a=null==e?void 0:e.find((function(e){return Oo[e.browser]&&String(Oo.version).startsWith(String(e.version))}));return null!==(n=null!=a?a:t)&&void 0!==n?n:null}function ko(){var e,n=((null===(e=/\.?(?<host>[^.]+\.[^.]+)$/.exec(window.location.host))||void 0===e?void 0:e.groups)||{}).host;return n&&/^vk\.(com|ru)$/.test(n)?n:"vk.com"}var Lo=function(){var e,n,t,a,r=(0,c.useSelector)((function(e){return e})),s=u(),_=(0,Ae.useLang)(),v=_.getLang,p=_.langNumeric,f=r.config.desktopAppNotification,h=(0,i.__read)((0,l.useState)(!1),2),g=h[0],m=h[1];(0,l.useEffect)((function(){r.shouldShowRecordEndedDesktopAppNotification&&m(!0)}),[r.shouldShowRecordEndedDesktopAppNotification]);var A=(0,l.useMemo)((function(){return Po(r.config.browserWarnings)}),[r.config.browserWarnings]),C=(0,l.useCallback)((function(e){var n,t=null===(n=r.waitingHall)||void 0===n?void 0:n.members.get(e);t&&s({type:d.E_ACTION.TOGGLE_PARTICIPANTS_KICK,data:{type:d.KickParticipantType.WAITING_HALL,participant:t}})}),[null===(e=r.waitingHall)||void 0===e?void 0:e.members,r.participants]),E=(0,l.useCallback)((function(){var e=[mi(r,s)];return Promise.all(e).then((function(){s({type:d.E_ACTION.MANAGEMENT,isOpen:!0,managementView:lo.WAITING_HALL})}))}),[r.waitingHall]),S=(0,l.useCallback)((function(e){r.waitingHall&&fi(e,r.waitingHall,s)}),[null===(n=r.waitingHall)||void 0===n?void 0:n.members]),I=(0,l.useCallback)((function(){!function(e,n){e&&(e.hasNew=!1,n({type:d.E_ACTION.SET_WAITING_HALL,data:e}))}(r.waitingHall,s)}),[null===(t=r.waitingHall)||void 0===t?void 0:t.hasNew]);if(r.waitingHall&&0!==r.waitingHall.members.size&&r.waitingHall.hasNew){var T=Array.from(r.waitingHall.members.values()),x=v("calls_notification_users_in_waiting_hall_notification",r.waitingHall.totalCount).replace("{names}",(0,Qe.getParticipantsListLabel)(T,T.slice(0,3),(function(e){return e.shortName||e.name}),v,p,r.waitingHall.totalCount)),y=null;if(1===T.length){var N=T[0];y=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:function(){return S(N.peerId)},appearance:"overlay_primary"},{children:v("calls_waiting_hall_join")}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:function(){return C(N.peerId)},appearance:"overlay_secondary"},{children:v("calls_waiting_hall_forbid")}),void 0)]},void 0)}else y=(0,o.jsx)(_i.default,(0,i.__assign)({onClick:function(){return E()},appearance:"overlay_primary"},{children:v("calls_waiting_show_participants")}),void 0);return(0,o.jsx)(po,{children:(0,o.jsxs)("div",{children:[(0,o.jsx)(vo,{className:"NotificationWithButton--close",onClick:I},void 0),(0,o.jsx)("span",{children:x},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"NotificationWithButton--buttons"},{children:y}),void 0)]},void 0)},void 0)}if(r.shouldShowRecordEndedDesktopAppNotification&&ja(r))return(0,o.jsx)(xo,{open:g,onClose:function(e){var n,t;!e&&r.translation.ownerId&&window.open&&window.open((n=r.translation.ownerId,t="https://"+ko(),(0,k.isParticipantGroup)(n)?t+"/video/playlist/"+n+"_-8":t+function(e){return"/video/@"+e+"/recorded_calls"}(n)),"_blank"),m(!1)},onExit:function(){s({type:d.E_ACTION.SET_SHOW_RECORD_ENDED_DESKTOP_NOTIFICATION})}},void 0);if(A&&r.shouldShowWarningDesktopAppNotification&&(0,M.isGroupCallByPeer)(r.peer)&&(null===(a=r.join)||void 0===a?void 0:a.joinLink)){return(0,o.jsx)(No,{onClose:function(){s({type:d.E_ACTION.SET_SHOW_WARNING_DESKTOP_NOTIFICATION,data:!1}),s({type:d.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION,data:!1})},onClickJoin:function(){var e,n,t,a;if(null===(e=r.join)||void 0===e?void 0:e.joinLink)return bo(Mo({joinLink:null===(n=r.join)||void 0===n?void 0:n.joinLink,vkJoinLink:null===(t=r.join)||void 0===t?void 0:t.vkJoinLink,userId:null===(a=window.vk)||void 0===a?void 0:a.id}))}},void 0)}if(f&&r.shouldShowDesktopAppNotification){return(0,o.jsx)(So,{onClose:function(){s({type:d.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION,data:!1})},isSferum:!!r.config.sferum},void 0)}return null},Do=!1,Ro=!0;function jo(e){Ro=e}function Bo(e,n,t){if(void 0===t&&(t=!0),Ro)if(e){var a=!!(null==n?void 0:n.isAudioEnabled);t&&(Do=a),a&&(0,G.toggleLocalAudio)(!1)}else Do&&(0,G.toggleLocalAudio)(!0);else jo(!0)}var Uo,Ho=!1;function Vo(e,n,t,a){var i=e.keyCode,o=e.type,r=e.repeat,s="keydown"===o;if(32===i){if(e&&e.target){if(["FCComposer__input","FCSearch__input","fc_editable","fc_clist_filter_text"].some((function(n){return e.target.classList.contains(n)})))return}if(e.preventDefault(),r)return;if(Ho)return clearTimeout(Uo),void(Ho=!1);Ho=!0,Uo=setTimeout((function(){(function(e,n,t,a){var i=function(){var n,i,o=(null===(n=a.notification)||void 0===n?void 0:n.type)===d.NotificationType.PUSH_TO_TALK,r=!1;if(e&&!o?r=!0:e&&o?r=(null===(i=a.notification)||void 0===i?void 0:i.data)!==(0,M.isIAmSpeaking)(a):!e&&o&&(r=!0),r){var s=null;e&&(s={type:d.NotificationType.PUSH_TO_TALK,timer:0,data:(0,M.isIAmSpeaking)(a)}),t({type:d.E_ACTION.CALL_NOTIFICATION,notification:s})}};return e&&n||!e&&!n?Promise.resolve().then(i):(0,G.toggleLocalAudio)(e).then(i)})(s,n,t,a).then((function(){Ho=!1}))}),s?200:100)}}var Go=(0,l.memo)((function(e){var n=e.externalId,t=e.isInfoShown,a=e.isPinned,r=e.isPinnedByAdmin,c=e.isHandRaised,d=void 0!==c&&c,u=e.photo,_=e.hasAudio,v=e.isMe,p=void 0!==v&&v,f=e.name,m=e.letter,A=e.wasConnected,C=void 0===A||A,E=e.onClickParticipant,S=e.onDblClickParticipant,I=e.availableStreamModes,T=(0,l.useContext)(N.ConfigContext).anonymPhoto,x=(0,l.useRef)(null),y=(0,k.isParticipantAnonym)(n),b=(0,s.classNames)("Participant","Participant--withAnimation",{"Participant--isPinned":a}),M=(0,k.externalIdToString)(n),w=(0,l.useCallback)((function(e){E&&E(e,n)}),[E,n]),O=(0,l.useCallback)((function(e){S&&S(e,n)}),[S,n]);return(0,o.jsxs)("article",(0,i.__assign)({ref:x,className:b,onClick:w,onDoubleClick:O,"participant-id":M},{children:[(0,o.jsx)(h,(0,i.__assign)({id:+n.id,className:"Participant__main"},{children:(0,o.jsx)(g.CallPhoto,{id:+n.id,photo:!T&&y?"":u,alt:f||"",letter:m,className:t?"Participant__offsetCard":""},void 0)}),void 0),(0,o.jsx)(he,{isPinnedByAdmin:r,isPinned:a,availableStreamModes:I},void 0),d&&(0,o.jsx)("div",(0,i.__assign)({className:"Participant__handIndicator"},{children:(0,o.jsx)(U,{className:"Participant__handIcon"},void 0)}),void 0),t&&(0,o.jsxs)("footer",(0,i.__assign)({className:"Participant__footer"},{children:[(0,o.jsx)("span",(0,i.__assign)({className:"Participant__name"},{children:f}),void 0),(C||p)&&!_&&(0,o.jsx)("span",{className:"Participant__statusIcon Participant__statusIcon--mic"},void 0)]}),void 0)]}),void 0)})),Fo=function(){var e=P((function(e){return e.localDevice})),n=P((function(e){return e.commonStreamedMovieInfo})),t=ea();return(0,k.participantIsAdmin)(e)||!n||t};function Zo(e){var n,t,a,r,_,v,p,f,h,m,A=e.SDK,C=e.navigateToConvo,E=e.navigateToProfile,S=e.onHandCountChanged,I=e.isVirtualBackgroundSupported,T=(0,c.useSelector)((function(e){return e})),x=u(),y=ze().getLang,O=(0,l.useContext)(N.ConfigContext),D=O.isModalView,R=O.debugLog,j=O.enableScreenTrack,B=O.enableProducerScreenTrack,U=O.allowPushToTalk,H=T.peer,V=function(){var e=P((function(e){return e.adminPinnedParticipant})),n=P((function(e){return e.movieSharingPinnedParticipant})),t=P((function(e){return e.screenSharingPinnedParticipant})),a=P((function(e){return e.pinnedParticipant})),i=P((function(e){return e.orator})),o=P((function(e){return e.externalId}));return(0,k.getFirstMatchedId)(e,n,t,a,i,o)}(),F=(0,l.useMemo)((function(){var e,n,t=(0,k.getPeerIdDeviceInfo)(H,T.devices);return(0,M.isGroupCallByPeer)(H)||!!(null===(e=T.localDevice.mediaSettings)||void 0===e?void 0:e.isScreenSharingEnabled)||!!(null===(n=null==t?void 0:t.mediaSettings)||void 0===n?void 0:n.isScreenSharingEnabled)||!(!T.localDevice.movieStream||!T.localDevice.movieStreamInfo)||!(!(null==t?void 0:t.movieStream)||!(null==t?void 0:t.movieStreamInfo))}),[H,T.localDevice,T.devices]),Z=F?T.callData.conversation:T.participants[H],W=T.localDevice,z=W.mediaSettings,K=xt.isMediaAllowed("audio",T.localDevice),Q=xt.isMediaAllowed("video",T.localDevice),Y=xt.isMediaAllowed("screenSharing",T.localDevice),J=L(),X=J>1,q=(0,k.isCallHaveOtherParticipants)(),$=X||(0,k.isParticipantWithVideo)(W)||Boolean(W.movieStream&&W.movieStreamInfo),ee=!(!T.commonStreamedMovieInfo||!T.config.enableMovieShare),ne=(0,l.useMemo)((function(){var e;if(!F||!(0,k.participantIsAdmin)(W))return!1;if(T.externalId&&!!(null===(e=T.maps.vkIdToDevices.get(+T.externalId.id))||void 0===e?void 0:e.size))return!1;var n=(0,k.getNonAnonymousConnectParticipantsCount)(),t=n.admins;return!!n.users&&!t}),[F,W.roles,T.externalId,T.participants,T.devices,T.me]),te=F||J>2,ae=te&&$&&!T.isOratorMode,ie=te&&$&&T.isOratorMode,oe=null!==T.adminPinnedParticipant,re=!oe&&null!==T.pinnedParticipant,se=!re&&null!==T.screenSharingPinnedParticipant,le=T.uiMode===d.UIMode.FULLSCREEN,ce=(0,l.useMemo)((function(){return A.browser.isScreenCapturingSupported()}),[]),de=(null===(n=T.callData)||void 0===n?void 0:n.canFinishCall)||F&&0===H&&(0,k.isCreator)(W),ue=!!T.translation.deferredId&&!T.translation.isOn,_e=(0,i.__read)((0,l.useState)(!1),2),ve=_e[0],pe=_e[1],fe=(0,i.__read)((0,l.useState)(!1),2),he=fe[0],ge=fe[1],Ae=(0,i.__read)((0,l.useState)(0),2),Ee=Ae[0],Se=Ae[1],Ie=wn(T),Te=(0,l.useMemo)((function(){return Ie?function(e){var n,t,a,o=null!==(t=null===(n=e.participantsChunk)||void 0===n?void 0:n.ids.reduce((function(n,t){var a=(0,k.externalIdToString)(t),i=Jn(e,a);return i&&n.push(i),n}),[]))&&void 0!==t?t:Ln;return 0===(null===(a=e.participantsChunk)||void 0===a?void 0:a.countBefore)&&e.externalId&&o.unshift((0,i.__assign)((0,i.__assign)({},e.localDevice),{externalId:e.externalId})),{activeDevices:Ln=(0,Qe.shallowEqual)(Ln,o)?Ln:o}}(T):(0,k.getActiveDevices)(T)}),[T.devices,T.participantsChunk,T.adminPinnedParticipant,T.gridScrollFirstVisible,T.oratorScrollFirstVisible,T.isOratorMode,T.localDevice,T.oratorScrollNumberOfVisible,T.externalId,Ie]),xe=(0,i.__read)(function(e){if(e.participantsChunk){var n=Bn(e.participantsChunk);return[n,n+e.participantsChunk.ids.length]}var t=e.isOratorMode,a=t?e.oratorScrollNumberOfVisible:d.GRID_SCROLL_NUMBER_OF_VISIBLE,i=t?k.PARTICIPANTS_LIST_BUFFER_SIZE.ORATOR:k.PARTICIPANTS_LIST_BUFFER_SIZE.GRID,o=t?e.oratorScrollFirstVisible:e.gridScrollFirstVisible;return[o<i?0:o-i,o+a+i]}(T),2),ye=xe[0],Ne=xe[1],be=(0,l.useMemo)((function(){var e=Te.activeDevices;return Ie?e:e.slice(ye,Ne)}),[Te.activeDevices,Ie,ye,Ne]),Me=(null===(t=T.callData.conversation)||void 0===t?void 0:t.canAddMembers)&&!(0,k.isParticipantAnonym)(T.me),we=(0,l.useCallback)((function(e,n){var t=(0,k.isSameExternalId)(T.pinnedParticipant,n)?null:n;(0,k.isSameExternalId)(T.screenSharingPinnedParticipant,n)&&(t=null),T.movieSharingPinnedParticipant&&x({type:d.E_ACTION.SET_MOVIE_SHARING_PINNED_PARTICIPANT,data:null}),T.screenSharingPinnedParticipant&&x({type:d.E_ACTION.SET_SCREEN_SHARING_PINNED_PARTICIPANT,screenSharingPinnedParticipant:null}),x({type:d.E_ACTION.SET_PINNED_PARTICIPANT,pinnedParticipant:t})}),[T.pinnedParticipant,T.screenSharingPinnedParticipant,T.movieSharingPinnedParticipant]),Oe=(0,l.useCallback)((function(e,n){T.isOratorMode||x({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0}),(0,k.isSameExternalId)(T.pinnedParticipant,n)||x({type:d.E_ACTION.SET_PINNED_PARTICIPANT,pinnedParticipant:n})}),[T.isOratorMode,T.pinnedParticipant]),Pe=(0,l.useMemo)((function(){return be.map((function(e){var n,t,a,i,r,s,l,c,d,u,_=e.mediaSettings,v=_.isAudioEnabled,p=_.isScreenSharingEnabled,f=(0,k.isSameExternalId)(e.externalId,T.externalId),h=T.participants[e.externalId.id],g=f?y("calls_own_label"):(null==h?void 0:h.shortName)?null==h?void 0:h.shortName:null==h?void 0:h.name,m=(0,k.externalIdToString)(e.externalId),S=(0,k.getAvailableStreamModes)(e);if(!e.visible)return(0,o.jsx)(Go,{externalId:e.externalId,isInfoShown:!0,isMe:f,isHandRaised:e.wasConnected&&(null===(t=null===(n=e.statusData)||void 0===n?void 0:n.hand)||void 0===t?void 0:t.state),hasAudio:!!v,photo:null==h?void 0:h.photo,name:g,letter:null!==(i=null===(a=null==h?void 0:h.name)||void 0===a?void 0:a[0])&&void 0!==i?i:"",wasConnected:e.wasConnected,onClickParticipant:we,isPinned:T.isOratorMode&&(0,k.isSameExternalId)(T.pinnedParticipant,e.externalId)||(0,k.isSameExternalId)(T.screenSharingPinnedParticipant,e.externalId),isPinnedByAdmin:T.isOratorMode&&(0,k.isSameExternalId)(T.adminPinnedParticipant,e.externalId),availableStreamModes:S},m);var I=T.isOratorMode&&(j||B),N=(0,k.isSameExternalId)(e.externalId||T.externalId,V),b=ie?(0,k.getSausageStream)(e,N):(0,k.getStream)(e,{onlyVideo:I&&(null===(r=e.mediaSettings)||void 0===r?void 0:r.isVideoEnabled)}),M=!(I&&(null===(s=e.mediaSettings)||void 0===s?void 0:s.isVideoEnabled)||!p),w=(0,k.isParticipantWithVideo)(e),O=T.localDevice.status===G.ParticipantStatus.CONNECTED?e.status:G.ParticipantStatus.CONNECTED,P=h&&Ca({state:T,SDK:A,dispatch:x,participant:h,addProfileLink:!0,getLang:y,navigateToConvo:C,navigateToProfile:E,separatedList:!1,device:e}),L=T.isOratorMode&&(0,k.isSameExternalId)(T.pinnedParticipant,e.externalId)||(0,k.isSameExternalId)(T.screenSharingPinnedParticipant,e.externalId)||(0,k.isSameExternalId)(T.movieSharingPinnedParticipant,e.externalId);return(0,o.jsx)(me,{externalId:e.externalId,isVisible:e.visible,isInfoShown:!0,isMe:f,isHandRaised:null===(c=null===(l=e.statusData)||void 0===l?void 0:l.hand)||void 0===c?void 0:c.state,hasVideo:!!w,hasAudio:!!v,hasMovieStream:!(!ae||!e.movieStream),isSharingScreen:!!M,streamData:b,photo:null==h?void 0:h.photo,name:g,letter:null!==(u=null===(d=null==h?void 0:h.name)||void 0===d?void 0:d[0])&&void 0!==u?u:"",status:O,allowContain:!1,wasConnected:e.wasConnected,networkStatus:e.networkStatus,onClickParticipant:T.isOratorMode?we:void 0,onDblClickParticipant:T.isOratorMode?void 0:Oe,actions:P,isPinned:L,isPinnedByAdmin:T.isOratorMode&&(0,k.isSameExternalId)(T.adminPinnedParticipant,e.externalId),availableStreamModes:S},m)}))}),[be,V,T.externalId,T.participants,T.isOratorMode,T.pinnedParticipant,T.screenSharingPinnedParticipant,T.movieSharingPinnedParticipant,T.adminPinnedParticipant,T.groupId,T.me,T.peer,T.config,T.localDevice,T.callData,T.permissions]),ke=Fo(),Le=function(e){x({type:d.E_ACTION.CHANGE_UI_MODE,mode:e})},De=function(){ga(A,[G.MediaOption.AUDIO,G.MediaOption.VIDEO]).then((function(){x({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_SETTINGS})}))},Re=function(e){x(e?{type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_RECORD}:{type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION})},je=(0,l.useCallback)((function(){Wo({isModalView:D,uiMode:T.uiMode,changeUIMode:Le})}),[T.uiMode]);(0,ma.useNavGoListener)(je,!T.config.enableNavChangeCallCollapse),(0,ma.useBoxLayerObserver)(je,!T.config.enableNavChangeCallCollapse);var Be=(0,l.useCallback)((function(){x({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!T.isOratorMode})}),[T.isOratorMode]),Ue=(0,l.useCallback)((function(){x({type:d.E_ACTION.TOGGLE_PARTICIPANTS_ASIDE,isShownParticipantsAside:!T.isShownParticipantsAside})}),[T.isShownParticipantsAside]),He=(0,l.useCallback)((function(){x({type:d.E_ACTION.MANAGEMENT,isOpen:!0})}),[]),Ge=(0,l.useCallback)((function(){x({type:d.E_ACTION.MANAGEMENT,isOpen:!0,managementView:lo.CALL_LINK})}),[]),Ze=(0,l.useCallback)((function(){if(!he){var e=!z.isVideoEnabled||!!z.isScreenSharingEnabled&&!j;(e?ga(A,[G.MediaOption.VIDEO]):Promise.resolve()).then((function(){ge(!0),j||z.isScreenSharingEnabled&&A.captureScreen(!1),A.toggleLocalVideo(e).catch((function(){})).finally((function(){ge(!1)}))})),w.callStats.logEvent({call_event_type:e?d.CallActionEventType.VIDEO_ENABLED:d.CallActionEventType.VIDEO_DISABLED,session_id:T.callData.callId,peer_id:T.peer,is_group_call:(0,M.isGroupCallByPeer)(T.peer),reason:e?void 0:"manual"})}}),[z,he]),We=(0,l.useCallback)((function(){A.captureScreen(!z.isScreenSharingEnabled).catch((function(){"MacOS"===A.browser.os()&&"Chrome"===A.browser.browserName()?x({type:d.E_ACTION.ERROR,text:y("calls_error_disabled_screen_sharing_macos_chrome")}):x({type:d.E_ACTION.ERROR,text:y("calls_error_disabled_screen_sharing")})})),w.callStats.logEvent({call_event_type:z.isScreenSharingEnabled?d.CallActionEventType.SCREEN_SHARING_STOPPED:d.CallActionEventType.SCREEN_SHARING_STARTED,session_id:T.callData.callId,peer_id:T.peer,is_group_call:(0,M.isGroupCallByPeer)(T.peer)})}),[z.isScreenSharingEnabled,T.screenSharers,T.callData.callId,T.peer]),Ke=(0,l.useCallback)((function(){C(T.peer)===ma.ENavigateToConvoDirection.Messenger&&je()}),[T.peer,T.uiMode]),Ye=(0,l.useCallback)((function(){if(!ve){var e=!z.isAudioEnabled;(e?ga(A,[G.MediaOption.AUDIO]):Promise.resolve()).then((function(){var n;pe(!0),(null===(n=T.notification)||void 0===n?void 0:n.type)===d.NotificationType.SPEAKING_ON_MUTE&&x({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),A.toggleLocalAudio(e).catch((function(){})).finally((function(){pe(!1)}))}))}}),[z,ve]),Je=(0,l.useCallback)((function(){var e,n,t,a,o=!(null===(n=null===(e=W.statusData)||void 0===e?void 0:e.hand)||void 0===n?void 0:n.state);A.changeParticipantState({hand:o?d.SdkHandType.RAISED:d.SdkHandType.LOWERED}),x({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{statusData:(0,i.__assign)((0,i.__assign)({},W.statusData),{hand:{state:!(null===(a=null===(t=W.statusData)||void 0===t?void 0:t.hand)||void 0===a?void 0:a.state),ts:Date.now()}})}}),w.callStats.logEvent({call_event_type:o?d.CallActionEventType.HAND_RAISED:d.CallActionEventType.HAND_LOWERED,session_id:T.callData.callId,peer_id:T.peer,is_group_call:(0,M.isGroupCallByPeer)(T.peer)})}),[null===(r=null===(a=W.statusData)||void 0===a?void 0:a.hand)||void 0===r?void 0:r.state]),Xe=(0,l.useCallback)((function(){x({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_EXIT})}),[]),qe=(0,l.useCallback)((function(){x({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSFER_ADMIN_RIGHTS})}),[]),$e=(0,l.useCallback)((function(){A.hangup(),w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:T.callData.callId,peer_id:T.peer,is_group_call:(0,M.isGroupCallByPeer)(T.peer),reason:"none",group_call_users_count:J})}),[T.callData.callId,T.peer,J]),en=(0,l.useCallback)((function(){x({type:d.E_ACTION.CHANGE_UI_MODE,mode:le?d.UIMode.DEFAULT:d.UIMode.FULLSCREEN}),x({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[T.uiMode]),nn=(0,l.useCallback)((function(e,n){var t;x({type:d.E_ACTION.SET_TOOLTIP,tooltips:(t={},t[e]=n,t)})}),[]),tn=(0,l.useCallback)((function(){x({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[]);(0,l.useEffect)((function(){ue&&nn("streaming",!0)}),[ue]);(0,l.useEffect)((function(){T.isOratorMode||function(e,n){var t;void 0===n&&(n=0);for(var a=(null===(t=document.querySelectorAll('[data-calls-id="grid-item"]')[0])||void 0===t?void 0:t.offsetHeight)||1/0,i=5*Math.floor(e/a),o=Te.activeDevices,r=0;r<o.length;r++){var s=n+r,l=s>=i&&s<i+30;o[r].visible!==l&&((0,k.isSameExternalId)(T.externalId,o[r].externalId)?x({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{visible:l}}):Nt(x,o[r].externalId,{visible:l}))}}(T.gridScrollPosition,Bn(T.participantsChunk))}),[T.isOratorMode,T.uiMode,T.gridScrollPosition,Te.activeDevices,null===(_=T.participantsChunk)||void 0===_?void 0:_.countBefore]),(0,l.useEffect)((function(){T.isOratorMode&&function(e,n){var t;void 0===n&&(n=0);for(var a=(null===(t=document.querySelectorAll('[data-calls-id="content"]')[0])||void 0===t?void 0:t.offsetHeight)||0,i=Math.max(0,Math.floor(e/134)-1),o=Math.min(T.config.videoSlotsCount,Math.floor(a/134+3)),r=Te.activeDevices,s=0;s<r.length;s++){var l=n+s,c=l>=i&&l<i+o;r[s].visible!==c&&((0,k.isSameExternalId)(T.externalId,r[s].externalId)?x({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{visible:c}}):Nt(x,r[s].externalId,{visible:c}))}}(T.oratorScrollPosition,Bn(T.participantsChunk))}),[T.externalId,T.config.videoSlotsCount,T.isOratorMode,T.uiMode,T.oratorScrollPosition,Te.activeDevices,null===(v=T.participantsChunk)||void 0===v?void 0:v.countBefore]);var an=(0,l.useCallback)((0,s.debounce)((function(e){var n,t=(null===(n=document.querySelectorAll('[data-calls-id="grid-item"]')[0])||void 0===n?void 0:n.offsetHeight)||1/0,a=5*Math.floor(e/t);gn(T,x,{type:d.E_ACTION.SET_GRID_SCROLL_POSITION,position:e,firstVisible:a,numberOfVisible:d.GRID_SCROLL_NUMBER_OF_VISIBLE},A)}),200),[]),on=(0,l.useCallback)((0,s.throttle)((function(e){var n,t=document.querySelectorAll('[data-calls-id="participant"]')[0]?134:1/0,a=(null===(n=document.querySelectorAll('[data-calls-id="content"]')[0])||void 0===n?void 0:n.offsetHeight)||0,i=Math.floor(e/t)-1,o=Math.min(T.config.videoSlotsCount,a/t+3);gn(T,x,{type:d.E_ACTION.SET_ORATOR_SCROLL_POSITION,position:e,firstVisible:i,numberOfVisible:Math.floor(o)},A)}),100),[T.config]),rn=(0,l.useCallback)((function(){ke&&x({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_MOVIE_CHOOSE})}),[ke]),sn=(0,l.useMemo)((function(){var e,n,t=[{text:y("calls_call_menu_settings"),key:"settings",onClick:De,disabled:!1}];if(T.config.streaming&&!(0,k.isParticipantAnonym)(T.me)&&(t.push({text:y("calls_call_menu_translation"),key:"translation",onClick:function(){return Re(!1)},disabled:!!(null===(e=T.translation)||void 0===e?void 0:e.isOn)&&(!!T.translation.isRecord||Da(T))}),T.config.enableTranslationSplit)){var a=!(!(null===(n=T.translation)||void 0===n?void 0:n.isOn)||!T.translation.isRecord),i=function(){var e;return a?!Ra(T):!!(null===(e=T.translation)||void 0===e?void 0:e.isOn)}(),o=function(){var e;return(null===(e=T.translation)||void 0===e?void 0:e.isOn)?function(){x({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_STOP})}:function(){return Re(!0)}}();t.push({text:a&&Ra(T)?y("calls_record_stop_confirmation"):y("calls_call_menu_recording"),key:"recording",onClick:o,disabled:i})}return(0,k.canMuteParticipants)(W)&&(t.push({separator:!0}),F&&(t.push({text:y("calls_call_menu_mute_audio_all_v2"),key:"muteAllAudio",onClick:function(){x({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:d.ParticipantsManagementMode.ALL_AUDIO}})},isEnabled:T.permissions.AUDIO!==G.MuteState.MUTE_PERMANENT}),t.push({text:y("calls_call_menu_mute_video_all_v2"),key:"muteAllVideo",onClick:function(){x({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:d.ParticipantsManagementMode.ALL_VIDEO}})},isEnabled:T.permissions.VIDEO!==G.MuteState.MUTE_PERMANENT}))),(0,k.canMuteParticipants)(W)&&F&&q&&t.push({text:y("calls_call_menu_enable_media_request"),key:"unmuteRequest",onClick:function(){A.muteParticipant(null,{},[G.MediaOption.AUDIO,G.MediaOption.VIDEO,G.MediaOption.SCREEN_SHARING]).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ASK_ALL_TO_UNMUTE,session_id:T.callData.callId,peer_id:T.peer,is_group_call:(0,M.isGroupCallByPeer)(T.peer)})}}),I&&(t.push({separator:!0}),t.push({text:y("calls_virtual_background"),key:d.POPUP_VIRUTAL_BACKGROUND,onClick:function(){x({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_VIRUTAL_BACKGROUND})}})),R&&(t.push({separator:!0}),t.push({text:y("calls_call_menu_debug"),key:"debugLog",onClick:function(){window.__VKCallsSDKLogs__()},disabled:!1})),t}),[T.peer,T.config.streaming,T.me,T.groupId,null===(p=T.translation)||void 0===p?void 0:p.isOn,null===(f=T.translation)||void 0===f?void 0:f.isRecord,T.conversationOptions,T.permissions,T.callData.callId,T.localDevice.roles,W,F,q]);(0,l.useEffect)((function(){return function(){x({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}}),[]);var ln=(0,l.useCallback)((function(){oe&&(0,k.canPinParticipants)(W)?(A.pinParticipant(T.adminPinnedParticipant,!0).then((function(){x({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:null})})).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ADMIN_UNPIN,session_id:T.callData.callId,peer_id:T.peer,is_group_call:(0,M.isGroupCallByPeer)(T.peer)})):(x({type:d.E_ACTION.SET_MOVIE_SHARING_PINNED_PARTICIPANT,data:null}),x({type:d.E_ACTION.SET_SCREEN_SHARING_PINNED_PARTICIPANT,screenSharingPinnedParticipant:null}),x({type:d.E_ACTION.SET_PINNED_PARTICIPANT,pinnedParticipant:null}))}),[T.adminPinnedParticipant,T.peer,T.callData.callId]),cn=(0,l.useCallback)((function(e){K&&Vo(e,!!z.isAudioEnabled,x,T)}),[K,z.isAudioEnabled,T.notification]);(0,l.useEffect)((function(){U&&K&&Bo(T.pushToTalkEnabled,z,!0)}),[]),(0,l.useEffect)((function(){return U&&!function(e){return e.uiMode===d.UIMode.COLLAPSED}(T)&&T.pushToTalkEnabled?(e=cn,window.addEventListener("keydown",e),window.addEventListener("keyup",e),function(){!function(e){window.removeEventListener("keydown",e),window.removeEventListener("keyup",e)}(cn)}):function(){};var e}),[T.uiMode,T.pushToTalkEnabled,cn]);var dn=(0,l.useMemo)((function(){return(0,o.jsx)(Lo,{},void 0)}),[T.waitingHall,T.shouldShowDesktopAppNotification,T.shouldShowWarningDesktopAppNotification,T.join]);(0,l.useEffect)((function(){if(!T.callData.localTimeStamp&&!(0,M.isGroupCallByPeer)(T.peer)&&!ua(T,y)){var e=(0,k.getPeerIdDeviceInfo)(T.peer,T.devices);e&&e.status===G.ParticipantStatus.CONNECTED&&x({type:d.E_ACTION.LOCAL_TIME_START,data:Date.now()})}}),[T]),(0,l.useEffect)((function(){F&&Se(J)}),[J]);var un=(0,l.useRef)({}),vn=(0,l.useRef)({});(0,l.useEffect)((function(){var e,n,t,a,o,r=[],s=function(e){var n,t=T.devices[e],a=t&&T.participants[t.externalId.id],i=a?a.peerId:e.split(":")[0];return(!a||(0,Qe.isEmpty)(null==t?void 0:t.mediaSettings)||!a.name)&&(null!==(n=un.current[i])&&void 0!==n?n:0)<5&&(void 0===vn.current[i]||Date.now()-vn.current[i]>1e4)},l=Date.now();try{for(var c=(0,i.__values)(be),d=c.next();!d.done;d=c.next()){var u=d.value,_=(0,k.externalIdToString)(u.externalId),v=+u.externalId.id;s(_)&&(r.push(v),un.current[v]=(null!==(o=un.current[v])&&void 0!==o?o:0)+1,vn.current[v]=l)}}catch(n){e={error:n}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}try{for(var p=(0,i.__values)(T.speakersInHeader),f=p.next();!f.done;f=p.next()){s(_=f.value)&&T.devices[_]&&r.push(+T.devices[_].externalId.id)}}catch(e){t={error:e}}finally{try{f&&!f.done&&(a=p.return)&&a.call(p)}finally{if(t)throw t.error}}if(window.Calls&&r.length>0){var h=T.callData.callId||"",g={withConversation:!T.callData.conversation,awaitImages:!1};_n(T,x,window.Calls,h,r,g)}}),[T.peer,T.speakersInHeader,be]);var pn=(0,k.getOrator)(T),fn=pn.device.streamMode===G.MediaType.MOVIE||pn.device.streamMode===G.MediaType.STREAM,hn=qt({isHardStop:!(fn&&le)}),mn=pa("CallOrator__notification");return(0,o.jsx)(b,(0,i.__assign)({onClose:ne?qe:$e,isCautionBoxShown:!ne,onBackdropClick:je},{children:(0,o.jsx)(Ve,(0,i.__assign)({info:(0,o.jsx)(za,{onHandCountChanged:S},void 0),callMenuActions:sn,isVideoAllowed:z.isVideoEnabled||Q,isAudioAllowed:z.isAudioEnabled||K,isVideoEnabled:j?!!z.isVideoEnabled:!!z.isVideoEnabled&&!z.isScreenSharingEnabled,isAudioEnabled:z.isAudioEnabled,isScreenSharingEnabled:z.isScreenSharingEnabled,isMovieStreamEnabled:ee,isOratorMode:T.isOratorMode,isFullScreen:le,onToggleVideo:Ze,onToggleAudio:Ye,onToggleScreenShare:We,onLeaveCall:ne?qe:de?Xe:$e,onCollapseCall:D?je:null,onToggleOratorMode:Be,onFullScreenToggle:en,onTooltipChange:nn,onHidePanel:tn,onChat:Ke,onHandClick:Je,isParticipantControlActive:T.isManagementOpen,isLayoutSwitchShown:F&&X,isHandRaised:null===(m=null===(h=W.statusData)||void 0===h?void 0:h.hand)||void 0===m?void 0:m.state,isHandControlShown:F,isChatControlShown:!!H&&!T.groupId,isScreenShareControlShown:Y&&ce,isStreamingControlShown:ue,isChainControlShown:Me,onDeferredStreamStart:function(){if(T.translation.deferredId){var e={isOn:!1,startStreamParams:{upcomingStreamParams:{ovId:T.translation.deferredId}}};x({type:d.E_ACTION.SET_TRANSLATION,data:e}),x({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_START_COUNTDOWN})}},onParticipantsClick:He,chatUnreadCount:T.chatUnreadCount,tooltips:T.tooltips,onChainClick:Ge,notificationWithButton:dn,participantCount:Ee,isPopupOrModalOpen:!(!T.popup&&!T.isManagementOpen),isMovieChooseShown:T.config.enableMovieShare&&Q,onMovieChooseClick:rn,isMovieChooseDisabled:!ke,callControlsVisibilityController:hn},{children:(0,o.jsxs)(o.Fragment,{children:[!ie&&mn,!te&&(0,o.jsx)(Ce,{},void 0),ae&&(0,o.jsx)(Fe,(0,i.__assign)({onScroll:an,scrollPosition:T.gridScrollPosition,participantsCount:J,participantsShiftCount:ye},{children:Pe}),void 0),ie&&(0,o.jsx)(fa,(0,i.__assign)({orator:pn,onToggleScreenShare:We,localDevice:T.localDevice,SDK:A,handleShowCallControls:hn.handleShowControls,streamedMovieState:T.streamedMovieState,localExternalId:T.externalId,me:T.me,groupId:T.groupId,meGroup:T.meGroup,isPinned:re,isPinnedByAdmin:oe,isPinnedByShareScreen:se,isUnpinAllowed:(0,k.canPinParticipants)(W)||!oe,onUnpin:ln,tooltips:T.tooltips,onTooltipChange:nn,onToggleParticipantsAside:Ue,isShownParticipantsAside:T.isShownParticipantsAside,onScroll:on,scrollPosition:T.oratorScrollPosition,participantsAsideCount:J,firstRenderedParticipantIndex:ye,isFullScreen:le},{children:Pe}),void 0),te&&!$&&(0,o.jsx)(ha.default,{children:(0,o.jsx)(g.CallPhoto,{id:H,photo:Z&&Z.photo||"",waves:!0,alt:Z&&Z.tab||"",className:"CallPhoto--orator"},void 0)},void 0)]},void 0)}),void 0)}),void 0)}function Wo(e){var n=e.isModalView,t=e.uiMode,a=e.changeUIMode;n&&(t===d.UIMode.FULLSCREEN?((0,Ka.pause)(.3,null).then((function(){a(d.UIMode.COLLAPSED)})),a(d.UIMode.DEFAULT)):a(d.UIMode.COLLAPSED))}var zo=function(e,n,t,a){var i=Math.max(e,Math.min(n,t));return Math.abs(i-e)<a?e:Math.abs(i-n)<a?n:i},Ko={bottom:0,left:0,right:0,top:0},Qo=[15,-15],Yo=function(e){var n=e.children,t=e.style,a=e.startCoords,r=void 0===a?Qo:a,s=e.padding,c=void 0===s?Ko:s,d=e.className,u=e.onUpdateStartCoords,_=e.ignoredSelectors,v=(0,l.useRef)(null),p=(0,l.useRef)(!1),f=(0,i.__read)(function(){var e=(0,i.__read)((0,l.useState)((function(){return[window.innerHeight,window.innerWidth]})),2),n=e[0],t=e[1],a=(0,l.useRef)();return(0,l.useEffect)((function(){var e=function(){a.current&&clearTimeout(a.current),a.current=setTimeout((function(){t([window.innerHeight,window.innerWidth])}),300)};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),n}(),2),h=f[0],g=f[1],m=(0,i.__read)(function(e){var n=(0,i.__read)((0,l.useState)([0,0]),2),t=n[0],a=n[1];return(0,l.useEffect)((function(){if(e.current){var n=e.current.getBoundingClientRect();a([n.width,n.height])}}),[]),t}(v),2),A=m[0],C=m[1],E=(0,i.__read)((0,l.useState)([0,0]),2),S=(0,i.__read)(E[0],2),I=S[0],T=S[1],x=E[1],y=(0,i.__read)((0,l.useState)(r),2),N=(0,i.__read)(y[0],2),b=N[0],M=N[1],w=y[1],O=(0,l.useCallback)((function(e,n){var t=0+c.left,a=0-c.top;return[zo(t,g-A-c.right,e,10),zo(-h+C+c.bottom,a,n,10)]}),[g,h,A,C,c]);(0,l.useEffect)((function(){w(O(b,M))}),[O]),(0,l.useEffect)((function(){null==u||u([b,M])}),[b,M,u]);var P=(0,l.useCallback)((function(e){e.originalEvent.preventDefault(),p.current||x([e.shiftX,e.shiftY])}),[b,M]),k=(0,l.useCallback)((function(e){e.originalEvent.preventDefault(),p.current?p.current=!1:(w((function(n){var t=(0,i.__read)(n,2),a=t[0],o=t[1];return O(a+e.shiftX,o+e.shiftY)})),x([0,0]))}),[O]),L=(0,l.useCallback)((function(e){(function(e,n){return!!n&&n.some((function(n){var t,a;return null===(a=(t=e.originalEvent.target).closest)||void 0===a?void 0:a.call(t,n)}))})(e,_)&&(p.current=!0)}),[]),D=(0,i.__read)(O(b+I,M+T),2),R=D[0],j=D[1];return(0,o.jsx)(Ze.Touch,(0,i.__assign)({className:d,Component:"div",getRootRef:v,style:(0,i.__assign)((0,i.__assign)({},t),{transform:"translate("+R+"px, "+j+"px)"}),onStart:L,onMove:P,onEnd:k},{children:n}),void 0)};function Jo(e){var n={h:!1,v:!1};if(!e)return n;var t=document.querySelector(e);return t?(t.scrollHeight>window.innerHeight&&(n.v=!0),t.scrollWidth>window.innerWidth&&(n.h=!0),n):((0,G.debugMessage)(G.DebugMessageType.ERROR,{hook:"useDragStaticElement",desc:"padding.checkScrollSelector (="+e+") is invalid"}),n)}var Xo={key:"calls_collapsed_call_position",getPosition:function(){var e=sessionStorage.getItem(Xo.key);return(0,s.isString)(e)?JSON.parse(e):void 0},setPosition:function(e){sessionStorage.setItem(Xo.key,JSON.stringify(e))}},qo=function(e){var n=e.children,t=(0,l.useContext)(N.ConfigContext).withAnimation,a=(0,s.classNames)("CollapsedCall",{"CollapsedCall--withAnimation":t});return(0,o.jsx)("div",(0,i.__assign)({className:a},{children:n}),void 0)},$o=function(e){var n=e.children,t=function(e){var n=(0,i.__read)((0,l.useState)({h:!1,v:!1}),2),t=n[0],a=n[1],o=(0,l.useRef)();return(0,l.useLayoutEffect)((function(){a(Jo(e))}),[e]),(0,l.useEffect)((function(){var n=function(){o.current&&clearTimeout(o.current),o.current=setTimeout((function(){a(Jo(e))}),300)};return window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}}),[e]),t}("body"),a=(0,l.useMemo)((function(){return{bottom:t.h?30:15,left:15,right:t.v?30:15,top:15}}),[t]),r=(0,l.useMemo)((function(){return Xo.getPosition()||[15,-15]}),[]),c=(0,l.useMemo)((function(){return[".CallVideoWidget__buttons"]}),[]),d=(0,l.useCallback)((function(e){Xo.setPosition(e)}),[]),u=(0,l.useContext)(N.ConfigContext).withAnimation,_=(0,s.classNames)("CollapsedCall","CollapsedCall--draggable",{"CollapsedCall--withAnimation":u});return(0,o.jsx)(Yo,(0,i.__assign)({className:_,padding:a,startCoords:r,onUpdateStartCoords:d,ignoredSelectors:c},{children:n}),void 0)},er=function(e){var n=e.id,t=e.photo,a=e.title,r=e.status,s=e.isIncoming,l=e.onClick,c=e.children;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallWidget",onClick:l},{children:[(0,o.jsx)(h,{id:n,className:"CallWidget__background"},void 0),(0,o.jsx)(g.CallPhoto,{id:n,photo:t,waves:s,alt:a||"",className:"CallWidget__photo"},void 0),(0,o.jsx)("h1",(0,i.__assign)({className:"CallWidget__name"},{children:a}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallWidget__status"},{children:r}),void 0),c]}),void 0)},nr=(0,l.forwardRef)((function(e,n){var t=e.children,a=e.className,r=e.alignX,l=e.alignY,c=e.size,d=void 0===c?"m":c,u=(0,i.__rest)(e,["children","className","alignX","alignY","size"]),_=(0,s.classNames)("CallIconButtonGroup","CallIconButtonGroup--"+r,"CallIconButtonGroup--"+l,"CallIconButtonGroup--size-"+d,a);return(0,o.jsx)("div",(0,i.__assign)({className:_,ref:n},u,{children:t}),void 0)})),tr=function(e){var n=e.localVideoStreamData,t=e.isLocalAudioEnabled,a=e.isLocalAudioAllowed,r=e.isLocalScreenSharing,s=e.participantId,c=e.isMe,u=void 0!==c&&c,_=e.isWithVideo,v=e.isWithAudio,p=e.isScreenSharing,f=e.streamData,h=e.photo,g=e.name,m=e.status,S=void 0===m?G.ParticipantStatus.CONNECTED:m,I=e.networkStatus,T=e.onRestoreCall,x=e.onToggleAudio,y=e.children,N=e.isRecord,b=(0,l.useContext)(E.LangContext).getLang,M=(0,i.__read)((0,l.useState)(!1),2),w=M[0],O=M[1],P=ne().storedVideoOptions;(0,l.useEffect)((function(){(null==n?void 0:n.data)||O(!1)}),[n,w]);var L=(0,l.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),T()}),[T]),D=(0,l.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),x&&x()}),[x]),R=(0,l.useCallback)((function(e){var n,t;(null===(t=(n=e.target).closest)||void 0===t?void 0:t.call(n,".CallVideoWidget__buttons"))||T()}),[T]);return(0,o.jsxs)("div",(0,i.__assign)({className:"CallVideoWidget",onDoubleClick:R},{children:[n&&n.data&&(0,o.jsx)(B,{className:"CallVideoWidget__local",participantId:(0,k.externalIdToString)(s),stream:n.data,isMirrored:!r&&P[d.EVideoOptionType.IS_VIDEO_MIRRORED],isLocalSchreenShare:r,isContained:!1,isStartWithVisible:!0},void 0),N&&(0,o.jsx)(Ma,{className:"CallVideoWidget__is-record-icon",fill:"#FF3347",width:16,height:16},void 0),(0,o.jsx)(ge,{externalId:s,hasVideo:_,hasAudio:v,isSharingScreen:p,isMe:u,streamData:f,photo:h,name:g,status:S,allowContain:!1,networkStatus:I},void 0),y,(0,o.jsx)(nr,(0,i.__assign)({alignX:"l",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},{children:(0,o.jsx)(C.default,(0,i.__assign)({position:"t",align:"left",marginTop:6,text:b(t?"calls_mute":"calls_unmute")},{children:(0,o.jsx)(A,{type:t?"mute":"unmute",onClick:D,disabled:!a},void 0)}),void 0)}),void 0),(0,o.jsx)(nr,(0,i.__assign)({alignX:"r",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},{children:(0,o.jsx)(C.default,(0,i.__assign)({position:"t",align:"right",text:b("calls_restore"),marginTop:6},{children:(0,o.jsx)(A,{type:"restore",onClick:L},void 0)}),void 0)}),void 0)]}),void 0)},ar=function(e){var n,t,a,r=e.SDK,s=P((function(e){return e})),c=u(),_=(0,l.useContext)(E.LangContext).getLang,v=s.peer,p=(0,Qe.isAnyoneWithVideo)(s),f=(0,M.isGroupCallByPeer)(v)?s.callData.conversation:s.participants[s.peer],h=s.localDevice,g=(0,k.getCallVisibleParticipant)(s,p),m=((0,k.isParticipantWithVideo)(h)||h.movieStream)&&g&&!(0,k.isSameExternalId)(g.externalId,s.externalId),A=P((function(e){return e.translation.isOn&&!!e.translation.isRecord})),C=xt.isMediaAllowed("audio",s.localDevice),S=(0,l.useCallback)((function(){c({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.DEFAULT}),jo(!1)}),[]),I=(null===(n=null==h?void 0:h.mediaSettings)||void 0===n?void 0:n.isAudioEnabled)||C,T=(0,l.useCallback)((function(){var e;r.toggleLocalAudio(!(null===(e=h.mediaSettings)||void 0===e?void 0:e.isAudioEnabled))}),[s]);return(0,o.jsxs)(o.Fragment,{children:[s.mode===d.Mode.INCOMING&&(0,o.jsx)(qo,{children:(0,o.jsx)(er,{id:v,title:(null==f?void 0:f.tab)||"",photo:(null==f?void 0:f.photo)||"",status:_("calls_incoming_collapsed"),isIncoming:!0,onClick:S},void 0)},void 0),s.mode!==d.Mode.INCOMING&&(0,o.jsx)($o,{children:(0,o.jsx)(tr,(0,i.__assign)({localVideoStreamData:m?(0,k.getStream)(h):void 0,isLocalAudioEnabled:!!(null===(t=h.mediaSettings)||void 0===t?void 0:t.isAudioEnabled),isLocalAudioAllowed:I,isLocalScreenSharing:!!(null===(a=h.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled)},ir(s,g,f),{onRestoreCall:S,onToggleAudio:T,isRecord:A}),void 0)},void 0)]},void 0)};function ir(e,n,t){var a,i,o=n&&e.participants[n.externalId.id];return n&&o?{participantId:n.externalId,isMe:+n.externalId.id===e.me,isWithVideo:(0,k.isParticipantWithVideo)(n)||(0,k.isParticipantWithMovie)(n),isWithAudio:!!(null===(a=n.mediaSettings)||void 0===a?void 0:a.isAudioEnabled),isScreenSharing:!!(null===(i=n.mediaSettings)||void 0===i?void 0:i.isScreenSharingEnabled),streamData:(0,k.getStream)(n),photo:o.photo,name:o.name,status:n.status,networkStatus:n.networkStatus||1}:{participantId:(0,k.getDefaultExternalId)(),isMe:!1,isWithVideo:!1,isWithAudio:!1,isScreenSharing:!1,streamData:void 0,photo:(null==t?void 0:t.photo)||"",name:(null==t?void 0:t.tab)||"",status:(null==t?void 0:t.status)||G.ParticipantStatus.CONNECTED,networkStatus:1}}var or="incoming",rr="outgoing",sr="connecting",lr="connected",cr="end";function dr(e){var n,t=e.onBeforeCallStart,a=e.onAfterCallFinish,r=e.callSounds,s=(0,c.useSelector)((function(e){return e})),u=(0,l.useRef)(),_=((n={}).incoming=(0,l.useRef)(null),n.outgoing=(0,l.useRef)(null),n.connecting=(0,l.useRef)(null),n.connected=(0,l.useRef)(null),n.end=(0,l.useRef)(null),n),v={controls:!1,preload:"auto"},p=(0,l.useCallback)((function(e){var n=_[e].current;n&&n.paused&&n.play().catch((function(){}))}),[]),f=(0,l.useCallback)((function(e){var n=_[e].current;n&&!n.paused&&(n.pause(),n.currentTime=0)}),[]),h=(0,l.useCallback)((function(){Object.keys(_).forEach(f)}),[]),g=(0,l.useCallback)((function(e){var n=_[e].current;if(n){var t=n.volume;n.volume=0,n.play().catch((function(){})),n.pause(),n.currentTime=0,n.volume=t}}),[]),m=(0,l.useCallback)((function(){t&&t()}),[t]),A=(0,l.useCallback)((function(){a&&a()}),[a]);return(0,l.useEffect)((function(){return Oo.safari&&document.body.addEventListener("mousedown",(function e(){Object.keys(_).forEach(g),document.body.removeEventListener("mousedown",e)})),function(){h(),A()}}),[]),(0,l.useEffect)((function(){var e=u.current||s,n=s;e.mode!==n.mode&&(e.mode!==d.Mode.READY||n.mode!==d.Mode.INCOMING&&n.mode!==d.Mode.CALL||m(),e.mode===d.Mode.INCOMING&&f(or),n.mode===d.Mode.INCOMING&&p(or),n.mode!==d.Mode.READY||e.mode!==d.Mode.INCOMING&&e.mode!==d.Mode.CALL||(h(),p(cr),A()));var t=n.me,a=e.participants,o=n.participants,r=e.localDevice.status,l=n.localDevice.status,c=e.devices,_=n.devices;r!==l&&(r===G.ParticipantStatus.CONNECTING&&f(sr),l===G.ParticipantStatus.CONNECTING&&p(sr));var v=(0,Qe.objectSome)(o,(function(e){var n=e.peerId;return!!a[n]&&(0,k.someDeviceByParticipant)(a[n],(function(e){return e.status===G.ParticipantStatus.CONNECTED}))})),g=(0,Qe.objectSome)(o,(function(e){var n=e.peerId,t=c[n],a=_[n];return t&&a&&t.status!==a.status&&a.status===G.ParticipantStatus.CONNECTED}));!v&&g&&p(lr),n.mode===d.Mode.CALL&&(!function(e,n,t,a){var o,r,s=!1;try{for(var l=(0,i.__values)(Object.values(e)),c=l.next();!c.done;c=l.next()){var d=c.value;if(d.peerId!==n){if((0,k.someDeviceByParticipant)(d,(function(e){return e.status===G.ParticipantStatus.CONNECTED})))return!1;(0,k.someDeviceByParticipant)(d,(function(e){return e.status===G.ParticipantStatus.WAITING}))&&(!a||t.has(d.peerId))&&(s=!0)}}}catch(e){o={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(o)throw o.error}}return s}(o,t,n.participantsAddedByMe,(0,M.isGroupCallByPeer)(s.peer))?f(rr):p(rr)),u.current=s}),[s]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("audio",(0,i.__assign)({src:r.incoming,ref:_.incoming,loop:!0},v),void 0),(0,o.jsx)("audio",(0,i.__assign)({src:r.outgoing,ref:_.outgoing,loop:!0},v),void 0),(0,o.jsx)("audio",(0,i.__assign)({src:r.connected,ref:_.connected,loop:!1},v),void 0),(0,o.jsx)("audio",(0,i.__assign)({src:r.connecting,ref:_.connecting,loop:!0},v),void 0),(0,o.jsx)("audio",(0,i.__assign)({src:r.end,ref:_.end,loop:!1},v),void 0)]},void 0)}var ur=t(56589),_r=t(79806),vr=t(74041);function pr(e){var n=e.cameras,t=e.mics,a=e.noiseCancellationOptions,r=e.videoResolutionOptions,c=e.currentCamId,u=e.currentMicId,_=e.currentNoiseCancellation,v=e.currentVideoResolution,p=e.isCamAvailable,f=void 0!==p&&p,h=e.isMicAvailable,g=void 0!==h&&h,m=e.onCameraChange,A=e.onMicChange,S=e.onNoiseCancellationChange,I=e.onVideoResolutionChange,T=e.pushToTalkEnabled,x=e.onPushToTalkChange,y=(0,l.useContext)(E.LangContext).getLang,b=(0,l.useContext)(N.ConfigContext).allowPushToTalk,M=(0,l.useRef)(null);!function(e){var n=e.kind,t=e.resolution,a=e.mediaElRef,i=e.streamRef,o=e.deviceId,r=e.isActive,s={deviceId:o};"video"===n&&t&&(s.width={min:428,max:d.VideoWidth[t]||d.VideoWidth.SD,ideal:d.VideoWidth[t]||d.VideoWidth.SD},s.height={min:240,max:d.VideoHeight[t]||d.VideoHeight.SD,ideal:d.VideoHeight[t]||d.VideoHeight.SD});(0,l.useEffect)((function(){r&&hr(n,s).then((function(e){var n;null===(n=i.current)||void 0===n||n.getTracks().forEach((function(e){return e.stop()}));var t=a.current;t&&(i.current=e,t.srcObject=e,t.volume=0,t.play())})).catch((function(e){(0,G.debugMessage)(G.DebugMessageType.ERROR,{err:e,deviceId:o,kind:n,kindParams:s})}))}),[o,r,t]),(0,l.useEffect)((function(){return function(){var e=i.current;e&&e.getTracks().forEach((function(e){return e.stop()}));var n=a.current;n&&(n.srcObject=null)}}),[])}({kind:"video",resolution:v,mediaElRef:M,streamRef:(0,l.useRef)(null),deviceId:c,isActive:f});var w=ne().storedVideoOptions;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__camera"},{children:f?(0,o.jsx)("video",(0,i.__assign)({ref:M},{controls:!1,crossOrigin:"anonymous",playsInline:!0},{className:(0,s.classNames)({CallSettings__cameraStream:w[d.EVideoOptionType.IS_VIDEO_MIRRORED]},"CallSettings__cameraContent")}),void 0):(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("CallSettings__cameraStub","CallSettings__cameraContent")},{children:y("calls_no_camera")}),void 0)}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__label"},{children:y("calls_settings_camera")}),void 0),f?(0,o.jsx)(ur.default,{options:n.map(fr),value:c,onChange:function(e){var n=e.selected;return m(n.value)},appearance:"secondary",className:"CallSettings__field"},void 0):(0,o.jsx)(ii.default,(0,i.__assign)({className:"CallSettings__field"},{children:y("calls_settings_no_camera")}),void 0)]}),void 0),f&&(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__label"},{children:y("calls_settings_video_resolution")}),void 0),(0,o.jsx)(ur.default,{options:r,value:v,onChange:function(e){var n=e.selected;return I(n.value)},appearance:"secondary",className:"CallSettings__field"},void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__label"},{children:y("calls_settings_mic")}),void 0),g?(0,o.jsx)(ur.default,{options:t.map(fr),value:u,onChange:function(e){var n=e.selected;return A(n.value)},appearance:"secondary",className:"CallSettings__field"},void 0):(0,o.jsx)(ii.default,(0,i.__assign)({className:"CallSettings__field"},{children:y("calls_settings_no_mic")}),void 0)]}),void 0),b&&(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",{className:"CallSettings__label"},void 0),(0,o.jsx)(vr.default,(0,i.__assign)({className:"CallSettings__field",onChange:x,checked:T},{children:y("calls_settings_push_to_talk_mode_description")}),void 0),(0,o.jsx)(C.default,(0,i.__assign)({className:"CallSettings__tooltip",text:y("calls_settings_push_to_talk_mode_hint"),position:"t",appearance:"light",maxWidth:320},{children:(0,o.jsx)(_r.default,{className:"CallSettings__hint","aria-label":y("calls_settings_push_to_talk_mode_hint")},void 0)}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallSettings__block"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallSettings__label"},{children:(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:y("calls_settings_noise")}},void 0)}),void 0),g?(0,o.jsx)(ur.default,{options:a,value:_,onChange:function(e){var n=e.selected;return S(n.value)},appearance:"secondary",className:"CallSettings__field"},void 0):(0,o.jsx)(ii.default,(0,i.__assign)({className:"CallSettings__field"},{children:y("calls_settings_no_mic")}),void 0),(0,o.jsx)(C.default,(0,i.__assign)({className:"CallSettings__tooltip",text:y("calls_settings_noise_description"),position:"t",appearance:"light",maxWidth:320},{children:(0,o.jsx)(_r.default,{className:"CallSettings__hint","aria-label":y("calls_settings_noise_description")},void 0)}),void 0)]}),void 0)]}),void 0)}function fr(e){return{value:e.deviceId,label:e.label}}function hr(e,n){return(0,i.__awaiter)(this,void 0,Promise,(function(){var t,a;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,navigator.mediaDevices.getUserMedia((a={video:!1,audio:!1},a[e]=n,a))];case 1:return[2,i.sent()];case 2:if(t=i.sent(),(0,G.debugMessage)(G.DebugMessageType.ERROR,{src:"[CallSettings][useDeviceOutput][getUserMedia]",err:t,kind:e,kindParams:n}),"OverconstrainedError"===(null==t?void 0:t.name)&&"video"===e&&Object.keys(n).length>1&&"deviceId"in n)return[2,hr(e,{deviceId:n.deviceId})];throw t;case 3:return[2]}}))}))}function gr(e){var n=e.onClose,t=e.onSubmit,a=e.children,r=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(Qa.default,(0,i.__assign)({onClose:n,title:r("calls_settings"),appearance:"blue",actionButtons:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:n,appearance:"tertiary"},{children:r("calls_cancel")}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:t},{children:r("calls_save")}),void 0)]},void 0),className:"CallSettingsModal"},{children:a}),void 0)}function mr(e){var n,t,a=e.SDK,r=(0,Ae.useLang)().getLang,c=P((function(e){return e})),_=u(),v=c.config.fullHD,p=c.mode,f=!!(null===(n=c.localDevice.mediaSettings)||void 0===n?void 0:n.isVideoEnabled),h=!!(null===(t=c.localDevice.mediaSettings)||void 0===t?void 0:t.isAudioEnabled),g=xt.isMediaAllowed("audio",c.localDevice),m=(0,l.useMemo)((function(){return[{label:r("calls_noise_neural"),value:d.NoiseCancellationTypes.NEURAL,data:{denoise:!0,denoiseAnn:!0}},{label:r("calls_noise_simple"),value:d.NoiseCancellationTypes.SIMPLE,data:{denoise:!0,denoiseAnn:!1}},{label:r("calls_noise_none"),value:d.NoiseCancellationTypes.NONE,data:{denoise:!1,denoiseAnn:!1}}]}),[r]),A=(0,l.useMemo)((function(){var e=[{label:r("calls_video_resolution_sd"),value:d.VideoResolutionTypes.SD},{label:r("calls_video_resolution_hd"),value:d.VideoResolutionTypes.HD}];return v&&e.push({label:r("calls_video_resolution_fhd"),value:d.VideoResolutionTypes.FHD}),e}),[r,v]),C=a.browser.getCameras(),E=a.browser.getMicrophones(),S=a.browser.hasCamera()&&a.browser.hasCameraPermission(),I=a.browser.hasMicrophone()&&a.browser.hasMicrophonePermission(),T=a.browser.getSavedCamera(),x=a.browser.getSavedMicrophone(),y=S&&(T&&T.deviceId||C[0].deviceId),N=I&&(x&&x.deviceId||E[0].deviceId),b=(0,i.__read)((0,l.useState)(!1===y?void 0:y),2),M=b[0],w=b[1],O=(0,i.__read)((0,l.useState)(!1===N?void 0:N),2),k=O[0],L=O[1],D=(0,i.__read)((0,l.useState)(c.noiseCancellation),2),R=D[0],j=D[1],B=s.localStorage.getItem(d.VIDEO_RESOLUTION_STORAGE_KEY),U=(0,i.__read)((0,l.useState)(B===d.VideoResolutionTypes.FHD?d.VideoResolutionTypes.FHD:B===d.VideoResolutionTypes.HD?d.VideoResolutionTypes.HD:d.VideoResolutionTypes.SD),2),H=U[0],V=U[1],G=(0,i.__read)((0,l.useState)(c.pushToTalkEnabled),2),F=G[0],Z=G[1];return(0,o.jsx)(gr,(0,i.__assign)({onClose:function(){_({type:d.E_ACTION.TOGGLE_POPUP})},onSubmit:function(){var e,n=[Promise.resolve()];!T&&y===M&&p!==d.Mode.READY&&!f||!M||T&&T.deviceId===M||(f?n.push(a.changeDevice("videoinput",M)):n.push(a.browser.saveDeviceId("videoinput",M))),!k||x&&x.deviceId===k||(h?n.push(a.changeDevice("audioinput",k)):n.push(a.browser.saveDeviceId("audioinput",k))),c.noiseCancellation!==R&&n.push(a.setMediaModifiers((null===(e=m.find((function(e){return e.value===R})))||void 0===e?void 0:e.data)||{denoise:!0,denoiseAnn:!0}).then((function(){_({type:d.E_ACTION.SET_NOISE_CANCELLATION,data:R})})));var t=function(){return Promise.resolve()};c.localVideoResolution!==H&&(console.debug("set resolution from -> to: ",c.localVideoResolution,H,d.VideoWidth[H],d.VideoHeight[H]),t=function(){return a.setLocalResolution(d.VideoWidth[H],d.VideoHeight[H],{effect:{width:d.VideoWidth[H],height:d.VideoHeight[H]}}).catch((function(e){console.error(e)})).finally((function(){s.localStorage.setItem(d.VIDEO_RESOLUTION_STORAGE_KEY,H),_({type:d.E_ACTION.CHANGE_LOCAL_VIDEO_RESOLUTION,data:H})}))}),c.pushToTalkEnabled!==F&&(g&&Bo(F,c.localDevice.mediaSettings),_({type:d.E_ACTION.SET_PUSH_TO_TALK_ENABLE,data:F})),Promise.all(n).then(t).then((function(){_({type:d.E_ACTION.TOGGLE_POPUP})})).catch((function(e){console.error("Device change failed",e),_({type:d.E_ACTION.TOGGLE_POPUP})}))}},{children:(0,o.jsx)(pr,{mics:E,cameras:C,noiseCancellationOptions:m,videoResolutionOptions:A,currentCamId:M,currentMicId:k,currentNoiseCancellation:R,currentVideoResolution:H,isCamAvailable:S,isMicAvailable:I,onCameraChange:w,onMicChange:L,onNoiseCancellationChange:function(e){return j(e)},onVideoResolutionChange:function(e){return V(e)},pushToTalkEnabled:F,onPushToTalkChange:function(){Z(!F)}},void 0)}),void 0)}var Ar=function(e){function n(n){var t=e.call(this,n)||this;return t.state={hasError:!1},t}return(0,i.__extends)(n,e),n.getDerivedStateFromError=function(){return{hasError:!0}},n.prototype.componentDidCatch=function(e){switch(this.props.mode){case d.Mode.CALL:this.props.SDK.hangup();break;case d.Mode.INCOMING:this.props.SDK.declineCall()}this.props.onReset(),this.setState({hasError:!1}),console.error("Calls crashed:",e,e)},n.prototype.render=function(){return this.state.hasError?null:this.props.children},n}(l.Component),Cr=function(e){var n=e.children;return(0,o.jsx)("h2",(0,i.__assign)({className:"JoinHeader"},{children:n}),void 0)},Er=t(11541),Sr=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({width:"16",height:"16",fill:"currentColor"},n,{xmlns:"http://www.w3.org/2000/svg"},{children:(0,o.jsx)("path",{d:"M3.14 3C1.96 3 1 3.96 1 5.14v5.72C1 12.04 1.96 13 3.14 13h5.72c1.18 0 2.14-.96 2.14-2.14V5.14C11 3.96 10.04 3 8.86 3H3.14zM14.95 4.87c.23-.17.55 0 .55.28v5.7c0 .28-.32.45-.55.28L12 9.01V6.99l2.95-2.12z"},void 0)}),void 0)};const Ir=(0,F.makeIcon)("Icon28LaptopOutline","laptop_outline_28","0 0 28 28",'<symbol fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="laptop_outline_28"><path clip-rule="evenodd" d="M8 5h-.151c-.781 0-1.4-.001-1.93.171A3.5 3.5 0 0 0 3.67 7.418C3.5 7.95 3.5 8.568 3.5 9.348V19H2.162a1.162 1.162 0 0 0-.367 2.265l1.466.489c.276.092.415.138.556.17.125.029.253.05.38.062.145.014.29.014.582.014H23.22c.291 0 .437 0 .581-.014.128-.012.256-.033.381-.062.141-.032.28-.078.556-.17l1.466-.49A1.162 1.162 0 0 0 25.838 19H24.5V9.349c0-.781.001-1.4-.171-1.93a3.5 3.5 0 0 0-2.247-2.248C21.55 5 20.932 5 20.152 5H20zM6.536 7.073C6.724 7.013 6.992 7 8 7h12c1.008 0 1.276.012 1.464.073a1.5 1.5 0 0 1 .963.963c.06.188.073.456.073 1.464V19h-17V9.5c0-1.008.012-1.276.073-1.464a1.5 1.5 0 0 1 .963-.963z" fill="currentColor" fill-rule="evenodd" /></symbol>',28,28,!1,void 0),Tr=(0,F.makeIcon)("Icon28UserOutline","user_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="user_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="M17.5 8.5C17.5 6.566 15.934 5 14 5a3.499 3.499 0 0 0-3.5 3.5c0 1.934 1.566 3.5 3.5 3.5s3.5-1.566 3.5-3.5Zm2 0c0 3.039-2.461 5.5-5.5 5.5a5.499 5.499 0 0 1-5.5-5.5C8.5 5.461 10.961 3 14 3s5.5 2.461 5.5 5.5ZM7 20.643c0 .943-.08.857.456.857h13.588c.536 0 .456.086.456-.857 0-2.288-3.304-3.643-7.25-3.643S7 18.355 7 20.643Zm-2 0C5 16.763 9.299 15 14.25 15s9.25 1.763 9.25 5.643c0 2.016-.781 2.857-2.456 2.857H7.456C5.78 23.5 5 22.66 5 20.643Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',28,28,!1,void 0);var xr=function(e){var n=e.isAnonym,t=e.title,a=e.label,r=e.items,l=e.onChangeName,c=e.name,d=e.namePlaceholder,u=e.joinWithVideoText,_=e.joinWithAudioText,v=e.onJoinWithVideo,p=e.onJoinWithAudio,f=e.disabled,h=e.inputDisabled,g=e.callByNameShow,m=e.onCallByNameClick,A=e.onCallViaNativeAppClick,C=e.callViaNativeAppShow,E=e.callByNameTitle,S=e.callViaNativeAppTitle;return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("JoinScreen",{"JoinScreen--anonym":n})},{children:[(0,o.jsx)(Cr,{children:t},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"JoinScreen__members"},{children:[(0,o.jsx)(Er.AvatarsStack,{items:r},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"JoinScreen__membersLabel"},{children:a}),void 0)]}),void 0),(0,o.jsxs)("footer",(0,i.__assign)({className:"JoinScreen__footer"},{children:[n&&(0,o.jsx)(ti.default,{onChange:l,className:"JoinScreen__input",value:c,placeholder:d,disabled:h,maxLength:25,onKeyDown:function(e){"Enter"===e.key&&v()}},void 0),(0,o.jsxs)(_i.default,(0,i.__assign)({appearance:"primary",onClick:v,disabled:f,type:"submit"},{children:[(0,o.jsx)(Sr,{className:"JoinScreen__icon"},void 0),(0,o.jsx)("span",{children:u},void 0)]}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({appearance:"primary",title:_,"aria-label":_,onClick:p,disabled:f},{children:(0,o.jsx)(zi,{className:"JoinScreen__icon"},void 0)}),void 0)]}),void 0),(g||C)&&(0,o.jsxs)(Ja.default,(0,i.__assign)({border:!1,className:"JoinScreen__options"},{children:[C&&(0,o.jsx)(Xa.default,(0,i.__assign)({border:!1,selectable:!0,chevron:!0,onClick:A,icon:(0,o.jsx)(Ir,{className:"JoinScreen__optionIcon"},void 0)},{children:S}),void 0),g&&(0,o.jsx)(Xa.default,(0,i.__assign)({border:!1,selectable:!0,chevron:!0,onClick:m,icon:(0,o.jsx)(Tr,{className:"JoinScreen__optionIcon"},void 0)},{children:E}),void 0)]}),void 0)]}),void 0)},yr=t(73479),Nr=t(71154);function br(e){var n=e.onVolumeLevelReached,t=e.needCheckMicEnabled,a=e.vectorLength,o=e.volumeLevelDetection,r=e.callbackFactorStep,s=e.sensitivityCoefficient,l=e.onVolumeLevelUpdated,c=e.debugCallback,d=function(e){var n=[],t=0;return function(a){if(n.push(a),t+=a,n.length>e){var i=n.shift();t-=i||0}return t/n.length}}(a),u=0,_=!1;return function(){for(var e=[],a=0;a<arguments.length;a++)e[a]=arguments[a];c&&c(e);var v=(0,i.__read)(e,2),p=v[0],f=v[1],h=p>o;_!==h&&l&&l(h),_=h,0!==u&&f&&(u=0);var g=d(p);t&&f||p/g>(1+u)/s&&p>o&&(u+=r,n())}}function Mr(e,n){var t=Object.keys(e),a=Object.keys(n);return t.length===a.length&&t.every((function(e){return n[e]}))}function wr(e,n){return e.length===n.length&&e.every((function(e,t){return e===n[t]}))}var Or="calls_token";function Pr(e){s.localStorage.setItem(Or,e)}function kr(e){var n=s.localStorage.getItem(Or);return n?Promise.resolve(n):(0,qe.getCallAuthToken)(e).then((function(e){return e.token}))}var Lr={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null};function Dr(e){switch(e){case G.ParticipantStatus.WAITING:return 1;case G.ParticipantStatus.CONNECTING:return 2;case G.ParticipantStatus.CONNECTED:return 3;default:return 0}}var Rr,jr=function(){return Lr},Br=function(e){var n,t;Lr=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},Lr),e),{connectionStep:(n=e.connectionStep,t=Lr.connectionStep,n&&Dr(n)&&Dr(n)>Dr(t)?n:t)})},Ur=function(){Lr={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null}};function Hr(e){Rr=e}function Vr(e,n,t,a){var i,o,r,s=jr(),l=s.startType,c=s.entryPoint,u=s.timeStart,_=s.isGroupCall,v=s.hadVideoEnabled,p=s.isOutgoingCall,f=!e||e===d.HANGUP_TYPE_HUNGUP&&!t,h=l&&function(e,n,t){var a;a=e===d.CallType.VIDEO?n?d.CallStatReachedType.GROUP_VIDEO:d.CallStatReachedType.VIDEO:t?n?d.CallStatReachedType.GROUP_AUDIO_TO_VIDEO:d.CallStatReachedType.AUDIO_TO_VIDEO:n?d.CallStatReachedType.GROUP_AUDIO:d.CallStatReachedType.AUDIO;return a}(l,_,v),g={type:h,result:f?d.CallStatResult.SUCCESS:d.CallStatResult.FAIL,failReason:f?null:Gr(e,t),callSource:c,totalDuration:u?Date.now()-u:0};p&&(a&&console.log(g),i=n,r=[(o=g).type||"",o.result,o.failReason||"",o.callSource||"",o.totalDuration],Rr&&Rr({name:"call_stats",value:i,keys:r}))}function Gr(e,n){var t=jr().isOutgoingCall,a=jr().connectionStep;switch(!0){case n:return d.CallStatFailReason.CONNECTION_LOST;case e===d.HANGUP_TYPE_CANCELED:return d.CallStatFailReason.LOCAL_DECLINE;case e===d.HANGUP_TYPE_REJECTED:return d.CallStatFailReason.REMOTE_DECLINE;case e===d.HANGUP_TYPE_BUSY:return d.CallStatFailReason.REMOTE_BUSY;case e===d.HANGUP_TYPE_MISSED:return t?d.CallStatFailReason.REMOTE_TIMEOUT:null;case a===G.ParticipantStatus.CONNECTING:return d.CallStatFailReason.REMOTE_FAILED_ACCEPT;case!a:return d.CallStatFailReason.REMOTE_NO_CONNECT;default:return null}}function Fr(e,n,t){void 0===n&&(n=!0);var a="";return e&&n?a=t("calls_error_no_cam_and_mic"):e?a=t("calls_error_no_cam"):n&&(a=t("calls_error_no_mic")),a}function Zr(e,n){var t;return((t={})[d.MediaError.CAMERA_PERMISSION]=n("calls_error_no_cam"),t[d.MediaError.MIC_PERMISSION]=n("calls_error_no_mic"),t[d.MediaError.CAMERA_ACCESS]=n("calls_error_cameralock"),t[d.MediaError.MIC_ACCESS]=n("calls_error_miclock"),t[d.MediaError.MIC_NOT_FOUND]=n("calls_error_nomic"),t[d.MediaError.SCREEN_PERMISSION]=n("calls_error_screenpermission"),t[d.MediaError.SCREEN_ACCESS]=n("calls_error_screenlock"),t)[e]}function Wr(e,n){return function(t){e&&e({msg:t}),(null==n?void 0:n.onError)&&n.onError(new Error(t)),console.error(t)}}var zr=t(62090);function Kr(e,n,t,a,o,r){var l,c,u,_,v,p,f,h,g,m=a.dispatch,A=a.getState(),C=A.me,E=(0,Qe.compose)(qr,Qe.startCallRetryWrapper.bind(null,Yr.bind(null,n,e,a))),S=(0,Qe.compose)(n.joinCallByLink,Qe.startCallRetryWrapper.bind(null,Yr.bind(null,n,e,a))),I=A.localVideoResolution===d.VideoResolutionTypes.SD?d.VideoHeight.SD:d.VideoHeight.HD,T=A.localVideoResolution===d.VideoResolutionTypes.SD?d.VideoWidth.SD:d.VideoWidth.HD,x=function(){switch(!0){case A.config.enableDomainBender:return"bender";case r:return"vk_corp";default:return}}(),y=function(){if(A.config.enableCustomScreenSharePacketSize&&(0,s.isNumber)(A.config.customScreenSharePacketSize))return A.config.customScreenSharePacketSize}(),N={apiKey:t.key,apiEnv:t.is_dev?"VIDEOTEST":"PROD",anonymToken:t.is_anonym?t.token:"",filteredMessages:!0,batchParticipantsOnStart:!0,serverAudioRed:A.config.enableServerAudioRed,p2pAudioRed:A.config.enableP2PAudioRed,useParticipantListChunk:wn(A),participantListChunkInitCount:(g=window.innerHeight,Mn(Math.max(Math.ceil(g/140),8))),voiceParams:{speakerLevelMultiplier:1.3,smoothing:.5},domain:x,videoTracksCount:A.config.enableVideoSlots?A.config.videoSlotsCount:void 0,producerNotificationDataChannel:!0,videoMaxHeight:I,videoMaxWidth:T,videoEffectMaxHeight:I,videoEffectMaxWidth:T,debugLog:A.config.debugLog,consumerScreenTrack:A.config.enableScreenTrack,producerScreenTrack:A.config.enableProducerScreenTrack,callStatReportEnabled:!0,joinFromMultipleDevices:A.config.enableMultipleDevices,h264spsPpsIdrInKeyframe:!!A.config.enableSpsPpsIdrInKeyframe,movieShare:!0,clientType:"VK",consumerScreenDataChannelPacketSize:y,onLocalStream:function(n,t){e.debug&&console.warn("onLocalStream",n,t),m({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{stream:n,mediaSettings:t,streamMode:(0,k.getNewStreamModeByDevice)(G.MediaType.CAMERA,a.getState().localDevice,!!n)}}),Br({hadVideoEnabled:t.isVideoEnabled})},onLocalStreamUpdate:function(n,t){e.debug&&console.warn("onLocalStreamUpdate",n,t);var i=a.getState(),o=i.localDevice.mediaSettings;xt.decreasePermissionsOnce(i,m,n),n.isScreenSharingEnabled!==(null==o?void 0:o.isScreenSharingEnabled)&&i.externalId&&((0,k.toggleScreenSharing)(i,m,n.isScreenSharingEnabled,i.externalId),n.isScreenSharingEnabled?e.eventHandlers.onScreenSharingEnabled&&e.eventHandlers.onScreenSharingEnabled():e.eventHandlers.onScreenSharingDisabled&&e.eventHandlers.onScreenSharingDisabled()),Br({hadVideoEnabled:n.isVideoEnabled})},onRemoteStream:function(n,t){e.debug&&console.warn("onRemoteStream",n.id,t);var i=(0,k.getNewStreamModeByDevice)(G.MediaType.CAMERA,(0,k.getDeviceFromStoreById)(a,n),!!t);wn(A)?function(e,n,t){ot(e,n,t.externalId,{stream:t.stream,streamMode:t.streamMode})}(a.getState(),m,{externalId:n,stream:t,streamMode:i}):Nt(m,n,{stream:t,streamMode:i})},onRemoteLive:function(n,t){var i=t.streamName,o=t.stream,r=t.mediaType;e.debug&&console.warn("onRemoteLive",{externalId:n,streamName:i,stream:o,mediaType:r}),Nt(m,n,o?{movieStream:o,streamMode:(0,k.getNewStreamModeByDevice)(r,(0,k.getDeviceFromStoreById)(a,n),!!o)}:{movieStreamStoppedInfo:null})},onRemoteLiveUpdate:function(e,n){m({type:d.E_ACTION.UPDATE_SHARED_MOVIE_STATE,data:n})},onRemoteSharedMovieInfo:function(n,t){e.debug&&console.warn("onRemoteSharedMovieInfo",{externalId:n,sharedMovieInfo:t}),Mt({externalId:n,sharedMovieInfo:t},m,a.getState()),Nt(m,n,{movieStreamInfo:t})},onRemoteSharedMovieStoppedInfo:function(n,t){e.debug&&console.warn("onRemoteSharedMovieStoppedInfo",{externalId:n,sharedMovieStoppedInfo:t}),Mt({sharedMovieInfo:null,externalId:null},m,a.getState()),Nt(m,n,{movieStreamStoppedInfo:t,movieStream:null,movieStreamInfo:null,streamMode:(0,k.getNewStreamModeByDevice)(t.source,(0,k.getDeviceFromStoreById)(a,n),!1)})},onLocalLive:function(n,t){var i=t.streamName,o=t.stream,r=t.mediaType;if(e.debug&&console.warn("onLocalLive",n,i,o,r),o){var s=a.getState().localDevice;m({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{movieStream:o,streamMode:(0,k.getNewStreamModeByDevice)(r,s,!!o)}})}else m({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{movieStreamStoppedInfo:null}})},onLocalLiveUpdate:function(e,n){m({type:d.E_ACTION.UPDATE_SHARED_MOVIE_STATE,data:n})},onLocalSharedMovieInfo:function(n,t){e.debug&&console.warn("onLocalSharedMovieInfo",n,t),Mt({externalId:n,sharedMovieInfo:t},m,a.getState()),m({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{movieStreamInfo:t}})},onLocalSharedMovieStoppedInfo:function(n,t){e.debug&&console.warn("onLocalSharedMovieStoppedInfo",n,t),Mt({sharedMovieInfo:null,externalId:null},m,a.getState()),m({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{movieStreamStoppedInfo:t,movieStream:null,movieStreamInfo:null,streamMode:(0,k.getNewStreamModeByDevice)(t.source,a.getState().localDevice,!1)}})},onScreenStream:function(n,t){e.debug&&console.warn("onScreenStream",n,t);var i=a.getState();xt.decreasePermissionsOnce(i,m,t),m({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{screenSharingStream:n,mediaSettings:t,streamMode:(0,k.getNewStreamModeByDevice)(G.MediaType.SCREEN,a.getState().localDevice,!!n)}})},onRemoteScreenStream:function(n,t){e.debug&&console.warn("onRemoteScreenStream",n.id,t);var i=(0,k.getNewStreamModeByDevice)(G.MediaType.SCREEN,(0,k.getDeviceFromStoreById)(a,n),!!t);wn(A)?function(e,n,t){ot(e,n,t.externalId,{screenSharingStream:t.stream,streamMode:t.streamMode})}(a.getState(),m,{externalId:n,stream:t,streamMode:i}):Nt(m,n,{screenSharingStream:t,streamMode:i})},onConversation:function(t,i,o,r){if(e.debug&&((0,G.debugMessage)(G.DebugMessageType.LOG,{type:"start call info",os:go.Platform.OS,arch:go.Platform.ARCH,isMobile:go.Platform.isMobile,browser:(0,go.getBrowserInfo)(),config:a.getState().config,cameras:n.browser.getCameras(),microphones:n.browser.getMicrophones(),hasMicrophonePermission:n.browser.hasMicrophonePermission(),hasCameraPermission:n.browser.hasCameraPermission(),screenHeight:window.screen.availHeight,screenWidth:window.screen.availWidth,windowHeight:window.screen.height,windowWidth:window.screen.width}),console.warn("onConversation",t,i,r)),!a.getState().callData.ts){var s=Date.now();m({type:d.E_ACTION.TIME_START,data:s})}var l=a.getState().peer;0!==l&&ln(0,m,l),bt(A,m,r)},onConversationParticipantListChunk:function(n){!function(e,n,t,a){var i=[];a.participants.forEach((function(e){i.push(e.uid);var t=e.participantState;if(t){var a=(0,k.convertParticipantStateFromSDK)(t);zn(n,e.uid,a)}})),Xn(e,n,t,i),Gn(e,n,a)}(A,m,e,n)},onParticipantJoined:function(t,i){!function(e,n,t,a,i){var o=i.externalId,r=i.markers;if(wn(e)){var s=Fn(r),l=e.participantsChunk;if(l&&s){var c=st(e),d=l.ids||[],u=mt(s,e),_=0===c&&0===l.countBefore;if(!(u<0)){if(0===u&&!_)return it(n,{countBefore:l.countBefore+1}),void gt(e,n,t);var v=pt(l,e);u>=d.length&&v?it(n,{countAfter:l.countAfter+1}):vt(e,n,a,{externalId:o,markers:r})}}}}(a.getState(),m,n,e,{externalId:t,markers:i})},onRemoteMediaSettings:function(t,o,r){var s,l=(0,k.externalIdToString)(t),c=a.getState(),d=c.devices[l],u=null==d?void 0:d.mediaSettings;if((null==u?void 0:u.isVideoEnabled)!==o.isVideoEnabled||(null==u?void 0:u.isAudioEnabled)!==o.isAudioEnabled||(null==u?void 0:u.isScreenSharingEnabled)!==o.isScreenSharingEnabled){e.debug&&console.warn("onRemoteMediaSettings",t,o);var _=!!(null===(s=null==d?void 0:d.mediaSettings)||void 0===s?void 0:s.isScreenSharingEnabled),v=o.isScreenSharingEnabled;v!==_&&(0,k.toggleScreenSharing)(c,m,v,t,!0);var p=xt.getDecreasedPermissionsOnce(u,o,null==d?void 0:d.permissionsOnce),f=(0,i.__assign)((0,i.__assign)({},(0,k.getMediaSettingsWithStreamMode)(o,(0,k.getDeviceFromStoreById)(a,t))),{permissionsOnce:p});wn(c)&&!os(t,c)?kn(c,m,n,e,{externalId:t,markers:r,mediaSettings:o,permissionsOnce:p}):Nt(m,t,f),Br({hadVideoEnabled:o.isVideoEnabled})}},onRemoteStatus:function(n,t,o){var r,s,l=a.getState();e.debug&&console.warn("onRemoteStatus",n,t,o);var c=[];try{for(var u=(0,i.__values)(n),_=u.next();!_.done;_=u.next()){var v=_.value,p=+v.id,f=l.participants[p];f&&f.shortName||c.push(p);var h={status:t};o&&(h.statusData=o),Nt(m,v,h)}}catch(e){r={error:e}}finally{try{_&&!_.done&&(s=u.return)&&s.call(u)}finally{if(r)throw r.error}}if(e&&c.length>0){var g=l.callData.callId||"",A={withConversation:!l.callData.conversation,awaitImages:!1};_n(l,m,e,g,c,A)}Br({connectionStep:t});var C=+(null==n?void 0:n[0].id);if(C===l.peer){var E=(0,k.getPeerIdDeviceInfo)(C,Ye.GlobalStore.getCallsState().devices),S=function(e,n){var t={call_event_type:e,session_id:l.callData.callId,peer_id:l.peer,is_group_call:!1};n&&(t.reason=n),w.callStats.logEvent(t)};if(t===G.ParticipantStatus.CONNECTED){if(S(d.CallActionEventType.CALL_CONNECTED),zr.mailRuCounter.push(zr.EMailRuGoals.JoinCall),!(null==E?void 0:E.wasConnected)&&(0,k.isCreator)(l.localDevice)){var I=jr().startType;S(d.CallActionEventType.OUTGOING_CALL_ACCEPTED_REMOTELY,null==I?void 0:I.toString())}}else t===G.ParticipantStatus.WAITING&&S(d.CallActionEventType.OUTGOING_CALL_REMOTE_RINGING)}},onPermissionsError:function(t){if(e.debug&&console.warn("onPermissionsError",t),a.getState().mode===d.Mode.CALL){switch(t){case d.MediaError.CAMERA_PERMISSION:case d.MediaError.CAMERA_ACCESS:n.toggleLocalVideo(!1);break;case d.MediaError.MIC_ACCESS:case d.MediaError.MIC_NOT_FOUND:n.toggleLocalAudio(!1);break;case d.MediaError.SCREEN_PERMISSION:case d.MediaError.SCREEN_ACCESS:n.captureScreen(!1)}m({type:d.E_ACTION.ERROR,text:Zr(t,o)})}},onPermissionsRequested:function(){e.debug&&console.warn("onPermissionsRequested")},onRemoteRemoved:function(t,i){e.debug&&console.warn("onRemoteRemoved",t);var o=a.getState();wn(o)&&On(o,m,n,{externalId:t,markers:i}),m({type:d.E_ACTION.REMOVE_USER,participantId:t});var r=a.getState().movieSharingPinnedParticipant;(0,k.isSameExternalId)(r,t)&&Mt({sharedMovieInfo:null,externalId:null},m,a.getState())},onCallState:function(n,t,i){var o,r,s;e.debug&&console.warn("onCallState",n,t,i);var l=i.id,c=i.direction,u=i.joinLink,_=i.externalId,v=i.options,p=i.topology;if(l&&a.getState().callData.callId)m({type:d.E_ACTION.CALL_STATE,callData:{topology:p}});else{m({type:d.E_ACTION.CALL_STATE,callData:{callId:l,topology:p},joinLink:u,externalId:_}),m({type:d.E_ACTION.SET_CONVERSATION_OPTIONS,data:v});var f=a.getState(),h=f.peer,g=f.participants,C=f.entryPoint;if(!h){var E=[];(0,Qe.objectForEach)(g,(function(e){E.push(e.peerId)})),E.length&&_n(A,m,e,l,E,{withConversation:!0,withChatMembers:!0,withCallParticipants:!0,awaitImages:!1})}var S=a.getState().peer||0;(0,M.isGroupCallByPeer)(S)&&[G.CallDirection.JOINING,G.CallDirection.OUTGOING].includes(c)&&(w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_CONNECTED,session_id:l,peer_id:S,is_group_call:!0,source:C}),zr.mailRuCounter.push(zr.EMailRuGoals.JoinCall)),(null===(o=a.getState())||void 0===o?void 0:o.startOptions)&&(null===(s=null===(r=a.getState())||void 0===r?void 0:r.startOptions)||void 0===s?void 0:s.createLink)&&hn(m,l,a.getState().groupId)}},onRateNeeded:function(){e.debug&&console.warn("onRateNeeded")},onSpeakerChanged:function(n){e.debug&&console.warn("onSpeakerChanged",n),m({type:d.E_ACTION.SET_ORATOR,orator:n})},onJoinStatus:function(n,t){e.debug&&console.warn("onJoinStatus",n,t)},onHangup:function(t,i){var o,r=t.hangup;e.debug&&console.warn("onHangup",r,i);var s=r&&![d.HANGUP_TYPE_CANCELED,d.HANGUP_TYPE_MISSED,d.HANGUP_TYPE_HUNGUP].includes(r),l=a.getState(),c=r&&r===d.HANGUP_TYPE_HUNGUP,u=(0,M.isGroupCallByPeer)(l.peer);if(l.mode===d.Mode.CALL&&s||l.localDevice.status===G.ParticipantStatus.WAITING_HALL&&r===d.HANGUP_TYPE_REMOVED){var _=d.CALL_HANGUP_MODAP_MAP[r],v=!!(null===(o=l.lastCallData)||void 0===o?void 0:o.isMeEndedCallForAll)&&(r===G.HangupType.KILLED||r===G.HangupType.KILLED_WITHOUT_DELETE);m({type:d.E_ACTION.HANGUP,data:r}),(0,Qe.conditionalPausedPromise)(v||d.HANGUP_DELAY).finally((function(){m({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY}),_&&m({type:d.E_ACTION.TOGGLE_POPUP,data:_})}))}else if(A.config.showFeedbackScreen&&c){var p=l.callData.ts,f=(p?Math.floor((Date.now()-p)/1e3):0)>10&&0===Math.floor(3*Math.random()),h=0===Math.floor(5*Math.random());u&&f||h?(m({type:d.E_ACTION.MANAGEMENT,isOpen:!1}),m({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.FEEDBACK})):l.mode!==d.Mode.ERROR&&m({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})}else l.mode!==d.Mode.ERROR&&m({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY});e.isInActiveCall=!1;var g=(0,Qe.isInReconnect)(l);if(Vr(r,i=i||"",g,e.debug),!g&&!u){var C="none";r===G.HangupType.MISSED?C="timeout":r===G.HangupType.BUSY&&(C="busy");var E=l.callData.conversation,S={call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_REMOTELY,session_id:i,peer_id:(null==E?void 0:E.peerId)||0,is_group_call:!1,reason:C};w.callStats.logEvent(S)}e.authorizedGroupId&&function(e,n,t,a){Xr(e,n,t,0,a)}(n,e,a,m),Ur(),ao(l)},onCallAccepted:function(){e.debug&&console.warn("onCallAccepted"),(0,M.isGroupCallByPeer)(a.getState().peer)&&(w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_CONNECTED,session_id:a.getState().callData.callId,peer_id:a.getState().peer,is_group_call:(0,M.isGroupCallByPeer)(a.getState().peer)}),zr.mailRuCounter.push(zr.EMailRuGoals.JoinCall))},onTokenExpired:function(){e.debug&&console.warn("onTokenExpired"),(e.tokenAttempts||0)<3&&(Yr(n,e,a),e.tokenAttempts=(e.tokenAttempts||0)+1)},onDeviceChange:function(){e.debug&&console.warn("onDeviceChange")},onMultipartyChatCreated:function(){e.debug&&console.warn("onMultipartyChatCreated")},onFingerprintChange:function(n){e.debug&&console.warn("onFingerprintChange",n)},onVolumesDetected:(l={onUpdate:function(e){m({type:d.E_ACTION.SET_SPEAKERS,data:{speakers:e.speakers,speakersInHeader:e.speakersInHeader}})},volumeLevelDetection:d.VOLUME_LEVEL_DETECTION,debugCallback:function(){e.debug}},c=l.onUpdate,u=l.volumeLevelDetection,_=l.debugCallback,v={},p=[],f={},h=[],function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];_&&_(e);var t=(0,i.__read)(e,1),a=t[0];f=Object.keys(f).reduce((function(e,n){return f[n]-1>0&&(e[n]=f[n]-1),e}),{});var o=a.reduce((function(e,n){var t=n.uid,a=n.volume,i=(0,k.externalIdToString)(t);return a>u&&(e[i]=!0,f[i]=3),e}),{});h=Object.keys(f);var r=!1,s={speakers:v,speakersInHeader:p};Mr(v,o)||(s.speakers=o,v=o,r=!0),wr(p,h)||(s.speakersInHeader=h,p=h,r=!0),r&&c(s)}),onLocalVolume:br({onVolumeLevelReached:function(){var e=a.getState();m({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.SPEAKING_ON_MUTE}}),w.callStats.logEvent({call_event_type:d.CallActionEventType.MIC_OFF_WHILE_TALKING_ALERT,session_id:e.callData.callId,peer_id:e.peer,is_group_call:(0,M.isGroupCallByPeer)(e.peer)})},onVolumeLevelUpdated:function(e){var n,t=null===(n=a.getState().localDevice.mediaSettings)||void 0===n?void 0:n.isAudioEnabled,o=a.getState().speakers,r=(0,i.__assign)({},o),s=a.getState().externalId,l=s?(0,k.externalIdToString)(s):C;e&&t&&s?r[l]=!0:!e&&s&&delete r[l],r[l]!==o[l]&&m({type:d.E_ACTION.SET_SPEAKERS,data:{speakers:r}})},needCheckMicEnabled:!0,volumeLevelDetection:d.VOLUME_LEVEL_DETECTION,vectorLength:5,callbackFactorStep:0,sensitivityCoefficient:.45,debugCallback:function(){e.debug}}),onChatMessage:function(n,t,a){e.debug&&console.warn("onChatMessage",n,t,a)},onCustomData:function(n,t){e.debug&&console.warn("onCustomData",n,t)},onNetworkStatusChanged:function(n){var t,a;if(e.debug&&console.warn("onNetworkStatusChanged",n),(0,M.isGroupCallByPeer)(A.peer)&&A.config.badNetwork||!(0,M.isGroupCallByPeer)(A.peer)&&A.config.badNetworkP2P)try{for(var o=(0,i.__values)(n),r=o.next();!r.done;r=o.next()){var s=r.value;Nt(m,s.uid,{networkStatus:s.rating})}}catch(e){t={error:e}}finally{try{r&&!r.done&&(a=o.return)&&a.call(o)}finally{if(t)throw t.error}}},onLocalNetworkStatusChanged:function(n){e.debug&&console.warn("onLocalNetworkStatusChanged",n),((0,M.isGroupCallByPeer)(A.peer)&&A.config.badNetwork||!(0,M.isGroupCallByPeer)(A.peer)&&A.config.badNetworkP2P)&&m({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{networkStatus:n}})},onDebugMessage:function(n){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];e.debug&&console.warn.apply(console,(0,i.__spreadArray)(["onDebugMessage",n],(0,i.__read)(t),!1))},onRemoteParticipantState:function(t,i,o){var r,s,l,c,u,_,v,p;i=(0,k.convertParticipantStateFromSDK)(i);var f=(0,k.externalIdToString)(t),h=+t.id,g=a.getState(),A=!!(null!==(c=null===(l=null===(s=null===(r=g.devices[f])||void 0===r?void 0:r.statusData)||void 0===s?void 0:s.hand)||void 0===l?void 0:l.state)&&void 0!==c?c:null===(u=g.handState)||void 0===u?void 0:u[f]);if(A!==!!(null===(_=null==i?void 0:i.hand)||void 0===_?void 0:_.state)){e.debug&&console.warn("onRemoteParticipantState",t,i);var C=!!(null===(v=a.getState().participants[+t.id])||void 0===v?void 0:v.name);wn(g)&&!os(t,g)?function(e,n,t,a,i){var o=i.externalId,r=i.markers,s=i.participantState;zn(n,o,s);var l=et(e,r);nt(e.participantsChunk,l)?jn(e,n,a,o,{markers:r,statusData:s}):Qn(e,n,(0,k.externalIdToString)(o)),Wn(e,n,t,a,{externalId:o,markers:r})}(g,m,n,e,{externalId:t,markers:o,participantState:i}):Nt(m,t,{statusData:i}),(null===(p=null==i?void 0:i.hand)||void 0===p?void 0:p.state)&&!A&&C&&h!==g.me&&m({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.RAISED_HAND,data:h}})}},onRolesChanged:function(n,t){e.debug&&console.warn("onRolesChanged",n,t);var i=a.getState().participants[n.id];t.includes(G.UserRole.ADMIN)&&i&&i.peerId!==A.me&&m({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.USER_GRANTED_WITH_ADMIN_ROLE,data:n.id}}),m({type:d.E_ACTION.CHANGE_PARTICIPANT_ROLES,participantId:+n.id,data:t})},onLocalRolesChanged:function(t){if(e.debug&&console.warn("onLocalRolesChanged",t),t.includes(G.UserRole.ADMIN)){m({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.ADMIN_ROLE_GRANTED,ts:Date.now()}});var i=a.getState();i.config.enableParticipantListChunk?At(i,m,n):It.getParticipantsMuteStates(n)}t.includes(G.UserRole.ADMIN)||t.includes(G.UserRole.CREATOR)?A.config.allowWaitingHall&&(0,M.isWaitingHallEnabled)(a.getState())&&function(e,n){(0,G.getWaitingHall)(null,void 0).then((function(t){return gi(t.totalCount,t.participants,e,n)}))}(a.getState(),m):(It.abortGetParticipants(),a.getState().waitingHall&&function(e){e({type:d.E_ACTION.SET_WAITING_HALL,data:void 0})}(m)),m({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{roles:t}})},onDeviceSwitched:function(n,t){e.debug&&console.warn("onDeviceSwitched",n,t)},onMuteStates:function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];e.debug&&console.warn("onMuteStates",xt.mapArgs.apply(null,t));var o=new(xt.bind.apply(xt,(0,i.__spreadArray)([void 0],(0,i.__read)(t),!1)));o.updateCallMuteState(n),o.updatePersonalMuteState(),o.updatePersonalPermissionsOnce(),o.updateExternalMuteState(),o.attractAttentionIfNeeded()},onRecordStarted:function(n,t,a,i,o,r){e.debug&&console.warn("onRecordStarted",n,t,a,i);var s={isOn:!0,videoId:o?+o:void 0,ownerId:r?+r:void 0,host:n,startTime:a,link:r&&o?"https://"+ko()+D(r,o):void 0,startStreamParams:void 0,isRecord:"RECORD"===i};m({type:d.E_ACTION.SET_TRANSLATION,data:s})},onRecordStopped:function(){e.debug&&console.warn("onRecordStopped"),m({type:d.E_ACTION.SET_TRANSLATION,data:{isOn:!1,hasPermission:!1}}),m({type:d.E_ACTION.SET_SHOW_RECORD_ENDED_DESKTOP_NOTIFICATION,data:!0})},onLocalPin:function(n){var t;e.debug&&console.warn("onLocalPin",{unpin:n});var i=a.getState(),o=i.localDevice;n||m({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.PINNED_BY_ADMIN}}),n||(null===(t=o.mediaSettings)||void 0===t?void 0:t.isAudioEnabled)||m({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_ADMIN_PIN_UNMUTE_REQUEST}),n||i.isOratorMode||m({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0}),i.externalId&&m({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:n?null:i.externalId})},onPinnedParticipant:function(t,o,r){e.debug&&console.warn("onPinnedParticipant",t,o);var s=a.getState(),l=s.participants[t.id];!o&&l&&((null==l?void 0:l.shortName)||(null==l?void 0:l.name))&&m({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.USER_PINNED_BY_ADMIN,data:t.id}}),s.isOratorMode||m({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0}),os(t,s)||function(e,n,t,a,o){var r=o.externalId,s=o.pin,l=o.markers;(0,i.__awaiter)(this,void 0,void 0,(function(){var o,c,d,u,_,v,p;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return o=Fn(l),wn(e)&&o?(c=(0,k.externalIdToString)(r),d=Yn(e,c),u=$n(e,r),_=u>-1,v=et(e,l),p=nt(e.participantsChunk,v),Wn(e,n,t,a,{externalId:r,markers:l}),p&&qn(n,r,{markers:l}),s&&d?[2]:s&&!d||p&&!_?[4,tt(e,n,t,a,{externalId:r,marker:o})]:[3,2]):[2];case 1:return i.sent(),[2];case 2:return!d||p||s||Qn(e,n,c),[2]}}))}))}(s,m,n,e,{externalId:t,pin:!o,markers:r}),m({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:o?null:t})},onOptionsChanged:function(n){e.debug&&console.warn("onOptionsChanged",n),m({type:d.E_ACTION.SET_CONVERSATION_OPTIONS,data:n})},onLocalStatus:function(n){e.debug&&console.warn("onLocalStatus",n);var t=a.getState(),o=t.callData,r=t.me,s=t.localDevice.status===G.ParticipantStatus.WAITING_HALL&&n===G.ParticipantStatus.WAITING,l=n===G.ParticipantStatus.CONNECTED&&!t.peer;o.callId&&!(0,k.isParticipantAnonym)(r)&&(l||s)&&(0,qe.getConversationsByCall)([o.callId]).then((function(e){var n=e.items,t=(0,i.__read)(n,1)[0].peer.id;return $r(a,t,void 0)})).catch((function(e){var n;if(951===(null===(n=null==e?void 0:e.error)||void 0===n?void 0:n.error_code))return 0;throw e})).catch(Nr.handlePromiseError),m({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{status:n,wasConnected:!0}})},onChatRoomUpdated:function(n,t,i){e.debug&&console.warn("onChatRoomUpdated",n,t,i),n===G.ChatRoomEventType.ATTENDEE&&gi(t,i,a.getState(),m)},onJoinLinkChanged:function(n){e.debug&&console.warn("onJoinLinkChanged",n);var t=a.getState(),i=t.callData.callId||"",o=(0,M.isAuthedByGroupId)(t)?t.groupId:0;vn(a.dispatch,i,!1,o)}};e.authorized=!1,e.authorizedGroupId=0,e.debugMessage=G.debugMessage,e.call=function(e,n,t,a,i){var o=a.dispatch;return function(r,s,l,c,u,_,v){void 0===u&&(u=0),void 0===v&&(v={});var p=(0,M.getMediaOptions)({video:s,audio:!0});return e.isInActiveCall?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(Qr):(e.isInActiveCall=!0,Promise.resolve().then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return Jr(e)})).then((function(){return Xr(n,e,a,u,o)})).then((function(){return ga(n,p)})).then((function(){return $r(a,r,l)})).then((function(t){return Promise.all([nn(t),i(e,n,a,p,r)])})).then((function(){return is(n,v)})).then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),o({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,peerId:r}),Br({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:c,startType:s?d.CallType.VIDEO:d.CallType.AUDIO}),w.callStats.logEvent({call_event_type:s?d.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:d.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:a.getState().callData.callId,peer_id:r,is_group_call:!1,source:c,group_call_users_count:2}),zr.mailRuCounter.push(zr.EMailRuGoals.StartP2PCall),es(a,r,l)})).catch((function(a){e.isInActiveCall=!1,o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),ts(a,n,e,(0,M.isGroupCallByPeer)(r),t,o)})))}}(e,n,o,a,E),e.startGroupCall=function(e,n,t,a,i){var o=a.dispatch;return function(r,s,l,c,u,_,v,p){void 0===_&&(_=!0),void 0===v&&(v=null),void 0===p&&(p={});var f=(0,M.getMediaOptions)({video:c,audio:!0}),h=l?l.filter(Ri.isUserPeer):[];return e.debug&&l&&l.length!==h.length&&console.warn("Some ids cannot get into the call.",l.filter((function(e){return!(0,Ri.isUserPeer)(e)}))),e.isInActiveCall?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(Qr):(e.isInActiveCall=!0,Promise.resolve().then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return Jr(e)})).then((function(){return Xr(n,e,a,0,o)})).then((function(){return ga(n,f)})).then((function(){return $r(a,r,s)})).then((function(e){return an(a.getState(),o,r,e[0])})).then((function(){return i(e,n,a,f,r)})).then((function(){return is(n,p)})).then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),o({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,peerId:r}),_&&(h&&h.length?o({type:d.E_ACTION.GROUP_CALL_SETUP,open:!0,peerId:r,preselectedIds:h}):o({type:d.E_ACTION.MANAGEMENT,isOpen:!0})),v&&o({type:d.E_ACTION.SET_TRANSLATION,data:{deferredId:v}}),es(a,r,s),Br({timeStart:Date.now(),isOutgoingCall:!0,startType:c?d.CallType.VIDEO:d.CallType.AUDIO,entryPoint:u,isGroupCall:!0}),w.callStats.logEvent({call_event_type:c?d.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:d.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:a.getState().callData.callId,peer_id:r,is_group_call:!0,source:u,group_call_users_count:1}),zr.mailRuCounter.push(zr.EMailRuGoals.StartGroupCall)})).catch((function(a){e.isInActiveCall=!1,o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),ts(a,n,e,(0,M.isGroupCallByPeer)(r),t,o)})))}}(e,n,o,a,E),e.startCall=function(e,n,t,a,i){var o=a.dispatch;return function(r,s,l,c,u){void 0===l&&(l=!0),void 0===c&&(c=0),void 0===u&&(u={});var _=(0,M.getMediaOptions)({video:r,audio:!0});if(e.isInActiveCall)return Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(Qr);e.isInActiveCall=!0;var v=(0,M.getDefaultConversation)(t);return Promise.resolve().then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return Jr(e)})).then((function(){return Xr(n,e,a,c,o)})).then((function(){return ga(n,_)})).then((function(){return Promise.all([i(e,n,a,_),nn([v])])})).then((function(){return is(n,u)})).then((function(){o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),o({type:d.E_ACTION.LOAD_PEERS,conversation:v,members:[],peerId:0}),o({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL}),l&&o({type:d.E_ACTION.MANAGEMENT,isOpen:!0});var e=a.getState().callData.callId;(null==u?void 0:u.createLink)&&(e?hn(o,e,c):o({type:d.E_ACTION.SET_START_OPTIONS,data:u})),Br({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:s,startType:r?d.CallType.VIDEO:d.CallType.AUDIO,isGroupCall:!0}),w.callStats.logEvent({call_event_type:r?d.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:d.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:e,peer_id:0,is_group_call:!0,source:s,group_call_users_count:1}),zr.mailRuCounter.push(zr.EMailRuGoals.StartGroupCall)})).catch((function(a){e.isInActiveCall=!1,o({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),ts(a,n,e,!0,t,o)}))}}(e,n,o,a,E),e.joinCallByLink=function(e,n,t,a,o){var r=a.dispatch;return function(s,l,c,u,_,v,p){void 0===c&&(c=!1),void 0===_&&(_=0),void 0===v&&(v=void 0);var f=(0,M.getMediaOptions)({video:c,audio:!0});return e.isInActiveCall?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(Qr):(e.isInActiveCall=!0,r({type:d.E_ACTION.SET_ENTRYPOINT,entryPoint:u}),(0,k.isParticipantAnonym)(a.getState().me)?Promise.resolve().then((function(){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return Jr(e)})).then((function(){return ga(n,f)})).then((function(){return o(s,f).then((function(){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),r({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,joinLink:s,vkJoinLink:p})}))})).catch((function(a){e.isInActiveCall=!1,r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),ts(a,n,e,!0,t,r)})):Promise.resolve().then((function(){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return Jr(e)})).then((function(){return Xr(n,e,a,_,r)})).then((function(){return ga(n,f)})).then((function(){return o(s,f)})).then((function(e){var n=e.id;return(0,qe.getConversationsByCall)([n])})).then((function(e){var n=e.items;if(!(null==n?void 0:n.length))return 0;var t=(0,i.__read)(n,1)[0].peer.id;return $r(a,t,l).then((function(e){return nn(e)})),t})).catch((function(e){var n,t;if(8===(null===(n=null==e?void 0:e.error)||void 0===n?void 0:n.error_code))return 0;if((0,Qe.hasIn)(null===(t=null==e?void 0:e.error)||void 0===t?void 0:t.error_code,951,1007))return 0;throw e})).then((function(e){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),r({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,peerId:e,joinLink:s}),v&&r({type:d.E_ACTION.SET_TRANSLATION,data:{deferredId:v}}),e&&es(a,e,l),w.callStats.logEvent({call_event_type:d.CallActionEventType.GROUP_CALL_JOINED,session_id:a.getState().callData.callId,peer_id:null!=e?e:0,is_group_call:!0,source:u,group_call_users_count:(0,k.getActiveParticipantsCount)(a.getState())})})).catch((function(a){e.isInActiveCall=!1,r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),ts(a,n,e,!0,t,r)})))}}(e,n,o,a,S),e.showJoinPopup=function(e,n,t){var a=t.dispatch;return function(o,r){var s=t.getState().mode;return s===d.Mode.CALL||s===d.Mode.INCOMING?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch((function(){a({type:d.E_ACTION.ERROR,text:n("calls_already_in_call_error")})})):(a({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),(0,qe.getJoinLinkDetails)(o).then(Qe.normalizePreviewData.bind(null,n)).then((function(e){a({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),a({type:d.E_ACTION.JOIN,data:(0,i.__assign)((0,i.__assign)({},e),{entryPoint:r})})})).catch((function(t){var i;e.eventHandlers.onError&&t&&e.eventHandlers.onError(t),e.debug&&console.warn("getJoinLinkDetails",t);var o=(0,Qe.getTextForApiErrorByCode)(null===(i=null==t?void 0:t.error)||void 0===i?void 0:i.error_code,!0,n);console.error(o),a({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),a({type:d.E_ACTION.ERROR,text:o,handleType:d.ErrorHandleType.FATAL})})))}}(e,o,a),e.acceptCall=function(e,n,t,a){var i=a.dispatch;return function(o,r){var s=a.getState(),l=s.peer,c=s.callData,u=(0,M.getMediaOptions)({video:o,audio:r});return ga(n,u).then((function(){return n.acceptCall(u)})).then((function(n){var t=n.acceptTime;i({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CALL,ts:t}),e.isInActiveCall=!0,w.callStats.logEvent({call_event_type:d.CallActionEventType.INCOMING_CALL_ACCEPTED,session_id:c.callId,peer_id:l,is_group_call:(0,M.isGroupCallByPeer)(l),reason:o?d.CallType.VIDEO:d.CallType.AUDIO}),zr.mailRuCounter.push(zr.EMailRuGoals.AcceptCall)})).catch((function(n){i({type:d.E_ACTION.ERROR,text:Fr(o,!0,t),handleType:d.ErrorHandleType.DECLINE}),e.eventHandlers.onError&&n&&e.eventHandlers.onError(n),(0,G.debugMessage)(G.DebugMessageType.ERROR,n),console.error(n)}))}}(e,n,o,a),e.showCallByNamePopup=function(e,n,t,a){var i=a.dispatch;return function(e,n,o){var r=a.getState().mode;return r===d.Mode.CALL||r===d.Mode.INCOMING?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch((function(){i({type:d.E_ACTION.ERROR,text:t("calls_already_in_call_error")})})):Promise.resolve().then((function(){i({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){i({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),i({type:d.E_ACTION.CALL_BY_NAME,data:{peerId:e,joinLink:o,entryPoint:n}})})).catch((function(){i({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})}))}}(0,0,o,a),e.showCreateCallByLinkPopup=function(e,n,t,a){var i=a.dispatch;return function(e){var n=a.getState().mode;return n===d.Mode.CALL||n===d.Mode.INCOMING?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(Qr):Promise.resolve().then((function(){i({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.CREATE_CALL,entryPoint:e})}))}}(0,0,0,a),e.showPlanCalendarEventPopup=function(e){var n=e.dispatch;return function(){return e.getState().mode===d.Mode.INCOMING?Promise.reject(d.CallErrorType.ALREADY_IN_CALL).catch(Qr):Promise.resolve().then((function(){n({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_PLAN_CALENDAR_EVENT})}))}}(a),e.store=a;var b=Po(A.config.browserWarnings);if(null==b?void 0:b.block){var O=function(){return a.dispatch({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.START})};e.call=O,e.startGroupCall=O,e.startCall=O,e.acceptCall=O,e.joinCallByLink=function(e){return a.dispatch({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.START,joinLink:e})},e.showJoinPopup=O,e.showCallByNamePopup=O,e.showCreateCallByLinkPopup=O,e.showPlanCalendarEventPopup=O}var P=t.token?Promise.resolve(t.token):kr(t.is_dev),L=function(t){return Promise.resolve().then((function(){return(0,k.isParticipantAnonym)(a.getState().me)?Promise.resolve():n.authorize(t).then((function(){return Pr(t)})).then((function(){return e.authorized=!0})).catch((function(e){throw s.localStorage.removeItem(Or),e}))}))};return P.then((function(t){return n.init(N).then((function(){A.config.debugLog&&e.setDebug(!0)})).then((function(){return L(t)}))}))}function Qr(e){if(e===d.CallErrorType.ALREADY_IN_CALL)console.log("Already in call");else console.log(e)}function Yr(e,n,t){return function(e,n,t){return(0,qe.getCallAuthToken)(t.getState().isDev).then((function(t){var a=t.token;return e.authorize(a).then((function(){return Pr(a)})).then((function(){return n.authorized=!0}))}))}(e,n,t).catch((function(e){n.eventHandlers.onError&&e&&n.eventHandlers.onError(e),console.error("Could not authorize with token request",e)}))}function Jr(e){return new Promise((function(n){e.initializing.finally((function(){n()}))}))}function Xr(e,n,t,a,i,o){return void 0===o&&(o=!1),new Promise((function(r,s){a||n.authorizedGroupId||r(),a&&n.authorizedGroupId===a&&r(),o||(w.callStats.setEventCommonData(),i({type:d.E_ACTION.SET_GROUP_MEMBERS,groupMembersCount:0,groupMembers:[],unableToCallGroupMembersIds:[]})),(0,qe.getCallAuthToken)(t.getState().isDev,a).then((function(t){var l=t.token;e.authorize(l).then((function(){n.authorizedGroupId=a,o?r():a?(0,qe.getGroupById)(-a).then((function(e){if(e.groups){var n=e.groups[0];i({type:d.E_ACTION.SET_GROUP,groupId:a,meGroup:(0,$e.normalizeGroup)(n)}),w.callStats.setEventCommonData({group_id:a}),r()}})).catch((function(e){s(e)})):r()}))}))}))}function qr(e,n,t,a,i,o){void 0===i&&(i=0),void 0===o&&(o=[]);var r=e.authorizedGroupId?e.id:0,s=(0,Qe.createPayload)(i,a,r);if(!i)return n.callTo(void 0,a,s,!0);if(!(0,M.isGroupCallByPeer)(i))return as(e,t,i).then((function(e){return n.forceRelayPolicy(e),n.callTo(i.toString(),a,s)}));var l=o.filter((function(e){return e=Number(e),(0,Ri.isUserPeer)(e)&&e!==t.getState().me}));return n.callTo(l,a,s,!0)}function $r(e,n,t){var a=e.dispatch;return!!t||n?(t?Promise.resolve((0,Qe.convertClientData)(t)):(0,qe.retryLoadCallPeers)(n).then(Qe.convertServerData)).then((function(e){var t=(0,i.__read)(e,3),o=t[0],r=t[1],s=t[2];return pn(a,s||o),a({type:d.E_ACTION.LOAD_PEERS,conversation:o,members:r,peerId:n}),e})):Promise.reject("Cannot load data")}function es(e,n,t){var a=e.dispatch;return!!t&&n?(0,qe.retryLoadCallPeers)(n).then((function(e){var n=(0,i.__read)((0,Qe.convertServerData)(e),2),t=n[0],o=n[1];return pn(a,e.items[0]),nn([t,o])})).then((function(e){var n=(0,i.__read)(e,2),t=n[0],o=n[1];a({type:d.E_ACTION.LOAD_PEERS,conversation:t,members:o})})):Promise.resolve()}function ns(e,n,t){switch(!0){case function(e){var n=e||{},t=n.hangup,a=n.message;return!(!t||!a)}(e):case function(e){var n=e||{},t=n.hangup;return n.message&&void 0===t}(e):return(0,Qe.getTextForServerError)(e.message,n,t);case function(e){var n;return["TypeError","SyntaxError","RangeError","EvalError","URIError"].includes(null===(n=null==e?void 0:e.__proto__)||void 0===n?void 0:n.name)}(e):return t("calls_error");case function(e){return!!e.error_msg}(e):return(0,Qe.getTextForServerError)(e.error_msg,n,t);case function(e){return"number"==typeof e}(e):return(0,Qe.getTextForClientError)(e,n,t);case function(e){return!!e}(e):default:return t("calls_sorry_error")}}function ts(e,n,t,a,i,o){var r,s;try{var l=ns(e,a,i);n.hangup(),t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),(0,G.debugMessage)(G.DebugMessageType.ERROR,e),console.error(e),o({type:d.E_ACTION.ERROR,text:l,handleType:d.ErrorHandleType.FATAL}),(null===(r=t.eventHandlers)||void 0===r?void 0:r.onErrorStartCall)&&(null===(s=t.eventHandlers)||void 0===s||s.onErrorStartCall())}catch(t){throw(0,G.debugMessage)(G.DebugMessageType.ERROR,t),console.error(t),n.hangup(),e}}function as(e,n,t){var a=n.getState();return a.ipSettingEnabled&&"all"!==a.privacySettings.callsIp?(0,Ri.isChatPeer)(t)?Promise.resolve(!0):e.isFriend?Promise.resolve(!e.isFriend(t)):Object.keys(a.friendsCache).length>0?Promise.resolve(!a.friendsCache[t]):(0,Qe.exponentialRetry)(tn)(e,a,n.dispatch).then((function(){return as(e,n,t)})):Promise.resolve(!1)}function is(e,n){void 0===n&&(n={}),n&&(n.conversationOptions&&Object.keys(n.conversationOptions).length>0&&e.changeConversationOptions(n.conversationOptions),n.mediaOptions&&Object.keys(n.mediaOptions).length>0&&e.muteParticipant(null,n.mediaOptions))}function os(e,n){return(0,k.isSameExternalId)(e,n.externalId)}var rs=function(e){var n=e.isAnonym,t=e.joinLink,a=e.vkJoinLink,r=e.title,s=e.members,c=e.membersCount,u=e.conversationData,_=e.withPopup,v=e.onBeforeCallStart,p=e.onAfterCallFinish,f=e.onClose,h=e.bridge,g=e.entryPoint,m=e.tabIsMaster,A=e.tabIsIdle,C=e.onError,S=e.isDev,T=e.okPublicKey,x=(0,l.useContext)(E.LangContext),y=x.getLang,b=x.langNumeric,M=(0,i.__read)((0,l.useState)(""),2),w=M[0],O=M[1],P=(0,i.__read)((0,l.useState)(null),2),L=P[0],D=P[1],R=(0,i.__read)((0,l.useState)(!1),2),j=R[0],B=R[1],U=!1,H=(0,l.useContext)(N.ConfigContext).allowCallByName,V=s?s.slice(0,3).map((function(e){var n=e.firstName||e.shortName||e.name||"";return e.photo_100?{src:e.photo_100,alt:n,key:e.peerId}:{id:e.peerId,text:n.slice(0,1)}})):[],G=(0,l.useCallback)((function(e){O(e.target.value)}),[]),F=(0,l.useCallback)((function(e){if(n)return U?Promise.resolve():(U=!0,function(e,n,t,a,i,o){if(e)return Promise.resolve(e);return(0,qe.getJoinLinkDetails)(t,!0).then((function(e){var r=e.secret,s=void 0===r?"":r,l=e.user_id,c=void 0===l?0:l,u=e.preview;return(0,qe.getAnonymCallToken)(t,c,a,s).then((function(e){var t,r=e.token,s=e.secret,l=void 0===s?"":s,_={is_dev:ss(o),key:i,token:r,ok_user:c,secret:l,is_anonym:!0,me:{canAddMembers:!1,firstName:a,peerId:c,id:c,sex:"0",shortName:a,name:a,lastName:"",link:"",photo:"",photo_100:"",shortNameGen:""}},v={callPreview:{tab:null==u?void 0:u.title,photo:null===(t=null==u?void 0:u.photo)||void 0===t?void 0:t.photo_200},callsCredentials:_,callsOkStaging:ss(o),callsLogging:!1,CallsIncomingCall:!1,callsAllowBanParticipant:!1,callsFeedbackScreenEnabled:!1,callsVideoSlotsEnabled:!0,videoSlotsCount:d.VIDEO_SLOTS_COUNT,browserWarnings:[{browser:"safari"},{browser:"firefox"}],callsAllowCallByName:!1,callsEnableScreenTrack:!0,callsEnableProducerScreenTrack:!0,callsAllowWaitingHall:!1,callsAllowPushToTalk:!1,callsBadNetwork:!1,callsBadNetworkP2P:!1,callsDesktopAppNotification:!1,callsLazyLoading:!1,callsEnableDomainBender:!1,callsEnableMultipleDevices:!1,callsEnableTranslationSplit:!1,callsEnableMovieShare:!1,callsEnableNavChangeCallCollapse:!1};return n(v),v}))}))}(L,D,a,w,T,S).then((function(e){return function(e){var n=e.bridge,t=e.inited,a=e.setInited,o=e.data,r=e.onBeforeCallStart,s=e.onAfterCallFinish,l=e.tabIsMaster,c=e.tabIsIdle,d=e.langUtils;return(0,i.__awaiter)(this,void 0,void 0,(function(){var e,u,_,v,p,f,h,g,m,A,C,E,S,I,T,x,y,N,b,M,w,O,P,k,L,D;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return t?[2,Promise.resolve()]:(e=o.callPreview,u=o.callsCredentials,_=o.callsOkStaging,v=o.callsLogging,p=o.CallsIncomingCall,f=o.callsAllowBanParticipant,h=o.callsFeedbackScreenEnabled,g=o.callsVideoSlotsEnabled,m=o.videoSlotsCount,A=o.browserWarnings,C=o.callsAllowCallByName,E=o.callsEnableScreenTrack,S=o.callsEnableProducerScreenTrack,I=o.callsAllowWaitingHall,T=o.callsAllowPushToTalk,x=o.callsBadNetwork,y=o.callsBadNetworkP2P,N=o.callsDesktopAppNotification,b=o.callsLazyLoading,M=o.callsEnableDomainBender,w=o.callsEnableMultipleDevices,O=o.callsEnableTranslationSplit,P=o.callsEnableMovieShare,k=o.callsEnableNavChangeCallCollapse,L=o.callsCustomScreenSharePacketSize,D=o.callsEnableCustomScreenSharePacketSize,[4,n.init({callPreview:e,callsCredentials:u,imHash:"",callsOkStaging:_,onBeforeCallStart:r,onAfterCallFinish:s,tabIsMaster:l,tabIsIdle:c,langUtils:d,toggles:{debugLog:v,incomingCall:p,allowBanParticipant:f,showFeedbackScreen:h,enableVideoSlots:g,videoSlotsCount:m,browserWarnings:A,allowCallByName:C,enableScreenTrack:E,enableProducerScreenTrack:S,allowWaitingHall:I,allowPushToTalk:T,badNetwork:x,badNetworkP2P:y,desktopAppNotification:N,lazyLoading:b,enableDomainBender:M,enableMultipleDevices:w,enableTranslationSplit:O,enableNavChangeCallCollapse:k,enableCustomScreenSharePacketSize:D,customScreenSharePacketSize:L,enableMovieShare:P}})]);case 1:return i.sent(),a(!0),[2]}}))}))}({bridge:h,inited:j,setInited:B,data:e,onBeforeCallStart:v,onAfterCallFinish:p,tabIsMaster:m,tabIsIdle:A,langUtils:x})})).then((function(){return h.joinCallByLink(t,null,e,g,void 0,void 0,a)})).catch((function(e){h.eventHandlers.onError&&e&&h.eventHandlers.onError(e);var n="";n="string"==typeof e?e:e&&e.error&&e.error.error_code?(0,Qe.getTextForApiErrorByCode)(e.error.error_code,!0,y):ns(e,!0,y)||y("calls_unknown_error"),C&&C(n)})).finally((function(){U=!1})));if(f&&f(),!u)throw Error("no peer_id to join");return h.joinCallByLink(t,[u,s],e,g,void 0,void 0,a).catch((function(e){var n="";n="string"==typeof e?e:e&&e.error&&e.error.error_code?(0,Qe.getTextForApiErrorByCode)(e.error.error_code,!0,y):y("calls_unknown_error"),C&&C(n)})),Promise.resolve()}),[t,f,w,L,j,T]),Z=(0,l.useCallback)((function(){f&&f()}),[f]),W=(0,l.useMemo)((function(){return(0,Di.escape)((0,Di.decodeHTMLEntities)(r||""))}),[r]),z=(0,l.useCallback)((function(){h.showCallByNamePopup(null,g,t)}),[]),K=(0,l.useCallback)((function(){h.showStartCallModal(null,t)}),[]),Q=(0,o.jsx)(xr,{isAnonym:!!n,name:w,onChangeName:G,namePlaceholder:y("calls_name_placeholder"),title:W,label:(0,Qe.getParticipantsListLabel)(s||[],V,(function(e){return(0,k.isParticipantGroup)(e.peerId)?e.name:e.firstName}),y,b,c),items:V,joinWithVideoText:y("calls_join_with_video"),joinWithAudioText:y("calls_join_with_audio"),onJoinWithVideo:function(){return F(!0)},onJoinWithAudio:function(){return F(!1)},disabled:!!n&&!/^[A-Za-zА-Яа-яЁё0-9_\- ]{2,25}$/.test(w),inputDisabled:!!L,callByNameShow:H&&!n,callByNameTitle:y("calls_call_by_name_join_by"),callByNameDescription:"",onCallByNameClick:z,callViaNativeAppShow:!n,callViaNativeAppTitle:y("calls_call_via_native_app_join"),onCallViaNativeAppClick:K},void 0);return _?(0,o.jsxs)(I.default,(0,i.__assign)({onClose:Z},{children:[(0,o.jsx)(yr.ModalHeader,{title:y("calls_invite"),onClose:Z},void 0),Q]}),void 0):Q},ss=function(e){return void 0!==e?e:!(!window.vk||void 0===window.vk.isCallsDevEnv)&&window.vk.isCallsDevEnv};var ls=function(e){var n=e.children;return(0,o.jsx)("div",(0,i.__assign)({className:"ErrorPopupText"},{children:n}),void 0)},cs=function(e){var n=e.title,t=e.onClose,a=e.actionButtons,r=e.text;return(0,o.jsx)(Qa.default,(0,i.__assign)({appearance:"blue",title:n,onClose:t,actionButtons:a,className:"CallError"},{children:(0,o.jsx)(ls,{children:r},void 0)}),void 0)},ds=function(e){var n=e.title,t=e.text,a=e.onCloseFatal,r=e.handleType,s=e.callId,c=e.bridge,_=u(),v=(0,l.useContext)(E.LangContext).getLang,p=function(){switch(_({type:d.E_ACTION.ERROR,isClosed:!0}),r){case d.ErrorHandleType.FATAL:a();break;case d.ErrorHandleType.DECLINE:(0,G.declineCall)().catch((function(){}));break;case d.ErrorHandleType.PROCESS:(0,G.processPush)(s||"").then((function(){(0,G.declineCall)().catch((function(){}))})).catch((function(e){c.debug&&console.error("Delayed by error push process error",e)}))}},f=t||v("calls_error"),h=f.match(/<\s?[a-zA-Z0-9]+\s?\/?>/)?(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:f}},void 0):f;return(0,o.jsx)(cs,{title:n||v("calls_oops"),onClose:p,actionButtons:(0,o.jsx)(_i.default,(0,i.__assign)({onClick:p},{children:v("calls_close")}),void 0),text:h},void 0)},us=function(e){var n=e.onClose,t=e.actionButtons,a=e.description,r=e.title;return(0,o.jsx)(Qa.default,(0,i.__assign)({onClose:n,title:r,appearance:"blue",actionButtons:t,className:"CallExitModal"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallExitModal__text"},{children:a}),void 0)}),void 0)},_s=function(e){var n=e.SDK,t=(0,c.useSelector)((function(e){return e})),a=u(),r=(0,l.useContext)(E.LangContext).getLang,s=t.conversationOptions.find((function(e){return"RECURRING"===e})),_=function(){w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:t.callData.callId,peer_id:t.peer,is_group_call:(0,M.isGroupCallByPeer)(t.peer),reason:"none",group_call_users_count:(0,k.getActiveParticipantsCount)(t)})},v=(0,l.useCallback)((function(){a({type:d.E_ACTION.TOGGLE_POPUP})}),[]),p=r(s?"calls_exit_call_disconnect_all":"calls_force_call_finish_v2"),f=r(s?"calls_exit_call_desc":"calls_sure_leave_call_v2");return(0,o.jsx)(us,{onClose:v,actionButtons:[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:function(){a({type:d.E_ACTION.TOGGLE_POPUP}),_(),io(0,t,a,r)},appearance:"secondary"},{children:p}),"forceCallFinish"),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:function(){return a({type:d.E_ACTION.TOGGLE_POPUP}),_(),n.hangup()}},{children:r("calls_exit")}),"leave")],description:f,title:r("calls_exit_call")},void 0)};function vs(e,n){var t=new ResizeObserver((function(t){var a,o;try{for(var r=(0,i.__values)(t),s=r.next();!s.done;s=r.next()){var l=s.value;n&&(0,G.debugMessage)(G.DebugMessageType.LOG,{text:"[useResizeObserver]",entry:l}),null==e||e(l)}}catch(e){a={error:e}}finally{try{s&&!s.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}}}));return t}var ps=function(e,n){var t=function(e){var n=(0,l.useRef)({gridNew:[0,0],window:[0,0]}),t=(0,i.__read)((0,l.useState)(n.current),2),a=t[0],o=t[1],r=(0,l.useCallback)((0,s.debounce)((function(){return o((0,i.__assign)({},n.current))}),200),[]),c=(0,l.useCallback)((function(e){n.current=(0,i.__assign)((0,i.__assign)({},n.current),e),r()}),[]);return(0,l.useEffect)((function(){var e=function(){c({window:[window.innerWidth,window.innerHeight]})};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e),r.cancel()}}),[]),(0,l.useEffect)((function(){if(mn(e)===dn.Grid){var n=document.getElementById(d.ID_CALLS_PARTICIPANTS_BOX);if(n){var t=vs((function(e){var n=e.contentRect,t=n.width,a=n.height;t&&a&&c({gridNew:[Math.round(t)-48,Math.round(a)]})}));return t.observe(n),function(){t.disconnect()}}}}),[e.peer,e.uiMode,e.isOratorMode]),{ww:a.window[0],wh:a.window[1],gw:a.gridNew[0],gh:a.gridNew[1]}}(n),a=(0,l.useRef)(new Map),o=wn(n);(0,l.useEffect)((function(){if(n.mode===d.Mode.CALL){var i=o?function(e,n,t){var a=An(e,n);return a.forEach((function(e,n){var i=t.get(n);!e.stopStream||i&&!i.stopStream||a.delete(n)})),t.forEach((function(e,n){if(!a.has(n)&&!e.stopStream){var t=En({externalId:e.uid},e.mediaType);a.set(n,t)}})),a}(n,t,a.current):An(n,t),r=function(e,n){var t=[];return n.forEach((function(n,a){var i=e.get(a);(Cn(i)||Cn(n))&&(i&&function(e,n){var t=e,a=n;if(t.stopStream&&a.stopStream)return!0;if(t.stopStream||a.stopStream)return!1;var i=e,o=n;return i.fit===o.fit&&i.width===o.width&&i.height===o.height&&i.priority===o.priority&&e.streamName===n.streamName}(i,n)||t.push(n))})),t}(a.current,i);r.length>0&&(a.current=i,e.updateDisplayLayout(r))}else a.current=new Map}),[t.ww,t.wh,t.gw,t.gh,n.peer,n.participants,n.devices,n.localDevice,n.mode,n.uiMode,n.isOratorMode,n.orator,n.pinnedParticipant,n.adminPinnedParticipant,n.screenSharingPinnedParticipant,n.translation,o,n.callData.topology])},fs=function(e){var n=e.isIncoming,t=void 0!==n&&n,a=(0,c.useSelector)((function(e){return e})),r=u(),s=(0,l.useContext)(E.LangContext).getLang,_=s(t?"calls_reject_title":"calls_hangup_description"),v=s(t?"calls_reject_description":"calls_hangup_description"),p=(0,l.useCallback)((function(){r({type:d.E_ACTION.SHOW_CAUTION_BOX,isOpen:!1})}),[]),f=function(){p(),t?(0,G.declineCall)().catch((function(){})):((0,G.hangup)().catch((function(){})),w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:a.callData.callId,peer_id:a.peer,is_group_call:(0,M.isGroupCallByPeer)(a.peer),reason:"none",group_call_users_count:(0,k.getActiveParticipantsCount)(a)}))},h=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(_i.default,(0,i.__assign)({appearance:"secondary",onClick:p},{children:s("calls_cancel_reject")}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:f},{children:s("calls_reject")}),void 0)]},void 0),g=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:f},{children:s("calls_yes")}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:p},{children:s("calls_no")}),void 0)]},void 0);return(0,o.jsx)(cs,{title:_,onClose:p,actionButtons:t?h:g,text:(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:v}},void 0)},void 0)},hs=function(e){var n=e.title,t=e.description,a=e.onClose,r=e.actionButtons;return(0,o.jsx)(Qa.default,(0,i.__assign)({className:"MuteParticipantModal",appearance:"blue",title:n,actionButtons:r,onClose:a},{children:t&&(0,o.jsx)("div",(0,i.__assign)({className:"MuteParticipantModal__content"},{children:t}),void 0)}),void 0)};function gs(e){var n,t,a=e.isAudio,i=e.isSingle,o=e.isPermanent,r=e.participantExternalId,s=e.logEvent,l=e.closeDialog,c=function(e){var n=Xe(["isPermanent","isCurrentlyOn","isMediaAllowed"]),t=function(e,n){return(0,Qe.objectReduce)(n,(function(n,t,a){return t?n|e[a]:n}),0)}(n,e);if(Je(t,n.isPermanent))return G.MuteState.MUTE_PERMANENT;if(t===n.isCurrentlyOn)return G.MuteState.UNMUTE;return G.MuteState.MUTE}({isPermanent:o,isCurrentlyOn:e.isCurrentlyOn,isMediaAllowed:e.isMediaAllowed}),d=a?((n={})[G.MediaOption.AUDIO]=c,n):((t={})[G.MediaOption.VIDEO]=c,t[G.MediaOption.SCREEN_SHARING]=c,t);(0,G.muteParticipant)(i?r:null,d).catch(console.log).finally(l),s(o?no.CallStatMuteType.ONCE:no.CallStatMuteType.PERMANENT)}var ms=function(){var e,n,t,a,r,s=P((function(e){return e})),c=u(),_=(0,Ae.useLang)().getLang,v=null===(n=null===(e=s.participantsManagement)||void 0===e?void 0:e.device)||void 0===n?void 0:n.externalId,p=(0,k.isSameExternalId)(v,s.externalId),f=function(e,n,t){if(!t)return;if(!n)return e.devices[(0,k.externalIdToString)(t)];return e.localDevice}(s,p,v),h=v&&s.participants[v.id],g=null!==(a=null===(t=s.participantsManagement)||void 0===t?void 0:t.mode)&&void 0!==a?a:d.ParticipantsManagementMode.SINGLE,m=p?s.localDevice:h,A=[d.ParticipantsManagementMode.SINGLE_AUDIO,d.ParticipantsManagementMode.ALL_AUDIO].includes(g),C=[d.ParticipantsManagementMode.SINGLE,d.ParticipantsManagementMode.SINGLE_AUDIO,d.ParticipantsManagementMode.SINGLE_VIDEO].includes(g),E=(0,i.__read)((0,l.useState)(!0),2),S=E[0],I=E[1],T=(0,i.__read)((0,l.useState)(null!==(r=null==h?void 0:h.name)&&void 0!==r?r:""),2),x=T[0],y=T[1],N=function(){var e=!1,n=!1,t=!1,a=_("calls_mute_participant_dialog_action_v2"),i="",o=!1;switch(g){case d.ParticipantsManagementMode.SINGLE_AUDIO:var r=As(m);e=!(o=xt.isMediaAllowed("audio",f,!0))||r,t=!!(null==f?void 0:f.mediaSettings.isAudioEnabled),a=_(o?"calls_mute_participant_dialog_action_v2":"calls_mic_turn_on"),i=_(o?"calls_mute_participant_dialog_title_audio":"calls_unmute_participant_dialog_title_audio_v2").replace("{name}",x);break;case d.ParticipantsManagementMode.SINGLE_VIDEO:r=As(m);e=!(o=xt.isMediaAllowed("video",f,!0))||r,t=!(!(null==f?void 0:f.mediaSettings.isVideoEnabled)&&!(null==f?void 0:f.mediaSettings.isScreenSharingEnabled)),a=_(o?"calls_mute_participant_dialog_action_v2":"calls_mute_participant_dialog_action_video_ss"),i=_(o?"calls_mute_participant_dialog_title_video":"calls_unmute_participant_dialog_title_video_v2").replace("{name}",x);break;case d.ParticipantsManagementMode.ALL_AUDIO:(n=s.permissions[G.MediaOption.AUDIO]===G.MuteState.MUTE_PERMANENT)&&(a=_("calls_mute_participant_dialog_action_mics")),e=n,i=_(n?"calls_unmute_all_participants_audio_title":"calls_mute_all_participants_dialog_title_audio");break;case d.ParticipantsManagementMode.ALL_VIDEO:(n=s.permissions[G.MediaOption.VIDEO]===G.MuteState.MUTE_PERMANENT)&&(a=_("calls_mute_participant_dialog_action_video_ss")),e=n,i=_(n?"calls_unmute_all_participants_video_title":"calls_mute_all_participants_dialog_title_video")}return{isPermanentHide:e,onMuteTitle:a,title:i,isCurrentlyOn:t,isMediaAllowed:o}}(),b=N.isPermanentHide,O=N.onMuteTitle,L=N.title,D=N.isCurrentlyOn,R=N.isMediaAllowed;(0,l.useEffect)((function(){C&&!(0,k.isParticipantAnonym)((null==h?void 0:h.peerId)||0)?(c({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),new Promise((function(e,n){h&&h.peerId<0?(0,qe.getGroupById)(-h.peerId).then((function(n){var t,a=n.groups;e(a&&a.length>0&&(null===(t=a[0])||void 0===t?void 0:t.name)||"")})).catch(n):(0,qe.loadUsers)({user_ids:h&&String(h.peerId),name_case:"dat"}).then((function(n){var t=(0,i.__read)(n,1)[0];e((null==t?void 0:t.first_name)||"")})).catch(n)})).then((function(e){y(e),I(!1),c({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})})).catch(console.log)):I(!1)}),[s.participantsManagement]);var j=function(e){var n=e.callEventType,t=e.sessionId,a=e.peerId,i=e.isGroupCall;return function(e){return w.callStats.logEvent({call_event_type:n,session_id:t,peer_id:a,is_group_call:i,mute_permanent:e})}}({callEventType:C?d.CallActionEventType.USER_MICS_AND_VIDEO_DISABLED:d.CallActionEventType.ALL_MICS_AND_VIDEO_DISABLED,sessionId:s.callData.callId,peerId:s.peer,isGroupCall:(0,M.isGroupCallByPeer)(s.peer)}),B=(0,l.useCallback)((function(){c({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT})}),[]),U=(0,l.useCallback)((function(e,n){gs({isAudio:A,isSingle:C,isPermanent:e,participantExternalId:n,logEvent:j,closeDialog:B,isCurrentlyOn:D,isMediaAllowed:R})}),[A,C,j,B,D,R]),H=(0,l.useCallback)((function(){U(!0,C&&v?v:null)}),[U,v,C]),V=(0,l.useCallback)((function(){U(!1,C&&v?v:null)}),[U,v,C]);return C&&S?null:(0,o.jsx)(hs,{title:L,onClose:B,actionButtons:(0,o.jsxs)(o.Fragment,{children:[!b&&(0,o.jsx)(_i.default,(0,i.__assign)({onClick:H,appearance:"secondary"},{children:_("calls_mute_participant_permanent_dialog_action")}),"mute_permanent"),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:V},{children:O}),"mute")]},void 0)},void 0)};function As(e){return(0,k.isCreator)(e)||(0,k.isAdmin)(e)}var Cs,Es=function(e){var n=e.onClose,t=e.actionButtons,a=e.title,r=e.description;return(0,o.jsx)(Qa.default,(0,i.__assign)({className:"UnmuteRequestModal",appearance:"blue",title:a,actionButtons:t,onClose:n},{children:(0,o.jsx)("div",(0,i.__assign)({className:"UnmuteRequestModal__content"},{children:r}),void 0)}),void 0)},Ss=function(e){var n=e.SDK,t=e.popup,a=u(),r=(0,l.useContext)(E.LangContext).getLang,s=(0,c.useSelector)((function(e){return e})),_=s.localDevice,v=_.mediaSettings,p=(0,Qe.hasIn)(t,d.POPUP_UNMUTE_REQUEST,d.POPUP_UNMUTE_VIDEO_REQUEST),f=(0,Qe.hasIn)(t,d.POPUP_UNMUTE_REQUEST,d.POPUP_UNMUTE_AUDIO_REQUEST),h=function(){a({type:d.E_ACTION.TOGGLE_POPUP})},g=function(){var e=_.mediaSettings;(null==e?void 0:e.isAudioEnabled)||(v.isAudioEnabled?Promise.resolve():ga(n,[G.MediaOption.AUDIO])).then((function(){var e;(null===(e=s.notification)||void 0===e?void 0:e.type)===d.NotificationType.SPEAKING_ON_MUTE&&a({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),n.toggleLocalAudio(!0).catch(console.log)}))},m=function(){var e=_.mediaSettings;(null==e?void 0:e.isVideoEnabled)||(null==e?void 0:e.isScreenSharingEnabled)||(!v.isVideoEnabled||v.isScreenSharingEnabled?ga(n,[G.MediaOption.VIDEO]):Promise.resolve()).then((function(){n.toggleLocalVideo(!0).catch(console.log)}))},A=function(){g(),h()},C=function(){g(),m(),h()},S=function(){m(),h()},I=(0,l.useMemo)((function(){var e="",n="",t=[];return p&&f?(e=r("calls_dialog_unmute_request_audio_and_video_title"),n=r("calls_dialog_unmute_request_audio_and_video_description"),t.push((0,o.jsx)(_i.default,(0,i.__assign)({onClick:A,appearance:"secondary"},{children:r("calls_dialog_unmute_request_mic_only_action")}),"mic"),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:C},{children:r("calls_dialog_unmute_request_action")}),"all"))):f?(e=r("calls_dialog_unmute_request_audio_title"),n=r("calls_dialog_unmute_request_audio_description"),t.push((0,o.jsx)(_i.default,(0,i.__assign)({onClick:A},{children:r("calls_dialog_unmute_request_mic_action")}),"mic"))):p&&(e=r("calls_dialog_unmute_request_video_title"),n=r("calls_dialog_unmute_request_video_description"),t.push((0,o.jsx)(_i.default,(0,i.__assign)({onClick:S},{children:r("calls_dialog_unmute_request_camera_only_action")}),"video"))),{actions:t,title:e,desc:n}}),[p,f,r]);return(0,o.jsx)(Es,{onClose:h,title:I.title,description:I.desc,actionButtons:I.actions},void 0)},Is=function(e){var n=e.title,t=e.description,a=e.onClose,r=e.actionButtons;return(0,o.jsx)(Qa.default,(0,i.__assign)({className:"AssignAdminModal",appearance:"blue",title:n,actionButtons:r,onClose:a},{children:(0,o.jsx)("div",(0,i.__assign)({className:"AssignAdminModal__content"},{children:t}),void 0)}),void 0)},Ts=function(e){var n=e.SDK,t=(0,c.useSelector)((function(e){return e.adminAssignment?e.participants[e.adminAssignment.participant.peerId]:void 0})),a=(0,c.useSelector)((function(e){return e})),r=u(),s=(0,i.__read)((0,l.useState)(!0),2),_=s[0],v=s[1],p=(0,i.__read)((0,l.useState)(""),2),f=p[0],h=p[1],g=(0,l.useContext)(E.LangContext).getLang;(0,l.useEffect)((function(){r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),new Promise((function(e,n){t&&t.peerId<0?(0,qe.getGroupById)(-t.peerId).then((function(n){var t,a=n.groups;e(a&&a.length>0&&(null===(t=a[0])||void 0===t?void 0:t.name)||"")})).catch((function(e){return n(e)})):(0,qe.loadUsers)({user_ids:t&&String(t.peerId),name_case:"dat"}).then((function(n){var t=(0,i.__read)(n,1)[0];e((null==t?void 0:t.first_name)+" "+(null==t?void 0:t.last_name))})).catch((function(e){return n(e)}))})).then((function(e){h(e),v(!1),r({type:d.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})})).catch(console.log)}),[t]);var m=(0,l.useCallback)((function(){r({type:d.E_ACTION.TOGGLE_ADMIN_ASSIGNMENT})}),[]),A=(0,l.useCallback)((function(){var e=(0,k.getParticipantExternalId)(t);e?(n.grantRoles(e,[G.UserRole.ADMIN],!1).then((function(){t&&r({type:d.E_ACTION.CHANGE_PARTICIPANT_ROLES,participantId:t.peerId,data:t.roles?(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(t.roles),!1),[G.UserRole.ADMIN],!1):[G.UserRole.ADMIN]})})).catch(console.log),w.callStats.logEvent({call_event_type:d.CallActionEventType.ASSIGN_ADMIN,session_id:a.callData.callId,peer_id:a.peer,is_group_call:(0,M.isGroupCallByPeer)(a.peer)}),m()):m()}),[]);return _?null:(0,o.jsx)(Is,{onClose:m,title:g("calls_dialog_assign_admin_role_title"),description:g("calls_dialog_assign_admin_role_description").replace("{name}",f),actionButtons:[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:m,appearance:"secondary"},{children:g("calls_dialog_assign_admin_role_action_later")}),"cancel"),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:A},{children:g("calls_dialog_assign_admin_role_action_primary")}),"primary")]},void 0)},xs=t(92110),ys="wakeLock"in navigator&&!0,Ns=null,bs=!1,Ms=function(){null!==Ns&&"visible"===document.visibilityState&&Os()},ws=function(){var e,n,t,a;Cs||((Cs=document.createElement("video")).setAttribute("title","Wake lock"),Cs.setAttribute("playsinline",""),e=Cs,n="mp4",t="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA=",(a=document.createElement("source")).src=t,a.type="video/"+n,e.appendChild(a),Cs.addEventListener("loadedmetadata",(function(){Cs&&Cs.addEventListener("timeupdate",(function(){Cs&&Cs.currentTime>.5&&(Cs.currentTime=Math.random())}))}))),Cs.play().catch((function(){}))};function Os(){if(!ys)return ws();bs||(bs=!0,document.addEventListener("visibilitychange",Ms));try{navigator.wakeLock.request("screen").then((function(e){(Ns=e).addEventListener("release",(function(){}))}))}catch(e){console.error(e.name+", "+e.message)}}function Ps(){ys?Ns&&Ns.release().then((function(){Ns=null})):Cs&&Cs.pause()}var ks=t(73947);function Ls(e){var n=e.onClose,t=e.onSubmit,a=e.title,r=e.children,s=e.isWithBackButton,c=e.onBackClick,d=e.contentClassName,u=void 0===d?"TranslationCreateModal__content":d,_=e.isRecord,v=(0,l.useContext)(E.LangContext).getLang,p=n&&t&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:n,appearance:"tertiary"},{children:v("calls_cancel")}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:t},{children:v(_?"calls_record_start":"calls_translation_start")}),void 0)]},void 0);return(0,o.jsx)(Qa.default,(0,i.__assign)({className:"TranslationCreateModal",title:a,onClose:n,backText:s?v("calls_back"):void 0,onBack:c,actionButtons:p},{children:(0,o.jsx)("div",(0,i.__assign)({className:u},{children:l.Children.toArray(r).map((function(e,n){return(0,o.jsx)("div",(0,i.__assign)({className:"CallManagementModal__section"},{children:e}),n)}))}),void 0)}),void 0)}var Ds,Rs,js=t(28581),Bs=t(21086),Us=t(31897);function Hs(e){var n=e.onSubmit,t=e.onClose,a=e.isRecord,r=(0,l.useContext)(E.LangContext),s=r.getLang,d=r.langShortDateTime,u=(0,c.useSelector)((function(e){return e})),_=function(){var e=(new Date).toISOString().split("T")[0];return s("calls_translation_title_default_value").replace("%s",e)},v=function(e,n,t){return void 0===n&&(n=""),void 0===t&&(t=""),{id:e,name:n,photo:t,isGroup:e<0}},p=function(e){var n=[{value:Ds.ONLY_ME,label:s("calls_translation_privacy_only_me_and_chat")},{value:Ds.FRIENDS,label:s("calls_translation_privacy_friends_and_chat")}];return e&&n.push({value:Ds.ALL,label:s("calls_translation_privacy_all_users")}),n},f=u.participants[u.me],h=u.config,g=(0,i.__read)((0,l.useState)(_()),2),m=g[0],A=g[1],C=(0,i.__read)((0,l.useState)(""),2),S=C[0],I=C[1],T=(0,i.__read)((0,l.useState)(u.groupId?Ds.ALL:Ds.ONLY_ME),2),x=T[0],y=T[1],N=(0,i.__read)((0,l.useState)((function(){return p(!f.isClosed||!!u.groupId)})),2),b=N[0],M=N[1],w=(0,i.__read)((0,l.useState)((function(){var e,n;return u.groupId?v(u.groupId,null===(e=u.meGroup)||void 0===e?void 0:e.name,null===(n=u.meGroup)||void 0===n?void 0:n.photo):v(f.peerId,f.name,f.photo)})),2),O=w[0],P=w[1],k=(0,i.__read)((0,l.useState)(Rs.MAIN),2),L=k[0],D=k[1],R=(0,i.__read)((0,l.useState)({}),2),j=R[0],B=R[1],U=(0,i.__read)((0,l.useState)((function(){return u.groupId&&u.meGroup?[{value:u.meGroup.peerId,label:u.meGroup.name}]:[{value:f.peerId,label:f.name}]})),2),H=U[0],V=U[1],G=(0,i.__read)((0,l.useState)([]),2),F=G[0],Z=G[1],W=(0,i.__read)((0,l.useState)(!1),2),z=W[0],K=W[1],Q=(0,i.__read)((0,l.useState)([]),2),Y=Q[0],J=Q[1],X=(0,i.__read)((0,l.useState)([]),2),q=X[0],$=X[1],ee=(0,l.useCallback)((function(){var e=m.trim(),t=S.trim(),a={};if(Object.keys(j).length>0){e||(e=j.title),t||(t=j.description);var i=t!=j.title||e!=j.description;i||(i=O.id>0&&j.privacy_view.category!=x),i&&(0,qe.sendVideoEdit)(O.id,j.id,e,t,x).catch((function(e){return console.error(e)}));var o={ovId:j.ov_id};j.live_start_time&&(o.startTime=j.live_start_time),a.upcomingStreamParams=o}else a.streamParams={name:e||_(),description:t,privacy_view:x,group_id:O.id<0?-O.id:0,call:1};n(a)}),[m,S,x,O,j]);(0,l.useEffect)((function(){if(!u.groupId)try{(0,qe.getGroupsForStreaming)().then((function(e){var n=(0,i.__spreadArray)([],(0,i.__read)(H),!1);e.length>0&&(e.forEach((function(e){n.push({value:-e.id,label:e.name||""})})),V(n),Z(e))})).catch(console.error)}catch(e){console.log(e)}}),[]),(0,l.useEffect)((function(){B({}),K(!1),J([]),(0,qe.getUpcomingLives)([O.id]).then((function(e){var n=[];e.count>0&&(n=e.items.filter((function(e){return""!==e.ov_id})));var t=n.length>0;if(K(t),J(n),t){var a=[];n.forEach((function(e){e.owner_id&&e.owner_id>0&&a.push(e.owner_id.toString())})),a&&(0,qe.loadUsers)({user_ids:a.join(",")}).then((function(e){var n=[];e.forEach((function(e){n.push({id:e.id,name:e.first_name+" "+e.last_name})})),$(n)})).catch((function(e){return console.error(e)}))}})).catch((function(e){return console.error(e)}))}),[O]);var ne=function(e){var n=e.date;e.live_start_time&&(n=e.live_start_time);var t=n-Date.now()/1e3;return t>0&&t<La.WEEK?s("calls_translation_date_label_soon"):""},te=function(e){if(!(e>0))return O.name;var n=q.filter((function(n){return n.id==e}));if(n.length>0){var t=n[0];if(t)return t.name}return""};return(0,o.jsxs)(o.Fragment,{children:[L===Rs.MAIN&&(0,o.jsxs)(Ls,(0,i.__assign)({onClose:t,onSubmit:ee,title:s(a?"calls_record_box_title":"calls_translation_box_title"),isRecord:a},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationCreateForm__link"},{children:[(0,o.jsxs)(Ja.default,{children:[!!H.length&&(0,o.jsx)(Xa.default,(0,i.__assign)({border:!0,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(qa.ListIcon,{icon:(0,o.jsx)("img",{className:"TranslationCreateForm__ownerIcon",src:O.photo,alt:O.name},void 0),color:qa.ListIconColors.GRAY},void 0),aside:(0,o.jsx)(ur.default,{className:"TranslationCreateFormOptions__longselect",options:H,value:O.id,onChange:function(e){var n=e.selected.value;n<0?F.forEach((function(e){e.id==-n&&(y(Ds.ALL),M(p(!0)),P(v(-e.id,e.name,e.photo_100)))})):(M(p(!f.isClosed)),y(Ds.ONLY_ME),P(v(f.peerId,f.name,f.photo)))},disabled:H.length<=1},void 0)},{children:s(a?"calls_record_owner_title":"calls_translation_owner_title")}),void 0),z&&!a&&(0,o.jsxs)(Xa.default,(0,i.__assign)({onClick:function(){z&&D(Rs.SELECT_POSTPONE)},chevron:!0,border:!0,icon:(0,o.jsx)(qa.ListIcon,{icon:(0,o.jsx)(Bs.TimeIcon,{},void 0),color:qa.ListIconColors.GREEN},void 0)},{children:[s("calls_translation_postponed_title"),Object.keys(j).length>0&&(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__copyControl"},{children:(0,o.jsx)(Us.default,(0,i.__assign)({className:"TranslationCreateForm__copyButton",onClick:function(e){e.preventDefault(),e.stopPropagation(),B({}),A(_()),I("")}},{children:s("calls_translation_postponed_reset")}),void 0)}),void 0)]}),void 0),!h.sferum&&(0,o.jsx)(Xa.default,(0,i.__assign)({border:!1,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(qa.ListIcon,{icon:(0,o.jsx)(js.PrivacyIcon,{},void 0),color:qa.ListIconColors.GRAY},void 0),aside:(0,o.jsx)(ur.default,{className:"TranslationCreateForm__privacySelector TranslationCreateFormOptions__longselect",disabled:O.isGroup,options:b,value:x,onChange:function(e){y(e.selected.value)}},void 0)},{children:s("calls_translation_who_can_see_video_privacy")}),void 0)]},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__privacyHint"},{children:s(a?"calls_record_who_can_see_video_privacy_hint":"calls_translation_who_can_see_video_privacy_hint")}),void 0)]}),void 0),(0,o.jsxs)("form",(0,i.__assign)({className:"TranslationCreateForm__main",onSubmit:ee},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationCreateForm__section"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__block"},{children:(0,o.jsxs)("label",(0,i.__assign)({className:"TranslationCreateForm__label"},{children:[s("calls_translation_title"),(0,o.jsx)(ti.default,{className:"TranslationCreateForm__field",value:m,onChange:function(e){var n=e.target;A(n.value)},placeholder:s("calls_translation_name_placeholder")},void 0)]}),void 0)}),void 0),!a&&(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__block"},{children:(0,o.jsxs)("label",(0,i.__assign)({className:"TranslationCreateForm__label"},{children:[s("calls_translation_description"),(0,o.jsx)(ks.default,{className:"TranslationCreateForm__field",placeholder:s("calls_translation_description_placeholder"),value:S,onChange:function(e){var n=e.target;I(n.value)}},void 0)]}),void 0)}),void 0)]}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__tabSection"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__warning"},{children:s(a?"calls_record_notification_warning":"calls_translation_notification_warning")}),void 0)}),void 0)]}),void 0)]}),void 0),L===Rs.SELECT_POSTPONE&&(0,o.jsx)(Ls,(0,i.__assign)({title:s("calls_translation_select_upcoming_box_title"),isWithBackButton:!0,onBackClick:function(){return D(Rs.MAIN)},onClose:t,contentClassName:"TranslationCreateForm__modalVideo"},{children:(0,o.jsx)("div",{children:Y.length>0&&(0,o.jsx)(Ja.default,(0,i.__assign)({className:"TranslationCreateForm__VideoList"},{children:Y.map((function(e,n){return(0,o.jsxs)(Xa.default,(0,i.__assign)({className:"TranslationCreateForm__videoItem",active:e.id===j,border:!0,canBeHovered:!0,selectable:!0,onClick:function(){return(n=e).owner_id>0&&(0,qe.getVideos)(n.owner_id,[n.owner_id+"_"+n.id],!0).then((function(e){if(e.count>0){var t=e.items.filter((function(e){return e.id==n.id}));t.length>0&&(n.privacy_view=t[0].privacy_view,B(n),n.privacy_view&&y(n.privacy_view.category))}})),B(n),D(Rs.MAIN),A(n.title),void I(n.description);var n},aside:(0,o.jsx)("span",(0,i.__assign)({className:"TranslationCreateForm__videoLink"},{children:s("calls_translation_select_video_link")}),void 0)},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationCreateForm__videoImagePreview"},{children:[(0,o.jsx)("img",{className:"TranslationCreateForm__videoImage",src:e.image&&e.image[0]&&e.image[0].url?e.image[0].url:"",alt:e.title},void 0),ne(e)&&(0,o.jsx)("span",(0,i.__assign)({className:"TranslationCreateForm__videoImageLabel"},{children:ne(e)}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationCreateForm__videoDescription"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__videoTitle"},{children:e.title}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__videoOwner"},{children:te(e.owner_id)}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"TranslationCreateForm__videoDate"},{children:(t=e,a=t.date,t.live_start_time&&(a=t.live_start_time),d(1e3*a))}),void 0)]}),void 0)]}),n);var t,a}))}),void 0)},void 0)}),void 0)]},void 0)}!function(e){e.ONLY_ME="only_me",e.FRIENDS="friends",e.ALL="all"}(Ds||(Ds={})),function(e){e[e.MAIN=0]="MAIN",e[e.SELECT_POSTPONE=1]="SELECT_POSTPONE"}(Rs||(Rs={}));var Vs=function(e){var n,t=e.isRecord,a=(0,c.useSelector)((function(e){return e})),r=u(),s=(0,l.useContext)(E.LangContext).getLang,_=(0,l.useCallback)((function(){r({type:d.E_ACTION.TOGGLE_POPUP})}),[]),v=Da(a),p=(0,l.useCallback)((function(){r({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_STOP})}),[]),f=(0,l.useCallback)((function(e){var n,a;if(null==e?void 0:e.upcomingStreamParams){var i=e.upcomingStreamParams,o=i.startTime,s=i.ovId;if(o&&o>Date.now()/1e3+4)return fn(s,t).finally(_)}var l={isOn:!1,startStreamParams:e,isRecord:t,name:null===(n=e.streamParams)||void 0===n?void 0:n.name};return t&&(null===(a=l.startStreamParams)||void 0===a?void 0:a.streamParams)&&(l.startStreamParams.streamParams.is_call_record=1),r({type:d.E_ACTION.SET_TRANSLATION,data:l}),r({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_START_COUNTDOWN}),Promise.resolve()}),[t]),h=(0,l.useCallback)((function(){r({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_SHARE})}),[]);return(null===(n=a.translation)||void 0===n?void 0:n.isOn)?(0,o.jsx)(Ya,(0,i.__assign)({title:s("calls_translation_menu_title"),actionButtons:v?[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:p,appearance:"negative"},{children:s("calls_translation_menu_stop")}),"stop")]:[],onCloseModal:_},{children:(0,o.jsx)(ni,{isLinkBlockShown:!0,linkBlockTitle:s("calls_translation_menu_link"),onLinkBlockClick:h,callUrlLink:a.translation.link},void 0)}),void 0):(0,o.jsx)(Hs,{onSubmit:f,onClose:_,isRecord:t},void 0)},Gs=function(e){var n=e.onClose,t=e.actionButtons,a=e.isRecord,r=(0,Ae.useLang)().getLang,s=r(a?"calls_record_stop_confirmation":"calls_translation_stop_confirmation"),l=r(a?"calls_record_stop_sure":"calls_translation_stop_sure");return(0,o.jsx)(Qa.default,(0,i.__assign)({onClose:n,title:s,appearance:"blue",actionButtons:t,className:"TranslationStopModal"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStopModal__text"},{children:l}),void 0)}),void 0)},Fs=function(){var e=function(){var e=u(),n=(0,l.useContext)(E.LangContext).getLang,t=P((function(e){return e.translation.isRecord})),a=(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP})}),[]);return{dispatch:e,getLang:n,isRecord:t,onClose:a}}(),n=e.dispatch,t=e.getLang,a=e.isRecord,r=e.onClose;return(0,o.jsx)(Gs,{onClose:r,actionButtons:[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:r,appearance:"secondary"},{children:t("calls_cancel")}),"cancel"),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:function(){(0,qe.stopVideoStream)().then((function(){n({type:d.E_ACTION.TOGGLE_POPUP})}))}},{children:t("calls_translation_stop")}),"stop")],isRecord:a},void 0)};var Zs=function(e){var n=e.link,t=(0,l.useContext)(E.LangContext).getLang,a=(0,i.__read)((0,l.useState)(!1),2),r=a[0],s=a[1],c=(0,l.useCallback)((function(){return s(!0)}),[]),d=(0,l.useCallback)((function(){return s(!1)}),[]);return(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationLink"},{children:[(0,o.jsx)("p",(0,i.__assign)({className:"TranslationLink__info"},{children:t("calls_translation_link_info")}),void 0),(0,o.jsx)(ti.default,{readOnly:"readonly",className:"TranslationLink__input",value:n},void 0),n&&(0,o.jsx)(uo.CopyText,(0,i.__assign)({text:n,onCopyDone:c},{children:(0,o.jsx)(_i.default,{children:t("calls_translation_link_copy")},void 0)}),void 0),(0,o.jsx)(ai.default,(0,i.__assign)({className:"TranslationLink__copied",shown:r,callback:d},{children:t("calls_translation_link_copied")}),void 0)]}),void 0)},Ws=function(e){var n,t=e.onBack,a=e.link,r=e.linkExtractor,s=u(),_=(0,l.useContext)(E.LangContext).getLang,v=(0,c.useSelector)((function(e){return e.translation})),p=(0,l.useCallback)((function(){s({type:d.E_ACTION.TOGGLE_POPUP})}),[]);return(0,o.jsx)(Ya,(0,i.__assign)({title:_("calls_translation_link"),onCloseModal:p,isWithBackButton:!!t,onBackClick:t},{children:(0,o.jsx)(Zs,{link:null!==(n=null==r?void 0:r(v))&&void 0!==n?n:a},void 0)}),void 0)},zs=function(e){var n=e.onClose,t=e.actionButtons,a=e.title,r=e.description;return(0,o.jsx)(Qa.default,(0,i.__assign)({className:"AdminPinUnmuteRequestModal",appearance:"blue",title:a,actionButtons:t,onClose:n},{children:(0,o.jsx)("div",(0,i.__assign)({className:"AdminPinUnmuteRequestModal__content"},{children:r}),void 0)}),void 0)},Ks=function(e){var n=e.SDK,t=u(),a=(0,l.useContext)(E.LangContext).getLang,r=(0,c.useSelector)((function(e){return e})),s=r.localDevice.mediaSettings,_=function(){t({type:d.E_ACTION.TOGGLE_POPUP})};return(0,o.jsx)(zs,{onClose:_,title:a("calls_admin_pin_dialog_title"),description:a("calls_admin_pin_dialog_description"),actionButtons:[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:_,appearance:"secondary"},{children:a("calls_admin_pin_dialog_cancel")}),"cancel"),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:function(){(s.isAudioEnabled?Promise.resolve():ga(n,[G.MediaOption.AUDIO])).then((function(){var e;(null===(e=r.notification)||void 0===e?void 0:e.type)===d.NotificationType.SPEAKING_ON_MUTE&&t({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),n.toggleLocalAudio(!0).catch(console.log)})).then((function(){return _()}))}},{children:a("calls_admin_pin_dialog_action")}),"mic")]},void 0)},Qs=function(e){var n=e.participants,t=e.selected,a=e.onSelect,r=e.onClose,s=e.onCallForceFinish,c=e.onRightsTransfer,d=e.onSearch,u=e.isCreator,_=(0,Ae.useLang)().getLang,v=P((function(e){return e.me})),p=(0,l.useMemo)((function(){return n.filter((function(e){return e.peerId!==v}))}),[n,v]);return(0,o.jsx)(Ya,(0,i.__assign)({title:_("calls_dialog_creator_exit_title"),onCloseModal:r,actionButtons:(0,o.jsxs)(o.Fragment,{children:[u&&(0,o.jsx)(_i.default,(0,i.__assign)({appearance:"secondary",onClick:s},{children:_("calls_force_call_finish")}),"force"),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:c},{children:_(null===t?"calls_leave_call":"calls_dialog_creator_exit_action")}),"action")]},void 0)},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"TransferAdminRightsModal__content"},{children:[(0,o.jsx)(ti.default,{onChange:function(e){return d(e.target.value)},placeholder:_("calls_search_participants_placeholder"),className:"TransferAdminRightsModal__searchInput"},void 0),(0,o.jsxs)(Ja.default,(0,i.__assign)({border:!1},{children:[(0,o.jsx)(li.ListHeader,(0,i.__assign)({extra:p.length},{children:_("calls_call_participants")}),void 0),!p.length&&(0,o.jsx)(ha.default,{children:_("calls_participants_not_found")},void 0),p.map((function(e){return(0,o.jsx)(Xa.default,(0,i.__assign)({className:"TransferAdminRightsModal__item",onClick:function(){return a(t!==e.peerId?e:null)},aside:(0,o.jsx)("span",(0,i.__assign)({className:"TransferAdminRightsModal__label","aria-selected":t===e.peerId},{children:t===e.peerId?_("calls_dialog_creator_exit_selected"):_("calls_dialog_creator_exit_select")}),void 0)},{children:(0,o.jsx)(ui.default,{size:"34",title:e.name,photo:e.photo},void 0)}),e.peerId)}))]}),void 0)]}),void 0)}),void 0)},Ys=function(e){var n=e.SDK,t=u(),a=(0,c.useSelector)((function(e){return e})),r=(0,l.useContext)(E.LangContext).getLang,s=(0,i.__read)((0,l.useState)((function(){var e=(0,Qe.objectFilter)(a.participants,(function(e){return e.peerId===a.me||!(0,k.isParticipantAnonym)(e.peerId)&&(0,k.someDeviceByParticipant)(e,(function(e){return e.status===G.ParticipantStatus.CONNECTED}))}));return e})),2),_=s[0],v=s[1],p=(0,i.__read)((0,l.useState)(null),2),f=p[0],h=p[1],g=(0,l.useCallback)((function(e){return e.name}),[]),m=(0,l.useCallback)((function(e){return e.peerId}),[]),A=y(_,g,m),C=(0,l.useMemo)((function(){return(0,k.getActiveParticipantsCount)(a)}),[a.participants]),S=function(){return w.callStats.logEvent({call_event_type:d.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:a.callData.callId,peer_id:a.peer,is_group_call:(0,M.isGroupCallByPeer)(a.peer),reason:"none",group_call_users_count:C})},I=(0,l.useMemo)((function(){return(0,k.isCreator)(a.localDevice)}),[a.localDevice]),T=(0,l.useCallback)((function(e){v(e?A.search(e):A.list),h(null)}),[a]),x=function(){t({type:d.E_ACTION.TOGGLE_POPUP})},N=function(){t({type:d.E_ACTION.TOGGLE_POPUP}),S(),n.hangup().catch(console.log)},b=(0,l.useCallback)((function(e){h(null===e?null:e.peerId)}),[]);return(0,l.useEffect)((function(){f&&!_.find((function(e){return e.peerId===f}))&&h(null)}),[f]),(0,o.jsx)(Qs,{participants:_,onClose:x,onSelect:b,selected:f,onCallForceFinish:function(){t({type:d.E_ACTION.TOGGLE_POPUP}),S(),n.hangup(),io(0,a,t,r)},onRightsTransfer:function(){if(null!==f){var e=(0,k.getParticipantExternalId)(a.participants[f]);e&&(n.grantRoles(e,[G.UserRole.ADMIN],!1).then((function(){return N()})).catch(console.log),x())}else N()},onSearch:T,isCreator:I},void 0)},Js=function(e){var n=e.onCloseModal,t=e.counter,a=e.onStopTranslation,r=e.isRecord,s=(0,l.useContext)(E.LangContext).getLang,c=s(r?"calls_record_cancel_button":"calls_translation_cancel_button");return(0,o.jsx)(I.default,(0,i.__assign)({disableBackdropClick:!0,disableEscapeClose:!0,className:"TranslationStartCountdownModal",onClose:n},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"TranslationStartCountdownModal__content"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"TranslationStartCountdownModal__counter"},{children:t}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({className:"TranslationStartCountdownModal__stop",onClick:a,appearance:"overlay_secondary"},{children:c}),void 0)]}),void 0)}),void 0)};function Xs(){var e=u(),n=P((function(e){return e})),t=(0,i.__read)((0,l.useState)(3),2),a=t[0],r=t[1],s=P((function(e){return e.translation.isRecord})),c=(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP})}),[]),_=(0,l.useCallback)((function(){var e,t=null===(e=n.translation)||void 0===e?void 0:e.startTime;t&&t>=Date.now()&&(0,qe.stopVideoStream)(),c()}),[]);return(0,l.useEffect)((function(){var e=setInterval((function(){return r(a-1)}),La.SECOND_JS);return function(){return clearInterval(e)}}),[a]),(0,l.useEffect)((function(){var e,t;if(a<=0){var i=null===(e=n.translation)||void 0===e?void 0:e.startStreamParams;(null==i?void 0:i.streamParams)?(t=i.streamParams,(0,qe.videoStartStreaming)(t).then((function(e){return(0,G.startStream)(!!t.is_call_record,null,String(e.stream.ov_id))})).catch((function(e){(0,G.debugMessage)(G.DebugMessageType.ERROR,e),console.error(e)}))):(null==i?void 0:i.upcomingStreamParams)&&fn(i.upcomingStreamParams.ovId),c()}}),[a]),(0,o.jsx)(Js,{onCloseModal:c,counter:a,onStopTranslation:_,isRecord:s},void 0)}var qs,$s=function(e){var n=e.onClose,t=e.actionButtons,a=e.onAllowReconnectChange,r=e.description,s=e.allowBan,c=e.banText,d=(0,l.useContext)(E.LangContext).getLang,u=(0,l.useContext)(N.ConfigContext).allowBanParticipant,_=(0,i.__read)((0,l.useState)(!0),2),v=_[0],p=_[1],f=(0,l.useCallback)((function(e,n){a&&a(n),p(n)}),[]);return(0,o.jsx)(Qa.default,(0,i.__assign)({className:"KickParticipantModal",appearance:"blue",title:d("calls_kick_participant_title"),actionButtons:t,onClose:n},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"KickParticipantModal__content"},{children:[r,u&&s&&(0,o.jsx)("div",{children:(0,o.jsx)(vr.default,(0,i.__assign)({className:"KickParticipantModal__checkbox",onChange:f,checked:v},{children:c}),void 0)},void 0)]}),void 0)}),void 0)},el=function(){var e,n=u(),t=(0,l.useContext)(E.LangContext),a=t.getLang,r=t.langSex,s=P((function(e){return e.waitingHall})),c=P((function(e){var n;return null===(n=e.participantKick)||void 0===n?void 0:n.participant})),_=P((function(e){var n;return(null===(n=e.participantKick)||void 0===n?void 0:n.type)===d.KickParticipantType.CALL})),v=P((function(e){return e.callData.conversation})),p=(0,i.__read)((0,l.useState)(!0),2),f=p[0],h=p[1],g=!!c&&(!(0,k.participantIsAdmin)(c)&&!(0,k.participantIsChatAdmin)(c,v)),m=(0,l.useCallback)((function(){n({type:d.E_ACTION.TOGGLE_PARTICIPANTS_KICK})}),[]),A=(0,l.useCallback)((function(){(0,k.kickParticipant)(c,!f).then((function(){!_&&s&&(null==c?void 0:c.peerId)&&hi(null==c?void 0:c.peerId,s,n)})),m()}),[c,f,s]),C=(0,l.useCallback)((function(e){h(e)}),[]),S=_?"calls_kick_participant_text":"calls_kick_participant_from_waiting_hall_text",I=a(_?"calls_kick_participant_text":"calls_kick_participant_from_waiting_hall_text",!0),T=r(null==c?void 0:c.sex,S,I).replace("{user}",null!==(e=null==c?void 0:c.name)&&void 0!==e?e:""),x=a(_?"calls_kick_participant_kick_button_text":"calls_kick_participant_from_waiting_hall_button_text"),y=a(_?"calls_kick_participant_with_ban_setting":"calls_kick_participant_from_waiting_hall_with_ban_setting");return(0,o.jsx)($s,{onClose:m,onAllowReconnectChange:C,description:T,allowBan:g,banText:y,actionButtons:[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:m,appearance:"secondary"},{children:a("calls_cancel")}),"cancel"),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:A},{children:x}),"stop")]},void 0)},nl=function(e){var n=e.title,t=e.children,a=e.sendButtonClick,r=e.skipButtonClick,s=e.sendButtonDisabled,c=void 0===s||s,d=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("div",(0,i.__assign)({className:"FeedbackScreen"},{children:[(0,o.jsx)("div",{className:"FeedbackScreen__close",onClick:r},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"FeedbackScreen__title"},{children:n}),void 0),t,(0,o.jsxs)("div",(0,i.__assign)({className:"FeedbackScreen__actions"},{children:[(0,o.jsx)(_i.default,(0,i.__assign)({appearance:"overlay_secondary",onClick:r},{children:d("calls_feedback_skip")}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({appearance:"overlay_primary",onClick:a,disabled:c},{children:d("calls_feedback_send")}),void 0)]}),void 0)]}),void 0)},tl=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"28",width:"28",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M14 19.2l5.7 3.5a.2.2 0 00.3-.3L18.4 16l5.1-4.3a.2.2 0 00-.1-.4l-6.7-.5-2.5-6.1a.2.2 0 00-.4 0l-2.5 6.1-6.7.5a.2.2 0 00-.1.4l5 4.3L8 22.4a.2.2 0 00.3.3zm0 2.3l-4.6 2.9A2.2 2.2 0 016 22l1.2-5.3L3.2 13a2.2 2.2 0 011.2-3.8l5.5-.5 2-5a2.2 2.2 0 014.1 0l2.1 5 5.5.5a2.2 2.2 0 011.2 3.8l-4.1 3.6 1.2 5.3a2.2 2.2 0 01-3.3 2.4z"},void 0)}),void 0)},al=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsx)("svg",(0,i.__assign)({height:"28",width:"28",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},n,{children:(0,o.jsx)("path",{d:"M14 21.5l-4.6 2.9A2.2 2.2 0 016 22l1.2-5.3L3.2 13a2.2 2.2 0 011.2-3.8l5.5-.5 2-5a2.2 2.2 0 014.1 0l2.1 5 5.5.5a2.2 2.2 0 011.2 3.8l-4.1 3.6 1.2 5.3a2.2 2.2 0 01-3.3 2.4L14 21.5z"},void 0)}),void 0)};!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.ADVANCE=1]="ADVANCE"}(qs||(qs={}));var il=function(e){var n=e.onSuccessFeedback,t=u(),a=(0,c.useSelector)((function(e){return e})),r=(0,l.useContext)(E.LangContext).getLang,_=(0,i.__read)((0,l.useState)(qs.DEFAULT),2),v=_[0],p=_[1],f=(0,i.__read)((0,l.useState)(!0),2),h=f[0],g=f[1],m=(0,i.__read)((0,l.useState)(!1),2),A=m[0],C=m[1],S=new Map([["DID_NOT_HEAR_INTERLOCUTOR",r("calls_feedback_reason_did_not_hear_interlocutor")],["DID_NOT_SEE_INTERLOCUTOR",r("calls_feedback_reason_did_not_see_interlocutor")],["BAD_VIDEO_QUALITY",r("calls_feedback_reason_bad_video_quality")],["VIDEO_FREEZES",r("calls_feedback_reason_video_freezes")],["VERY_QUIET_SOUND",r("calls_feedback_reason_very_quiet_sound")],["BAD_SOUND_QUALITY",r("calls_feedback_reason_bad_sound_quality")],["SOUND_DID_NOT_MATCH_THE_VIDEO",r("calls_feedback_reason_sound_did_not_match_the_video")],["FAILED_TO_TURN_ON_CAMERA_OR_MICROPHONE",r("calls_feedback_reason_failed_to_turn_on_camera_or_microphone")]]),I=(0,i.__read)((0,l.useState)({user_response:0,feedback:[],custom_feedback:void 0}),2),T=I[0],x=I[1],y=(0,i.__read)((0,l.useState)(Array.from(S,(function(e){return{name:(0,i.__read)(e,1)[0],checked:!1}}))),1),N=y[0],O=function(){t({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})},P=function(e){var n=e.target.getAttribute("data-response");if(n){var t=parseInt(n,10);t<=3&&p(qs.ADVANCE),x((0,i.__assign)((0,i.__assign)({},T),{user_response:t})),g(!1)}},k=function(e,n){N.forEach((function(t){t.name===e&&(t.checked=n)})),x((function(e){return(0,i.__assign)((0,i.__assign)({},e),{feedback:N.filter((function(e){return e.checked})).map((function(e){return e.name}))})}))},L=function(e,n){C(n)},D=function(e){x((0,i.__assign)((0,i.__assign)({},T),{custom_feedback:e.currentTarget.value}))};return(0,o.jsx)(b,(0,i.__assign)({onClose:O,onBackdropClick:O},{children:(0,o.jsx)("section",(0,i.__assign)({className:"Call"},{children:(0,o.jsx)(nl,(0,i.__assign)({title:v===qs.DEFAULT?r("calls_feedback_default_title"):r("calls_feedback_advance_title"),sendButtonClick:function(){var e=(a.lastCallData?a.lastCallData.peerId:0)||0;w.callStats.logEvent({call_event_type:d.CallActionEventType.USER_FEEDBACK_RECEIVED,session_id:a.lastCallData?a.lastCallData.callId:"",peer_id:e,is_group_call:(0,M.isGroupCallByPeer)(e),user_response:T.user_response,feedback:T.feedback,custom_feedback:A&&T.custom_feedback?T.custom_feedback:void 0}),t({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY}),n&&n()},skipButtonClick:O,sendButtonDisabled:h},{children:v===qs.DEFAULT?(0,o.jsx)("div",(0,i.__assign)({className:"FeedbackScreen__stars",onClick:P},{children:[1,2,3,4,5].map((function(e,n){return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("FeedbackScreen__star",{"FeedbackScreen__star--active":e<=T.user_response}),"data-response":e},{children:[(0,o.jsx)(tl,{className:"FeedbackScreen__starIcon FeedbackScreen__starIcon--outline"},void 0),(0,o.jsx)(al,{className:"FeedbackScreen__starIcon FeedbackScreen__starIcon--filled"},void 0)]}),n)}))}),void 0):(0,o.jsxs)("div",(0,i.__assign)({className:"FeedbackScreen__voting"},{children:[Array.from(S,(function(e){var n=(0,i.__read)(e,2),t=n[0],a=n[1];return(0,o.jsx)("div",(0,i.__assign)({className:"FeedbackScreen__votingItem"},{children:(0,o.jsx)(vr.default,(0,i.__assign)({name:t,className:"FeedbackScreen__votingItemCheckbox",onChange:k},{children:a}),void 0)}),t)})),(0,o.jsxs)("div",(0,i.__assign)({className:"FeedbackScreen__votingItem FeedbackScreen__votingItem--custom"},{children:[(0,o.jsx)(vr.default,{name:"CUSTOM_FEEDBACK",className:"FeedbackScreen__votingItemCheckbox",onChange:L},void 0),(0,o.jsx)(ks.default,{className:"FeedbackScreen__votingItemTextArea",placeholder:r("calls_feedback_custom_reason_placeholder"),grow:!1,disabled:!A,onChange:D},void 0)]}),void 0)]}),void 0)}),void 0)}),void 0)}),void 0)},ol=function(e){var n=e.onClose,t=e.actionButtons,a=e.description,r=e.subDescription,s=e.avatarsItems,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(Qa.default,(0,i.__assign)({className:"UnbanMembersModal",appearance:"blue",title:c("calls_unban_participant_title"),actionButtons:t,onClose:n},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"UnbanMembersModal__content"},{children:[(0,o.jsx)(Er.AvatarsStack,{items:s},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"UnbanMembersModal__description"},{children:a}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"UnbanMembersModal__subDescription"},{children:r}),void 0)]}),void 0)}),void 0)},rl=function(e){var n,t=e.SDK,a=u(),r=(0,l.useContext)(E.LangContext),s=r.getLang,_=r.langNumeric,v=r.langSex,p=(0,c.useSelector)((function(e){return e})),f=(0,k.participantIsAdmin)(p.localDevice),h=null===(n=p.membersUnban)||void 0===n?void 0:n.members,g=(0,l.useCallback)((function(){a({type:d.E_ACTION.UNBAN_PARTICIPANTS,data:null})}),[]),m=(0,l.useCallback)((function(){null==h||h.forEach((function(e){t.addParticipant(String(e.id),{unban:!0})})),g()}),[p.membersUnban]);if(!h||0===h.length)return(0,o.jsx)(o.Fragment,{},void 0);var A=null==h?void 0:h.length,C=_(A,"calls_unban_participant_text",s("calls_unban_participant_text",!0)),S="",I=[];if(1===A){var T=h[0];S=v(T.sex,"calls_unban_participant_description_text_one_person",s("calls_unban_participant_description_text_one_person",!0)).replace("{user}",T.name),I.push((0,$e.getMemberForUserStack)(T))}else{var x=[h[0].name,h[1].name];I=h.slice(0,2).map((function(e){return(0,$e.getMemberForUserStack)(e)}));if(A<=3)3===A&&(x.push(h[2].name),I.push((0,$e.getMemberForUserStack)(h[2]))),S=s("calls_unban_participant_description_text_two_persons").replace("{users}",x.join(", "));else{var y=A-2;S=_(y,"calls_unban_participant_description_text_more_persons",s("calls_unban_participant_description_text_more_persons",!0)).replace("{users}",x.join(", ")).replace("{users_count}",y),I.push({id:y,text:"+"+y})}}var N=f?[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:g,appearance:"secondary"},{children:s("calls_unban_participant_cancel_button_text")}),"cancel"),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:m},{children:s("calls_unban_participant_ok_button_text")}),"stop")]:[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:g},{children:s("calls_unban_participant_disallowed_button_text")}),"cancel")];return(0,o.jsx)(ol,{onClose:g,description:C,subDescription:S,actionButtons:N,avatarsItems:I},void 0)};const sl=(0,F.makeIcon)("Icon28DownloadOutline","download_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="download_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="M21 22a1 1 0 1 1 0 2H7a1 1 0 0 1 0-2h14ZM14 2a1 1 0 0 1 1 1v13.585l5.293-5.292a1 1 0 0 1 1.414 1.414l-7 7a1 1 0 0 1-1.414 0l-7-7a1 1 0 0 1 1.414-1.414L13 16.585V3a1 1 0 0 1 1-1Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',28,28,!1,void 0),ll=(0,F.makeIcon)("Icon28VideocamOutline","videocam_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 28 28" id="videocam_outline_28"><path fill-rule="evenodd" d="M9.357 5h4.286c1.084 0 1.958 0 2.666.058.729.06 1.369.185 1.961.487a5 5 0 0 1 2.185 2.185c.231.454.36.936.433 1.464l.437-.284.903-.585c.239-.155.52-.338.773-.471.255-.134.794-.395 1.482-.348a2.7 2.7 0 0 1 1.975 1.07c.415.552.49 1.148.516 1.434.026.285.026.62.026.904v6.172c0 .284 0 .619-.026.904-.026.286-.1.882-.516 1.434a2.7 2.7 0 0 1-1.975 1.07c-.688.047-1.227-.214-1.482-.348a10.407 10.407 0 0 1-.773-.47l-.905-.588-.435-.282c-.074.528-.202 1.01-.433 1.464a5 5 0 0 1-2.185 2.185c-.592.302-1.232.428-1.961.487C15.6 23 14.727 23 13.643 23H9.357c-1.084 0-1.958 0-2.666-.058-.728-.06-1.369-.185-1.96-.487a5 5 0 0 1-2.186-2.185c-.302-.592-.428-1.232-.487-1.961C2 17.6 2 16.727 2 15.643v-3.286c0-1.084 0-1.958.058-2.666.06-.728.185-1.369.487-1.961A5 5 0 0 1 4.73 5.545c.592-.302 1.233-.428 1.961-.487C7.4 5 8.273 5 9.357 5ZM21 15.643v-4.138l2.27-1.472c.563-.365.844-.548 1.077-.532a.7.7 0 0 1 .513.277c.14.187.14.522.14 1.192v6.06c0 .67 0 1.005-.14 1.192a.7.7 0 0 1-.513.277c-.233.016-.514-.167-1.077-.532L21 16.495v-.852ZM6.854 7.05c-.605.05-.953.142-1.216.276a3 3 0 0 0-1.311 1.311c-.134.263-.226.611-.276 1.216-.05.617-.051 1.41-.051 2.546v3.2c0 1.137 0 1.929.051 2.546.05.605.142.953.276 1.216a3 3 0 0 0 1.311 1.311c.263.134.611.226 1.216.276.617.05 1.41.051 2.546.051h4.2c1.137 0 1.929 0 2.546-.051.605-.05.953-.142 1.216-.276a3 3 0 0 0 1.311-1.311c.134-.263.226-.611.276-1.216.05-.617.051-1.41.051-2.546v-3.2c0-1.137 0-1.929-.051-2.546-.05-.605-.142-.953-.276-1.216a3 3 0 0 0-1.311-1.311c-.263-.134-.611-.226-1.216-.276-.617-.049-1.41-.05-2.546-.05H9.4c-1.137 0-1.929 0-2.546.051Z" clip-rule="evenodd" /></symbol>',28,28,!1,void 0);function cl(){var e,n,t,a=(0,c.useSelector)((function(e){return e})),r=u(),_=(0,l.useContext)(E.LangContext).getLang,v=!(null===(e=a.join)||void 0===e?void 0:e.joinLink),p=(0,i.__read)((0,l.useState)(null!==s.localStorage.getItem(d.LOCALSTORAGE_IS_CALLS_APP_DOWNLOADED)),2),f=p[0],h=p[1],g=(0,i.__read)((0,l.useState)(!f),2),m=g[0],A=g[1],C=(0,l.useRef)(Ao()),S=null!==C.current,I=(0,i.__read)((0,l.useState)(!f),2),T=I[0],x=I[1],y=function(){var e,n,t,i;return(null===(e=a.join)||void 0===e?void 0:e.joinLink)?bo(Mo({joinLink:null===(n=a.join)||void 0===n?void 0:n.joinLink,userId:null===(t=window.vk)||void 0===t?void 0:t.id})):bo(function(e){var n=e.peerId,t=e.userId,a=""+d.DESKTOP_CALLS_SCHEME+d.DESKTOP_CALLS_HOST+"/join?peerId="+n+"&userId="+t;return console.log("deeplink: ",a),a}({peerId:a.peer,userId:null===(i=window.vk)||void 0===i?void 0:i.id}))};(0,l.useEffect)((function(){y().then((function(){A(!1)})).catch((function(){A(!1)}))}),[f]);var N=function(){r({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})},M=null!==(t=null===(n=Po(a.config.browserWarnings))||void 0===n?void 0:n.block)&&void 0!==t&&t;return(0,o.jsx)(b,(0,i.__assign)({onClose:N,onBackdropClick:N},{children:(0,o.jsxs)(Ze.ModalCard,(0,i.__assign)({nav:"StartCallModal",header:(0,o.jsx)(ae.default,{children:_(m&&S?"calls_download_started":f?"calls_app_title":v?"calls_start_call_after_install_app":"calls_join_call_after_install_app")},void 0),subheader:T?_("calls_download_and_install_app_for_pc"):f?_(v?"calls_try_manual_start_lesson":"calls_try_manual_join_lesson"):m?_("calls_wait_until_app_downloaded"):"",className:"StartCallModal"},{children:[m&&S&&C.current?(0,o.jsxs)(l.Fragment,{children:[(0,o.jsx)(Ze.Spinner,{size:"large",className:"StartCallModal__action"},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"StartCallModal__text"},{children:_("calls_downloading_file").replace("{file}",C.current.filename)}),void 0)]},void 0):T?C.current&&S?(0,o.jsx)(Ze.Button,(0,i.__assign)({size:"l",before:(0,o.jsx)(sl,{},void 0),onClick:function(){return e=C.current.url,n=C.current.filename,Co(),mo(e,n),A(!0),void setTimeout((function(){h(!0),A(!1),x(!1)}),3e3);var e,n},className:"StartCallModal__action"},{children:_("calls_download_app")}),void 0):(0,o.jsx)(Ze.Button,(0,i.__assign)({size:"l",before:(0,o.jsx)(sl,{},void 0),href:d.DESKTOP_CALLS_DOWNLOAD_PAGE,target:"_blank",onClick:function(){Co(),x(!1)},className:"StartCallModal__action"},{children:_("calls_download_app")}),void 0):(0,o.jsx)(Ze.Button,(0,i.__assign)({mode:"secondary",size:"l",before:(0,o.jsx)(ll,{},void 0),onClick:y,className:"StartCallModal__action"},{children:_(v?"calls_start_in_app":"calls_join_call_in_app")}),void 0),!T&&(0,o.jsxs)(Ze.Subhead,(0,i.__assign)({weight:"regular",className:"StartCallModal__text"},{children:[(0,o.jsx)("div",{children:_("calls_apps_for_all_platform")},void 0),(0,o.jsx)(Ze.Link,(0,i.__assign)({href:d.DESKTOP_CALLS_DOWNLOAD_PAGE,target:"_blank"},{children:_("calls_open_app_list")}),void 0)]}),void 0),!M&&(0,o.jsxs)(Ze.Subhead,(0,i.__assign)({weight:"regular",className:"StartCallModal__text"},{children:[_("calls_calls_troubles_with_app"),(0,o.jsx)("br",{},void 0),(0,o.jsx)(Ze.Link,(0,i.__assign)({onClick:function(){var e,n,t,i,o=a.peer;if(window.Calls)if(null===(e=a.join)||void 0===e?void 0:e.joinLink){var r=null!==(n=a.entryPoint)&&void 0!==n?n:d.CallStatSource.CONVO_JOIN_SNIPPET;window.Calls.joinCallByLink(null===(t=a.join)||void 0===t?void 0:t.joinLink,void 0,!1,r)}else{var s=null!==(i=a.entryPoint)&&void 0!==i?i:d.CallStatSource.CONVO_LIST;if(o)o>2e9?window.Calls.startGroupCall(o,void 0,null,!1,s):window.Calls.call(o,!1,void 0,s);else window.Calls.startCall(!1,s)}}},{children:_(v?"calls_calls_start_lesson_in_browser":"calls_join_call_in_browser")}),void 0)]}),void 0),M&&(0,o.jsx)(Ze.Subhead,(0,i.__assign)({weight:"regular",className:"StartCallModal__text"},{children:_("calls_warning_native_app_description")}),void 0)]}),void 0)}),void 0)}var dl=t(98037),ul=function(e){var n=e.items,t=e.actionButtons,a=e.onListItemClick,r=e.selectedId,s=e.onClose,c=e.onSearchChange,d=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)(I.default,(0,i.__assign)({className:"CallByNameModal",onClose:s},{children:[(0,o.jsx)(yr.ModalHeader,{title:d("calls_call_by_name_title"),onClose:s},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallByNameModal__content"},{children:[(0,o.jsx)(si.BlockSearchInput,{className:"CallByNameModalList__input",placeholder:d("calls_call_by_name_search_placeholder"),onChange:c,onInput:c,onPaste:c},void 0),(0,o.jsx)(li.ListHeader,(0,i.__assign)({extra:n.length||""},{children:d("calls_call_by_name_list_header")}),void 0),0!==n.length&&(0,o.jsx)(Ja.default,(0,i.__assign)({border:!1,className:"CallByNameModalList__list"},{children:n.map((function(e){return function(e,n){var t=null;return t=n===e.id?(0,o.jsx)("span",(0,i.__assign)({className:"CallByNameModalList__selected"},{children:d("calls_call_by_name_selected")}),void 0):(0,o.jsx)("span",(0,i.__assign)({className:"CallByNameModalList__select"},{children:d("calls_call_by_name_select")}),void 0),(0,o.jsx)(Xa.default,(0,i.__assign)({onClick:function(){return a(e.id)},className:"CallByNameModalList__listItem",aside:t},{children:(0,o.jsx)(ui.default,{photo:(0,o.jsx)(g.CallPhoto,{id:e.id,photo:e.photo,alt:e.name||"",className:"CallByNameModalList__photo"},void 0),title:e.name,href:e.link,target:"_blank"},void 0)}),e.id)}(e,r)}))}),void 0),0===n.length&&(0,o.jsx)(ha.default,{children:d("calls_call_by_name_not_found")},void 0)]}),void 0),(0,o.jsx)(dl.ModalFooter,{actionButtons:t},void 0)]}),void 0)},_l=function(e){var n=e.bridge,t=(0,c.useSelector)((function(e){return e})),a=u(),r=(0,i.__read)((0,l.useState)([]),2),s=r[0],_=r[1],v=(0,i.__read)((0,l.useState)(t.me),2),p=v[0],f=v[1],h=(0,l.useContext)(E.LangContext).getLang,g=(0,i.__read)((0,l.useState)(""),2),m=g[0],A=g[1],C=(0,l.useCallback)((function(e){return e.name}),[]),S=(0,l.useCallback)((function(e){return e.id}),[]),I=y([],C,S),T=t.participants[t.me],x=m?I.search(m):s,N=(0,l.useCallback)((function(e){A(e.target.value)}),[]),b=function(e,n){void 0===n&&(n=!1);var t="id"in e?e.id:e.peerId,a="screen_name"in e?"/"+e.screen_name:e.link,i="photo_100"in e?e.photo_100:e.photo;return{id:n?t:-t,name:(0,Di.escape)(e.name),link:a,photo:i}};(0,l.useEffect)((function(){var e=[b(T,!0)];(0,qe.getGroupsForCall)().then((function(n){n.count>0&&n.items.forEach((function(n){e.push(b(n))}))})).finally((function(){_(e),e.forEach((function(e){return I.add(e)}))}))}),[]);var M=(0,l.useCallback)((function(e){if(t.callByName){var a=t.callByName,i=a.peerId,o=a.entryPoint,r=a.joinLink;r?n.joinCallByLink(r,void 0,e,o,p>0?0:p):i?n.call(i,e,void 0,o,p>0?0:p):n.startCall(e,o,!0,p>0?0:p)}}),[p]);if(!s.length)return(0,o.jsx)(xs.default,{},void 0);var w=[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:function(){return M(!1)},appearance:"secondary"},{children:h("calls_call_by_name_audio_button")}),"callByNameByAudio"),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:function(){return M(!0)}},{children:h("calls_call_by_name_video_button")}),"callByNameByVideo")];return(0,o.jsx)(ul,{items:x,actionButtons:w,selectedId:p,onListItemClick:function(e){f(e)},onClose:function(){a({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})},participantMe:T,onSearchChange:N},void 0)},vl=function(e){var n,t,a,i=e.SDK,r=(0,c.useSelector)((function(e){return e})),s=u(),_=r.localDevice,v=r.externalId,p=r.participants[r.me],f=(0,l.useCallback)((function(){s({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.DEFAULT})}),[]),h=(0,l.useCallback)((function(){var e;i.toggleLocalAudio(!(null===(e=r.localDevice.mediaSettings)||void 0===e?void 0:e.isAudioEnabled))}),[r.localDevice.mediaSettings]);return(0,o.jsx)(qo,{children:v&&(0,o.jsx)(tr,{onRestoreCall:f,isMe:!0,isLocalAudioEnabled:!!(null===(n=_.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),isLocalAudioAllowed:!0,isLocalScreenSharing:!1,onToggleAudio:h,photo:p.photo,name:p.name,participantId:v,isWithVideo:(0,k.isParticipantWithVideo)(_),isWithAudio:!!(null===(t=_.mediaSettings)||void 0===t?void 0:t.isAudioEnabled),isScreenSharing:!!(null===(a=_.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled),streamData:(0,k.getStream)(_),status:_.status,networkStatus:_.networkStatus},void 0)},void 0)},pl=function(e){var n=e.name,t=e.letter,a=e.hasAudio,r=e.hasVideo,s=e.streamData,l=e.wasConnected,c=e.externalId;return(0,o.jsx)("div",(0,i.__assign)({className:"WaitingHall"},{children:(0,o.jsx)("main",(0,i.__assign)({className:"WaitingHall__main"},{children:(0,o.jsx)(ge,{externalId:c,hasVideo:r,hasAudio:a,isSharingScreen:!1,streamData:s,isMe:!0,name:n,letter:t,allowContain:!0,wasConnected:l,networkStatus:1,className:"WaitingHall__participant"},void 0)}),void 0)}),void 0)},fl=function(e){var n=e.text;return(0,o.jsx)("div",(0,i.__assign)({className:"WaitingHallInfo"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"WaitingHallInfo__text"},{children:n}),void 0)}),void 0)};function hl(e){var n,t,a=e.SDK,r=e.navigateToConvo,s=(0,c.useSelector)((function(e){return e})),_=u(),v=(0,l.useContext)(E.LangContext).getLang,p=(0,l.useContext)(N.ConfigContext),f=p.isModalView,h=p.enableScreenTrack,g=s.peer,m=s.localDevice.mediaSettings,A=s.uiMode===d.UIMode.FULLSCREEN,C=(0,i.__read)((0,l.useState)(!1),2),S=C[0],I=C[1],T=(0,i.__read)((0,l.useState)(!1),2),x=T[0],y=T[1],M=function(e){return _({type:d.E_ACTION.CHANGE_UI_MODE,mode:e})},w=(0,l.useCallback)((function(){f&&(s.uiMode===d.UIMode.FULLSCREEN?((0,Ka.pause)(.3,null).then((function(){M(d.UIMode.COLLAPSED)})),M(d.UIMode.DEFAULT)):M(d.UIMode.COLLAPSED))}),[s.uiMode]),O=(0,l.useCallback)((function(){if(!S){var e=!m.isAudioEnabled;(e?ga(a,[G.MediaOption.AUDIO]):Promise.resolve()).then((function(){var n;I(!0),(null===(n=s.notification)||void 0===n?void 0:n.type)===d.NotificationType.SPEAKING_ON_MUTE&&_({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),a.toggleLocalAudio(e).finally((function(){I(!1)}))}))}}),[m,S]),P=(0,l.useCallback)((function(){if(!x){var e=!m.isVideoEnabled||!!m.isScreenSharingEnabled&&!h;(e?ga(a,[G.MediaOption.VIDEO]):Promise.resolve()).then((function(){y(!0),h||m.isScreenSharingEnabled&&a.captureScreen(!1),a.toggleLocalVideo(e).finally((function(){y(!1)}))}))}}),[m,x]),L=(0,l.useCallback)((function(){w(),r(s.peer)}),[s.peer,s.uiMode]),D=(0,l.useCallback)((function(){a.hangup()}),[]),R=(0,l.useCallback)((function(){_({type:d.E_ACTION.CHANGE_UI_MODE,mode:A?d.UIMode.DEFAULT:d.UIMode.FULLSCREEN}),_({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[s.uiMode]),j=(0,l.useCallback)((function(e,n){var t;_({type:d.E_ACTION.SET_TOOLTIP,tooltips:(t={},t[e]=n,t)})}),[]),B=(0,l.useCallback)((function(){_({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[]);(0,l.useEffect)((function(){return function(){_({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}}),[]);var U=pa(),H=s.hangupType===d.HANGUP_TYPE_REMOVED?v("calls_waiting_hall_removed"):v("calls_waiting_hall_info");return(0,o.jsx)(b,(0,i.__assign)({onClose:D,onBackdropClick:w},{children:(0,o.jsx)(Ve,(0,i.__assign)({info:null,isVideoAllowed:!0,isAudioAllowed:!0,isVideoEnabled:!!m.isVideoEnabled,isAudioEnabled:!!m.isAudioEnabled,isFullScreen:A,onToggleAudio:O,onToggleVideo:P,onLeaveCall:D,onCollapseCall:f?w:null,onFullScreenToggle:R,onTooltipChange:j,onHidePanel:B,onChat:L,isChatControlShown:!!g&&!s.groupId,chatUnreadCount:s.chatUnreadCount,tooltips:s.tooltips,notificationWithButton:null,isWaitingHall:!0},{children:(0,o.jsxs)(o.Fragment,{children:[!!m.isVideoEnabled&&s.externalId&&(0,o.jsx)(pl,{name:"",letter:null===(n=s.participants[s.me].name)||void 0===n?void 0:n.slice(0,1),hasAudio:!!(null===(t=s.localDevice.mediaSettings)||void 0===t?void 0:t.isAudioEnabled),externalId:s.externalId,streamData:(0,k.getStream)(s.localDevice),hasVideo:(0,k.isParticipantWithVideo)(s.localDevice),wasConnected:!!s.localDevice.wasConnected},void 0),(0,o.jsx)(fl,{text:H},void 0),U]},void 0)}),void 0)}),void 0)}var gl=function(e){var n=e.onClose,t=e.onSubmit,a=e.children,r=e.onChangeVideoOption,s=e.videoOptions,c=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(Qa.default,(0,i.__assign)({onClose:n,title:c("calls_virtual_background"),appearance:"blue",disableEscapeClose:!0,actionButtons:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__options"},{children:(0,o.jsx)(vr.default,(0,i.__assign)({checked:!!s[d.EVideoOptionType.IS_VIDEO_MIRRORED],name:d.EVideoOptionType.IS_VIDEO_MIRRORED,onChange:r},{children:c("calls_mirror_display_view")}),void 0)}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:n,appearance:"tertiary"},{children:c("calls_cancel")}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:t},{children:c("calls_save")}),void 0)]},void 0),className:"VirtualBackgroundSettingsModal"},{children:a}),void 0)},ml=function(e,n){return ml=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},ml(e,n)};function Al(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}ml(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}function Cl(e,n,t,a){return new(t||(t=Promise))((function(i,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(r,s)}l((a=a.apply(e,n||[])).next())}))}function El(e,n){var t,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;r;)try{if(t=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!((i=(i=r.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=n.call(e,r)}catch(e){o=[6,e],a=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var Sl,Il=function(e,n){void 0===n&&(n=[]);var t=n.join(","),a=new Blob(["("+e+")("+t+");"],{type:"application/javascript; charset=utf-8"});return window.URL.createObjectURL(a)};!function(e){e.IE="IE",e.Safari="Safari",e.Chrome="Chrome",e.Edge="Edge",e.Firefox="Firefox",e.Yandex="Yandex",e.Opera="Opera",e.Sferum="Sferum"}(Sl||(Sl={}));var Tl,xl,yl,Nl,bl,Ml,wl,Ol=(Tl=navigator.appVersion,xl=navigator.appName,yl=navigator.userAgent,Nl=[],function(){return Nl.length?Nl:Nl=function(){var e,n=!1,t=0,a=yl.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(a[1]))return e=/\brv[ :]+(\d+)/g.exec(yl),[Sl.IE,e&&e[1]||"Unknown",n,t];if("Safari"===a[1]){if(e=yl.match(/\bEdge\/(\d+)/))return[Sl.Edge,e[1]||"Unknown",n,t];if(e=yl.match(/\bCriOS\/(\d+)/))return[Sl.Chrome,e[1],!0,+e[1]];if(e=yl.match(/\bFxiOS\/(\d+)/))return[Sl.Firefox,e[1],!1,t];if(e=yl.match(/\bYaBrowser\/(\d+)/))return[Sl.Yandex,e[1],!1,t];if(e=yl.match(/\bOPT\/(\d+)/))return[Sl.Opera,e[1],!1,t]}if(a[1]===Sl.Chrome){if(n=!0,t=Number(a[2]),e=yl.match(/\bOPR\/(\d+)/))return[Sl.Opera,e[1]||"Unknown",n,t];if(e=yl.match(/\bYaBrowser\/(\d+)/))return[Sl.Yandex,e[1]||"Unknown",n,t];if(e=yl.match(/\bSferum\/((\d+)(?:\.\d+)*)/))return[Sl.Sferum,e[1]||"Unknown",n,t];if(e=yl.match(/\bEdge?\/(\d+)/))return[Sl.Edge,e[1]||"Unknown",n,t];if(void 0!==window.opr&&/^(.+\.)?ok.ru$/.test(window.location.host))return[Sl.Opera,"Hidden",n,t]}return e=yl.match(/version\/(\d+)/i),[a[2]?a[1]:xl,e&&e[1]||a[2]||Tl,n,t]}()}),Pl=function(e){return Cl(void 0,void 0,void 0,(function(){return El(this,(function(n){return[2,new Promise((function(n,t){var a=document.createElement("img");a.crossOrigin="anonymous",a.onerror=function(e){t("Failed image loading: "+e)},a.onload=function(){return n(a)},a.src=e}))]}))}))},kl=function(){function e(){this._backgroundCanvas=document.createElement("canvas")}return e.prototype.resize=function(e,n,t,a){var i,o,r=(void 0===a?{}:a).ctxOptions,s=(o={width:0,height:0},"number"==typeof(i=e).width&&"number"==typeof i.height&&(o.height=i.height,o.width=i.width),o),l=s.height,c=s.width,d=this._backgroundCanvas,u=d.getContext("2d",r);if(!u)throw new Error("ctx did not initialized");d.width=n,d.height=t;var _=Math.max(d.width/c,d.height/l),v=d.width/2-c/2*_,p=d.height/2-l/2*_;return u.drawImage(e,v,p,c*_,l*_),d},e}(),Ll=(bl=function(e,n){e.exports=function(e){var n,t,a="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,i=void 0!==(e=e||{})?e:{};i.ready=new Promise((function(e,a){n=e,t=a}));var o,r={};for(o in i)i.hasOwnProperty(o)&&(r[o]=i[o]);var s="./this.program",l=function(e,n){throw n},c="";"undefined"!=typeof document&&document.currentScript&&(c=document.currentScript.src),void 0!==a&&a&&(c=a),c=0!==c.indexOf("blob:")?c.substr(0,c.lastIndexOf("/")+1):"";var d,u=i.print||console.log.bind(console),_=i.printErr||console.warn.bind(console);for(o in r)r.hasOwnProperty(o)&&(i[o]=r[o]);r=null,i.arguments,i.thisProgram&&(s=i.thisProgram),i.quit&&(l=i.quit),i.wasmBinary&&(d=i.wasmBinary);var v,p=i.noExitRuntime||!0;"object"!=typeof WebAssembly&&P("no native wasm support detected");var f,h,g,m,A,C=!1,E="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function S(e,n,t){for(var a=n+t,i=n;e[i]&&!(i>=a);)++i;if(i-n>16&&e.subarray&&E)return E.decode(e.subarray(n,i));for(var o="";n<i;){var r=e[n++];if(128&r){var s=63&e[n++];if(192!=(224&r)){var l=63&e[n++];if((r=224==(240&r)?(15&r)<<12|s<<6|l:(7&r)<<18|s<<12|l<<6|63&e[n++])<65536)o+=String.fromCharCode(r);else{var c=r-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&r)<<6|s)}else o+=String.fromCharCode(r)}return o}function I(e){f=e,i.HEAP8=h=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=m=new Int32Array(e),i.HEAPU8=g=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}i.INITIAL_MEMORY;var T,x,y,N=[],b=[],M=[],w=0,O=null;function P(e){i.onAbort&&i.onAbort(e),_(e+=""),C=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var n=new WebAssembly.RuntimeError(e);throw t(n),n}function k(e){return e.startsWith("data:application/octet-stream;base64,")}function L(e){try{if(e==T&&d)return new Uint8Array(d);throw"both async and sync fetching of the wasm failed"}catch(e){P(e)}}function D(e){for(;e.length>0;){var n=e.shift();if("function"!=typeof n){var t=n.func;"number"==typeof t?void 0===n.arg?A.get(t)():A.get(t)(n.arg):t(void 0===n.arg?null:n.arg)}else n(i)}}function R(e){try{return v.grow(e-f.byteLength+65535>>>16),I(v.buffer),1}catch(e){}}i.preloadedImages={},i.preloadedAudios={},k(T="https://st.mycdn.me/static/callseffects/0-0-3/tflite-simd.wasm")||(x=T,T=i.locateFile?i.locateFile(x,c):c+x),y=function(){return performance.now()};var j={};function B(){if(!B.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:s||"./this.program"};for(var n in j)void 0===j[n]?delete e[n]:e[n]=j[n];var t=[];for(var n in e)t.push(n+"="+e[n]);B.strings=t}return B.strings}var U={mappings:{},buffers:[null,[],[]],printChar:function(e,n){var t=U.buffers[e];0===n||10===n?((1===e?u:_)(S(t,0)),t.length=0):t.push(n)},varargs:void 0,get:function(){return U.varargs+=4,m[U.varargs-4>>2]},getStr:function(e){var n=function(e,n){return e?S(g,e,void 0):""}(e);return n},get64:function(e,n){return e}},H={a:function(){P()},m:function(e,n){var t;if(0===e)t=Date.now();else{if(1!==e&&4!==e)return 28,m[G()>>2]=28,-1;t=y()}return m[n>>2]=t/1e3|0,m[n+4>>2]=t%1e3*1e3*1e3|0,0},i:function(e,n){P("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},c:function(e,n){P("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},g:function(){return 2147483648},k:function(e,n,t){g.copyWithin(e,n,n+t)},l:function(e){var n,t=g.length,a=2147483648;if((e>>>=0)>a)return!1;for(var i=1;i<=4;i*=2){var o=t*(1+.2/i);if(o=Math.min(o,e+100663296),R(Math.min(a,((n=Math.max(e,o))%65536>0&&(n+=65536-n%65536),n))))return!0}return!1},d:function(e){for(var n=y();y()-n<e;);},e:function(e,n){var t=0;return B().forEach((function(a,i){var o=n+t;m[e+4*i>>2]=o,function(e,n,t){for(var a=0;a<e.length;++a)h[n++>>0]=e.charCodeAt(a);h[n>>0]=0}(a,o),t+=a.length+1})),0},f:function(e,n){var t=B();m[e>>2]=t.length;var a=0;return t.forEach((function(e){a+=e.length+1})),m[n>>2]=a,0},o:function(e){!function(e,n){var t;t=e,p||(i.onExit&&i.onExit(t),C=!0),l(t,new F(t))}(e)},h:function(e){return 0},j:function(e,n,t,a,i){},b:function(e,n,t,a){for(var i=0,o=0;o<t;o++){for(var r=m[n+8*o>>2],s=m[n+(8*o+4)>>2],l=0;l<s;l++)U.printChar(e,g[r+l]);i+=s}return m[a>>2]=i,0},n:function e(n,t){e.randomDevice||(e.randomDevice=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}return function(){P("randomDevice")}}());for(var a=0;a<t;a++)h[n+a>>0]=e.randomDevice();return 0}};!function(){var e={a:H};function n(e,n){var t,a=e.exports;i.asm=a,I((v=i.asm.p).buffer),A=i.asm.A,t=i.asm.q,b.unshift(t),function(e){if(w--,i.monitorRunDependencies&&i.monitorRunDependencies(w),0==w&&O){var n=O;O=null,n()}}()}function a(e){n(e.instance)}function o(n){return(d||"function"!=typeof fetch?Promise.resolve().then((function(){return L(T)})):fetch(T,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+T+"'";return e.arrayBuffer()})).catch((function(){return L(T)}))).then((function(n){return WebAssembly.instantiate(n,e)})).then((function(e){return e})).then(n,(function(e){_("failed to asynchronously prepare wasm: "+e),P(e)}))}if(w++,i.monitorRunDependencies&&i.monitorRunDependencies(w),i.instantiateWasm)try{return i.instantiateWasm(e,n)}catch(e){return _("Module.instantiateWasm callback failed with error: "+e),!1}(d||"function"!=typeof WebAssembly.instantiateStreaming||k(T)||"function"!=typeof fetch?o(a):fetch(T,{credentials:"same-origin"}).then((function(n){return WebAssembly.instantiateStreaming(n,e).then(a,(function(e){return _("wasm streaming compile failed: "+e),_("falling back to ArrayBuffer instantiation"),o(a)}))}))).catch(t)}(),i.___wasm_call_ctors=function(){return(i.___wasm_call_ctors=i.asm.q).apply(null,arguments)},i._setNumThreads=function(){return(i._setNumThreads=i.asm.r).apply(null,arguments)},i._getModelBufferMemoryOffset=function(){return(i._getModelBufferMemoryOffset=i.asm.s).apply(null,arguments)},i._getInputMemoryOffset=function(){return(i._getInputMemoryOffset=i.asm.t).apply(null,arguments)},i._getOutputMemoryOffset=function(){return(i._getOutputMemoryOffset=i.asm.u).apply(null,arguments)},i._getInputDim=function(){return(i._getInputDim=i.asm.v).apply(null,arguments)},i._getOutputDim=function(){return(i._getOutputDim=i.asm.w).apply(null,arguments)},i._loadModel=function(){return(i._loadModel=i.asm.x).apply(null,arguments)},i._updateRecurrentState=function(){return(i._updateRecurrentState=i.asm.y).apply(null,arguments)},i._runInference=function(){return(i._runInference=i.asm.z).apply(null,arguments)};var V,G=i.___errno_location=function(){return(G=i.___errno_location=i.asm.B).apply(null,arguments)};function F(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function Z(e){function t(){V||(V=!0,i.calledRun=!0,C||(D(b),n(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),M.unshift(e);var e;D(M)}()))}w>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),N.unshift(e);var e;D(N)}(),w>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t()))}if(O=function e(){V||Z(),V||(O=e)},i.run=Z,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return Z(),e.ready}},bl(Ml={exports:{}}),Ml.exports),Dl="https://st.mycdn.me/static/callseffects",Rl=Dl+"/0-0-3",jl=Dl+"/0-0-5",Bl=Dl+"/0-0-6",Ul=Dl+"/0-0-8",Hl=Dl+"/0-0-9",Vl=Dl+"/0-0-12",Gl={segmentation:{models:{"192x256":Rl+"/segmentation-model.tflite"},wasm:{tfliteSimd:Rl+"/tflite-simd.wasm"}},backgrounds:[{id:3012,preview:jl+"/3012-preview.png",original:jl+"/3012-original.jpg",description:"elephant in the white room",tags:["default"]},{id:3013,preview:jl+"/3013-preview.png",original:jl+"/3013-original.jpg",description:"old native stove in russian historic house",tags:["default"]},{id:3014,preview:jl+"/3014-preview.png",original:jl+"/3014-original.jpg",description:"flying baloons surrounded by mountains",tags:["default"]},{id:3015,preview:jl+"/3015-preview.png",original:jl+"/3015-original.jpg",description:"two pilots driving a plate",tags:["default"]},{id:3016,preview:jl+"/3016-preview.png",original:jl+"/3016-original.jpg",description:"sauna",tags:["default"]},{id:3017,preview:jl+"/3017-preview.png",original:jl+"/3017-original.jpg",description:"red chairs in movie theater",tags:["default"]},{id:3018,preview:jl+"/3018-preview.png",original:jl+"/3018-original.jpg",description:"sleeping person in train cart",tags:["default"]},{id:3019,preview:jl+"/3019-preview.jpg",original:jl+"/3019-original.jpg",description:"Little Big icons on pink background",tags:["star"]},{id:3020,preview:jl+"/3020-preview.jpg",original:jl+"/3020-original.jpg",description:"Violet wild mint (2 colors split background)",tags:["star"]},{id:3021,preview:jl+"/3021-preview.jpg",original:jl+"/3021-original.jpg",description:"Klava Koka left the chat and in love with MDK",tags:["star"]},{id:3022,preview:jl+"/3022-preview.jpg",original:jl+"/3022-original.jpg",description:"Some half-naked dude with rifle",tags:["star"]},{id:3023,preview:jl+"/3023-preview.jpg",original:jl+"/3023-original.jpg",description:'"Cirle" photo collage',tags:["star"]},{id:3024,preview:jl+"/3024-preview.jpg",original:jl+"/3024-original.jpg",description:"Gazgolder & red carpet on the wall",tags:["star"]},{id:3025,preview:jl+"/3025-preview.jpg",original:jl+"/3025-original.jpg",description:"Gazgolder & VK Clips collab pink-yellow-blue collage",tags:["star"]},{id:3026,preview:jl+"/3026-preview.jpg",original:jl+"/3026-original.jpg",description:"Crem Soda people collage",tags:["star"]},{id:3027,preview:jl+"/3027-preview.jpg",original:jl+"/3027-original.jpg",description:"Dmitry Glukhovsky collage",tags:["star"]},{id:3028,preview:Bl+"/3028-preview.jpeg",original:Bl+"/3028-original.jpeg",description:"Dogs in space",tags:["cosmonautics-day-2022"]},{id:3029,preview:Ul+"/3029-preview.jpg",original:Ul+"/3029-original.jpg",description:"Blackboard with e=mc2 formulas",tags:["teachers-day-2022"]},{id:3030,preview:Hl+"/3030-preview.jpg",original:Hl+"/3030-original.jpg",description:"vk 2022 birthday",tags:["vk-2022-birthday"]},{id:3031,preview:Vl+"/3031-preview.png",original:Vl+"/3031-original.png",description:"vk 2022 mothers day",tags:["vk-2022-mothers-day"]}],icons:{starBackground:{id:"icon-star-background",description:"Icon for indicating that virtual background is from stars",url:jl+"/icon-star-background.svg",type:"svg"}}},Fl=function(){function e(){}return e.workerFn=function(e){console.log("here goes the worker...");var n=null,t=!1,a={"192x256":[192,256]},i={processSizeKey:"192x256",inputMemoryOffset:0,outputMemoryOffset:0,maskArray:null,numThreads:2},o=function(){c.call(null,"log",Array.from(arguments))},r=function(){c.call(null,"warn",Array.from(arguments))};function s(s,c,d){return void 0===c&&(c={}),void 0===d&&(d=!1),t=d,o("[createModel]",s,c,{debugFlag:d}),e().then((function(e){return function(e,n){return o("[loadModel][modelPath]",e,n),fetch(n).then((function(e){return e.arrayBuffer()})).then((function(n){o("Model buffer size:",n.byteLength);var t=i.numThreads,a=e._getModelBufferMemoryOffset();return o("Model buffer memory offset:",a),o("Loading model buffer..."),e.HEAPU8.set(new Uint8Array(n),a),o("_loadModel result:",e._loadModel(n.byteLength,t)),{inputMemoryOffset:e._getInputMemoryOffset(0)/4,outputMemoryOffset:e._getOutputMemoryOffset(0)/4}}))}(e,s).then((function(t){return n=e,t}))})).then((function(e){var n=c.processSizeKey||i.processSizeKey,t=a[n],o=t[0],r=t[1],s=new Float32Array(o*r);l(Object.assign({maskArray:s},e,c))})).catch((function(e){n=null,r("simd error",e),self.postMessage({type:"error",error:e})}))}function l(e){Object.assign(i,e),o("settings updated",i)}function c(e,n){if(void 0===e&&(e="log"),"function"==typeof console[e]&&t){var a=["[segmentation-worker]"].concat(n);console[e].apply(null,a)}}self.onmessage=function(e){try{switch(e.data.type){case"create":s(e.data.modelPath,e.data.settings,e.data.debug).then((function(){self.postMessage({type:"ready"})}));break;case"frame":var t=function(e){var t=i.maskArray,o=i.inputMemoryOffset,s=i.outputMemoryOffset,l=a[i.processSizeKey],c=l[0],d=l[1];if(n){if(t){for(var u=0,_=0;u<c*d;u++,_+=4)n.HEAPF32[o+_]=e.data[_]/255,n.HEAPF32[o+_+1]=e.data[_+1]/255,n.HEAPF32[o+_+2]=e.data[_+2]/255,n.HEAPF32[o+_+3]=t[u];n._runInference(),n._updateRecurrentState(1,1);var v=new ImageData(d,c);for(u=0,_=0;u<c*d;u++,_+=4)t[u]=n.HEAPF32[s+u],v.data[_+3]=255*t[u];return v}r("no maskArray created")}else r("no tfliteSIMD instance!")}(e.data.imageData);t&&self.postMessage({type:"frame",segmentationMask:t,resizedImage:e.data.imageData},[t.data.buffer,e.data.imageData.data.buffer]);break;case"params":l(e.data.params);break;default:r("unhandled event",e.data)}}catch(e){r("onmessage error",e),self.postMessage({type:"error",error:e})}}},e}(),Zl=function(){function e(e){var n=this,t=e.onFrame,a=e.onReady,i=e.onError;this._settings={modelKey:"192x256",processSizeKey:"192x256"},this._processSize={"192x256":[192,256]},this._worker=null,this._worker=new Worker(Il(Fl.workerFn,[Ll,JSON.stringify({})])),this._worker.onmessage=function(e){switch(e.data.type){case"ready":a(n);break;case"frame":t({image:n._canvasImageBackup,resizedImage:e.data.resizedImage,segmentationMask:e.data.segmentationMask});break;case"error":null==i||i(e.data);break;default:console.warn("unhandled event type",e.data)}},this._canvas=document.createElement("canvas"),this._canvasImageBackup=document.createElement("canvas");var o=this._canvas.getContext("2d"),r=this._canvasImageBackup.getContext("2d");if(!o||!r)throw new Error("can't get ctx for canvas");this._ctx=o,this._ctxImageBackup=r}return e.prototype.createModel=function(e){var n,t=this._settings,a=Gl.segmentation.models[t.modelKey];null===(n=this._worker)||void 0===n||n.postMessage({type:"create",modelPath:a,settings:t,debug:e})},e.prototype.setParams=function(e){var n=this._worker,t=this._settings;Object.assign(t,e),null==n||n.postMessage({type:"params",params:t})},e.prototype.requestSegmentation=function(e){var n=this,t=n._settings,a=n._canvas,i=n._ctx,o=n._worker,r=n._processSize[t.processSizeKey],s=r[0],l=r[1];this._saveImage(e),a.width=l,a.height=s,i.drawImage(e,0,0,l,s);var c=i.getImageData(0,0,l,s);null==o||o.postMessage({type:"frame",imageData:c},[c.data.buffer])},e.prototype._saveImage=function(e){var n=this._ctxImageBackup,t=this._canvasImageBackup,a=function(e){var n={height:0,width:0};return"number"==typeof e.height?n.height=e.height:n.height=e.height.baseVal.value,"number"==typeof e.width?n.width=e.width:n.width=e.width.baseVal.value,n}(e),i=a.height,o=a.width;t.height=i,t.width=o,n.clearRect(0,0,o,i),n.drawImage(e,0,0,o,i)},e.prototype.destroy=function(){this._worker&&(this._worker.terminate(),this._worker=null)},e}(),Wl=function(){function e(){}return e.updateSegmentationParams=function(n){Object.assign(e._params.segmentation,n)},e.getSegmentationParams=function(){return e._params.segmentation},e.setDebug=function(n){e._params.debug=n},e.getDebug=function(){return!!e._params.debug},e._params={segmentation:{processSizeKey:"192x256",modelKey:"192x256"}},e}(),zl=function(){function e(){this._timeouts=new Map,this._throttles=new Map,this._worker=new Worker(Il(e.workerFn))}return e.prototype.initWorker=function(e){var n=void 0===e?{}:e,t=n.onError,a=n.onTimeout,i=n.onThrottle,o=n.onReady;return Cl(this,void 0,void 0,(function(){var e=this;return El(this,(function(n){return[2,new Promise((function(n,r){e._worker.addEventListener("message",(function(s){switch(s.data.type){case"timeout":e._callTimeout(s.data.id),null==a||a(s.data);break;case"throttle":e._callThrottle(s.data.id),null==i||i(s.data);break;case"error":null==t||t(s.data),r(s.data);break;case"ready":null==o||o(s.data),n()}})),e._worker.addEventListener("error",(function(e){null==t||t(e),r(e)})),e._worker.postMessage({type:"ready"})}))]}))}))},e.workerFn=function(){var e=new Map,n=new Map;self.onmessage=function(t){switch(t.data.type){case"timeout":!function(n,t){void 0===t&&(t=5);var a=setTimeout((function(){self.postMessage({type:"timeout",id:n}),e.delete(n)}),t);e.set(n,a)}(t.data.id,t.data.ms);break;case"throttle":!function(e,t){void 0===t&&(t=5);var a=n.get(e);a&&clearTimeout(a);var i=setTimeout((function(){self.postMessage({type:"throttle",id:e}),n.delete(e)}),t);n.set(e,i)}(t.data.id,t.data.ms);break;case"ready":self.postMessage({type:"ready"});break;default:self.postMessage({type:"error",data:t.data})}},self.postMessage({type:"ready"})},e.prototype.postTimeout=function(e,n,t){void 0===t&&(t=5),this._timeouts.set(e,n),this._worker.postMessage({type:"timeout",id:e,ms:t})},e.prototype.postThrottle=function(e,n,t){void 0===t&&(t=5),this._throttles.set(e,n),this._worker.postMessage({type:"throttle",id:e,ms:t})},e.prototype._callTimeout=function(e){var n=this._timeouts.get(e);n&&(this._timeouts.delete(e),n())},e.prototype._callThrottle=function(e){var n=this._throttles.get(e);n&&(this._throttles.delete(e),n())},e.prototype.destroy=function(){this._worker.terminate(),this._throttles.clear(),this._timeouts.clear()},e}();!function(e){e.NONE="none",e.BLUR="blur",e.BACKGROUND="background"}(wl||(wl={}));var Kl=function(){function e(e){var n=void 0===e?{}:e,t=n.segmentation,a=n.debug;this._effect=null,this._net=null,this._video=null,this._canvas=null,this._stream=null,this._track=null,this._sendNextFrame=null,this._timerWorker=null,t&&Wl.updateSegmentationParams(t),a&&Wl.setDebug(a)}return e.prototype._createDom=function(e){var n=function(e){var n,t,a=e.defaults,i=e.track,o=i.getSettings(),r=i.getConstraints(),s=a;return t=["width","height"],"object"==typeof(n=o)&&(Array.isArray(t)?t.every((function(e){return e in n})):t in n)||!function(e){return"object"==typeof e?Array.isArray(e)?!e.length:!Object.keys(e).length:"string"==typeof e?!e.length:!e}(r)?(o.height?s.height=o.height:"number"==typeof r.height?s.height=r.height:"object"==typeof r.height&&(s.height=r.height.exact||r.height.ideal||r.height.max||r.height.min||s.height),o.width?s.width=o.width:"number"==typeof r.width?s.width=r.width:"object"==typeof r.width&&(s.width=r.width.exact||r.width.ideal||r.width.max||r.width.min||s.width),s):s}({track:e,defaults:{height:360,width:640}}),t=n.width,a=n.height;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.style.pointerEvents="none",this._canvas.style.visibility="hidden",this._canvas.style.position="absolute",this._canvas.style.width="160px",this._canvas.style.height="90px",this._canvas.height=a,this._canvas.width=t,this._canvas.style.bottom="0",this._canvas.style.left="0",this._canvas.style.zIndex="5000",document.body.appendChild(this._canvas)),this._video||(this._video=document.createElement("video"),this._video.controls=!1,this._video.autoplay=!1,this._video.preload="auto",this._video.muted=!0,this._video.style.pointerEvents="none",this._video.style.visibility="hidden",this._video.style.position="absolute",this._video.style.width="160px",this._video.style.height="90px",this._video.height=a,this._video.width=t,this._video.style.bottom="0",this._video.style.right="0",this._video.style.zIndex="5000",document.body.appendChild(this._video))},e.prototype._removeDom=function(){try{this._canvas&&document.body.removeChild(this._canvas),this._video&&document.body.removeChild(this._video)}catch(e){}this._canvas=null,this._video=null},e.prototype._createStream=function(e){return Cl(this,void 0,void 0,(function(){var n=this;return El(this,(function(t){if(!this._canvas||!this._video)throw new Error("Video element or canvas not found");return this._stream=this._canvas.captureStream(0),[2,new Promise((function(t,a){var i=n._video;i.srcObject=new MediaStream([e]),i.onloadeddata=function(){var e;i.width=i.videoWidth,i.height=i.videoHeight,n._track=null===(e=n._stream)||void 0===e?void 0:e.getVideoTracks()[0],t()},i.onerror=function(){return a(new Error("Video element error"))};var o=i.play(),r=function(){return a(new Error("Autoplay is disabled"))};o?o.catch(r):r()}))]}))}))},e.prototype._createNet=function(){return Cl(this,void 0,void 0,(function(){var e=this;return El(this,(function(n){return[2,new Promise((function(n,t){var a=Wl.getDebug()?function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];console.warn.apply(console,e),t()}:void 0;new Zl({onFrame:function(n){e._drawFrame(n)},onReady:n,onError:a}).createModel(Wl.getDebug())}))]}))}))},e.prototype._removeStream=function(){this._stream&&(this._stream.getTracks().forEach((function(e){return e.stop()})),this._stream=null,this._track=null),this._video&&(this._video.pause(),this._video.srcObject&&this._video.srcObject.getTracks().forEach((function(e){return e.stop()})),this._video.srcObject=null)},e.prototype._drawFrame=function(e){var n,t=this;this._net&&this._video&&this._effect&&this._canvas&&this._video&&this._effect&&(this._effect.draw(e),this._track&&(this._track.requestFrame(),null===(n=this._timerWorker)||void 0===n||n.postTimeout(Date.now(),(function(){t._video&&t._sendNextFrame&&t._sendNextFrame(t._video)}))))},e.prototype._cleanup=function(e){var n=void 0===e?{}:e,t=n.removeWorkerNet,a=n.removeWorkerTimer;this._effect&&(this._effect.destroy(),this._effect=null),this._removeStream(),this._removeDom(),t&&this._net&&(this._net.destroy(),this._net=null),a&&this._timerWorker&&(this._timerWorker.destroy(),this._timerWorker=null)},e.prototype._setEffect=function(e,n){return Cl(this,void 0,void 0,(function(){var t,a=this;return El(this,(function(i){switch(i.label){case 0:return this._timerWorker?[3,2]:(this._timerWorker=new zl,[4,this._timerWorker.initWorker()]);case 1:i.sent(),i.label=2;case 2:return this._net?[3,4]:(t=this,[4,this._createNet()]);case 3:t._net=i.sent(),i.label=4;case 4:return this._effect&&(this._effect=null),this._sendNextFrame=function(e){var n;null===(n=a._timerWorker)||void 0===n||n.postThrottle("img-segm",(function(){var n;null===(n=a._net)||void 0===n||n.requestSegmentation(e)}),1e3/60)},this._removeStream(),this._createDom(n),[4,this._createStream(n)];case 5:if(i.sent(),!this._canvas||!this._video)throw new Error("Video element or canvas not found");return this._effect=e,this._effect.video=this._video,this._effect.canvas=this._canvas,this._sendNextFrame(this._video),[2]}}))}))},e.prototype.setEffect=function(e,n){var t;return Cl(this,void 0,void 0,(function(){var a;return El(this,(function(i){switch(i.label){case 0:if(!e)return this._cleanup(),[2,n];e.effect!==(null===(t=this._effect)||void 0===t?void 0:t.effect)&&e.destroy(),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._setEffect(e,n)];case 2:return i.sent(),[2,this._track||n];case 3:throw a=i.sent(),this._cleanup(),a;case 4:return[2]}}))}))},e.prototype.stopEffect=function(){this._cleanup()},Object.defineProperty(e.prototype,"effect",{get:function(){return this._effect?this._effect.effect:wl.NONE},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._cleanup({removeWorkerNet:!0,removeWorkerTimer:!0})},e}(),Ql=function(e){var n=e.gl,t=e.fs,a=e.vs,i=n.createShader(n.VERTEX_SHADER);if(!i)throw new Error("vertex shader didn't initialized");n.shaderSource(i,a),n.compileShader(i);var o=n.createShader(n.FRAGMENT_SHADER);if(!o)throw new Error("fragment shader didn't initialized");n.shaderSource(o,t),n.compileShader(o);var r=n.createProgram();if(!r)throw new Error("shader program didn't initialized");if(n.attachShader(r,i),n.attachShader(r,o),n.linkProgram(r),!n.getProgramParameter(r,n.LINK_STATUS))throw n.getProgramInfoLog(r);return n.deleteShader(i),n.deleteShader(o),{program:r}},Yl=function(e){var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),n},Jl=function(e,n,t){var a=Yl(e);if(!a)throw new Error("texture was not created");e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,t,0,e.RGBA,e.UNSIGNED_BYTE,null);var i=e.createFramebuffer();if(!i)throw new Error("framebuffer was not created");return e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a,0),{framebuffer:i,texture:a}},Xl=function(e,n,t,a){e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,a,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,null)},ql=function(e,n){e.bindFramebuffer(e.FRAMEBUFFER,n),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindFramebuffer(e.FRAMEBUFFER,null)},$l=function(e,n){return{aTextureCoord:e.getAttribLocation(n,"aTextureCoord"),aVertexCoord:e.getAttribLocation(n,"aVertexCoord")}},ec="attribute vec3 aVertexCoord;\nattribute vec2 aTextureCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  gl_Position = vec4(aVertexCoord, 1.0);\n  vTextureCoord = aTextureCoord;\n}",nc=function(){function e(e){var n=this;this.gl=e,this.program=Ql({fs:"precision highp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uAlphaTexture;\nuniform float uLowerBound;\nuniform float uUpperBound;\n\nvoid main(void) {\n  vec4 color = texture2D(uAlphaTexture, vTextureCoord);\n  if (color.a < uLowerBound) {\n    color.a = 0.0;\n  } else {\n    if (color.a < uUpperBound) {\n      color.a = (color.a - uLowerBound) / (uUpperBound - uLowerBound);\n    } else {\n      color.a = 1.0;\n    }\n  }\n  gl_FragColor = color;\n}",gl:e,vs:ec}).program,this.uniforms={uAlphaTexture:function(e){var t=n.gl.getUniformLocation(n.program,"uAlphaTexture");n.gl.uniform1i(t,e)},uLowerBound:function(e){var t=n.gl.getUniformLocation(n.program,"uLowerBound");n.gl.uniform1f(t,e)},uUpperBound:function(e){var t=n.gl.getUniformLocation(n.program,"uUpperBound");n.gl.uniform1f(t,e)}},this.attributes=$l(this.gl,this.program)}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),tc=function(){function e(e){var n=this;this.gl=e,this.program=Ql({fs:"precision highp float;\n\nuniform sampler2D uCameraFrameTexture;\nuniform sampler2D uBackgroundTexture;\nuniform sampler2D uAlphaTexture;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  vec4 cameraFrameColor = texture2D(uCameraFrameTexture, vTextureCoord);\n  vec4 backgroundColor = texture2D(uBackgroundTexture, vTextureCoord);\n  vec4 alphaMask = texture2D(uAlphaTexture, vTextureCoord);\n  gl_FragColor = mix(backgroundColor, cameraFrameColor, alphaMask.a);\n}",gl:e,vs:ec}).program,this.uniforms={uAlphaTexture:function(e){var t=n.gl.getUniformLocation(n.program,"uAlphaTexture");n.gl.uniform1i(t,e)},uCameraFrameTexture:function(e){var t=n.gl.getUniformLocation(n.program,"uCameraFrameTexture");n.gl.uniform1i(t,e)},uBackgroundTexture:function(e){var t=n.gl.getUniformLocation(n.program,"uBackgroundTexture");n.gl.uniform1i(t,e)}},this.attributes=$l(this.gl,this.program)}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),ac=function(){function e(e){var n=this;this.gl=e,this.program=Ql({fs:"// https://github.com/Jam3/glsl-fast-gaussian-blur\n\nprecision highp float;\n\nuniform sampler2D texture;\nuniform vec3 iResolution;\nuniform bool flip;\nuniform vec2 direction;\n\nvec4 blur5(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3333333333333333) * direction;\n  color += texture2D(image, uv) * 0.29411764705882354;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n  return color;\n}\n\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.411764705882353) * direction;\n  vec2 off2 = vec2(3.2941176470588234) * direction;\n  vec2 off3 = vec2(5.176470588235294) * direction;\n  color += texture2D(image, uv) * 0.1964825501511404;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\n  color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\n  color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\n  return color;\n}\n\nvoid main() {\n  vec2 uv = vec2(gl_FragCoord.xy / iResolution.xy);\n  if (flip) {\n    uv.y = 1.0 - uv.y;\n  }\n\n  gl_FragColor = blur13(texture, uv, iResolution.xy, direction);\n}",gl:e,vs:"attribute vec3 position;\n\nvoid main() { gl_Position = vec4(position, 1.0); }"}).program,this.uniforms={texture:function(e){var t=n.gl.getUniformLocation(n.program,"texture");n.gl.uniform1i(t,e)},iResolution:function(e,t,a){var i=n.gl.getUniformLocation(n.program,"iResolution");n.gl.uniform3f(i,e,t,a)},flip:function(e){var t=n.gl.getUniformLocation(n.program,"flip");n.gl.uniform1f(t,e)},direction:function(e,t){var a=n.gl.getUniformLocation(n.program,"direction");n.gl.uniform2f(a,e,t)}},this.attributes={position:this.gl.getAttribLocation(this.program,"position")}}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),ic=function(){function e(e){var n=this;this.gl=e,this.program=Ql({fs:"precision highp float;\n\nuniform sampler2D uTextureOriginal;\nuniform sampler2D uTextureMask;\nuniform vec3 iResolution;\nuniform bool flip;\nuniform vec2 direction;\n\nvec4 blur13(sampler2D image, sampler2D maskTexture, vec2 uv, vec2 resolution,\n            vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.411764705882353) * direction;\n  vec2 off2 = vec2(3.2941176470588234) * direction;\n  vec2 off3 = vec2(5.176470588235294) * direction;\n  float sumCof = 0.0;\n\n  vec4 c = texture2D(image, uv);\n  vec4 m = texture2D(maskTexture, uv);\n  color += c * 0.1964825501511404 * (1.0 - m.a);\n  sumCof += 0.1964825501511404 * (1.0 - m.a);\n\n  c = texture2D(image, uv + (off1 / resolution));\n  m = texture2D(maskTexture, uv + (off1 / resolution));\n  color += c * 0.2969069646728344 * (1.0 - m.a);\n  sumCof += 0.2969069646728344 * (1.0 - m.a);\n\n  c = texture2D(image, uv - (off1 / resolution));\n  m = texture2D(maskTexture, uv - (off1 / resolution));\n  color += c * 0.2969069646728344 * (1.0 - m.a);\n  sumCof += 0.2969069646728344 * (1.0 - m.a);\n\n  c = texture2D(image, uv + (off2 / resolution));\n  m = texture2D(maskTexture, uv + (off2 / resolution));\n  color += c * 0.09447039785044732 * (1.0 - m.a);\n  sumCof += 0.09447039785044732 * (1.0 - m.a);\n\n  c = texture2D(image, uv - (off2 / resolution));\n  m = texture2D(maskTexture, uv - (off2 / resolution));\n  color += c * 0.09447039785044732 * (1.0 - m.a);\n  sumCof += 0.09447039785044732 * (1.0 - m.a);\n\n  c = texture2D(image, uv + (off3 / resolution));\n  m = texture2D(maskTexture, uv + (off3 / resolution));\n  color += c * 0.010381362401148057 * (1.0 - m.a);\n  sumCof += 0.010381362401148057 * (1.0 - m.a);\n\n  c = texture2D(image, uv - (off3 / resolution));\n  m = texture2D(maskTexture, uv - (off3 / resolution));\n  color += c * 0.010381362401148057 * (1.0 - m.a);\n  sumCof += 0.010381362401148057 * (1.0 - m.a);\n\n  return sumCof > 0.0 ? color / sumCof : vec4(0.0, 0.0, 0.0, 0.0);\n}\n\nvoid main() {\n  vec2 uv = vec2(gl_FragCoord.xy / iResolution.xy);\n\n  if (flip) {\n    uv.y = 1.0 - uv.y;\n  }\n\n  gl_FragColor =\n      blur13(uTextureOriginal, uTextureMask, uv, iResolution.xy, direction);\n}",gl:e,vs:"attribute vec3 position;\n\nvoid main() { gl_Position = vec4(position, 1.0); }"}).program,this.uniforms={uTextureOriginal:function(e){var t=n.gl.getUniformLocation(n.program,"uTextureOriginal");n.gl.uniform1i(t,e)},uTextureMask:function(e){var t=n.gl.getUniformLocation(n.program,"uTextureMask");n.gl.uniform1i(t,e)},iResolution:function(e,t,a){var i=n.gl.getUniformLocation(n.program,"iResolution");n.gl.uniform3f(i,e,t,a)},flip:function(e){var t=n.gl.getUniformLocation(n.program,"flip");n.gl.uniform1f(t,e)},direction:function(e,t){var a=n.gl.getUniformLocation(n.program,"direction");n.gl.uniform2f(a,e,t)}},this.attributes={position:this.gl.getAttribLocation(this.program,"position")}}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),oc=function(){function e(e){this.textures={background:null,image:null,resizedImage:null,segmentationMask:null},this.parameters={blurStrength:.8,fixSegmentation:!0,fixSegmentationBlurStrength:.25,fixSegmentationIterations:8,alphaCutterLowerBound:.4,alphaCutterUpperBound:.6},this.$canvas=e;var n=this.$canvas.getContext("webgl");if(!n)throw new Error("getting ctx failed");this.gl=n;var t=this.gl;this.onresize=this.onresize.bind(this),this.onresize(),this.pBlurFastWithMask=new ic(this.gl),this.pBackgroundComposer=new tc(this.gl),this.pBlurFast=new ac(this.gl),this.pAlphaCutter=new nc(this.gl),this.vertices=[1,1,0,1,1,1,-1,0,1,0,-1,-1,0,0,0,-1,1,0,0,1],this.indices=[0,1,3,1,2,3];var a=t.createBuffer(),i=t.createBuffer();if(!a||!i)throw new Error("create buffer error");this.positionBuffer=a,this.indexBuffer=i,t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.vertices),t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),t.STATIC_DRAW),this.fbs={blur:this.createTextureLayers(),segmentationFix:this.createTextureLayers()},this.textures={background:Yl(t),image:Yl(t),resizedImage:Yl(t),segmentationMask:Yl(t)},window.addEventListener("resize",this.onresize)}return e.prototype.onresize=function(){var e=this,n=e.$canvas,t=e.gl,a=e.fbs,i=n.width||n.clientWidth,o=n.height||n.clientHeight;n.width=i,n.height=o,t.viewport(0,0,i,o),a&&function(e,n){for(var t=n.height,a=n.width,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];i.forEach((function(n){n.forEach((function(n){ql(e,n.framebuffer),Xl(e,n.texture,a,t)}))}))}(t,{width:i,height:o},a.blur,a.segmentationFix)},e.prototype.loadTextures=function(e){var n=e.image,t=e.resizedImage,a=e.segmentationMask,i=e.background,o=this.gl,r=this.textures;return o.bindTexture(o.TEXTURE_2D,r.image),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,n),i||(o.bindTexture(o.TEXTURE_2D,r.resizedImage),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,t)),o.bindTexture(o.TEXTURE_2D,r.segmentationMask),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,a),i&&(o.bindTexture(o.TEXTURE_2D,r.background),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,i)),o.bindTexture(o.TEXTURE_2D,null),r},e.prototype.close=function(){var e=this,n=e.gl,t=e.positionBuffer,a=e.indexBuffer,i=e.pBackgroundComposer,o=e.pBlurFast,r=e.pBlurFastWithMask,s=e.pAlphaCutter,l=e.fbs,c=e.textures;window.removeEventListener("resize",this.onresize),n.bindBuffer(n.ARRAY_BUFFER,null),n.deleteBuffer(t),n.deleteBuffer(a),n.useProgram(null),i.destroy(),o.destroy(),r.destroy(),s.destroy(),function(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];n.forEach((function(n){n.forEach((function(n){e.deleteFramebuffer(n.framebuffer),e.deleteTexture(n.texture)}))}))}(n,l.blur,l.segmentationFix),function(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];n.forEach((function(n){return e.deleteTexture(n)}))}(n,c.background,c.image,c.resizedImage,c.segmentationMask)},e.prototype.drawGeometry=function(){var e=this,n=e.gl,t=e.indexBuffer,a=e.indices;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),n.drawElements(n.TRIANGLES,a.length,n.UNSIGNED_SHORT,0)},e.prototype.createTextureLayers=function(){var e=this.gl,n=this.$canvas,t=n.width,a=n.height;return[Jl(e,t,a),Jl(e,t,a)]},e.prototype.setGeometry=function(e,n){var t=this.gl,a=this.positionBuffer;t.bindBuffer(t.ARRAY_BUFFER,a),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,3,t.FLOAT,!1,5*Float32Array.BYTES_PER_ELEMENT,0),void 0!==n&&(t.enableVertexAttribArray(n),t.vertexAttribPointer(n,2,t.FLOAT,!1,5*Float32Array.BYTES_PER_ELEMENT,3*Float32Array.BYTES_PER_ELEMENT))},e.prototype.setParameters=function(e){Object.assign(this.parameters,e)},e.prototype.draw=function(e){var n,t,a=this,i=a.gl,o=a.$canvas,r=a.parameters,s=a.pBlurFastWithMask,l=a.pBackgroundComposer,c=a.pBlurFast,d=a.pAlphaCutter,u=a.fbs,_=r.fixSegmentation,v=r.fixSegmentationBlurStrength,p=r.blurStrength,f=r.fixSegmentationIterations,h=r.alphaCutterLowerBound,g=r.alphaCutterUpperBound,m=o.width,A=o.height;i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.viewport(0,0,m,A),i.disable(i.BLEND),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var C=this.loadTextures(e),E=null,S=e.background?C.background:null;if(_){c.bind(),this.setGeometry(c.attributes.position),c.uniforms.iResolution(m,A,0),c.uniforms.flip(0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,C.segmentationMask),c.uniforms.texture(0);for(var I=0,T=0;T<f;++T){var x=(f-T-1)*v,y=T%2==0?[x,0]:[0,x];(n=c.uniforms).direction.apply(n,y),i.bindFramebuffer(i.FRAMEBUFFER,u.segmentationFix[I%2].framebuffer),this.drawGeometry(),i.bindTexture(i.TEXTURE_2D,u.segmentationFix[I%2].texture),++I}d.bind(),this.setGeometry(d.attributes.aVertexCoord,d.attributes.aTextureCoord),d.uniforms.uLowerBound(h),d.uniforms.uUpperBound(g),d.uniforms.uAlphaTexture(0),i.bindFramebuffer(i.FRAMEBUFFER,u.segmentationFix[I%2].framebuffer),this.drawGeometry(),E=u.segmentationFix[I%2].texture}if(!S){s.bind(),this.setGeometry(s.attributes.position),s.uniforms.iResolution(m,A,0),s.uniforms.flip(0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,E||C.segmentationMask),s.uniforms.uTextureMask(0),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,C.resizedImage),s.uniforms.uTextureOriginal(1);var N=0;for(T=0;T<8;++T)x=(8-T-1)*p,y=T%2==0?[x,0]:[0,x],(t=s.uniforms).direction.apply(t,y),i.bindFramebuffer(i.FRAMEBUFFER,u.blur[N%2].framebuffer),this.drawGeometry(),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,u.blur[N%2].texture),++N;S=u.blur[(N-1)%2].texture}l.bind(),this.setGeometry(l.attributes.aVertexCoord,l.attributes.aTextureCoord),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,E||C.segmentationMask),l.uniforms.uAlphaTexture(0),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,S),l.uniforms.uBackgroundTexture(1),i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,C.image),l.uniforms.uCameraFrameTexture(2),i.bindFramebuffer(i.FRAMEBUFFER,null),this.drawGeometry()},e}(),rc=function(){function e(e){this._effect=e}return Object.defineProperty(e.prototype,"video",{set:function(e){this._video=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{set:function(e){this._canvas=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"effect",{get:function(){return this._effect},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){},e}(),sc=function(e){function n(){var n=e.call(this,wl.BACKGROUND)||this;return n._imageEdit=new kl,n._WebGlBlend=null,n}return Al(n,e),n.prototype.setBackgroundImage=function(e){return Cl(this,void 0,void 0,(function(){var n,t;return El(this,(function(a){switch(a.label){case 0:return n=this,e?[4,Pl(e)]:[3,2];case 1:return t=a.sent(),[3,3];case 2:t=void 0,a.label=3;case 3:return n._nextBackgroundImage=t,[2]}}))}))},n.prototype._updateBackground=function(){try{if(this._nextBackgroundImage){var e=this._canvas,n=this._imageEdit,t=e.width,a=e.height;this._backgroundImage=n.resize(this._nextBackgroundImage,t,a),delete this._nextBackgroundImage}}catch(e){console.warn(e)}},n.prototype.draw=function(e){try{if(this._WebGlBlend||(this._WebGlBlend=new oc(this._canvas)),this._nextBackgroundImage&&this._updateBackground(),this._WebGlBlend){var n=Object.assign({background:this._backgroundImage},e);this._WebGlBlend.draw(n)}}catch(e){console.warn(e)}},n.prototype.destroy=function(){e.prototype.destroy.call(this),this._WebGlBlend&&(this._WebGlBlend.close(),this._WebGlBlend=null)},n}(rc),lc=function(e){function n(){var n=e.call(this,wl.BLUR)||this;return n._WebGLEffects=null,n._savedOptions=null,n}return Al(n,e),n.prototype.draw=function(e){try{this._WebGLEffects||(this._WebGLEffects=new oc(this._canvas),this._savedOptions&&this._WebGLEffects.setParameters(this._savedOptions)),this._WebGLEffects.draw(e)}catch(e){console.warn(e)}},n.prototype.setEffects=function(e){this._savedOptions=e,this._WebGLEffects&&this._WebGLEffects.setParameters(e)},n.prototype.destroy=function(){e.prototype.destroy.call(this),this._WebGLEffects&&(this._WebGLEffects.close(),this._WebGLEffects=null)},n}(rc),cc=function(){function e(e){this.params=e}return e.prototype.getMappedParams=function(){return{id:this.params.id,originalUrl:this.params.original,previewUrl:this.params.preview,isPredefined:!0,tags:this.params.tags}},e}(),dc=[{audio:!1,video:{frameRate:25,height:250,width:436}},{audio:!1,video:{frameRate:25}},{audio:!1,video:!0}],uc=function(){var e,n,t=new Map;[3031,3030,3029,3028,3019,3026,3027,3023,3024,3025,3020,3021,3022,3015,3013,3016,3012,3014,3017,3018].forEach((function(e){return t.set(e,null)}));try{for(var a=(0,i.__values)(Gl.backgrounds),o=a.next();!o.done;o=a.next()){var r=o.value;t.has(r.id)&&t.set(r.id,new cc(r))}}catch(n){e={error:n}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return(0,i.__spreadArray)([],(0,i.__read)(t.values()),!1).filter(Boolean)}(),_c=function(e){var n;return null===(n=e.sizes)||void 0===n?void 0:n.reduce((function(e,n){return e[n.type]=n.url,e}),{})},vc=function(e){var n=_c(e);return(null==n?void 0:n.x)||(null==n?void 0:n.m)||(null==n?void 0:n.s)||""},pc=function(e,n){if(n){var t=n.find((function(n){return n.id===e}));if(t)return Promise.resolve({id:t.id,url:t.originalUrl})}return(0,qe.photosGetAllImages)({photo_ids:""+e}).then((function(e){try{var n=e.items[0];return n?{id:n.id,url:vc(n)}:null}catch(e){return null}}))},fc=t(71982),hc=function(e){var n=e.children,t=e.className,a=e.style,r=e.passedRef,c=(0,i.__rest)(e,["children","className","style","passedRef"]),d=(0,l.useCallback)((function(){}),[]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)(t),style:a,ref:r},{children:n}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__item--radio"},{children:(0,o.jsx)(fc.default,(0,i.__assign)({},c,{onChange:d}),void 0)}),void 0)]},void 0)},gc=(0,l.memo)((function(e){var n=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(hc,(0,i.__assign)({},e,{className:(0,s.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--with-border")},{children:n("calls_virtual_background_settings_no_background")}),void 0)})),mc=(0,l.memo)((function(e){return(0,o.jsx)(hc,(0,i.__assign)({},e,{className:(0,s.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--blur")}),void 0)})),Ac=t(45898),Cc=(0,l.memo)((function(){return(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--add-image")},{children:(0,o.jsx)(Ac.default,{},void 0)}),void 0)})),Ec=(0,l.forwardRef)((function(e,n){var t=(0,i.__rest)(e,[]);return(0,o.jsx)("div",(0,i.__assign)({},t,{ref:n,style:{width:18,height:18}},{children:(0,o.jsxs)("svg",(0,i.__assign)({width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:[(0,o.jsx)("rect",{width:"18",height:"18",rx:"2",fill:"black",fillOpacity:"0.4"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.10202 5L5 6.10202L7.89798 9L5 11.898L6.10202 13L9 10.102L11.898 13L13 11.898L10.102 9L13 6.10202L11.898 5L9.10108 7.7969L9 7.89798L6.10202 5Z",fill:"white",fillOpacity:"0.72"},void 0)]}),void 0)}),void 0)})),Sc=t(54190),Ic=(0,l.memo)((function(e){var n=e.backgroundUrl,t=e.checked,a=e.onDelete,r=e.photoId,c=e.isPredefinedBackground,d=e.isStarBackground,u=(0,i.__rest)(e,["backgroundUrl","checked","onDelete","photoId","isPredefinedBackground","isStarBackground"]),_=(0,l.useContext)(E.LangContext).getLang,v=(0,l.useRef)(null),p=(0,i.__read)((0,l.useState)(!0),2),f=p[0],h=p[1],g=(0,l.useMemo)((function(){return(0,o.jsx)("div",{dangerouslySetInnerHTML:{__html:_(t?"calls_cant_remove_background":"calls_delete_background")}},void 0)}),[t]),m=(0,l.useCallback)((function(e){e.stopPropagation(),t||a(r)}),[t,r]);return(0,l.useEffect)((function(){var e,t;return v.current&&(e=new IntersectionObserver((function(a){var o,r;try{for(var s=(0,i.__values)(a),l=s.next();!l.done;l=s.next()){l.value.isIntersecting&&(e.disconnect(),(t=new Image).src=n,t.onload=function(){h(!1),t.remove()})}}catch(e){o={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}}),{threshold:0,root:null}),e.observe(v.current)),function(){t&&(t.onload=null,t.remove()),null==e||e.disconnect()}}),[]),(0,o.jsxs)(hc,(0,i.__assign)({},u,{checked:t,className:(0,s.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--background",{"VirtualBackgroundSettings__item--background-star":!f&&!!d}),passedRef:v,style:{backgroundImage:f?void 0:"url("+n+")"}},{children:[f&&(0,o.jsx)(Sc.DivBlockSkeleton,{classNames:"VirtualBackgroundSettings__item--background__skeleton",height:80},void 0),!c&&!f&&(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("VirtualBackgroundSettings__item--background__deletebtn",{"VirtualBackgroundSettings__item--background__deletebtn--disabled":t}),onClick:m},{children:(0,o.jsx)(be.TooltipNew,(0,i.__assign)({content:g,className:"VirtualBackgroundSettings__item__popper",position:"t",align:"center"},{children:(0,o.jsx)(Ec,{},void 0)}),void 0)}),void 0)]}),void 0)})),Tc=function(){var e=(0,c.useSelector)((function(e){return e.me}));return{isAnonymous:(0,k.isParticipantAnonym)(e)}},xc=function(){function e(e){this.$c=e,this.gl=this.$c.getContext("webgl")}return e.prototype.draw=function(){var e=this.gl;null==e||e.clearColor(0,0,0,0),null==e||e.clear(e.COLOR_BUFFER_BIT)},e}(),yc=function(e){var n=e.backgroundList,t=e.$srcElement,a=e.userStream,o=(0,l.useRef)(null),r=(0,l.useRef)(null),s=(0,l.useRef)(null),c=(0,l.useRef)(null);null===c.current&&(c.current=new kl);var u=(0,l.useRef)(null),_=(0,l.useRef)(d.EVideoEffectType.NONE),v=(0,l.useRef)(d.EVideoEffectType.NONE),p=(0,l.useRef)(void 0),f=(0,l.useRef)(null),h=(0,l.useRef)(null),g=(0,l.useRef)(!1),m=(0,i.__read)((0,l.useState)(!1),2),A=m[0],C=m[1],E=(0,l.useCallback)((function(e){g.current="play"===e,C("play"===e)}),[]),S=(0,l.useCallback)((function(e,n){void 0===n&&(n=!1),v.current=e,n||(_.current=e)}),[]),I=(0,l.useCallback)((function(){if(f.current&&clearTimeout(f.current),g.current)if(t.current&&r.current)try{r.current.requestSegmentation(t.current)}catch(e){console.error("[useVideoEffects][onRequestSegmentation][error]",e)}else f.current=setTimeout((function(){I()}),300)}),[]),T=(0,l.useCallback)((function(e){var t,a,r;if(null===(t=o.current)||void 0===t?void 0:t.isReady)switch(e){case d.EVideoEffectType.ADD:break;case d.EVideoEffectType.BLUR:S(e),p.current&&(p.current=void 0),g.current||(E("play"),I());break;case d.EVideoEffectType.NONE:S(e),p.current&&(p.current=void 0),null===(a=u.current)||void 0===a||a.draw(),E("stop");break;default:var s=n.find((function(n){return n.id===e}));s&&(S(e,!0),(r=s.originalUrl,(0,i.__awaiter)(void 0,void 0,Promise,(function(){return(0,i.__generator)(this,(function(e){return[2,new Promise((function(e,n){var t=document.createElement("img");t.crossOrigin="anonymous",t.onerror=function(e){n("Failed image loading: "+e)},t.onload=function(){return e(t)},t.src=r}))]}))}))).then((function(n){if(!o.current)throw new Error("output canvas is not initialized");if(!c.current)throw new Error("ImageEdit class is not initialized");if(v.current!==e)throw new Error("Settings changed during load");var t=o.current,a=t.width,i=t.height;return c.current.resize(n,a,i)})).then((function(n){if(v.current!==e)throw new Error("Settings changed during load");S(e),p.current=n,g.current||(E("play"),I())})).catch(console.warn))}else h.current=function(){T(e)}}),[n]),x=(0,l.useCallback)((function(e){switch(_.current){case d.EVideoEffectType.ADD:case d.EVideoEffectType.NONE:break;case d.EVideoEffectType.BLUR:requestAnimationFrame((function(){var n;null===(n=s.current)||void 0===n||n.draw(e),g.current&&I()}));break;default:requestAnimationFrame((function(){var n,t=Object.assign({background:p.current},e);null===(n=s.current)||void 0===n||n.draw(t),g.current&&I()}))}}),[]);return(0,l.useEffect)((function(){var e;if(a){if(o.current){var n=a.getVideoTracks()[0].getSettings(),t=n.width,l=n.height;o.current.width=t||436,o.current.height=l||250,o.current.isReady=!0,null===(e=h.current)||void 0===e||e.call(h);s.current=new oc(o.current),u.current=new xc(o.current);var c=new Promise((function(e,n){var t=new Zl({onReady:e,onError:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn.apply(console,(0,i.__spreadArray)([],(0,i.__read)(e),!1)),n()},onFrame:x});t.createModel(!0)})).then((function(e){return r.current=e,e})).catch((function(){r.current=null}));return function(){var e,n;null===(e=s.current)||void 0===e||e.close(),null===(n=r.current)||void 0===n||n.destroy(),c.then((function(e){e&&e.destroy()})),s.current=null,r.current=null,h.current=null}}console.error("[useVideoEffects][on-userStream-update] canvas is not initialized")}}),[a]),{$canvas:o,onRequestSegmentation:I,onUpdateVideoEffectsSettings:T,isPlaying:A}},Nc=function(e){e.getTracks().forEach((function(e){return e.stop()}))},bc=function(e){var n=e.className;return(0,o.jsx)("svg",(0,i.__assign)({className:n,width:"4",height:"4",viewBox:"0 0 4 4",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4 4V0H0C2.20898 0 4 1.79077 4 4Z",fill:"white"},void 0)}),void 0)},Mc=(0,l.memo)((function(e){var n=e.onClick,t=e.id,a=e.content;return(0,o.jsx)("div",(0,i.__assign)({className:"VirtualBackgroundSettingsCarousel__Item",onClick:function(){return null==n?void 0:n(t)}},{children:a}),void 0)})),wc=function(e){var n=e.backgroundList,t=e.onDeleteBackground,a=e.onChooseBackground,r=e.chosen,c=e.videoOptions,u=e.isSferum,_=(0,Ae.useLang)().getLang,v=function(e){var n=(0,i.__read)((0,l.useState)(null),2),t=n[0],a=n[1],o=(0,i.__read)((0,l.useState)(!1),2),r=o[0],s=o[1],c=(0,l.useRef)(!1),d=(0,Gt.useIsMounted)(),u=(0,l.useRef)(0),_=(0,l.useCallback)((function(){if(!c.current){s(!1),c.current=!0;var n=function(t){return navigator.mediaDevices.getUserMedia(t).then((function(e){d()?a(e):Nc(e),c.current=!1})).catch((function(t){++u.current<e.length?n(e[u.current]):(a(null),s(t),c.current=!1)}))};n(e[u.current])}}),[e]);return(0,l.useEffect)((function(){_();var e=function(){u.current=0,_()};return navigator.mediaDevices.addEventListener("devicechange",e),function(){navigator.mediaDevices.removeEventListener("devicechange",e)}}),[_]),(0,l.useEffect)((function(){return function(){t&&Nc(t)}}),[t]),{userStream:t,error:r,updateUserMediaStream:_}}(dc),p=v.userStream,f=v.error,h=v.updateUserMediaStream,g=function(e){var n=e.userStream,t=(0,l.useRef)(null);return(0,l.useEffect)((function(){if(n&&t.current){var e=function(e){var n=e.getVideoTracks()[0].getSettings(),t=n.width,a=void 0===t?436:t,i=n.height;return{width:a,height:void 0===i?250:i}}(n),a=e.height,i=e.width;t.current.height=a,t.current.width=i,t.current.srcObject=n}}),[n]),{$video:t}}({userStream:p}).$video,m=yc({backgroundList:n,$srcElement:g,userStream:p}),A=m.$canvas,C=m.onUpdateVideoEffectsSettings,E=m.isPlaying,S=function(e){var n=e.onDeleteBackground,t=e.backgroundList,a=e.chosen,r=e.onUpdateVideoEffectsSettings,s=e.onChooseBackground,c=e.isSferum,u=Tc().isAnonymous;(0,l.useEffect)((function(){a!==d.EVideoEffectType.NONE&&r(a)}),[]);var _=(0,l.useCallback)((function(e){s(e),r(e)}),[s,r]),v=(0,l.useMemo)((function(){return t.map((function(e){var t;return{id:e.id,onClick:_,content:(0,o.jsx)(Ic,{checked:a===e.id,backgroundUrl:e.previewUrl,onDelete:n,photoId:e.id,isPredefinedBackground:e.isPredefined,isStarBackground:null===(t=e.tags)||void 0===t?void 0:t.includes("star")},void 0)}}))}),[a,t,_]);return{carouselItems:(0,l.useMemo)((function(){var e=[{id:d.EVideoEffectType.NONE,onClick:_,content:(0,o.jsx)(gc,{checked:a===d.EVideoEffectType.NONE},void 0)},{id:d.EVideoEffectType.BLUR,onClick:_,content:(0,o.jsx)(mc,{checked:a===d.EVideoEffectType.BLUR},void 0)}];return c||(u||e.push({id:d.EVideoEffectType.ADD,onClick:_,content:(0,o.jsx)(Cc,{},void 0)}),e.push.apply(e,(0,i.__spreadArray)([],(0,i.__read)(v),!1))),e}),[a,v,_])}}({backgroundList:n,onDeleteBackground:t,onUpdateVideoEffectsSettings:C,onChooseBackground:a,chosen:r,isSferum:u}).carouselItems;return(0,o.jsxs)("div",(0,i.__assign)({className:"VirtualBackgroundSettings"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__userStream"},{children:[p&&(0,o.jsx)("video",(0,i.__assign)({className:(0,s.classNames)("Video",{"Video--visible":!E},"Video--contain",{"Video--mirrored":c[d.EVideoOptionType.IS_VIDEO_MIRRORED]}),ref:g,controls:!1,crossOrigin:"anonymous",playsInline:!0,muted:!0,autoPlay:!0},{children:"Video tag is not supported"}),void 0),(0,o.jsx)("canvas",{ref:A,className:(0,s.classNames)("VirtualBackgroundSettings__userCanvas",{"VirtualBackgroundSettings__userCanvas--mirrored":c[d.EVideoOptionType.IS_VIDEO_MIRRORED]},{"VirtualBackgroundSettings__userCanvas--playing":E})},void 0),f&&(0,o.jsxs)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__error"},{children:[(0,o.jsx)("div",{children:_("profile_no_camera_access")},void 0),(0,o.jsx)("div",{children:(0,o.jsx)(_i.default,(0,i.__assign)({className:"VirtualBackgroundSettings__error__btn",size:"m",onClick:h},{children:_("calls_button_allow_access")}),void 0)},void 0)]}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)({VirtualBackgroundSettings__carousel__modalFix:!0,"VirtualBackgroundSettings__carousel__modalFix--sferum":u})},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"VirtualBackgroundSettings__carousel"},{children:S.map((function(e){return(0,o.jsx)(Mc,{id:e.id,onClick:e.onClick,content:e.content},e.id)}))}),void 0),(0,o.jsx)(bc,{className:"VirtualBackgroundSettings__carousel__cornerIcon"},void 0)]}),void 0)]}),void 0)},Oc=t(99939),Pc=function(){var e=(0,Oc.useSendStatsData)().sendStatsData,n=(0,l.useCallback)((function(n,t,a){var i=to(n,t,a),o=i.disabledActionType,r=i.prevSendValue,s=i.effectDuration;null!==o&&e(o,{background_id:r,background_duration:s})}),[e]),t=(0,l.useCallback)((function(t,a){var i,o=Date.now(),r=q();r&&n(a,o,r),i=t>4e3?Oc.ECallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_SELECTED:Oc.ECallActionEventType.VIRTUAL_BACKGROUND_SELECTED,e(i,{background_id:t}),$(o)}),[e,n]),a=(0,l.useCallback)((function(e){var t=q();if(t){var a=Date.now();n(e,a,t),ee()}}),[n]),i=(0,l.useCallback)((function(n){e(Oc.ECallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_ADDED,{background_id:n})}),[e]);return{sendVirtualBackgroundSelected:t,sendVirtualBackgroundDisabled:a,sendVirtualBackgroundDeleted:(0,l.useCallback)((function(n){e(Oc.ECallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_DELETED,{background_id:n})}),[e]),sendVirtualBackgroundAdded:i}},kc=function(){var e=u();return{onClose:(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP,data:null})}),[]),onClosePopupCalendar:(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING})}),[])}},Lc=function(e){var n=e.photos,t=e.onSuccessPhotoUpload,a=e.isSferum,o=u(),r=Pc(),s=r.sendVirtualBackgroundAdded,c=r.sendVirtualBackgroundDeleted,_=Tc().isAnonymous,v=(0,l.useRef)([]),p=(0,i.__read)((0,l.useState)(!1),2),f=p[0],h=p[1];(0,l.useEffect)((function(){n.length||_||a||(0,qe.photosGetAllImages)().then((function(e){o({type:d.E_ACTION.VB_SET_USER_PHOTOS,photos:Dc(e.items||[])})}))}),[]);var g=(0,l.useCallback)((function(e){var t=n.find((function(n){return n.id===e}));t&&(v.current.push(t),o({type:d.E_ACTION.VB_REMOVE_USER_PHOTO,photoId:e}))}),[n]),m=(0,l.useCallback)((function(){var e=v.current;return v.current=[],function(e,n){var t=e.map((function(e){return(0,qe.photosDelete)({photo_id:e.id})}));return Promise.allSettled(t).then((function(t){t.forEach((function(t,a){"fulfilled"===t.status&&n(e[a].id)}))}))}(e,c)}),[c]),A=(0,l.useCallback)((function(){var e=v.current;v.current=[];var t=n.concat(e);o({type:d.E_ACTION.VB_SET_USER_PHOTOS,photos:Dc(t)})}),[n]),C=(0,l.useCallback)((function(e){return h(!0),(0,qe.photosSaveBackgroundPhoto)(e).then((function(e){var n=e[0];if(!n)throw new Error("Something wrong with uploaded photo");return o({type:d.E_ACTION.VB_ADD_USER_PHOTO,photo:n}),t(n),s(n.id),n})).finally((function(){h(!1)}))}),[t,s]);return{photos:n,onAddBackground:C,onDeleteBackground:g,onSaveSettings:m,onCancelSettings:A,loadingUpload:f}};function Dc(e){return e.sort((function(e,n){return e.date<n.date?1:-1}))}var Rc,jc=function(e){var n=e.children,t=e.onClose,a=e.onSubmit,r=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(Qa.default,(0,i.__assign)({onClose:t,title:r("calls_warning"),appearance:"blue",className:"UploadBackgroundErrorModal",actionButtons:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:t,appearance:"tertiary"},{children:r("calls_cancel")}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:a},{children:r("calls_retry_action")}),void 0)]},void 0)},{children:(0,o.jsx)("div",(0,i.__assign)({className:"UploadBackgroundErrorModal__content"},{children:n}),void 0)}),void 0)},Bc=function(){var e=u(),n=(0,l.useContext)(E.LangContext).getLang,t=(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_VIRUTAL_BACKGROUND})}),[]),a=(0,l.useCallback)((function(){e({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_UPLOAD_BACKGROUND_PHOTO})}),[]);return(0,o.jsx)(jc,(0,i.__assign)({onClose:t,onSubmit:a},{children:n("calls_error_upload_background_image")}),void 0)},Uc=function(e){var n=e.children,t=e.onClose,a=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(Qa.default,(0,i.__assign)({onClose:t,title:a("calls_upload_image_for_background"),appearance:"blue",className:"UploadBackgroundPhotoModal",footerHint:a("calls_if_you_have_problems_with_upload")},{children:n}),void 0)},Hc=function(e){var n=e.onSubmit,t=e.loading,a=(0,l.useContext)(E.LangContext).getLang,r=(0,l.useRef)(null),s=function(e){var n=e.$inputEl,t=e.onSubmit,a=(0,i.__read)((0,l.useState)({}),2),o=a[0],r=a[1],s=(0,i.__read)((0,l.useState)(!1),2),c=s[0],d=s[1],u=(0,l.useCallback)((function(){n.current&&(n.current.onchange=function(e){var n;d(!1);var a=null===(n=e.target.files)||void 0===n?void 0:n[0];if(a){var i=new FileReader;i.onload=function(){var e=new Image;e.onload=function(){!function(e){return(e.width>=510||e.width>7e3)&&(e.height>=200||e.height>7e3)}(e)?d(!0):(r({file:a,image:e}),t&&t(a))},e.onerror=function(){return d(!0)},e.src=i.result},i.onerror=function(){return d(!0)},i.readAsDataURL(a)}},n.current.click())}),[]);return{error:c,fileData:o,onClick:u}}({$inputEl:r,onSubmit:n}),c=s.onClick,d=s.error,u=(0,l.useMemo)((function(){return(""+a("profile_oph_err_size")).replace("{sorry}","<b>"+a("global_sorry_error")+"</b>").replace("{min}","200").replace("{max}","7000")}),[]);return(0,o.jsxs)("div",(0,i.__assign)({className:"UploadBackgroundPhoto"},{children:[(0,o.jsx)("input",{ref:r,type:"file",className:"UploadBackgroundPhoto__upload"},void 0),d&&(0,o.jsxs)("div",(0,i.__assign)({className:"UploadBackgroundPhoto__error"},{children:[(0,o.jsx)("div",{className:"UploadBackgroundPhoto__error__left"},void 0),(0,o.jsx)("div",{className:"UploadBackgroundPhoto__error__right",dangerouslySetInnerHTML:{__html:u}},void 0)]}),void 0),(0,o.jsx)("div",{className:"UploadBackgroundPhoto__description",dangerouslySetInnerHTML:{__html:a("calls_you_can_upload_description")}},void 0),!t&&(0,o.jsx)("div",(0,i.__assign)({className:"UploadBackgroundPhoto__button"},{children:(0,o.jsx)(_i.default,(0,i.__assign)({onClick:c},{children:a("calls_choose_file")}),void 0)}),void 0),t&&(0,o.jsx)("div",{className:"UploadBackgroundPhoto__progress"},void 0)]}),void 0)},Vc=function(e){var n=e.onAddBackground,t=e.loading,a=u(),r=(0,l.useCallback)((function(){a({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_VIRUTAL_BACKGROUND})}),[]),s=(0,l.useCallback)((function(e){n(e).then(r).catch((function(){a({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_UPLOAD_BACKGROUND_ERROR})}))}),[r]);return(0,o.jsx)(Uc,(0,i.__assign)({onClose:r},{children:(0,o.jsx)(Hc,{loading:t,onSubmit:s},void 0)}),void 0)},Gc=(0,l.memo)((function(e){var n=e.SDK,t=(0,i.__read)((0,l.useState)(!1),2),a=t[0],r=t[1],s=P((function(e){return e.popup})),_=P((function(e){return e.virtualBackgroundSettings.photos})),v=P((function(e){return!!e.config.sferum})),p=function(e){var n=e.photos;return{backgroundList:(0,l.useMemo)((function(){return(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(n),!1),(0,i.__read)(uc),!1).map((function(e){return e instanceof cc?e.getMappedParams():{id:e.id,originalUrl:vc(e),previewUrl:(n=e,t=_c(n),(null==t?void 0:t.o)||(null==t?void 0:t.p)||(null==t?void 0:t.q)||(null==t?void 0:t.x)||(null==t?void 0:t.s)||""),isPredefined:!1};var n,t}))}),[n])}}({photos:_}).backgroundList,f=kc().onClose,h=function(){var e=(0,c.useSelector)((function(e){return e.localDevice.stream})),n=(0,c.useSelector)((function(e){return e.localDevice.mediaSettings}));return{userStream:e,isVideoEnabled:!!(null==n?void 0:n.isVideoEnabled)}}(),g=h.userStream,m=h.isVideoEnabled,A=function(e){var n=e.backgroundList,t=u(),a=(0,i.__read)((0,l.useState)(J),2),o=a[0],r=a[1],s=(0,l.useCallback)((function(e){switch(e){case d.EVideoEffectType.BLUR:r(e);break;case d.EVideoEffectType.ADD:t({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_UPLOAD_BACKGROUND_PHOTO});break;case d.EVideoEffectType.NONE:r(e);break;default:n.some((function(n){return n.id===e}))&&r(e)}}),[n]),c=(0,l.useRef)(null),_=(0,l.useCallback)((function(e){return c.current=e}),[]);return(0,l.useEffect)((function(){c.current&&(s(c.current.id),c.current=null)}),[s]),{chosen:o,setChosen:r,onClick:s,onSuccessPhotoUpload:_}}({backgroundList:p}),C=A.chosen,E=A.setChosen,S=A.onClick,I=A.onSuccessPhotoUpload,T=Lc({photos:_,onSuccessPhotoUpload:I,isSferum:v}),x=T.onCancelSettings,y=T.loadingUpload,N=T.onAddBackground,b=T.onDeleteBackground,M=T.onSaveSettings,w=function(e){var n=e.SDK,t=(0,l.useMemo)((function(){return{background:new sc,blur:new lc,effect:new Kl({debug:!0})}}),[]);(0,l.useEffect)((function(){return n.setVideoEffects(t.effect),function(){t.effect.destroy()}}),[]);var a=(0,l.useCallback)((function(e){switch(e.type){case d.EVideoEffectType.BACKGROUND:t.background.setBackgroundImage(e.value).then((function(){n.changeVideoEffect(t.background)}));break;case d.EVideoEffectType.BLUR:n.changeVideoEffect(t.blur);break;case d.EVideoEffectType.NONE:n.changeVideoEffect(null);case d.EVideoEffectType.ADD:}}),[]);return{onSettingsChange:a}}({SDK:n}).onSettingsChange;!function(e){var n=e.userStream,t=e.onSettingsChange,a=e.backgroundList,i=e.isVideoEnabled,o=Pc(),r=o.sendVirtualBackgroundSelected,s=o.sendVirtualBackgroundDisabled;(0,l.useEffect)((function(){if(n){var e=J();i?"number"==typeof e?pc(e,a).then((function(n){n&&(t({type:d.EVideoEffectType.BACKGROUND,value:n.url}),r(n.id,e))})):e===d.EVideoEffectType.BLUR&&(t({type:d.EVideoEffectType.BLUR}),r(d.VIRTUAL_BACKGROUND_BLUR_ID,e)):(t({type:d.EVideoEffectType.NONE}),s(e))}}),[n,i])}({onSettingsChange:w,userStream:g,backgroundList:p,isVideoEnabled:m});var O=function(e){var n=e.chosen,t=e.settingsOpened,a=e.onSettingsChange,i=e.setChosen,o=e.backgroundList,r=e.isVideoEnabled,s=Pc(),c=s.sendVirtualBackgroundSelected,u=s.sendVirtualBackgroundDisabled,_=(0,l.useRef)(null);return(0,l.useEffect)((function(){t&&(_.current=n)}),[t]),{onApplySettings:(0,l.useCallback)((function(){if(_.current!==n){var e=J();X(n),"number"==typeof n?pc(n,o).then((function(n){n&&(a({type:d.EVideoEffectType.BACKGROUND,value:n.url}),r&&c(n.id,e))})):n===d.EVideoEffectType.BLUR?(a({type:d.EVideoEffectType.BLUR}),r&&c(d.VIRTUAL_BACKGROUND_BLUR_ID,e)):n===d.EVideoEffectType.NONE&&(a({type:d.EVideoEffectType.NONE}),r&&u(e))}}),[a,o,n,c,u,r]),onRestoreSettings:(0,l.useCallback)((function(){_.current&&i(_.current)}),[i])}}({chosen:C,onSettingsChange:w,settingsOpened:a,setChosen:E,backgroundList:p,isVideoEnabled:m}),k=O.onRestoreSettings,L=O.onApplySettings,D=ne(),R=D.videoOptions,j=D.onRestoreSettings,B=D.onSaveSettings,U=D.onChangeVideoOption;(0,l.useEffect)((function(){ee()}),[]),(0,l.useEffect)((function(){s!==d.POPUP_VIRUTAL_BACKGROUND||a||r(!0)}),[s]);var H=(0,l.useCallback)((function(){M(),f(),r(!1),L(),B()}),[M,f,L,B]),V=(0,l.useCallback)((function(){x(),f(),r(!1),k(),j()}),[x,f,k,j]);return(0,o.jsxs)(o.Fragment,{children:[s===d.POPUP_VIRUTAL_BACKGROUND&&(0,o.jsx)(gl,(0,i.__assign)({onClose:V,onSubmit:H,onChangeVideoOption:U,videoOptions:R},{children:(0,o.jsx)(wc,{chosen:C,backgroundList:p,onDeleteBackground:b,onChooseBackground:S,videoOptions:R,isSferum:v},void 0)}),void 0),s===d.POPUP_UPLOAD_BACKGROUND_PHOTO&&(0,o.jsx)(Vc,{onAddBackground:N,loading:y},void 0),s===d.POPUP_UPLOAD_BACKGROUND_ERROR&&(0,o.jsx)(Bc,{},void 0)]},void 0)})),Fc=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallUserIconGradient)"},void 0),(0,o.jsx)("path",{d:"M17.25 10.25a3.25 3.25 0 1 0-6.5 0 3.25 3.25 0 1 0 6.5 0ZM7.5 18.462v.7c0 .463.375.838.838.838h11.325a.838.838 0 0 0 .837-.837v-.701C20.5 15.769 16.17 15 14 15s-6.5.77-6.5 3.462Z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallUserIconGradient",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#70B2FF"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#5C9CE6"},void 0)]}),void 0)},void 0)]}),void 0)},Zc=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallWaitingHallIconGradient)"},void 0),(0,o.jsx)("path",{d:"M13.85 6.85h1.072c1.529 0 2.095.127 2.657.428.493.263.88.65 1.143 1.143.3.562.428 1.129.428 2.657v5.842c0 1.528-.127 2.098-.428 2.66a2.74 2.74 0 0 1-1.143 1.14c-.562.3-1.128.43-2.657.43H13.85",stroke:"#fff",strokeWidth:"1.7",strokeLinecap:"round"},void 0),(0,o.jsx)("path",{d:"M10.85 10.85 14 14l-3.15 3.15M6.85 14h6.6",stroke:"#fff",strokeWidth:"1.7",strokeLinecap:"round",strokeLinejoin:"round"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallWaitingHallIconGradient",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#50C750"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#32B332"},void 0)]}),void 0)},void 0)]}),void 0)},Wc=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallAnonymousIconGradient)"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"m9.52 10.906.503-2.328A2 2 0 0 1 11.978 7h4.044a2 2 0 0 1 1.955 1.578l.503 2.328a.916.916 0 0 1 .015.094H20a1 1 0 1 1 0 2H8a1 1 0 1 1 0-2h1.505a.902.902 0 0 1 .015-.094Zm3.447 7a2.5 2.5 0 1 1-.217-1.497 4.984 4.984 0 0 1 2.5 0 2.5 2.5 0 1 1-.217 1.498 3.488 3.488 0 0 0-2.066 0Z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallAnonymousIconGradient",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#99A2AD"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#99A2AD"},void 0)]}),void 0)},void 0)]}),void 0)},zc=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallCameraIcon)"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.772 10.865C7.5 11.4 7.5 12.1 7.5 13.5v1c0 1.4 0 2.1.272 2.635a2.5 2.5 0 0 0 1.093 1.092c.535.273 1.235.273 2.635.273h2c1.4 0 2.1 0 2.635-.273a2.5 2.5 0 0 0 1.092-1.092c.273-.535.273-1.235.273-2.635v-1c0-1.4 0-2.1-.273-2.635a2.5 2.5 0 0 0-1.092-1.093C15.6 9.5 14.9 9.5 13.5 9.5h-2c-1.4 0-2.1 0-2.635.272a2.5 2.5 0 0 0-1.093 1.093Zm10.95 1.487 1.876-1.25a.58.58 0 0 1 .902.482v4.832a.58.58 0 0 1-.902.483l-1.875-1.25a.5.5 0 0 1-.223-.417v-2.464a.5.5 0 0 1 .223-.416Z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallCameraIcon",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#FF5263"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#FF3347"},void 0)]}),void 0)},void 0)]}),void 0)},Kc=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsx)("circle",{cx:"14",cy:"14",r:"14",fill:"url(#CreateCallMicrophoneIcon)"},void 0),(0,o.jsx)("path",{d:"M11.498 10.5c0-1.38 1.12-2.5 2.502-2.5a2.501 2.501 0 0 1 2.503 2.5v3c0 1.38-1.12 2.5-2.503 2.5a2.501 2.501 0 0 1-2.502-2.5v-3Z",fill:"#fff"},void 0),(0,o.jsx)("path",{d:"M9.194 13.767a.75.75 0 0 1 .891.576 4.005 4.005 0 0 0 7.83 0 .75.75 0 0 1 1.468.314 5.508 5.508 0 0 1-4.632 4.292v1.301a.75.75 0 0 1-1.502 0v-1.3a5.508 5.508 0 0 1-4.632-4.293.75.75 0 0 1 .577-.89Z",fill:"#fff"},void 0),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",(0,i.__assign)({id:"CreateCallMicrophoneIcon",x1:"0",y1:"0",x2:"28.733",y2:".773",gradientUnits:"userSpaceOnUse"},{children:[(0,o.jsx)("stop",{stopColor:"#FF5263"},void 0),(0,o.jsx)("stop",{offset:"1",stopColor:"#FF3347"},void 0)]}),void 0)},void 0)]}),void 0)},Qc=function(e){var n=e.actionButtons,t=e.onClose,a=e.ownerOptions,r=e.selectedOwnerId,s=e.waitingHall,l=e.allowAnon,c=e.onGroupSelectChange,d=e.onChangeWaitingHall,u=e.onChangeAllowAnon,_=e.microphoneOptions,v=e.cameraOptions,p=e.onMicrophoneSelectChange,f=e.onCameraSelectChange,h=e.selectedMicrophoneOption,g=e.selectedCameraOption,m=ze().getLang;return(0,o.jsxs)(I.default,(0,i.__assign)({className:"CreateCallByLinkModal",onClose:t,disableBodyScroll:!0},{children:[(0,o.jsx)(yr.ModalHeader,{title:m("calls_create_call_by_link_title"),onClose:t},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CreateCallByLinkModal__content"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CreateCallByLinkModal__description"},{children:m("calls_create_call_by_link_description")}),void 0),(0,o.jsxs)(Ja.default,{children:[(0,o.jsx)(Xa.default,(0,i.__assign)({border:!0,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(Fc,{},void 0),aside:(0,o.jsx)(ur.default,{className:"CreateCallByLinkModalOptions__longselect",options:a,value:r,onChange:c,disabled:a.length<=1},void 0)},{children:m("calls_create_call_by_link_by_name")}),void 0),(0,o.jsx)(ro,(0,i.__assign)({canBeHovered:!1,onClick:d,icon:(0,o.jsx)(Zc,{},void 0),hint:m("calls_menu_waiting_hall_description"),aside:(0,o.jsx)(ie.default,{onChange:d,checked:s},void 0)},{children:m("calls_menu_waiting_hall_title")}),void 0),(0,o.jsx)(ro,(0,i.__assign)({canBeHovered:!1,onClick:u,icon:(0,o.jsx)(Wc,{},void 0),hint:m("calls_create_call_by_link_anon_hint_shedule"),aside:(0,o.jsx)(ie.default,{onChange:u,checked:l},void 0)},{children:m("calls_create_call_by_link_anon")}),void 0),(0,o.jsx)(Xa.default,(0,i.__assign)({border:!0,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(Kc,{},void 0),aside:(0,o.jsx)(ur.default,{className:"CreateCallByLinkModalOptions__longselect",options:_,value:h,onChange:p},void 0)},{children:m("calls_create_call_by_link_microphones")}),void 0),(0,o.jsx)(Xa.default,(0,i.__assign)({border:!0,canBeHovered:!1,selectable:!1,icon:(0,o.jsx)(zc,{},void 0),aside:(0,o.jsx)(ur.default,{className:"CreateCallByLinkModalOptions__longselect",options:v,value:g,onChange:f},void 0)},{children:m("calls_create_call_by_link_cameras")}),void 0)]},void 0)]}),void 0),(0,o.jsx)(dl.ModalFooter,{actionButtons:n},void 0)]}),void 0)},Yc=function(e){var n=e.bridge,t=(0,c.useSelector)((function(e){return e})),a=u(),r=ze().getLang,s=t.participants[t.me],_=(0,i.__read)((0,l.useState)(s.peerId),2),v=_[0],p=_[1],f=(0,i.__read)((0,l.useState)([{value:s.peerId,label:s.name}]),2),h=f[0],g=f[1],m=(0,i.__read)((0,l.useState)(!1),2),A=m[0],C=m[1],E=(0,i.__read)((0,l.useState)(!0),2),S=E[0],I=E[1],T=(0,i.__read)((0,l.useState)(G.MuteState.UNMUTE),2),x=T[0],y=T[1],N=(0,i.__read)((0,l.useState)(G.MuteState.UNMUTE),2),b=N[0],M=N[1];(0,l.useEffect)((function(){(0,qe.getGroupsForCall)().then((function(e){var n=(0,i.__spreadArray)([],(0,i.__read)(h),!1);e.count>0&&(e.items.forEach((function(e){n.push({value:-e.id,label:e.name||""})})),g(n))}))}),[]);var w=(0,l.useCallback)((function(e){p(Number(e.selected.value))}),[]),O=(0,l.useCallback)((function(e){void 0!==e&&(e.preventDefault(),C(!A))}),[A]),P=(0,l.useCallback)((function(e){void 0!==e&&(e.preventDefault(),I(!S))}),[S]),k=(0,l.useCallback)((function(){a({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})}),[]),L=(0,l.useCallback)((function(){var e,a={};S||(a[G.ConversationOption.REQUIRE_AUTH_TO_JOIN]=!0),A&&(a[G.ConversationOption.WAITING_HALL]=!0);var i={};x!==G.MuteState.UNMUTE&&(i[G.MediaOption.AUDIO]=x),b!==G.MuteState.UNMUTE&&(i[G.MediaOption.VIDEO]=b,i[G.MediaOption.SCREEN_SHARING]=b),n.startCall(!1,null!==(e=t.entryPoint)&&void 0!==e?e:d.CallStatSource.HISTORY_CREATE,!1,v>0?0:v,{conversationOptions:a,createLink:!0,mediaOptions:i})}),[v,A,S,x,b]),D=[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:k,appearance:"tertiary"},{children:r("calls_cancel")}),"cancel"),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:L},{children:r("calls_create_call_by_link")}),"call")],R=[{value:G.MuteState.UNMUTE,label:r("calls_create_call_by_link_phone_option_allow_always")},{value:G.MuteState.MUTE,label:r("calls_create_call_by_link_phone_option_disallow_entrance")},{value:G.MuteState.MUTE_PERMANENT,label:r("calls_create_call_by_link_phone_option_disallow_always")}],j=function(e){var n=G.MuteState.UNMUTE;return e==G.MuteState.MUTE?n=G.MuteState.MUTE:e==G.MuteState.MUTE_PERMANENT&&(n=G.MuteState.MUTE_PERMANENT),n},B=(0,l.useCallback)((function(e){y(j(String(e.selected.value)))}),[]),U=(0,l.useCallback)((function(e){M(j(String(e.selected.value)))}),[]);return(0,o.jsx)(Qc,{actionButtons:D,onClose:k,ownerOptions:h,selectedOwnerId:v,waitingHall:A,allowAnon:S,onGroupSelectChange:w,onChangeWaitingHall:O,onChangeAllowAnon:P,microphoneOptions:R,cameraOptions:R,onMicrophoneSelectChange:B,onCameraSelectChange:U,selectedMicrophoneOption:x,selectedCameraOption:b},void 0)},Jc=function(e){var n=e.onClose,t=e.title,a=e.description,r=e.btnText;return(0,o.jsx)(Qa.default,(0,i.__assign)({className:"OnHangupModal",onClose:n,title:t,appearance:"blue",actionButtons:(0,o.jsx)(_i.default,(0,i.__assign)({onClick:n},{children:r}),void 0)},{children:(0,o.jsx)("div",(0,i.__assign)({className:"OnHangupModal__description"},{children:a}),void 0)}),void 0)},Xc=function(){var e=(0,Ae.useLang)().getLang,n=kc().onClose,t=(0,c.useSelector)((function(e){return e.popup})),a=(0,c.useSelector)((function(e){var n;return null===(n=e.lastCallData)||void 0===n?void 0:n.opponentName})),i=(0,c.useSelector)((function(e){var n;return null===(n=e.lastCallData)||void 0===n?void 0:n.isMeEndedCallForAll})),r=u(),s="",_="",v=e("calls_close"),p=!1;switch(t){case d.POPUP_ON_CALL_HANGUP_BUSY:s=e("calls_user_busy"),_=e("calls_user_busy_description").replace("{username}",a||e("calls_opponent"));break;case d.POPUP_ON_CALL_HANGUP_KILLED:if(i){p=!0;break}s=e("calls_join_error_not_found_conversation"),_=e("calls_admin_ended_call_for_everyone");break;case d.POPUP_ON_CALL_HANGUP_KILLED_WITHOUT_DELETE:if(i){p=!0;break}s=e("calls_meeting_ended_title"),_=e("calls_meeting_ended_desc"),v=e("calls_warning_ok");break;case d.POPUP_ON_CALL_HANGUP_BANNED:s=e("calls_call_is_interrupted"),_=e("calls_you_have_been_banned");break;case d.POPUP_ON_CALL_HANGUP_REMOVED:s=e("calls_call_is_interrupted"),_=e("calls_you_have_been_kicked")}return(0,l.useEffect)((function(){return function(){r({type:d.E_ACTION.CLEAN_LAST_CALL_DATA})}}),[]),(0,l.useEffect)((function(){p&&n()}),[p,n]),p?null:(0,o.jsx)(Jc,{onClose:n,title:s,description:_,btnText:v},void 0)};!function(e){e[e.Wall=0]="Wall",e[e.Community=1]="Community",e[e.History=2]="History",e[e.IM=3]="IM"}(Rc||(Rc={}));var qc=function(){return(0,o.jsx)("svg",(0,i.__assign)({width:"11",height:"6",viewBox:"0 0 11 6",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:(0,o.jsx)("path",{d:"M0.75 0.75L5.5 5.25L10.25 0.75",stroke:"#AEB7C2",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},void 0)}),void 0)},$c=t(11798),ed=function(e){var n=e.id,t=e.onClick,a=e.text,r=e.type,l=void 0===r?"regular":r;return(0,o.jsxs)("span",(0,i.__assign)({className:(0,s.classNames)("TokenInput__token",{"TokenInput__token--add":"add"===l}),onClick:"add"===l?function(){return t()}:void 0},{children:[(0,o.jsx)("span",(0,i.__assign)({className:"TokenInput__label"},{children:a}),void 0),(0,o.jsx)("button",(0,i.__assign)({"data-id":n,className:"TokenInput__remove",onClick:function(){return t(n)}},{children:(0,o.jsx)($c.default,{},void 0)}),void 0)]}),n)},nd="https://vk.com/images/icons/im_multichat_50.png",td=function(){},ad=function(e,n){var t=Array.isArray(e)?e.find((function(e){return e.id===n})):e;return t&&t.photo_50||nd},id=function(e,n){var t,a;switch(e.conversation.peer.type){case"chat":return(null===(a=null===(t=e.conversation.chat_settings)||void 0===t?void 0:t.photo)||void 0===a?void 0:a.photo_50)||nd;case"user":return ad(n,e.conversation.peer.id);default:return nd}},od=function(e,n){var t=Array.isArray(e)?e.find((function(e){return e.id===n})):e;if(!t||!t.first_name)return"";var a=t.first_name;return t.last_name&&(a+=" "+t.last_name),a},rd=function(e,n){var t;switch(e.conversation.peer.type){case"chat":return(null===(t=e.conversation.chat_settings)||void 0===t?void 0:t.title)||"";case"user":return od(n,e.conversation.peer.id);default:return""}},sd=(0,l.forwardRef)((function(e,n){var t=e.handleAddToken,a=e.handleChange,r=e.handleRemoveToken,c=e.handleSelect,d=e.opened,u=e.tokens,_=e.value,v=e.filteredOptions,p=e.onClickAway,f=e.loading,h=(0,Ae.useLang)().getLang,g=function(e){var n=e.ref,t=e.onClickAway,a=(0,l.useCallback)((function(e){var a;switch(e.code){case"Escape":n&&"function"!=typeof n&&(null===(a=n.current)||void 0===a||a.blur()),t();break;case"Tab":t()}}),[n,t]);return{handleClickAway:a}}({ref:n,onClickAway:p}).handleClickAway;return(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("ModalSendMessage__MultiSelect",{"ModalSendMessage__MultiSelect--hidden":!!f&&!v.length})},{children:(0,o.jsx)(Vi.default,{opened:d,placeholder:h("calls_enter_recipient_or_dialog_name"),removeTokenPlaceholder:"Remove",disableEmptyList:!!f,tokens:u,hasMore:!1,onChange:a,value:_,onSelect:c,onRemoveToken:r,disableOnSelectInputFocus:!0,hideInputWithName:!0,renderInput:function(){return(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("TokenInput","ModalSendMessage__TokenInput",{"ModalSendMessage__TokenInput--opened":d&&!f}),onClick:t},{children:[u.map((function(e){return(0,o.jsx)(ed,(0,i.__assign)({},e,{onClick:r}),e.id)})),!(!u.length||d)&&(0,o.jsx)(ed,{id:"token-add",text:h("calls_add"),type:"add",onClick:td},"token-add"),(!u.length||d)&&(0,o.jsx)("input",{ref:n,className:"ModalSendMessage__input",type:"text",value:_,onChange:a,onKeyDown:g,placeholder:h("calls_enter_recipient_or_dialog_name")},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"ModalSendMessage__angle-icon"},{children:(0,o.jsx)(qc,{},void 0)}),void 0)]}),void 0)},renderSuggest:function(e){return(0,o.jsx)(ui.default,{"data-id":e.id,photo:e.photo,title:e.text,onClick:function(){return c(e.id)}},e.id)},data:v,notFoundText:h("calls_search_empty_list")},void 0)}),void 0)})),ld=function(e){var n=e.options,t=e.onChangeInput,a=(0,i.__read)((0,l.useState)(""),2),o=a[0],r=a[1],s=(0,i.__read)((0,l.useState)(!1),2),c=s[0],d=s[1],u=(0,i.__read)((0,l.useState)([]),2),_=u[0],v=u[1],p=(0,i.__read)((0,l.useState)((function(){return(0,i.__spreadArray)([],(0,i.__read)(n),!1)})),2),f=p[0],h=p[1],g=(0,l.useRef)(null),m=(0,l.useCallback)((function(){d(!1),r("")}),[]);(0,l.useEffect)((function(){null==t||t(o)}),[o]),(0,l.useEffect)((function(){h(function(e,n,t){var a=t.reduce((function(e,n){return e[n.id]=!0,e}),{}),i=e.toLowerCase();return n.filter((function(e){return!a[e.id]&&e.text.toLowerCase().includes(i)}))}(o,n,_))}),[o,n,_]),function(e){var n=e.selector,t=e.opened,a=e.onClose;(0,l.useEffect)((function(){if(t){var e=function(e){var t=e.target;t instanceof HTMLElement&&(t.closest(n)||a(!1))};return document.addEventListener("click",e),function(){document.removeEventListener("click",e)}}}),[t])}({selector:".ModalSendMessage__MultiSelect",onClose:m,opened:c});var A=(0,l.useCallback)((function(e){var n=e.target.value;r(n),d(!0)}),[]),C=(0,l.useCallback)((function(e){var t=n.find((function(n){return n.id===e}));return t&&v((function(e){var n=new Set(e);return n.add({id:t.id,text:t.text,src:t.photo}),(0,i.__spreadArray)([],(0,i.__read)(n),!1)})),d(!1),r(""),Promise.resolve()}),[n]),E=(0,l.useCallback)((function(e){v((function(n){return n.filter((function(n){return n.id!==e}))})),d(!1)}),[]),S=(0,l.useCallback)((function(e){var n,t=e.target,a=null===(n=t.closest)||void 0===n?void 0:n.call(t,".TokenInput__token");a&&!a.classList.contains("TokenInput__token--add")||(d(!0),r(""),requestAnimationFrame((function(){var e;null===(e=g.current)||void 0===e||e.focus()})))}),[_,n]);return{ref:g,filteredOptions:f,handleAddToken:S,handleChange:A,handleRemoveToken:E,handleSelect:C,onClickAway:m,opened:c,options:n,tokens:_,value:o}},cd=function(e){var n=e.onClose,t=e.title,a=e.onSubmit,r=e.optionsIM,s=e.submitDisabled,c=e.initialText,d=e.onChangeInputIM,u=e.loading,_=(0,Ae.useLang)().getLang,v=(0,i.__read)((0,l.useState)(c||""),2),p=v[0],f=v[1],h=(0,i.__read)((0,l.useState)(Rc.IM),1)[0],g=ld({options:r,onChangeInput:d}),m=(0,l.useCallback)((function(e){var n=e.target.value;f(n)}),[]),A=(0,l.useCallback)((function(){switch(h){case Rc.IM:var e=g.tokens.map((function(e){return e.id}));if(!e.length||!p)break;a({text:p,ids:e,destination:h})}}),[p,g.tokens,a,h]),C=!p||!g.tokens.length;return(0,o.jsx)(Qa.default,(0,i.__assign)({className:"ModalSendMessage",onClose:n,title:t,actionButtons:(0,o.jsx)(_i.default,(0,i.__assign)({appearance:"primary",onClick:A,disabled:C||s},{children:_("calls_send")}),void 0),disableEscapeClose:!0,disableBodyScroll:!0},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"ModalSendMessage__Main"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"ModalSendMessage__Destination"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"ModalSendMessage__RadioDestination"},{children:(0,o.jsx)(sd,(0,i.__assign)({loading:u},g),void 0)}),void 0)}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"ModalSendMessage__Message"},{children:[(0,o.jsx)("p",(0,i.__assign)({className:"ModalSendMessage__Message__title"},{children:_("calls_your_message")}),void 0),(0,o.jsx)(ks.default,{value:p,onChange:m},void 0)]}),void 0)]}),void 0)}),void 0)},dd=t(73521),ud=t(84356),_d=function(){var e=(0,Ae.useLang)().getLang,n=(0,ud.usePromiseError)().handleError,t=u(),a=(0,i.__read)((0,l.useState)(!1),2),r=a[0],s=a[1],c=P((function(e){var n;return null===(n=e.misc)||void 0===n?void 0:n.plannedCalendarEvent})),_=function(){var e=(0,ud.usePromiseError)().handleError,n=(0,l.useRef)([]),t=(0,l.useRef)([]),a=(0,i.__read)((0,l.useState)([]),2),o=a[0],r=a[1],s=(0,i.__read)((0,l.useState)([]),2),c=s[0],d=s[1],u=(0,i.__read)((0,l.useState)(!1),2),_=u[0],v=u[1],p=(0,Gt.useIsMounted)(),f=(0,l.useRef)(null),h=P((function(e){var n;return+((null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me)})),g=vd(),m=vd(),A=(0,l.useCallback)((function(a){f.current&&clearTimeout(f.current);var o=m.getId();if(!a||a.length<=2)return d(n.current),void r(t.current);var s=g.getId();f.current=setTimeout((function(){v(!0),Promise.allSettled([(0,qe.messagesSearch)({q:a}),(0,qe.friendsSearch)(h,a,20)]).then((function(e){var a=(0,i.__read)(e,2),s=a[0],l=a[1];if(p()&&o===m.prevId.current){var c,u;if("fulfilled"===s.status)(c=s.value).count&&c.conversations?r(c.conversations.map((function(e){var n,t,a;return{id:e.peer.id.toString(),photo:(null===(t=null===(n=e.chat_settings)||void 0===n?void 0:n.photo)||void 0===t?void 0:t.photo_50)||nd,text:(null===(a=e.chat_settings)||void 0===a?void 0:a.title)||""}}))):r(t.current);if("fulfilled"===l.status)(c=l.value).count?d((void 0===(u=c.items)&&(u=[]),u.map((function(e){return{id:e.id.toString(),photo:ad(e,e.id),text:od(e,e.id)}})))):d(n.current)}})).catch(e).finally((function(){p()&&s===g.prevId.current&&v(!1)}))}),300)}),[]);return(0,l.useEffect)((function(){v(!0),(0,qe.messagesGetConversations)().then((function(e){if(p()){var n=function(e,n){var t,a;void 0===n&&(n=[]);var o=[];try{for(var r=(0,i.__values)(e),s=r.next();!s.done;s=r.next()){var l=s.value;"chat"===l.conversation.peer.type&&o.push({id:l.conversation.peer.id.toString(),photo:id(l,n),text:rd(l,n)})}}catch(e){t={error:e}}finally{try{s&&!s.done&&(a=r.return)&&a.call(r)}finally{if(t)throw t.error}}return o}(e.items,e.profiles);t.current=n,r(n)}})).catch(e).finally((function(){p()&&v(!1)}))}),[]),{conversations:(0,l.useMemo)((function(){return(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(c),!1),(0,i.__read)(o),!1)}),[o,c]),loading:_,fetchSearchFriends:A}}(),v=_.conversations,p=_.fetchSearchFriends,f=_.loading,h=vd().getId,g=kc().onClosePopupCalendar,m=P((function(e){var n;return e.participants[(null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me]})),A=(0,dd.useCalendarEventDetails)({meParticipant:m}),C=(0,Gt.useIsMounted)(),E=(0,l.useCallback)((function(e){if(e)return s(!0),e.destination===Rc.IM?Promise.allSettled(e.ids.map((function(n){return(0,qe.messagesSend)({peer_id:+n,message:e.text,random_id:h()})}))).then(g).catch(n).finally((function(){C()&&s(!1)})):void 0}),[]),S=(0,l.useCallback)((function(){t({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_SHARE_PLANNED_CALL})}),[t]);return(0,o.jsx)(cd,{onClose:S,onSubmit:E,optionsIM:v,title:e("calls_send_call_link_title"),submitDisabled:r,initialText:A.getDescription(c),onChangeInputIM:p,loading:f},void 0)};function vd(){var e=(0,l.useRef)(0);return e.current||(e.current=Date.now()),{getId:(0,l.useCallback)((function(){return e.current=Date.now(),e.current}),[]),prevId:e}}var pd=t(49336),fd=function(){return(0,o.jsxs)("svg",(0,i.__assign)({width:"40",height:"46",viewBox:"0 0 40 46",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:[(0,o.jsx)("path",{d:"M30.5607 17.4393C31.1464 18.0251 31.1464 18.9749 30.5607 19.5607L18.5607 31.5607C17.9749 32.1464 17.0251 32.1464 16.4393 31.5607L10.4393 25.5607C9.85355 24.9749 9.85355 24.0251 10.4393 23.4393C11.0251 22.8536 11.9749 22.8536 12.5607 23.4393L17.5 28.3787L28.4393 17.4393C29.0251 16.8536 29.9749 16.8536 30.5607 17.4393Z",fill:"var(--accent)"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 1.5C12 0.671573 11.3284 0 10.5 0C9.67157 0 9 0.671573 9 1.5V3.10786L8.92347 3.11398C7.49669 3.23055 6.28944 3.47376 5.18709 4.03544C3.39955 4.94624 1.94624 6.39955 1.03544 8.18709C0.473764 9.28944 0.230548 10.4967 0.113976 11.9235C-2.00495e-05 13.3187 -1.09936e-05 15.0497 2.21849e-07 17.234V31.766C-1.09936e-05 33.9503 -2.00495e-05 35.6813 0.113976 37.0765C0.230548 38.5033 0.473764 39.7106 1.03544 40.8129C1.94624 42.6004 3.39955 44.0538 5.18709 44.9646C6.28944 45.5262 7.49669 45.7695 8.92347 45.886C10.3187 46 12.0497 46 14.234 46H25.766C27.9503 46 29.6813 46 31.0765 45.886C32.5033 45.7695 33.7106 45.5262 34.8129 44.9646C36.6004 44.0538 38.0538 42.6004 38.9646 40.8129C39.5262 39.7106 39.7695 38.5033 39.886 37.0765C40 35.6813 40 33.9503 40 31.766V17.234C40 15.0497 40 13.3187 39.886 11.9235C39.7695 10.4967 39.5262 9.28944 38.9646 8.18709C38.0538 6.39955 36.6004 4.94624 34.8129 4.03544C33.7106 3.47376 32.5033 3.23055 31.0765 3.11398C31.0511 3.1119 31.0256 3.10986 31 3.10786V1.5C31 0.671573 30.3284 0 29.5 0C28.6716 0 28 0.671573 28 1.5V3.00568C27.3129 2.99999 26.5702 3 25.766 3H21.5V1.5C21.5 0.671573 20.8284 0 20 0C19.1716 0 18.5 0.671573 18.5 1.5V3H14.234C13.4299 3 12.6871 2.99999 12 3.00568V1.5ZM28 6.0059C27.3158 6.00017 26.5546 6 25.7 6H21.5V7.5C21.5 8.32843 20.8284 9 20 9C19.1716 9 18.5 8.32843 18.5 7.5V6H14.3C13.4454 6 12.6842 6.00017 12 6.0059V7.5C12 8.32843 11.3284 9 10.5 9C9.67157 9 9 8.32843 9 7.5V6.11854C7.85638 6.22335 7.13009 6.41241 6.54906 6.70846C5.32601 7.33163 4.33164 8.32601 3.70846 9.54906C3.39819 10.158 3.20543 10.9265 3.10401 12.1678C3.00117 13.4265 3 15.035 3 17.3V31.7C3 33.965 3.00117 35.5735 3.10401 36.8322C3.20543 38.0735 3.39819 38.842 3.70846 39.4509C4.33164 40.674 5.32601 41.6684 6.54906 42.2915C7.15801 42.6018 7.92651 42.7946 9.16776 42.896C10.4265 42.9988 12.035 43 14.3 43H25.7C27.965 43 29.5735 42.9988 30.8322 42.896C32.0735 42.7946 32.842 42.6018 33.4509 42.2915C34.674 41.6684 35.6684 40.674 36.2915 39.4509C36.6018 38.842 36.7946 38.0735 36.896 36.8322C36.9988 35.5735 37 33.965 37 31.7V17.3C37 15.035 36.9988 13.4265 36.896 12.1678C36.7946 10.9265 36.6018 10.158 36.2915 9.54906C35.6684 8.32601 34.674 7.33163 33.4509 6.70846C32.8699 6.41241 32.1436 6.22335 31 6.11854V7.5C31 8.32843 30.3284 9 29.5 9C28.6716 9 28 8.32843 28 7.5V6.0059Z",fill:"var(--accent)"},void 0)]}),void 0)},hd=function(e){var n=e.onClose,t=e.text,a=e.onCopyLink,r=e.onCopyText,s=e.onSendByMessage,l=(0,Ae.useLang)().getLang;return(0,o.jsx)(pd.BaseModal,(0,i.__assign)({className:"CallsModalEventPlanned",onClose:n,enableCrossButton:!0,disableBodyScroll:!0},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallsModalEventPlanned__wrap"},{children:[(0,o.jsx)(fd,{},void 0),(0,o.jsx)("h3",(0,i.__assign)({className:"CallsModalEventPlanned__title"},{children:l("calls_event_planned")}),void 0),(0,o.jsx)("textarea",{className:"CallsModalEventPlanned__preview",value:t,readOnly:!0},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsModalEventPlanned__buttons"},{children:[(0,o.jsx)(_i.default,(0,i.__assign)({appearance:"primary",onClick:r},{children:l("calls_copy_invite_text")}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({appearance:"link",onClick:a},{children:l("calls_copy_invite_link")}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({appearance:"link",onClick:s},{children:l("calls_send_text_by_im")}),void 0)]}),void 0)]}),void 0)}),void 0)},gd=t(209),md=function(){var e=(0,ud.usePromiseError)().handleError,n=(0,Ae.useLang)().getLang,t=(0,gd.useNotifier)().showText,a=u(),i=P((function(e){var n;return e.participants[(null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me]})),r=kc().onClosePopupCalendar,l=(0,dd.useCalendarEventDetails)({meParticipant:i}),c=P((function(e){var n;return null===(n=e.misc)||void 0===n?void 0:n.plannedCalendarEvent})),_=l.getDescription(c);return c?(0,o.jsx)(hd,{onClose:r,text:_,onCopyLink:function(){c?(0,s.copyTextToClipboard)(c.join_link).then((function(){t(n("calls_create_call_by_link_copied"))})).catch(e):(0,Nr.handlePromiseError)("No event stored is store to copy :(")},onCopyText:function(){c?(0,s.copyTextToClipboard)(_).then((function(){t(n("calls_create_call_by_link_text_copied"))})).catch(e):(0,Nr.handlePromiseError)("No event stored is store to copy :(")},onSendByMessage:function(){a({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_ON_CALL_SEND_LINK})}},void 0):null},Ad=t(37184),Cd=t(62833),Ed=t(82659),Sd=t(86969),Id=function(){var e=kc().onClosePopupCalendar,n=(0,Ae.useLang)().getLang,t=function(){var e=u(),n=P((function(e){var n;return e.participants[(null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me]})),t=P((function(e){var n;return null===(n=e.misc)||void 0===n?void 0:n.plannedCalendarEventOwnerOptions})),a=(0,l.useMemo)((function(){var e={value:n.peerId,label:n.name,profile:(0,i.__assign)((0,i.__assign)({},n),{id:n.peerId})};return(0,i.__spreadArray)([e],(0,i.__read)(t||[]),!1)}),[t,n]);return(0,l.useEffect)((function(){(0,qe.getGroupsForCall)().then((function(n){if(n.count>0){var t=(n.items||[]).map((function(e){return{value:-e.id,label:e.name||"",profile:e}}));e({type:d.E_ACTION.SET_PLANNED_CALENDAR_EVENT_OWNER_OPTIONS,data:t})}}))}),[]),{ownerOptions:a,meParticipant:n}}(),a=t.ownerOptions,r=t.meParticipant,c=function(){var e=u(),n=(0,i.__read)((0,l.useState)(!1),2),t=n[0],a=n[1],o=(0,ud.usePromiseError)().handleError,r=(0,gd.useNotifier)().showText,c=(0,Ae.useLang)().getLang,_=(0,Sd.useSendStatsDataCallScheduled)().sendCallScheduled,v=(0,zr.useMailRuCounter)().mailRuCounter,p=(0,Gt.useIsMounted)(),f=kc().onClosePopupCalendar,h=P((function(e){var n;return e.participants[(null===(n=e.externalId)||void 0===n?void 0:n.id)||e.me]})),g=(0,dd.useCalendarEventDetails)({meParticipant:h}).getDescription;return{handleOnSubmit:(0,l.useCallback)((function(n){return a(!0),(0,qe.messagesStartCall)((0,Cd.mapFormData)(n)).then((function(t){if(p()){var a=new Date(n.start),i={start:a,title:n.name,repeatRule:n.rrule,join_link:t.join_link,call_id:t.call_id,duration:n.duration,displayName:n.displayName,timezone:n.timezone,repeatRuleEnd:n.recurrenceUntilTime},l=g(i);switch(i.description=l,(0,s.copyTextToClipboard)(l).then((function(){r(c("calls_create_call_by_link_text_copied"))})).catch(o),_({creatorId:n.groupId,sharingChannel:n.calendar}),v.push(zr.EMailRuGoals.ScheduledCall),n.calendar){case Ed.ECalendar.Other:return e({type:d.E_ACTION.SET_PLANNED_CALENDAR_EVENT,data:i}),void e({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_SHARE_PLANNED_CALL});case Ed.ECalendar.Google:var u=(0,Cd.google)((0,Cd.mapGoogleIcsUrl)(i,c));(0,Cd.openLinkInNewTab)(u,a);break;case Ed.ECalendar.iCloud:case Ed.ECalendar.Outlook:u=(0,Cd.ics)((0,Cd.mapGoogleIcsUrl)(i,c));(0,Cd.openLinkInNewTab)(u,a,!1)}f()}})).catch(o).finally((function(){p()&&a(!1)}))}),[]),loading:t}}(),_=c.handleOnSubmit,v=c.loading;return(0,o.jsx)(Ad.ModalScheduleCall,{headerTitle:n("calls_plan_event"),onClose:e,onSubmit:_,userSelectOptions:a,myUserId:r.peerId,loading:v},void 0)};var Td,xd=function(e){var n=e.children,t=(0,l.useContext)(E.LangContext).getLang,a=kc().onClose;return(0,o.jsx)(Qa.default,(0,i.__assign)({className:"MovieChooseModal",onClose:a,title:t("calls_movie_choose_title"),appearance:"blue",hasScroll:!1},{children:n}),void 0)};!function(e){e.Recommended="Recommended",e.Added="Added",e.Uploaded="Uploaded"}(Td||(Td={}));var yd,Nd,bd,Md,wd,Od,Pd,kd=t(60385);!function(e){e.Any="any",e.Long="long",e.Short="short"}(yd||(yd={})),function(e){e.Any="any",e.Day="day",e.Week="week",e.Month="month",e.Year="year"}(Nd||(Nd={})),function(e){e.Relevance="relevance",e.Date="date",e.Length="length"}(bd||(bd={})),function(e){e.DirectTranslations="direct-translations",e.HighQuality="high-quality",e.NoRestrictions="no-restrictions"}(Md||(Md={})),function(e){e.Date="date",e.Length="length",e.Sort="sort",e.Checkbox="checkbox"}(wd||(wd={}));var Ld,Dd={w:257,h:146},Rd=((Od={})[bd.Date]=0,Od[bd.Length]=1,Od[bd.Relevance]=2,Od),jd=((Pd={})[yd.Any]=void 0,Pd[yd.Long]="long",Pd[yd.Short]="short",Pd),Bd=function(e){var n,t,a=new Map;if(e.groups)try{for(var o=(0,i.__values)(e.groups),r=o.next();!r.done;r=o.next()){var s=r.value;a.set(s.id,s)}}catch(e){n={error:e}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(n)throw n.error}}return e.items.map((function(e){return{movie:e,group:a.get(Math.abs(e.owner_id||0))}}))},Ud=function(e){var n=86400;switch(e){case Nd.Any:case!1:return;case Nd.Day:return n;case Nd.Week:return 7*n;case Nd.Month:return 30*n;case Nd.Year:return 365*n}},Hd=((Ld={})[Td.Added]=-2,Ld[Td.Uploaded]=-1,Ld),Vd=function(e){var n=P((function(e){return e.groupId})),t=(0,l.useRef)(null),a=(0,i.__read)((0,l.useState)(!0),2),o=a[0],r=a[1],s=(0,i.__read)((0,l.useState)(null),2),c=s[0],d=s[1],u=(0,i.__read)((0,l.useState)([]),2),_=u[0],v=u[1],p=(0,i.__read)((0,l.useState)(!1),2),f=p[0],h=p[1],g=(0,l.useCallback)((function(n,a){var o;if(a.aborted)return Promise.resolve();r(!0),d(null);var s={album_id:Hd[e],start_from:null===(o=t.current)||void 0===o?void 0:o.next_from,fields:"screen_name",extended:1};return n&&(s.owner_id=n),(0,qe.getWatchTogetherOwnerVideos)(s,{signal:a}).then((function(e){var n;t.current=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},t.current),e),{items:(null===(n=t.current)||void 0===n?void 0:n.items)?(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(t.current.items),!1),(0,i.__read)(e.items),!1):e.items,next_from:e.next_from}),v((function(n){return(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(n),!1),(0,i.__read)(Bd(e)),!1)})),h(Boolean(e.next_from))})).catch((function(e){a.aborted||d(e)})).finally((function(){a.aborted||r(!1)}))}),[]);return(0,l.useEffect)((function(){var e=new AbortController;return g(n,e.signal),function(){return e.abort()}}),[n]),{data:_,loading:o,error:c,isNextPage:f,getNextPage:(0,l.useCallback)((function(e){return g(n,e)}),[n,g])}},Gd=function(e,n){return(e%n+n)%n},Fd=function(e){var n=ze().getLang,t="";if(e){var a=function(e){var n={years:0,months:0,days:0,hours:0,minutes:0,seconds:0},t=1e3*e,a=Date.now()-t;if(a<0)return n;n.hours=Math.floor(Gd(a/1e3,86400)/3600),n.minutes=Math.floor(Gd(a/1e3,3600)/60),n.seconds=Math.floor(Gd(a/1e3,60));var i=new Date(t),o=new Date;return i.getHours()>o.getHours()&&(i=new Date(t+60*(24-i.getHours())*60*1e3)),n.years=o.getFullYear()-i.getFullYear(),n.months=o.getMonth()+1-(i.getMonth()+1),n.days=o.getDate()-i.getDate(),n.days<0&&n.months--,n.days=Math.floor(a/1e3/86400),n.months<0&&(n.years--,n.months+=12),(n.years||n.months)&&(n.days=0),n}(e),i=a.years,o=a.months,r=a.days,s=a.hours,l=a.minutes,c=a.seconds;switch(!0){case!!i:t=n("calls_movie_date_added_years",i);break;case!!o:t=n("calls_movie_date_added_months",o);break;case!!r:t=n("calls_movie_date_added_days",r);break;case!!s:t=n("calls_movie_date_added_hours",s);break;case!!l:t=n("calls_movie_date_added_minutes",l);break;case!!c:t=n("calls_movie_date_added_seconds",c)}}return t},Zd=t(64891);const Wd=(0,je.makeIcon)("Icon48PlayButton","play_button_48","0 0 48 48",'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" id="play_button_48"><path opacity=".4" fill-rule="evenodd" clip-rule="evenodd" d="M24 48c13.255 0 24-10.745 24-24S37.255 0 24 0 0 10.745 0 24s10.745 24 24 24z" fill="currentColor" /><path d="M31.65 21.922c1.181.682 1.772 1.023 1.97 1.468a1.5 1.5 0 0 1 0 1.22c-.198.445-.789.786-1.97 1.468L21.6 31.881c-1.181.682-1.772 1.023-2.257.972a1.5 1.5 0 0 1-1.056-.61C18 31.849 18 31.166 18 29.803V18.197c0-1.364 0-2.047.287-2.44a1.5 1.5 0 0 1 1.056-.611c.485-.05 1.076.29 2.257.972l10.05 5.803z" fill="#fff" /></symbol>',48,48);var zd=(0,l.memo)((function(e){var n,t=e.movie,a=e.group,r=e.onClick,s=ze().getLang,l=function(e){var n,t,a=e.targetSize,o=e.image;if(!o)return"";var r=null;try{for(var s=(0,i.__values)(o),l=s.next();!l.done;l=s.next()){var c=l.value;if(c.height>=a.h&&c.width>=a.w)return c.url;c.height>((null==r?void 0:r.height)||0)&&c.width>((null==r?void 0:r.width)||0)&&(r=c)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(t=s.return)&&t.call(s)}finally{if(n)throw n.error}}return r?r.url:""}({targetSize:Dd,image:t.image}),c=Fd(t.date),d=(n=null==a?void 0:a.screen_name)?document.location.origin+"/video/@"+n:"";return(0,o.jsxs)("div",(0,i.__assign)({className:"CallsMovieTile",onClick:function(){null==r||r(t)}},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CallsMovieTile__thumb",style:{backgroundImage:l?"url("+l+")":void 0}},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallsMovieTile__thumb__play"},{children:(0,o.jsx)(Wd,{},void 0)}),void 0),!!t.duration&&(0,o.jsx)("div",(0,i.__assign)({className:"CallsMovieTile__duration"},{children:Dt(t.duration)}),void 0),!!t.live&&!t.duration&&(0,o.jsx)(Xt,{className:"CallsMovieTile__live"},void 0)]}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsMovieTile__title",title:t.title},{children:t.title}),void 0),(null==a?void 0:a.name)&&d&&(0,o.jsx)("div",(0,i.__assign)({className:"CallsMovieTile__channel"},{children:(0,o.jsx)(Zd.default,(0,i.__assign)({href:d,onClick:function(e){e.preventDefault(),e.stopPropagation()}},{children:a.name}),void 0)}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsMovieTile__description"},{children:[t.views&&(0,o.jsx)("span",{children:s("calls_movie_views_count",t.views)},void 0),c&&(0,o.jsxs)("span",{children:[" · ",c]},void 0)]}),void 0)]}),void 0)})),Kd=function(e){var n=e.onNextPage,t=(0,l.useRef)(null),a=(0,l.useRef)(null),r=(0,l.useRef)(!1),s=(0,l.useRef)();return(0,l.useEffect)((function(){return function(){var e;return null===(e=s.current)||void 0===e?void 0:e.abort()}}),[]),a.current||(a.current=new IntersectionObserver((function(e){var t,a;try{for(var o=(0,i.__values)(e),l=o.next();!l.done;l=o.next()){l.value.isIntersecting&&!r.current&&(r.current=!0,(s.current=new AbortController,n(s.current.signal)).finally((function(){r.current=!1})))}}catch(e){t={error:e}}finally{try{l&&!l.done&&(a=o.return)&&a.call(o)}finally{if(t)throw t.error}}}),{threshold:1})),(0,l.useEffect)((function(){return a.current&&t.current&&a.current.observe(t.current),function(){var e;null===(e=a.current)||void 0===e||e.disconnect()}}),[]),(0,o.jsx)("div",{className:"CallsNextPageTrigger",ref:t},void 0)},Qd=function(){return(0,o.jsx)(Ge.default,{className:"CallsMovieTilesSpinner",size:44,color:"var(--icon_outline_secondary)"},void 0)},Yd=function(){var e=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallsMovieTilesSpinner--maxed"},{children:[(0,o.jsx)(Ge.default,{size:44,color:"var(--steel_gray_300)"},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsMovieTilesSpinner--maxed__description"},{children:e("calls_movie_choose_loader_title")}),void 0)]}),void 0)};const Jd=(0,F.makeIcon)("Icon56VideoOutline","video_outline_56","0 0 56 56",'<symbol fill="none" viewBox="0 0 56 56" xmlns="http://www.w3.org/2000/svg" id="video_outline_56"><path d="M37.745 6c3.566 0 4.859.371 6.162 1.069s2.327 1.72 3.025 3.024C47.629 11.396 48 12.69 48 16.256v23.489c0 3.566-.371 4.859-1.069 6.162a7.27 7.27 0 0 1-3.024 3.025C42.604 49.629 41.311 50 37.745 50h-19.49c-3.565 0-4.859-.371-6.162-1.069-1.304-.697-2.327-1.72-3.024-3.024S8 43.311 8 39.745v-23.49c0-3.565.371-4.859 1.069-6.162.697-1.304 1.72-2.327 3.024-3.024S14.689 6 18.255 6zm.314 3H18.256c-2.799 0-3.761.186-4.749.714a4.27 4.27 0 0 0-1.793 1.793c-.508.95-.7 1.876-.713 4.434L11 39.744c0 2.799.186 3.761.714 4.749a4.27 4.27 0 0 0 1.793 1.793c.988.528 1.95.714 4.749.714h19.489c2.798 0 3.76-.186 4.748-.714a4.27 4.27 0 0 0 1.793-1.793c.528-.988.714-1.95.714-4.748v-23.49c0-2.798-.186-3.76-.714-4.748a4.27 4.27 0 0 0-1.793-1.793c-.95-.508-1.876-.7-4.434-.713zM18.72 38c.445 0 .606.046.77.134.162.087.29.215.377.378.088.163.134.324.134.77v1.436c0 .446-.046.607-.134.77a.908.908 0 0 1-.378.378c-.163.088-.324.134-.77.134h-1.436c-.446 0-.607-.046-.77-.134a.908.908 0 0 1-.378-.378c-.088-.163-.134-.324-.134-.77v-1.436c0-.446.046-.607.134-.77a.908.908 0 0 1 .378-.378c.163-.088.324-.134.77-.134zm20 0c.445 0 .606.046.77.134.162.087.29.215.377.378.088.163.134.324.134.77v1.436c0 .446-.046.607-.134.77a.908.908 0 0 1-.378.378c-.163.088-.324.134-.77.134h-1.436c-.446 0-.607-.046-.77-.134a.908.908 0 0 1-.378-.378c-.088-.163-.134-.324-.134-.77v-1.436c0-.446.046-.607.134-.77a.908.908 0 0 1 .378-.378c.163-.088.324-.134.77-.134zm-20-8c.445 0 .606.046.77.134.162.087.29.215.377.378.088.163.134.324.134.77v1.436c0 .446-.046.607-.134.77a.908.908 0 0 1-.378.378c-.163.088-.324.134-.77.134h-1.436c-.446 0-.607-.046-.77-.134a.908.908 0 0 1-.378-.378c-.088-.163-.134-.324-.134-.77v-1.436c0-.446.046-.607.134-.77a.908.908 0 0 1 .378-.378c.163-.088.324-.134.77-.134zm20 0c.445 0 .606.046.77.134.162.087.29.215.377.378.088.163.134.324.134.77v1.436c0 .446-.046.607-.134.77a.908.908 0 0 1-.378.378c-.163.088-.324.134-.77.134h-1.436c-.446 0-.607-.046-.77-.134a.908.908 0 0 1-.378-.378c-.088-.163-.134-.324-.134-.77v-1.436c0-.446.046-.607.134-.77a.908.908 0 0 1 .378-.378c.163-.088.324-.134.77-.134zm-20-8c.445 0 .606.046.77.134.162.087.29.215.377.378.088.163.134.324.134.77v1.436c0 .446-.046.607-.134.77a.908.908 0 0 1-.378.378c-.163.088-.324.134-.77.134h-1.436c-.446 0-.607-.046-.77-.134a.908.908 0 0 1-.378-.378c-.088-.163-.134-.324-.134-.77v-1.436c0-.446.046-.607.134-.77a.908.908 0 0 1 .378-.378c.163-.088.324-.134.77-.134zm20 0c.445 0 .606.046.77.134.162.087.29.215.377.378.088.163.134.324.134.77v1.436c0 .446-.046.607-.134.77a.908.908 0 0 1-.378.378c-.163.088-.324.134-.77.134h-1.436c-.446 0-.607-.046-.77-.134a.908.908 0 0 1-.378-.378c-.088-.163-.134-.324-.134-.77v-1.436c0-.446.046-.607.134-.77a.908.908 0 0 1 .378-.378c.163-.088.324-.134.77-.134zm-20-8c.445 0 .606.046.77.134.162.087.29.215.377.378.088.162.134.324.134.77v1.436c0 .446-.046.607-.134.77a.908.908 0 0 1-.378.378c-.163.088-.324.134-.77.134h-1.436c-.446 0-.607-.046-.77-.134a.908.908 0 0 1-.378-.378c-.088-.163-.134-.324-.134-.77v-1.436c0-.446.046-.607.134-.77a.908.908 0 0 1 .378-.378c.163-.088.324-.134.77-.134zm20 0c.445 0 .606.046.77.134.162.087.29.215.377.378.088.162.134.324.134.77v1.436c0 .446-.046.607-.134.77a.908.908 0 0 1-.378.378c-.163.088-.324.134-.77.134h-1.436c-.446 0-.607-.046-.77-.134a.908.908 0 0 1-.378-.378c-.088-.163-.134-.324-.134-.77v-1.436c0-.446.046-.607.134-.77a.908.908 0 0 1 .378-.378c.163-.088.324-.134.77-.134z" fill="currentColor" /></symbol>',56,56,!1,void 0);var Xd=function(e){var n=e.query,t=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallsMovieTilesSpinner--maxed"},{children:[(0,o.jsx)(Jd,{className:"MoviesNotFound__icon"},void 0),!!n&&(0,o.jsxs)("span",(0,i.__assign)({className:"MoviesNotFound__description"},{children:[t("calls_movie_choose_empty_query_start")," ",(0,o.jsx)("b",{children:n},void 0)," ",t("calls_movie_choose_empty_query_end")]}),void 0),!n&&(0,o.jsx)("span",(0,i.__assign)({className:"MoviesNotFound__description"},{children:t("calls_movie_choose_video_not_found")}),void 0)]}),void 0)},qd=function(e){var n=e.onMovieClick,t=Vd(Td.Added),a=t.data,r=t.loading,s=t.getNextPage,l=t.isNextPage;return(0,o.jsxs)(o.Fragment,{children:[!a.length&&r&&(0,o.jsx)(Yd,{},void 0),!a.length&&!r&&(0,o.jsx)(Xd,{},void 0),!!a.length&&(0,o.jsxs)("div",(0,i.__assign)({className:"CallsMovieTiles"},{children:[a.map((function(e,t){var a=e.movie,i=e.group;return(0,o.jsx)(zd,{movie:a,group:i,onClick:n},(a.owner_id||t)+"-"+(a.id||t))})),l&&(0,o.jsx)(Kd,{onNextPage:s},"tiles-load-trigger")]}),void 0),!!a.length&&r&&(0,o.jsx)(Qd,{},void 0)]},void 0)},$d=function(e){var n=e.onMovieClick,t=function(){var e=(0,l.useRef)(null),n=(0,i.__read)((0,l.useState)([]),2),t=n[0],a=n[1],o=(0,i.__read)((0,l.useState)(!0),2),r=o[0],s=o[1],c=(0,i.__read)((0,l.useState)(null),2),d=c[0],u=c[1],_=(0,i.__read)((0,l.useState)(!1),2),v=_[0],p=_[1],f=(0,l.useCallback)((function(n){var t;return n.aborted?Promise.resolve():(s(!0),u(null),(0,qe.getWatchTogetherRecommended)({count:12,extended:1,fields:"screen_name",start_from:null===(t=null==e?void 0:e.current)||void 0===t?void 0:t.next_from},{signal:n}).then((function(t){var o;n.aborted||(e.current=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},e.current),t),{items:(null===(o=e.current)||void 0===o?void 0:o.items)?(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e.current.items),!1),(0,i.__read)(t.items),!1):t.items}),a((function(e){return(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e),!1),(0,i.__read)(Bd(t)),!1)})),p(e.current.count>e.current.items.length))})).catch((function(e){n.aborted||u(e)})).finally((function(){n.aborted||s(!1)})))}),[]);return(0,l.useEffect)((function(){var e=new AbortController;return f(e.signal),function(){return e.abort()}}),[]),{data:t,error:d,loading:r,isNextPage:v,getNextPage:f}}(),a=t.data,r=t.loading,s=t.getNextPage,c=t.isNextPage,d=(0,l.useMemo)((function(){return new AbortController}),[]),u=(0,l.useCallback)((function(){return s(d.signal)}),[d]);return(0,l.useEffect)((function(){return function(){return d.abort()}}),[d]),(0,o.jsxs)(o.Fragment,{children:[!a.length&&r&&(0,o.jsx)(Yd,{},void 0),!a.length&&!r&&(0,o.jsx)(Xd,{},void 0),!!a.length&&(0,o.jsxs)("div",(0,i.__assign)({className:"CallsMovieTiles"},{children:[a.map((function(e,t){var a=e.movie,i=e.group;return(0,o.jsx)(zd,{movie:a,group:i,onClick:n},(a.owner_id||t)+"-"+(a.id||t))})),c&&(0,o.jsx)(Kd,{onNextPage:u},"tiles-load-trigger")]}),void 0),!!a.length&&r&&(0,o.jsx)(Qd,{},void 0)]},void 0)},eu=function(e){var n=e.onMovieClick,t=Vd(Td.Uploaded),a=t.data,r=t.loading,s=t.getNextPage,l=t.isNextPage;return(0,o.jsxs)(o.Fragment,{children:[!a.length&&r&&(0,o.jsx)(Yd,{},void 0),!a.length&&!r&&(0,o.jsx)(Xd,{},void 0),!!a.length&&(0,o.jsxs)("div",(0,i.__assign)({className:"CallsMovieTiles"},{children:[a.map((function(e,t){var a=e.movie,i=e.group;return(0,o.jsx)(zd,{movie:a,group:i,onClick:n},(a.owner_id||t)+"-"+(a.id||t))})),l&&(0,o.jsx)(Kd,{onNextPage:s},"tiles-load-trigger")]}),void 0),!!a.length&&r&&(0,o.jsx)(Qd,{},void 0)]},void 0)},nu={count:0,mappedMovies:null},tu={last:-1,next:0},au=function(e){var n=e.searchSettings,t=(0,l.useRef)(""),a=(0,l.useRef)(""),o=(0,l.useRef)(null),r=(0,l.useRef)(tu),s=(0,i.__read)((0,l.useState)(nu),2),c=s[0],d=s[1],u=(0,i.__read)((0,l.useState)(!1),2),_=u[0],v=u[1],p=(0,i.__read)((0,l.useState)(null),2),f=p[0],h=p[1],g=(0,l.useCallback)((function(e,s){var l=JSON.stringify(n),c=t.current===e&&a.current===l;if(c&&r.current.next===r.current.last)return Promise.resolve();c||(d(nu),t.current=e,a.current=l,r.current=(0,i.__assign)({},tu)),h(null),v(!0);var u=r.current.next;return(0,qe.getSearchVideo)(function(e){var n=e.searchSettings,t=e.searchText,a=e.offset,i=n[wd.Sort],o=n[wd.Length],r=n[wd.Checkbox][Md.HighQuality],s=n[wd.Checkbox][Md.DirectTranslations];return{q:t,adult:n[wd.Checkbox][Md.NoRestrictions]?1:0,sort:i?Rd[i]:Rd[bd.Relevance],hd:r?1:0,filters:o?jd[o]:void 0,live:s?1:0,search_own:0,date:Ud(n[wd.Date]),offset:a,count:12}}({searchSettings:n,searchText:e,offset:u}),{signal:s}).then((function(n){s.aborted||t.current!==e||a.current!==l||(d((function(e){return{mappedMovies:e.mappedMovies?(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e.mappedMovies),!1),(0,i.__read)(Bd(n)),!1):Bd(n),count:n.count}})),o.current=n,r.current.last=u)})).catch((function(e){s.aborted||h(e)})).finally((function(){s.aborted||v(!1)}))}),[n]),m=(0,l.useCallback)((function(e){return r.current={last:r.current.next,next:r.current.next+12},g(t.current,e)}),[g]);return{data:c,loading:_,error:f,getSearchMovies:g,getNextPage:m}},iu=function(e){var n=e.moviesData,t=e.loading,a=e.getNextPage,r=e.count,s=e.query,l=e.onMovieClick,c=ze().getLang,d=n&&!n.length&&!t,u=!n&&t,_=n&&!!n.length&&t;return(0,o.jsxs)(o.Fragment,{children:[u&&(0,o.jsx)(Yd,{},void 0),d&&(0,o.jsx)(Xd,{query:s},void 0),!!(null==n?void 0:n.length)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CallsMovieSearchTitle"},{children:[(0,o.jsx)("span",{children:c("calls_movie_player_search")},void 0),!!r&&(0,o.jsxs)("span",(0,i.__assign)({className:"CallsMovieSearchTitle__count"},{children:[" ",r]}),void 0)]}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsMovieTiles"},{children:[n.map((function(e,n){var t=e.movie,a=e.group;return(0,o.jsx)(zd,{movie:t,group:a,onClick:l},(t.owner_id||n)+"-"+(t.id||n))})),n.length<r&&(0,o.jsx)(Kd,{onNextPage:a},"tiles-load-trigger")]}),void 0)]},void 0),_&&(0,o.jsx)(Qd,{},void 0)]},void 0)},ou=function(e){var n=e.onClose,t=e.onRemoveMovie,a=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(Qa.default,(0,i.__assign)({onClose:n,title:a("calls_remove_movie_modal_title"),className:"CallsMoviePlayer__removeModal",actionButtons:[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:n,appearance:"secondary"},{children:a("calls_cancel")}),"cancel"),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:t},{children:a("calls_remove_movie_modal_title")}),"confirm")]},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallsMoviePlayer__removeModalContent"},{children:a("calls_remove_movie_modal_content")}),void 0)}),void 0)},ru=function(e){var n=e.movieInfo,t=e.handleRemoveMovie,a=e.isRemoveAvailable,r=n.movieId,s=n.title,c=function(e){void 0===e&&(e=[]);var n={url:"",width:0,height:0};return e.forEach((function(e){n.width<e.width&&(n=e)})),n}(n.thumbnails),d=(0,l.useContext)(E.LangContext).getLang,u=(0,i.__read)((0,l.useState)(!1),2),_=u[0],v=u[1],p=(0,l.useCallback)((function(){return v(!1)}),[]),f=(0,l.useCallback)((function(){return v(!0)}),[]),h=(0,l.useCallback)((function(){return t(String(r))}),[t,r]);return(0,o.jsxs)("div",(0,i.__assign)({className:"CallsMovieCurrentSharedMovie"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallsMovieCurrentSharedMovie__mainTitle"},{children:d("calls_shared_movie_current")}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsMovieCurrentSharedMovie__content"},{children:[(0,o.jsx)("img",{src:c.url,alt:"img",className:"CallsMovieCurrentSharedMovie__preview"},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsMovieCurrentSharedMovie__description"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallsMovieCurrentSharedMovie__videoTitle"},{children:s}),void 0)}),void 0),a&&(0,o.jsx)(_i.default,(0,i.__assign)({className:"CallsMovieCurrentSharedMovie__removeButton",onClick:f},{children:d("calls_remove_movie_modal_complete")}),void 0)]}),void 0),_&&a&&(0,o.jsx)(ou,{onClose:p,onRemoveMovie:h},void 0)]}),void 0)};const su=(0,F.makeIcon)("Icon16Search","search_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="search_16"><path fill="currentColor" d="M14.743 13.574 10.91 9.74a5.426 5.426 0 0 0 1.05-3.232A5.532 5.532 0 0 0 6.46 1 5.436 5.436 0 0 0 1 6.468a5.532 5.532 0 0 0 5.5 5.508 5.409 5.409 0 0 0 3.241-1.062l.005-.003 3.829 3.832a.827.827 0 1 0 1.168-1.169Zm-8.247-2.696a4.425 4.425 0 0 1-4.4-4.406 4.35 4.35 0 0 1 4.368-4.374 4.426 4.426 0 0 1 4.4 4.406 4.35 4.35 0 0 1-4.368 4.374Z" /></symbol>',16,16,!1,void 0),lu=(0,F.makeIcon)("Icon24Filter","filter_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="filter_24"><path fill-rule="evenodd" d="M6.242 8.9a2.901 2.901 0 0 0 5.516 0H20a.9.9 0 1 0 0-1.8h-8.242a2.901 2.901 0 0 0-5.515 0H4a.9.9 0 1 0 0 1.8h2.242ZM9 6.9a1.1 1.1 0 1 0 0 2.2 1.1 1.1 0 0 0 0-2.2ZM3.1 16a.9.9 0 0 1 .9-.9h8.242a2.901 2.901 0 0 1 5.516 0H20a.9.9 0 1 1 0 1.8h-2.242a2.901 2.901 0 0 1-5.516 0H4a.9.9 0 0 1-.9-.9Zm10.8 0a1.1 1.1 0 1 1 2.2 0 1.1 1.1 0 0 1-2.2 0Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0);var cu,du,uu=t(33024),_u=t(64372),vu=t(94478),pu=function(e){var n=e.id,t=e.text,a=e.value,r=e.onDelete;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallsToken"},{children:[(0,o.jsx)("span",(0,i.__assign)({className:"CallsToken__text"},{children:t}),void 0),(0,o.jsx)(vu.default,{className:"CallsToken__cross",onClick:function(){null==r||r(n,a)}},void 0)]}),void 0)},fu=function(e){var n,t=e.loading,a=e.dropdownRows,r=e.tokens,c=e.onDeleteToken,d=e.onClearFilters,u=e.setText,_=e.text,v=ze().getLang,p=(0,l.useRef)(null),f=(0,l.useCallback)((function(){var e;u(""),null===(e=p.current)||void 0===e||e.focus()}),[]),h=(0,l.useCallback)((function(e){u(e.target.value)}),[]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CallsSearchBar"},{children:[(0,o.jsx)(su,{className:"CallsSearchBarLoupIcon"},void 0),(0,o.jsx)("input",{ref:p,className:"CallsSearchBar__input",type:"text",value:_,onChange:h,placeholder:v("calls_movie_player_search")},void 0),!!_&&(0,o.jsx)(_u.Dropdown,(0,i.__assign)({className:"CallsSearchBarDropdown",dataContainerClassName:"CallsSearchBarDropdownDataContainer",align:"right",position:"b",appearance:"fancy",disableCloseByItemClick:!0,disableCssHover:!0,data:a},{children:(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("CallsSearchBar__input__settings",(n={},n["CallsSearchBar__input__settings--invisible"]=t,n))},{children:(0,o.jsx)(lu,{className:"CallsSearchBarIcon"},void 0)}),void 0)}),void 0),_&&!t&&(0,o.jsx)(uu.default,{className:"CallsSearchBarIcon",onClick:f},void 0),t&&(0,o.jsx)(Ge.default,{color:"var(--steel_gray_400)",size:18},void 0)]}),void 0),!!_&&!!r.length&&(0,o.jsxs)("div",(0,i.__assign)({className:"CallsSearchBar__filters"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallsSearchBar__filters__tokens"},{children:r.map((function(e){return(0,o.jsx)(pu,(0,i.__assign)({},e,{onDelete:c}),e.id)}))}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsSearchBar__filters__clear"},{children:(0,o.jsx)(Zd.default,(0,i.__assign)({onClick:d},{children:v("calls_movie_player_clear_filters")}),void 0)}),void 0)]}),void 0)]},void 0)},hu=((cu={})[wd.Length]=!1,cu[wd.Date]=!1,cu[wd.Sort]=!1,cu[wd.Checkbox]=((du={})[Md.DirectTranslations]=!1,du[Md.HighQuality]=!1,du[Md.NoRestrictions]=!1,du),cu),gu=function(e){var n=e.onClose,t=e.onConfirm,a=(0,l.useContext)(E.LangContext).getLang;return(0,o.jsx)(Qa.default,(0,i.__assign)({onClose:n,title:a("calls_play_movie_modal_title"),className:"MovieChoose__innerModal",actionButtons:[(0,o.jsx)(_i.default,(0,i.__assign)({onClick:n,appearance:"secondary"},{children:a("calls_cancel")}),"cancel"),(0,o.jsx)(_i.default,(0,i.__assign)({onClick:t},{children:a("calls_yes_play")}),"confirm")]},{children:(0,o.jsx)("div",(0,i.__assign)({className:"MovieChoose__innerModalContent"},{children:a("calls_play_movie_modal_content")}),void 0)}),void 0)},mu=function(e){var n,t,a=e.onClose,r=(0,l.useContext)(E.LangContext).getLang,s=(n=P((function(e){return e.sharedMovieOwner})),t=P((function(e){return e.participants})),n&&t?t[n.id]:null);return(0,o.jsx)(Qa.default,(0,i.__assign)({onClose:a,title:r("calls_movie_already_started_modal_title"),className:"MovieChoose__innerModal",actionButtons:[(0,o.jsx)(Ze.Button,(0,i.__assign)({onClick:a},{children:r("calls_movie_already_started_modal_button")}),"confirm")]},{children:(0,o.jsx)("div",(0,i.__assign)({className:"MovieChoose__innerModalContent"},{children:r("calls_movie_already_started_modal_content").replace("{userName}",null==s?void 0:s.name)}),void 0)}),void 0)},Au=(0,l.memo)((function(e){var n=e.SDK,t=(0,i.__read)((0,l.useState)(!1),2),a=t[0],r=t[1],c=(0,i.__read)((0,l.useState)(!1),2),d=c[0],u=c[1],_=(0,l.useRef)(null),v=P((function(e){return e.commonStreamedMovieInfo})),p=P((function(e){return e.localDevice})),f=ea(),h=(0,k.participantIsAdmin)(p),g=Fo(),m=kc().onClose,A=function(){var e=(0,i.__read)((0,l.useState)(Td.Recommended),2),n=e[0],t=e[1],a=(0,l.useContext)(E.LangContext).getLang;return{tab:n,tabs:(0,l.useMemo)((function(){return[{href:"",id:Td.Recommended,label:a("calls_movie_choose_recommended")},{href:"",id:Td.Added,label:a("calls_movie_choose_added")},{href:"",id:Td.Uploaded,label:a("calls_movie_choose_loaded")}]}),[a]),onTabClick:(0,l.useCallback)((function(e){t(e)}),[])}}(),C=A.onTabClick,S=A.tab,I=A.tabs,T=function(){var e=ze().getLang,n=function(n){switch(n){case yd.Any:return e("calls_movie_player_filter_long_any");case yd.Long:return e("calls_movie_player_filter_long_long");case yd.Short:return e("calls_movie_player_filter_long_short");case Nd.Any:return e("calls_movie_player_filter_date_any");case Nd.Day:return e("calls_movie_player_filter_date_day");case Nd.Week:return e("calls_movie_player_filter_date_week");case Nd.Month:return e("calls_movie_player_filter_date_month");case Nd.Year:return e("calls_movie_player_filter_date_year");case bd.Relevance:return e("calls_movie_player_sort_relevance");case bd.Date:return e("calls_movie_player_sort_date");case bd.Length:return e("calls_movie_player_sort_length");case Md.DirectTranslations:return e("calls_movie_player_filter_live_translations");case Md.HighQuality:return e("calls_movie_player_filter_high_quality");case Md.NoRestrictions:return e("calls_movie_player_filter_no_limited")}},t=(0,i.__read)((0,l.useState)(hu),2),a=t[0],r=t[1],c=(0,i.__read)((0,l.useState)([]),2),d=c[0],u=c[1],_=(0,l.useMemo)((function(){var e;return(e={})[wd.Length]=[{value:!1,label:n(yd.Any)},{value:yd.Long,label:n(yd.Long)},{value:yd.Short,label:n(yd.Short)}],e[wd.Date]=[{value:!1,label:n(Nd.Any)},{value:Nd.Day,label:n(Nd.Day)},{value:Nd.Week,label:n(Nd.Week)},{value:Nd.Month,label:n(Nd.Month)},{value:Nd.Year,label:n(Nd.Year)}],e[wd.Sort]=[{value:!1,label:n(bd.Relevance)},{value:bd.Date,label:n(bd.Date)},{value:bd.Length,label:n(bd.Length)}],e}),[e]),v=(0,l.useCallback)((function(){r((0,i.__assign)({},hu)),u([])}),[]),p=(0,l.useCallback)((function(e){var n=e.id,t=e.text,a=e.value;u((function(e){var o,r;if(!a)return e.filter((function(e){return e.id!==n}));var s=[],l=!1,c={id:n,text:t,value:a};try{for(var d=(0,i.__values)(e),u=d.next();!u.done;u=d.next()){var _=u.value;_.id!==n?s.push(_):(s.push(c),l=!0)}}catch(e){o={error:e}}finally{try{u&&!u.done&&(r=d.return)&&r.call(d)}finally{if(o)throw o.error}}return l||s.push(c),s}))}),[]),f=(0,l.useCallback)((function(e){switch(e.type){case wd.Length:case wd.Date:case wd.Sort:r((function(n){var t;return(0,i.__assign)((0,i.__assign)({},n),((t={})[e.type]=e.value,t))})),p({id:e.type,text:e.value?n(e.value):e.value,value:e.value});break;case wd.Checkbox:r((function(n){var t,a;return(0,i.__assign)((0,i.__assign)({},n),((t={})[e.type]=(0,i.__assign)((0,i.__assign)({},n[e.type]),((a={})[e.value]=e.subValue,a)),t))})),p({id:e.value,text:n(e.value),value:e.subValue})}}),[]),h=(0,l.useCallback)((function(e,n){switch(e){case wd.Date:case wd.Length:case wd.Sort:f({type:e,value:!1});break;case Md.DirectTranslations:case Md.HighQuality:case Md.NoRestrictions:f({type:wd.Checkbox,value:e,subValue:!n})}}),[f]),g=(0,l.useCallback)((function(e){f({type:e.name,value:e.selected.value})}),[f]),m=(0,l.useCallback)((function(e,n){f({type:wd.Checkbox,value:e,subValue:n})}),[f]);return{dropdownRows:(0,l.useMemo)((function(){return[{id:"length-title",text:(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("CallsSearchBarSettingsRow--title","CallsSearchBarSettingsRow")},{children:e("calls_movie_player_filter_long")}),void 0)},{id:"length-select",text:(0,o.jsx)(ur.default,{className:"CallsSearchBarSettingsRow",appearance:"secondary",name:wd.Length,value:a[wd.Length],options:_[wd.Length],onChange:g},void 0)},{id:"date-title",text:(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("CallsSearchBarSettingsRow--title","CallsSearchBarSettingsRow")},{children:e("calls_movie_player_filter_date")}),void 0)},{id:"date-select",text:(0,o.jsx)(ur.default,{className:"CallsSearchBarSettingsRow CallsSearchBarSettingsRow--date",appearance:"secondary",name:wd.Date,value:a[wd.Date],options:_[wd.Date],onChange:g},void 0)},{id:"sort-title",text:(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("CallsSearchBarSettingsRow--title","CallsSearchBarSettingsRow")},{children:e("calls_movie_player_sort")}),void 0)},{id:"sort-select",text:(0,o.jsx)(ur.default,{className:"CallsSearchBarSettingsRow",appearance:"secondary",name:wd.Sort,value:a[wd.Sort],options:_[wd.Sort],onChange:g},void 0)},{id:"checkbox-direct-translations",text:(0,o.jsx)(vr.default,(0,i.__assign)({className:"CallsSearchBarSettingsRow",name:Md.DirectTranslations,checked:a[wd.Checkbox][Md.DirectTranslations],onChange:m},{children:n(Md.DirectTranslations)}),void 0)},{id:"checkbox-high-quality",text:(0,o.jsx)(vr.default,(0,i.__assign)({className:"CallsSearchBarSettingsRow",name:Md.HighQuality,checked:a[wd.Checkbox][Md.HighQuality],onChange:m},{children:n(Md.HighQuality)}),void 0)},{id:"checkbox-no-restrictions",text:(0,o.jsx)(vr.default,(0,i.__assign)({className:"CallsSearchBarSettingsRow",name:Md.NoRestrictions,checked:a[wd.Checkbox][Md.NoRestrictions],onChange:m},{children:n(Md.NoRestrictions)}),void 0)}]}),[a,g,m]),settings:a,tokens:d,onClearFilters:v,onDeleteToken:h}}(),x=au({searchSettings:T.settings}),y=function(e){var n=e.onSearchMovies,t=(0,i.__read)((0,l.useState)(""),2),a=t[0],o=t[1],r=(0,i.__read)((0,l.useState)(a),2),s=r[0],c=r[1],d=(0,l.useRef)(null);return(0,l.useEffect)((function(){var e;return n&&a.length>2&&(d.current=setTimeout((function(){e=new AbortController,n(a,e.signal),c(a)}),500)),function(){d.current&&clearTimeout(d.current),null==e||e.abort()}}),[a,n]),{text:a,lastText:s,setText:o}}({onSearchMovies:x.getSearchMovies}),N=ta({SDK:n,movieAddCallback:m}),b=N.handleAddMovie,M=N.handleRemoveMovie,w=function(){v&&M(String(v.movieId)).then((function(){_.current&&b(_.current)})).catch((function(e){(0,G.debugMessage)(G.DebugMessageType.ERROR,e)})).finally((function(){r(!1),_.current=null}))},O=function(e){g?v?(_.current=e,f?w():r(!0)):b(e):u(!0)},L=!y.text.length;return(0,o.jsxs)(xd,{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallsMovieChooseSearchContent"},{children:(0,o.jsx)(fu,(0,i.__assign)({},T,y,{loading:x.loading}),void 0)}),void 0),v&&(0,o.jsx)(ru,{movieInfo:v,handleRemoveMovie:M,isRemoveAvailable:f||h},void 0),L&&(0,o.jsx)(kd.PageTabs,{tabs:I,activeTab:S,onTabClick:C,headerClassnames:"CallsMovieChooseTabs",tabsClassnames:"CallsMovieChooseTabsHeader"},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsMovieChooseTilesContent"},{children:[!L&&(0,o.jsx)(iu,{loading:x.loading,moviesData:x.data.mappedMovies,count:x.data.count,getNextPage:x.getNextPage,query:y.lastText,onMovieClick:O},void 0),L&&S===Td.Recommended&&(0,o.jsx)($d,{onMovieClick:O},void 0),L&&S===Td.Added&&(0,o.jsx)(qd,{onMovieClick:O},void 0),L&&S===Td.Uploaded&&(0,o.jsx)(eu,{onMovieClick:O},void 0),a&&(0,o.jsx)(gu,{onClose:function(){return r(!1)},onConfirm:w},void 0),d&&(0,o.jsx)(mu,{onClose:m},void 0)]}),void 0)]},void 0)})),Cu=function(e){var n,t,a,r,s,_,v,p=e.SDK,f=e.bridge,h=e.onBeforeCallStart,g=e.onAfterCallFinish,m=e.tabIsMaster,A=e.navigateToConvo,C=e.callSounds,E=e.navigateToProfile,S=e.onHandCountChanged,I=e.onSuccessFeedback,T=e.okPublicKey,x=e.config,y=e.streamUrlExtractor,N=x.allowAddMembers,b=x.incomingCall,w=x.showFeedbackScreen,k=(0,c.useSelector)((function(e){return e})),L=u(),D=(0,l.useCallback)((function(){L({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})}),[]),R=(0,i.__read)((0,l.useState)(null),2),j=R[0],B=R[1],U=(0,l.useCallback)((function(e){L({type:d.E_ACTION.ERROR,text:e})}),[]),H=(0,l.useCallback)((function(){return L({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})}),[]);(0,l.useEffect)((function(){return k.mode===d.Mode.CALL?((0,M.increaseCallsCount)(),Os(),function(){Ps()}):function(){}}),[k.mode]),function(e,n,t,a){void 0===a&&(a=[]);var i=window.document,o=i.documentElement,r=o.requestFullscreen||o.webkitRequestFullscreen;if(r){var s=!o.requestFullscreen,c=s?i.webkitExitFullscreen:i.exitFullscreen,d=s?"webkitfullscreenchange":"fullscreenchange",u=s?"webkitFullscreenElement":"fullscreenElement";(0,l.useEffect)((function(){var e=function(){i.fullscreenElement?n&&n():t&&t()};return i.addEventListener(d,e),function(){return i.removeEventListener(d,e)}}),[]),(0,l.useEffect)((function(){e&&!i[u]?r.call(i.documentElement):!e&&i[u]&&c.call(i)}),a)}}(k.uiMode===d.UIMode.FULLSCREEN&&k.mode===d.Mode.CALL,(function(){var e;window.FastChat&&(B(window.FastChat.getFullScreenState()),window.FastChat.toggleFullScreenState(!0)),(null===(e=null===window||void 0===window?void 0:window.reforgedME)||void 0===e?void 0:e.setCollapsed)&&window.reforgedME.setCollapsed(!0,"call")}),(function(){var e;k.uiMode===d.UIMode.FULLSCREEN&&L({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.DEFAULT}),window.FastChat&&(window.FastChat.toggleFullScreenState(j),B(null)),(null===(e=null===window||void 0===window?void 0:window.reforgedME)||void 0===e?void 0:e.setCollapsed)&&window.reforgedME.setCollapsed(!1,"call")}),[k.uiMode,k.mode]),ps(p,k),(0,l.useEffect)((function(){if(k.mode===d.Mode.CALL&&((0,M.increaseCallsCount)(),k.callsCount%3==0)){var e=setTimeout((function(){return L({type:d.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION,data:!0})}),1e3);return function(){return clearTimeout(e)}}}),[k.mode]);var V,F=(0,l.useMemo)((function(){return function(){try{var e=window,n=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.captureStream&&e.CanvasCaptureMediaStreamTrack&&!0,t=Ol()[0]===Sl.Safari;return n&&!t}catch(e){return!1}}()}),[]);return V=P((function(e){return!!e.config.sferum})),(0,l.useMemo)((function(){var e=V?K.Sferum:K.VkCalls;Q.setAppType(e)}),[V]),(0,o.jsx)(Ar,(0,i.__assign)({SDK:p,mode:k.mode,onReset:H},{children:(0,o.jsxs)(o.Fragment,{children:[(b||m())&&(0,o.jsx)(dr,{onBeforeCallStart:h,onAfterCallFinish:g,callSounds:C},void 0),k.localDevice.status!==G.ParticipantStatus.WAITING_HALL&&k.mode===d.Mode.CALL&&k.uiMode!==d.UIMode.COLLAPSED&&(0,o.jsx)(Zo,{SDK:p,isVirtualBackgroundSupported:F,navigateToConvo:A,navigateToProfile:E,onHandCountChanged:S},void 0),k.localDevice.status===G.ParticipantStatus.WAITING_HALL&&k.mode===d.Mode.CALL&&k.uiMode!==d.UIMode.COLLAPSED&&(0,o.jsx)(hl,{SDK:p,navigateToConvo:A},void 0),k.mode===d.Mode.INCOMING&&k.uiMode!==d.UIMode.COLLAPSED&&(0,o.jsx)(O,{SDK:p,bridge:f},void 0),k.localDevice.status!==G.ParticipantStatus.WAITING_HALL&&k.mode!==d.Mode.READY&&k.uiMode===d.UIMode.COLLAPSED&&(0,o.jsx)(ar,{SDK:p},void 0),k.localDevice.status===G.ParticipantStatus.WAITING_HALL&&k.mode!==d.Mode.READY&&k.uiMode===d.UIMode.COLLAPSED&&(0,o.jsx)(vl,{SDK:p},void 0),k.mode===d.Mode.START&&k.uiMode!==d.UIMode.COLLAPSED&&(0,o.jsx)(cl,{},void 0),w&&k.mode===d.Mode.FEEDBACK&&(0,o.jsx)(il,{onSuccessFeedback:I},void 0),k.mode===d.Mode.CALL_BY&&(0,o.jsx)(_l,{bridge:f},void 0),k.mode===d.Mode.JOIN&&(0,o.jsx)(rs,(0,i.__assign)({},k.join,{bridge:f,withPopup:!0,onClose:D,onError:U,okPublicKey:T}),void 0),k.mode===d.Mode.CREATE_CALL&&(0,o.jsx)(Yc,{bridge:f},void 0),k.errorShown&&(0,o.jsx)(ds,{title:null===(n=k.error)||void 0===n?void 0:n.title,text:null===(t=k.error)||void 0===t?void 0:t.text,handleType:null===(a=k.error)||void 0===a?void 0:a.handleType,callId:null===(r=k.error)||void 0===r?void 0:r.callId,bridge:f,onCloseFatal:D},void 0),k.cautionShown&&(0,o.jsx)(fs,{isIncoming:k.isIncoming},void 0),k.groupCallSetup&&(0,o.jsx)($i,{SDK:p},void 0),k.isManagementOpen&&(0,o.jsx)(_o,{bridge:f,SDK:p,navigateToProfile:E,navigateToConvo:A,allowAddMembers:N},void 0),k.popup===d.POPUP_SETTINGS&&(0,o.jsx)(mr,{SDK:p},void 0),k.popup===d.POPUP_TRANSLATION&&(0,o.jsx)(Vs,{},d.POPUP_TRANSLATION),k.popup===d.POPUP_RECORD&&(0,o.jsx)(Vs,{isRecord:!0},d.POPUP_RECORD),k.popup===d.POPUP_TRANSLATION_START_COUNTDOWN&&(0,o.jsx)(Xs,{},void 0),k.popup===d.POPUP_TRANSLATION_STOP&&(0,o.jsx)(Fs,{},void 0),k.popup===d.POPUP_TRANSLATION_SHARE&&(0,o.jsx)(Ws,{link:k.translation.link,linkExtractor:y},void 0),k.popup===d.POPUP_EXIT&&(0,o.jsx)(_s,{SDK:p},void 0),k.popup===d.POPUP_TRANSFER_ADMIN_RIGHTS&&(0,o.jsx)(Ys,{SDK:p},void 0),(0,Qe.hasIn)(k.popup,d.POPUP_UNMUTE_REQUEST,d.POPUP_UNMUTE_AUDIO_REQUEST,d.POPUP_UNMUTE_VIDEO_REQUEST)&&(0,o.jsx)(Ss,{SDK:p,popup:k.popup},void 0),k.popup===d.POPUP_ADMIN_PIN_UNMUTE_REQUEST&&(0,o.jsx)(Ks,{SDK:p},void 0),(0,Qe.hasIn)(k.popup,d.POPUP_ON_CALL_HANGUP_BUSY,d.POPUP_ON_CALL_HANGUP_KILLED,d.POPUP_ON_CALL_HANGUP_BANNED,d.POPUP_ON_CALL_HANGUP_REMOVED,d.POPUP_ON_CALL_HANGUP_KILLED_WITHOUT_DELETE)&&(0,o.jsx)(Xc,{},void 0),(null===(s=k.misc)||void 0===s?void 0:s.popupCalendarPlanning)===d.POPUP_ON_CALL_SEND_LINK&&(0,o.jsx)(_d,{},void 0),(null===(_=k.misc)||void 0===_?void 0:_.popupCalendarPlanning)===d.POPUP_SHARE_PLANNED_CALL&&(0,o.jsx)(md,{},void 0),(null===(v=k.misc)||void 0===v?void 0:v.popupCalendarPlanning)===d.POPUP_PLAN_CALENDAR_EVENT&&(0,o.jsx)(Id,{},void 0),k.popup===d.POPUP_MOVIE_CHOOSE&&(0,o.jsx)(Au,{SDK:p},void 0),F&&(0,o.jsx)(Gc,{SDK:p},void 0),k.participantKick&&(0,o.jsx)(el,{SDK:p},void 0),k.membersUnban&&(0,o.jsx)(rl,{SDK:p},void 0),k.participantsManagement&&(0,o.jsx)(ms,{},void 0),k.adminAssignment&&(0,o.jsx)(Ts,{SDK:p},void 0),k.isLoaderVisible&&(0,o.jsx)(xs.default,{},void 0)]},void 0)}),void 0)},Eu=t(40182);function Su(e,n,t,a,o){var r=a.reduce((function(a,r){switch(r.type){case d.INCOMING_CALL:if(!Iu(e,r)){a.push(Promise.resolve());break}var s=(0,Qe.isGroupCallEvent)(r),l=s,c=(0,Qe.convertCallerFromLongpoll)(r.payload);if(!s&&c.peerId<0)JSON.parse((0,Di.decodeHTMLEntities)(r.payload.payload)).with_join_link&&(l=!0);if(l){var u=s?(0,Qe.convertChatFromLongpoll)(r.payload):(0,M.getDefaultConversation)(o);if(n({type:d.E_ACTION.LOAD_PEERS,conversation:u,members:[c],peerId:u.peerId,caller:s?u:c}),u.photo&&a.push(en(u.photo).catch((function(e){return(0,G.debugMessage)(G.DebugMessageType.WARN,e)}))),s){var _=function(e,n,t,a){return(0,qe.retryLoadCallPeers)(a).then((function(e){var a=(0,i.__read)((0,Qe.convertServerData)(e),3),o=a[0],r=a[1],s=a[2];pn(n,s),nn([o,r]).catch((function(e){t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),(0,G.debugMessage)(G.DebugMessageType.ERROR,e),console.error(e)})),n({type:d.E_ACTION.LOAD_PEERS,conversation:o,members:r})}))}(0,n,t,u.peerId);a.push(_)}}else n({type:d.E_ACTION.LOAD_PEERS,conversation:c,members:[c],peerId:c.peerId});c.photo&&a.push(en(c.photo).catch((function(e){n({type:d.E_ACTION.LOAD_PEERS,members:[(0,i.__assign)((0,i.__assign)({},c),{photo:""})]}),(0,G.debugMessage)(G.DebugMessageType.WARN,e)})))}return a}),[]);return Promise.all(r)}function Iu(e,n){return function(e){return!!e.payload.call_id}(n)&&e.mode!==d.Mode.INCOMING&&e.mode!==d.Mode.CALL}function Tu(){return(0,c.useSelector)((function(e){return e})).isLoaderVisible?(0,o.jsx)(xs.default,{},void 0):null}var xu=t(14890),yu=function(e,n,t,a){var o,r=a.isDev,s=void 0!==r&&r,l=a.token,c=a.config,u=void 0===c?{isModalView:!0,withAnimation:!0,allowAddMembers:!1,debugLog:!1,incomingCall:!1,streaming:!0,streamingPrivacy:!0,fullHD:!1,anonymPhoto:!0,allowBanParticipant:!1,showFeedbackScreen:!1,enableVideoSlots:!1,videoSlotsCount:d.VIDEO_SLOTS_COUNT,browserWarnings:null,allowCallByName:!1,enableScreenTrack:!1,enableProducerScreenTrack:!1,allowWaitingHall:!1,allowPushToTalk:!1,badNetwork:!1,badNetworkP2P:!1,desktopAppNotification:!1,sferum:!1,lazyLoading:!1,enableDomainBender:!1,enableMultipleDevices:!1,enableP2PAudioRed:!1,enableServerAudioRed:!1,enableTranslationSplit:!1,enableMovieShare:!1,enableNavChangeCallCollapse:!1,enableParticipantListChunk:!1}:c,_=a.localVideoResolution,v=void 0===_?d.VideoResolutionTypes.SD:_,p=a.friends,f=void 0===p?[]:p,h=a.friendsCache,g=a.privacySettings,m=a.ipSettingEnabled,A=a.pushToTalkEnabled,C=void 0!==A&&A,E=a.friendsCount,S=window.vk&&window.vk.id||e.peerId;return{anonymSecret:l,me:S,groupId:0,mode:d.Mode.READY,peer:0,participants:(o={},o[S]=(0,i.__assign)({},e),o),devices:{},localDevice:{mediaSettings:{isAudioEnabled:!0,isVideoEnabled:!1,isScreenSharingEnabled:!1,videoStreams:[]},statusData:{hand:{state:!1,ts:Date.now()}},networkStatus:1,roles:[],permissions:{audio:G.MuteState.UNMUTE,video:G.MuteState.UNMUTE,screenSharing:G.MuteState.UNMUTE},status:G.ParticipantStatus.WAITING},callData:{type:null,ts:null,localTimeStamp:null,conversation:t},imHash:n,isDev:s,popup:null,uiMode:d.UIMode.DEFAULT,orator:null,adminPinnedParticipant:null,screenSharingPinnedParticipant:null,movieSharingPinnedParticipant:null,screenSharingNeedDisableOratorModeAfterStop:!0,screenSharingOldPinnedParticipant:null,pinnedParticipant:null,screenSharers:{},isShownParticipantsAside:!0,isOratorMode:!0,chatMembers:[],groupMembers:[],groupMembersCount:0,preselectedIds:null,friends:f,friendsCount:E,speakers:{},speakersInHeader:[],chatUnreadCount:0,chatUpToMsgId:null,tooltips:{chat:!1,hand:!1,screenShare:!1,layout:!1,collapse:!1,fullscreen:!1},participantsAddedByMe:new Set,groupCallSetup:!1,isManagementOpen:!1,notification:null,errorShown:!1,cautionShown:!1,isLoaderVisible:!1,translation:{deferredId:null,isOn:!1},participantsManagement:null,adminAssignment:null,participantKick:null,membersUnban:null,noiseCancellation:d.NoiseCancellationTypes.NEURAL,config:u,localVideoResolution:v,conversationOptions:[],privacySettings:{callsIp:(null==g?void 0:g.callsIp)||"friends"},friendsCache:h||{},groupMembersCache:{},unableToCallGroupMembersIds:[],ipSettingEnabled:m||!1,isIncoming:!1,pushToTalkEnabled:C,gridScrollPosition:0,gridScrollFirstVisible:0,oratorScrollPosition:0,oratorScrollFirstVisible:0,oratorScrollNumberOfVisible:5,callsCount:(0,M.getCallsCount)(),shouldShowDesktopAppNotification:!1,shouldShowWarningDesktopAppNotification:!0,virtualBackgroundSettings:{photos:[],videoOptions:{}},permissions:{},maps:{vkIdToDevices:new Map},streamedMovieState:null,commonStreamedMovieInfo:null,sharedMovieOwner:null}};function Nu(e,n){var t,a,o,r,l,c,u,_,v,p,f,h,g,m,A,C,E;switch(n.type){case d.E_ACTION.LOAD_PEERS:var S=n.conversation||e.callData.conversation,I={};try{for(var T=(0,i.__values)(n.members),x=T.next();!x.done;x=T.next()){var y=x.value;y&&y.peerId&&(I[y.peerId]=(0,i.__assign)((0,i.__assign)({},e.participants[y.peerId]||{}),y))}}catch(e){t={error:e}}finally{try{x&&!x.done&&(a=T.return)&&a.call(T)}finally{if(t)throw t.error}}return(0,i.__assign)((0,i.__assign)({},e),{participants:(0,i.__assign)((0,i.__assign)({},e.participants),I),callData:(0,i.__assign)((0,i.__assign)({},e.callData),{conversation:S}),peer:"peerId"in n&&void 0!==n.peerId?n.peerId:e.peer,caller:"caller"in n?n.caller:e.caller});case d.E_ACTION.CHANGE_MODE:var N=n.mode!==d.Mode.READY&&n.data&&n.data.type?n.data.type:null;if(n.mode===d.Mode.READY||n.mode===d.Mode.FEEDBACK){S=e.callData&&e.callData.conversation;var b=yu(e.participants[e.me],e.imHash,S,{token:e.anonymSecret,config:e.config,localVideoResolution:e.localVideoResolution,friends:e.friends,friendsCache:e.friendsCache,friendsCount:e.friendsCount,privacySettings:e.privacySettings,ipSettingEnabled:e.ipSettingEnabled,isDev:e.isDev});return n.mode===d.Mode.FEEDBACK&&(b.mode=d.Mode.FEEDBACK,b.lastCallData={callId:null!==(c=null===(l=e.callData)||void 0===l?void 0:l.callId)&&void 0!==c?c:"",peerId:null!==(u=e.peer)&&void 0!==u?u:0}),b.virtualBackgroundSettings=e.virtualBackgroundSettings,b.misc=e.misc,e.hangupType===G.HangupType.BUSY?b.lastCallData=(0,i.__assign)((0,i.__assign)({},b.lastCallData||{}),{opponentName:null===(_=e.participants[e.peer])||void 0===_?void 0:_.name}):e.hangupType!==G.HangupType.KILLED&&e.hangupType!==G.HangupType.KILLED_WITHOUT_DELETE||(b.lastCallData=(0,i.__assign)((0,i.__assign)({},b.lastCallData||{}),{isMeEndedCallForAll:null===(v=e.lastCallData)||void 0===v?void 0:v.isMeEndedCallForAll})),b}e.maps.vkIdToDevices.clear();var M=(0,i.__assign)((0,i.__assign)({},e),{mode:n.mode,peer:"peerId"in n&&void 0!==n.peerId?n.peerId:e.peer,callData:(0,i.__assign)((0,i.__assign)({},e.callData),{type:N,ts:n.ts||e.callData.ts||null}),hangupType:e.hangupType,entryPoint:n.entryPoint||e.entryPoint,join:(0,i.__assign)({},e.join||{})});return n.joinLink&&M.join&&(M.join.joinLink=n.joinLink),n.vkJoinLink&&M.join&&(M.join.vkJoinLink=n.vkJoinLink),M;case d.E_ACTION.HANGUP:return(0,i.__assign)((0,i.__assign)({},e),{hangupType:n.data});case d.E_ACTION.TIME_START:return(0,i.__assign)((0,i.__assign)({},e),{callData:(0,i.__assign)((0,i.__assign)({},e.callData),{ts:n.data})});case d.E_ACTION.LOCAL_TIME_START:return(0,i.__assign)((0,i.__assign)({},e),{callData:(0,i.__assign)((0,i.__assign)({},e.callData),{localTimeStamp:n.data})});case d.E_ACTION.REMOVE_USER:var w=(0,k.externalIdToString)(n.participantId),O=e.devices[w]?function(e,n,t){var a;return(0,i.__assign)((0,i.__assign)({},e),{devices:(0,i.__assign)((0,i.__assign)({},e.devices),(a={},a[n]=(0,i.__assign)((0,i.__assign)({},e.devices[n]),t),a))})}(e,w,{status:void 0,statusData:void 0,wasConnected:void 0,mediaSettings:{},stream:void 0,screenSharingStream:void 0}):(0,i.__assign)({},e);if(null===(p=e.maps.vkIdToDevices.get(+n.participantId.id))||void 0===p||p.delete(w),e.screenSharers[w]&&delete O.screenSharers[w],(0,k.isSameExternalId)(e.orator,n.participantId)&&(O.orator=null),(0,k.isSameExternalId)(e.pinnedParticipant,n.participantId)&&(O.pinnedParticipant=null),(0,k.isSameExternalId)(e.adminPinnedParticipant,n.participantId)&&(O.adminPinnedParticipant=null),(0,k.isSameExternalId)(e.screenSharingPinnedParticipant,n.participantId)&&(O.screenSharingPinnedParticipant=null),e.participantsAddedByMe.has(+n.participantId.id)){var P=new Set(e.participantsAddedByMe);P.delete(+n.participantId.id),O.participantsAddedByMe=P}return O;case d.E_ACTION.SET_CHAT_INFO:return(0,i.__assign)((0,i.__assign)({},e),{chatMembers:n.data,chatData:n.conversation});case d.E_ACTION.GROUP_CALL_SETUP:return(0,i.__assign)((0,i.__assign)({},e),{groupCallSetup:n.open,peer:n.peerId||e.peer||0,preselectedIds:n.preselectedIds});case d.E_ACTION.TOGGLE_POPUP:return(0,i.__assign)((0,i.__assign)({},e),{popup:n.data||null});case d.E_ACTION.UPDATE_HASH:return(0,i.__assign)((0,i.__assign)({},e),{imHash:n.hash});case d.E_ACTION.CHANGE_UI_MODE:return(0,i.__assign)((0,i.__assign)({},e),{uiMode:n.mode||d.UIMode.DEFAULT});case d.E_ACTION.TOGGLE_ORATOR_MODE:return(0,i.__assign)((0,i.__assign)({},e),{isOratorMode:n.isOratorMode});case d.E_ACTION.TOGGLE_PARTICIPANTS_ASIDE:return(0,i.__assign)((0,i.__assign)({},e),{isShownParticipantsAside:n.isShownParticipantsAside});case d.E_ACTION.SET_ORATOR:return(0,i.__assign)((0,i.__assign)({},e),{orator:n.orator||null});case d.E_ACTION.SET_PINNED_PARTICIPANT:return(0,i.__assign)((0,i.__assign)({},e),{pinnedParticipant:n.pinnedParticipant});case d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT:return(0,i.__assign)((0,i.__assign)({},e),{adminPinnedParticipant:n.data});case d.E_ACTION.SET_SCREEN_SHARING_PINNED_PARTICIPANT:return(0,i.__assign)((0,i.__assign)({},e),{screenSharingPinnedParticipant:n.screenSharingPinnedParticipant,screenSharingNeedDisableOratorModeAfterStop:!!n.screenSharingNeedDisableOratorModeAfterStop,screenSharingOldPinnedParticipant:n.screenSharingOldPinnedParticipant||null});case d.E_ACTION.SET_MOVIE_SHARING_PINNED_PARTICIPANT:return(0,i.__assign)((0,i.__assign)({},e),{movieSharingPinnedParticipant:n.data});case d.E_ACTION.MANAGEMENT:return(0,i.__assign)((0,i.__assign)({},e),{isManagementOpen:n.isOpen,managementView:n.managementView});case d.E_ACTION.CALL_STATE:M=(0,i.__assign)((0,i.__assign)({},e),{callData:(0,i.__assign)((0,i.__assign)({},e.callData),n.callData),join:(0,i.__assign)({},e.join||{}),externalId:n.externalId||e.externalId});return n.joinLink&&M.join&&(M.join.joinLink=n.joinLink),n.vkJoinLink&&M.join&&(M.join.vkJoinLink=n.vkJoinLink),M;case d.E_ACTION.CALL_NOTIFICATION:return(0,i.__assign)((0,i.__assign)({},e),{notification:n.notification});case d.E_ACTION.JOIN:return(0,i.__assign)((0,i.__assign)({},e),{mode:d.Mode.JOIN,join:n.data});case d.E_ACTION.CALL_BY_NAME:return(0,i.__assign)((0,i.__assign)({},e),{mode:d.Mode.CALL_BY,callByName:n.data});case d.E_ACTION.ERROR:return(0,i.__assign)((0,i.__assign)({},e),{mode:n.handleType===d.ErrorHandleType.FATAL?d.Mode.ERROR:e.mode,errorShown:!n.isClosed,error:{title:n.title,text:n.text,handleType:n.handleType,callId:n.callId}});case d.E_ACTION.CHANGE_PARTICIPANT_ROLES:w=n.participantId;return(0,i.__assign)((0,i.__assign)({},e),{participants:(0,i.__assign)((0,i.__assign)({},e.participants),(o={},o[w]=(0,i.__assign)((0,i.__assign)({},e.participants[w]||{}),{roles:n.data}),o))});case d.E_ACTION.SET_SCREEN_SHARER:return(0,i.__assign)((0,i.__assign)({},e),{screenSharers:(0,i.__assign)((0,i.__assign)({},e.screenSharers),(r={},r[(0,k.externalIdToString)(n.participantId)]=n.isScreenSharingEnabled,r))});case d.E_ACTION.SET_FRIENDS:return(0,i.__assign)((0,i.__assign)({},e),{friends:n.data,friendsCache:(0,$e.createFriendsCache)(n.data),friendsCount:n.friendsCount});case d.E_ACTION.SET_GROUP_MEMBERS:return(0,i.__assign)((0,i.__assign)({},e),{groupMembersCount:n.groupMembersCount,groupMembers:n.groupMembers,unableToCallGroupMembersIds:n.unableToCallGroupMembersIds,groupMembersCache:(0,$e.createFriendsCache)(n.groupMembers)});case d.E_ACTION.SET_SPEAKERS:var L=n.data,D=L.speakers,R=L.speakersInHeader;return e=(0,i.__assign)((0,i.__assign)({},e),{speakers:D||e.speakers,speakersInHeader:R||e.speakersInHeader});case d.E_ACTION.UPDATE_PARTICIPANTS_BATCH:return function(e,n){var t=(0,i.__assign)((0,i.__assign)({},e),{devices:(0,i.__assign)({},e.devices)}),a=e.maps.vkIdToDevices;return(0,Qe.objectForEach)(n,(function(o){var r=(0,k.externalIdToString)(o.externalId),s=e.devices[r]||{};if(void 0===(null==s?void 0:s.status)&&o.status===G.ParticipantStatus.HANGUP)delete t.devices[r];else{var l=a.get(+o.externalId.id);l||(l=new Set,a.set(+o.externalId.id,l)),l.add(r);var c=o.statusData?(0,i.__assign)((0,i.__assign)({},s.statusData),o.statusData):s.statusData,d=s.wasConnected||o.status===G.ParticipantStatus.CONNECTED,u=Object.assign({},s.mediaSettings,o.mediaSettings);t.devices[r]=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},e.devices[r]),n[r]),{statusData:c,wasConnected:d,mediaSettings:u})}})),t}(e,n.data);case d.E_ACTION.REMOVE_DEVICE_FROM_CACHE:var j=(0,i.__assign)({},e.devices);return delete j[w=n.id],(0,i.__assign)((0,i.__assign)({},e),{devices:j});case d.E_ACTION.SET_UNREAD_COUNT:return(0,i.__assign)((0,i.__assign)({},e),{chatUnreadCount:n.chatUnreadCount,chatUpToMsgId:"chatUpToMsgId"in n?n.chatUpToMsgId:e.chatUpToMsgId});case d.E_ACTION.SHOW_CAUTION_BOX:return(0,i.__assign)((0,i.__assign)({},e),{cautionShown:n.isOpen,isIncoming:n.isIncoming||e.isIncoming});case d.E_ACTION.SHOW_LOADER:return(0,i.__assign)((0,i.__assign)({},e),{isLoaderVisible:n.isLoaderVisible});case d.E_ACTION.SET_ENTRYPOINT:return(0,i.__assign)((0,i.__assign)({},e),{entryPoint:n.entryPoint});case d.E_ACTION.SET_TOOLTIP:var B=n.tooltips?n.tooltips:Object.keys(e.tooltips).reduce((function(e,n){return e[n]=!1,e}),{});return(0,i.__assign)((0,i.__assign)({},e),{tooltips:(0,i.__assign)((0,i.__assign)({},e.tooltips),B)});case d.E_ACTION.MANUAL_ADD_PARTICIPANTS:return(0,i.__assign)((0,i.__assign)({},e),{participantsAddedByMe:(n.participants||[]).reduce((function(e,n){return e.add(n),e}),new Set(e.participantsAddedByMe))});case d.E_ACTION.SET_TRANSLATION:return(0,i.__assign)((0,i.__assign)({},e),{translation:(0,i.__assign)((0,i.__assign)({},e.translation),n.data)});case d.E_ACTION.UPDATE_ANON_SECRET:return(0,i.__assign)((0,i.__assign)({},e),{anonymSecret:n.secret});case d.E_ACTION.TOGGLE_PARTICIPANTS_KICK:return(0,i.__assign)((0,i.__assign)({},e),{participantKick:n.data?{participant:n.data.participant,type:n.data.type}:null});case d.E_ACTION.UNBAN_PARTICIPANTS:return(0,i.__assign)((0,i.__assign)({},e),{membersUnban:n.data?{members:n.data.members}:null});case d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT:return(0,i.__assign)((0,i.__assign)({},e),{participantsManagement:n.data?{mode:n.data.mode,device:n.data.device}:null});case d.E_ACTION.TOGGLE_ADMIN_ASSIGNMENT:return(0,i.__assign)((0,i.__assign)({},e),{adminAssignment:n.data?{participant:n.data.participant}:null});case d.E_ACTION.SET_NOISE_CANCELLATION:return(0,i.__assign)((0,i.__assign)({},e),{noiseCancellation:n.data});case d.E_ACTION.CHANGE_LOCAL_VIDEO_RESOLUTION:return(0,i.__assign)((0,i.__assign)({},e),{localVideoResolution:n.data});case d.E_ACTION.SET_CONVERSATION_OPTIONS:return(0,i.__assign)((0,i.__assign)({},e),{conversationOptions:n.data});case d.E_ACTION.SET_PRIVACY_SETTINGS:return(0,i.__assign)((0,i.__assign)({},e),{privacySettings:n.data});case d.E_ACTION.SET_GROUP:return(0,i.__assign)((0,i.__assign)({},e),{groupId:n.groupId,meGroup:n.meGroup});case d.E_ACTION.SET_WAITING_HALL:return(0,i.__assign)((0,i.__assign)({},e),{waitingHall:n.data});case d.E_ACTION.SET_PUSH_TO_TALK_ENABLE:return(0,i.__assign)((0,i.__assign)({},e),{pushToTalkEnabled:n.data});case d.E_ACTION.SET_GRID_SCROLL_POSITION:return(0,i.__assign)((0,i.__assign)({},e),{gridScrollPosition:n.position,gridScrollFirstVisible:n.firstVisible});case d.E_ACTION.SET_ORATOR_SCROLL_POSITION:return(0,i.__assign)((0,i.__assign)({},e),{oratorScrollPosition:n.position,oratorScrollFirstVisible:n.firstVisible,oratorScrollNumberOfVisible:n.numberOfVisible});case d.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION:return(0,i.__assign)((0,i.__assign)({},e),{shouldShowDesktopAppNotification:n.data});case d.E_ACTION.SET_SHOW_WARNING_DESKTOP_NOTIFICATION:return(0,i.__assign)((0,i.__assign)({},e),{shouldShowWarningDesktopAppNotification:n.data});case d.E_ACTION.SET_START_OPTIONS:return(0,i.__assign)((0,i.__assign)({},e),{startOptions:n.data});case d.E_ACTION.VB_SET_USER_PHOTOS:return bu(e,{photos:(0,i.__spreadArray)([],(0,i.__read)(n.photos),!1)});case d.E_ACTION.VB_ADD_USER_PHOTO:return bu(e,{photos:(0,i.__spreadArray)([n.photo],(0,i.__read)(e.virtualBackgroundSettings.photos),!1)});case d.E_ACTION.VB_REMOVE_USER_PHOTO:return bu(e,{photos:e.virtualBackgroundSettings.photos.filter((function(e){return e.id!==n.photoId}))});case d.E_ACTION.VB_SET_VIDEO_OPTIONS:return bu(e,{videoOptions:n.videoOptions});case d.E_ACTION.SET_CALL_PERMISSIONS:return(0,s.isEqual)(n.data,e.permissions)?e:(0,i.__assign)((0,i.__assign)({},e),{permissions:n.data});case d.E_ACTION.SET_PARTICIPANTS_CHUNK:return(0,i.__assign)((0,i.__assign)({},e),{participantsChunk:(0,i.__assign)({countBefore:null!==(h=null===(f=e.participantsChunk)||void 0===f?void 0:f.countBefore)&&void 0!==h?h:0,ids:null!==(m=null===(g=e.participantsChunk)||void 0===g?void 0:g.ids)&&void 0!==m?m:[],countAfter:null!==(C=null===(A=e.participantsChunk)||void 0===A?void 0:A.countAfter)&&void 0!==C?C:0},n.data)});case d.E_ACTION.SET_PARTICIPANT_HAND_STATE:var U=n.key,H=n.value,V=e.handState;if((null!==(E=null==V?void 0:V[U])&&void 0!==E&&E)===H)return e;var F=(0,i.__assign)({},V);return F[U]=H,H||delete F[U],(0,i.__assign)((0,i.__assign)({},e),{handState:F});case d.E_ACTION.CLEAN_LAST_CALL_DATA:return Mu(e,{opponentName:void 0,isMeEndedCallForAll:void 0});case d.E_ACTION.SET_LAST_CALL_DATA:return Mu(e,n.data);case d.E_ACTION.SET_LOCAL_DEVICE:return(0,i.__assign)((0,i.__assign)({},e),{localDevice:(0,i.__assign)((0,i.__assign)({},e.localDevice),n.data)});case d.E_ACTION.SET_PLANNED_CALENDAR_EVENT:return wu(e,{plannedCalendarEvent:n.data});case d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING:return wu(e,{popupCalendarPlanning:n.data});case d.E_ACTION.SET_PLANNED_CALENDAR_EVENT_OWNER_OPTIONS:return wu(e,{plannedCalendarEventOwnerOptions:n.data});case d.E_ACTION.UPDATE_SHARED_MOVIE_STATE:return(0,i.__assign)((0,i.__assign)({},e),{streamedMovieState:e.streamedMovieState?(0,i.__assign)((0,i.__assign)({},e.streamedMovieState),n.data):n.data});case d.E_ACTION.SET_COMMON_SHARED_MOVIE_INFO:return(0,i.__assign)((0,i.__assign)({},e),{commonStreamedMovieInfo:n.data});case d.E_ACTION.SET_SHOW_RECORD_ENDED_DESKTOP_NOTIFICATION:return(0,i.__assign)((0,i.__assign)({},e),{shouldShowRecordEndedDesktopAppNotification:n.data});case d.E_ACTION.SET_SHARED_MOVIE_OWNER:return(0,i.__assign)((0,i.__assign)({},e),{sharedMovieOwner:n.data});default:return e}}function bu(e,n){return(0,i.__assign)((0,i.__assign)({},e),{virtualBackgroundSettings:(0,i.__assign)((0,i.__assign)({},e.virtualBackgroundSettings),n)})}function Mu(e,n){return(0,i.__assign)((0,i.__assign)({},e),{lastCallData:(0,i.__assign)((0,i.__assign)({},e.lastCallData||{}),n)})}function wu(e,n){return(0,i.__assign)((0,i.__assign)({},e),{misc:(0,i.__assign)((0,i.__assign)({},e.misc||{}),n)})}var Ou=t(87080);function Pu(e,n){switch(n.type){case Ou.HistoryScreenActionTypes.DELETE_CALL:return(0,i.__assign)((0,i.__assign)({},e),{deleteCallId:n.data});case Ou.HistoryScreenActionTypes.SET_CURRENT_CALLS:return(0,i.__assign)((0,i.__assign)({},e),{currentCalls:n.data});case Ou.HistoryScreenActionTypes.SET_HISTORY_CALLS:return(0,i.__assign)((0,i.__assign)({},e),{historyCalls:n.data});case Ou.HistoryScreenActionTypes.SET_PROFILES:return(0,i.__assign)((0,i.__assign)({},e),{profiles:(0,i.__assign)((0,i.__assign)({},e.profiles),n.data)});case Ou.HistoryScreenActionTypes.SET_URLS:return(0,i.__assign)((0,i.__assign)({},e),{joinLinks:(0,i.__assign)((0,i.__assign)({},e.joinLinks),n.data)});case Ou.HistoryScreenActionTypes.ERROR:return(0,i.__assign)((0,i.__assign)({},e),{error:n.data});case Ou.HistoryScreenActionTypes.SET_LOADING:return(0,i.__assign)((0,i.__assign)({},e),{loading:n.data});case Ou.HistoryScreenActionTypes.SET_SHOW_CREATE_BUTTON:return(0,i.__assign)((0,i.__assign)({},e),{showCreateCall:n.data});case Ou.HistoryScreenActionTypes.SET_SCHEDULED_CALLS:return(0,i.__assign)((0,i.__assign)({},e),{scheduledCalls:n.data?(0,i.__assign)((0,i.__assign)({},e.scheduledCalls||{}),n.data):void 0});case Ou.HistoryScreenActionTypes.SET_SCHEDULED_CALLS_PREVIEW:return(0,i.__assign)((0,i.__assign)({},e),{scheduledCallsPreview:n.data?(0,i.__assign)((0,i.__assign)({},e.scheduledCallsPreview||{}),n.data):void 0});case Ou.HistoryScreenActionTypes.SET_POPUP:return(0,i.__assign)((0,i.__assign)({},e),{popup:n.data});case Ou.HistoryScreenActionTypes.SET_SCHEDULED_EDITABLE_CALL:return(0,i.__assign)((0,i.__assign)({},e),{scheduledEditableCall:n.data});case Ou.HistoryScreenActionTypes.SET_CALLS_QUEUE_RESPONSE:return(0,i.__assign)((0,i.__assign)({},e),{callsQueueResponse:n.data});default:return e}}var ku=function(e){var n=e.onClose,t=e.actionButtons,a=e.text,r=ze().getLang;return(0,o.jsx)(Qa.default,(0,i.__assign)({className:"DeleteCallModal",title:r("calls_history_delete_modal_title"),actionButtons:t,onClose:n,appearance:"blue"},{children:(0,o.jsx)("div",(0,i.__assign)({className:"DeleteCallModal__content"},{children:a}),void 0)}),void 0)},Lu=t(95098),Du=c.useSelector,Ru=function(){return(0,c.useDispatch)()},ju=t(50611),Bu=function(){var e=Ru(),n=ze(),t=n.getLang,a=n.langShortDateTime,r=Du((function(e){return e.deleteCallId})),s=Du((function(e){return e.profiles})),c=Du((function(e){return e.historyCalls})),d=Du((function(e){return e.currentCalls})),u=r in c?c[r]:null,_=(0,l.useCallback)((function(){e((0,ju.dispatchDeleteCall)(-1))}),[]),v=(0,l.useCallback)((function(){if((null==u?void 0:u.type)&&"merged"===(null==u?void 0:u.type)&&(null==u?void 0:u.items)){var n=u.items.reduce((function(e,n){return(null==n?void 0:n.id)&&e.push(n.id),e}),[]);n.length>0&&(0,G.removeHistoryRecords)(n)}else(null==u?void 0:u.id)&&(0,G.removeHistoryRecords)([u.id]);c.splice(r,1),e((0,ju.dispatchSetHistoryCalls)((0,i.__spreadArray)([],(0,i.__read)(c),!1))),_()}),[u]),p=(0,l.useCallback)((function(){if(null==u?void 0:u.call_id){(0,qe.forceCallFinish)(u.call_id);var n=d.filter((function(e){return e.call_id!==u.call_id}));e((0,ju.dispatchSetCurrentCalls)(n))}v()}),[u]),f=[];if((null==u?void 0:u.can_finish_call)&&(f=f.concat([(0,o.jsx)(_i.default,(0,i.__assign)({onClick:function(){p()},appearance:"secondary"},{children:t("calls_history_delete_and_finish_call_button")}),"finishAndDeleteCall")])),f=f.concat([(0,o.jsx)(_i.default,(0,i.__assign)({onClick:function(){v()}},{children:t("calls_history_delete_call_button")}),"deleteCall")]),!u)return(0,o.jsx)(o.Fragment,{},void 0);var h=(0,Lu.getHistoryItemOwner)(u,s),g=h.member,m=h.chat;if(!g&&!m)return(0,o.jsx)(o.Fragment,{},void 0);var A="";if(m)A=t("calls_history_delete_group_call").replace("%name",(0,Qe.shorten)(m.title,50));else{if(!g)return(0,o.jsx)(o.Fragment,{},void 0);var C=u.is_missed,E=u.is_inbound;A=(A=t(C&&E?"calls_history_delete_missed_call":!C&&E?"calls_history_delete_inbound_call":C&&!E?"calls_history_delete_declined_call":"calls_history_delete_outbound_call")).replace("%name",String(g.nameGen||g.name))}var S=(null==u?void 0:u.finished_at)?a(u.finished_at):"";return A=A.replace("%date",S),(0,o.jsx)(ku,{onClose:_,actionButtons:f,text:A},void 0)},Uu=t(69050),Hu=t(84330),Vu=t(3244),Gu=t(6057);const Fu=(0,F.makeIcon)("Icon16CalendarOutline","calendar_outline_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="calendar_outline_16"><path fill="currentColor" d="M12 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" /><path fill="currentColor" fill-rule="evenodd" d="M5 .5a.75.75 0 0 1 .75.75v.25H10.251v-.25a.75.75 0 0 1 1.5 0v.318c.347.047.669.13.975.286a3.25 3.25 0 0 1 1.42 1.42c.199.391.28.81.317 1.273.037.448.037.998.037 1.672V9.78c0 .674 0 1.224-.037 1.672-.037.463-.118.882-.317 1.272a3.25 3.25 0 0 1-1.42 1.42c-.391.2-.81.28-1.273.318-.447.037-.998.037-1.671.037H6.219c-.674 0-1.224 0-1.672-.037-.463-.037-.882-.118-1.272-.317a3.25 3.25 0 0 1-1.42-1.42c-.2-.391-.28-.81-.318-1.273-.037-.447-.037-.998-.037-1.672V6.22c0-.674 0-1.224.037-1.672.037-.463.118-.882.317-1.272a3.25 3.25 0 0 1 1.42-1.42c.306-.156.628-.24.976-.287V1.25A.75.75 0 0 1 5 .5ZM10.25 3v.25a.75.75 0 0 0 1.5 0v-.16c.125.028.218.062.294.1a1.75 1.75 0 0 1 .765.766c.074.144.13.343.16.713.027.333.03.751.03 1.331H3c0-.58.004-.998.032-1.331.03-.37.085-.57.159-.713a1.75 1.75 0 0 1 .764-.765c.077-.04.17-.073.295-.101v.16a.75.75 0 1 0 1.5 0V3h4.5ZM3 7.5v2.25c0 .712 0 1.202.032 1.58.03.371.085.57.159.714a1.75 1.75 0 0 0 .765.765c.144.074.343.13.713.16.38.03.869.031 1.581.031h3.5c.712 0 1.202 0 1.58-.032.371-.03.57-.085.714-.159a1.75 1.75 0 0 0 .765-.765c.074-.144.13-.343.16-.713.03-.38.031-.869.031-1.581V7.5H3Z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0);var Zu=function(e){var n=e.onCreateCallClick,t=e.onPlanCalendarEvent,a=ze().getLang;return(0,o.jsx)(Vu.default,(0,i.__assign)({title:"",isSaved:!1,savedTitle:"",className:""},{children:(0,o.jsx)(Ja.default,(0,i.__assign)({className:"CallHistoryScreenCreateCall",border:!1},{children:(0,o.jsx)(Xa.default,(0,i.__assign)({chevron:!1,selectable:!1,aside:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(_i.default,(0,i.__assign)({className:"CallHistoryScreenCreateCall__plan-calendar-btn",onClick:n,size:"s"},{children:[(0,o.jsx)(Gu.default,{width:16,height:16},void 0),a("calls_page_call_by_link_create")]}),void 0),(0,o.jsxs)(_i.default,(0,i.__assign)({className:"CallHistoryScreenCreateCall__plan-calendar-btn",onClick:t,appearance:"secondary",size:"s"},{children:[(0,o.jsx)(Fu,{},void 0),a("calls_landing_standalone_schedule_call")]}),void 0)]},void 0)},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreenCreateCall--title"},{children:a("calls_page_call_by_link_header_v2")}),void 0)}),void 0)}),void 0)}),void 0)},Wu=function(e){var n=e.showCreateCall,t=e.onCreateCallClick,a=e.activeMenuItem,r=e.menuItems,s=e.onMenuItemClick,l=e.loading,c=e.banner,d=e.children,u=e.onPlanCalendarEvent;return(0,o.jsx)(Uu.PageColumns,(0,i.__assign)({narrow:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Hu.RightMenu,{tabs:r,activeTab:a,onTabClick:s,loading:l},void 0),c]},void 0)},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreen"},{children:[n&&(0,o.jsx)(Zu,{onCreateCallClick:function(){return t(no.CallStatSource.HISTORY_CREATE)},onPlanCalendarEvent:u},void 0),d]}),void 0)}),void 0)},zu=(0,l.createContext)({bridge:{},SDK:{}}),Ku=function(){return(0,l.useContext)(zu)},Qu=function(){var e=Ku().bridge,n=(0,l.useCallback)((function(n){e.showCreateCallByLinkPopup(n)}),[e]),t=(0,l.useCallback)((function(n,t,a){void 0===t&&(t=0),e.showStartCallModal(t,n,a)}),[e]),a=(0,l.useCallback)((function(){e.showPlanCalendarEventPopup()}),[e]),i=(0,l.useCallback)((function(n){var t;null===(t=e.setPlannedCalendarEvent)||void 0===t||t.call(e,n)}),[e]);return{onCreateCallClick:n,onJoin:t,onPlanCalendarEvent:a,setPlannedCalendarEvent:i}},Yu=function(){var e=Du((function(e){return e.loading})),n=Ru(),t=(0,l.useCallback)((function(e){n((0,ju.dispatchSetLoading)(e))}),[]);return{loading:e,setLoading:t}};const Ju=(0,F.makeIcon)("Icon12ArrowDownLeft","arrow_down_left_12","0 0 12 12",'<symbol fill="none" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg" id="arrow_down_left_12"><path d="M3 10a1 1 0 0 1-1-1V4a1 1 0 0 1 2 0v2.586l4.293-4.293a1 1 0 0 1 1.414 1.414L5.415 8.001 8 8a1 1 0 0 1 0 2z" fill="currentColor" /></symbol>',12,12,!1,void 0),Xu=(0,F.makeIcon)("Icon12ArrowUpRight","arrow_up_right_12","0 0 12 12",'<symbol fill="none" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg" id="arrow_up_right_12"><path d="M9 2a1 1 0 0 1 1 1v5a1 1 0 0 1-2 0V5.414L3.707 9.707a1 1 0 0 1-1.414-1.414l4.292-4.294L4 4a1 1 0 0 1 0-2z" fill="currentColor" /></symbol>',12,12,!1,void 0);var qu=t(67458),$u=t(39446);const e_=(0,F.makeIcon)("Icon24PhoneOutline","phone_outline_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="phone_outline_24"><g fill="none"><path d="M0 0h24v24H0z" /><path d="M4.477 4.116c-2.924 3.217-1.362 8.196 2.932 12.51 4.204 4.222 9.407 5.8 12.486 2.936 1.685-1.567 1.436-4.343-.645-6.198l-.19-.161c-1.931-1.563-4.734-1.568-6.445-.027l-.088.082-.05-.042c-.187-.16-.43-.381-.724-.673l-.298-.303-.306-.326c-.092-.101-.174-.194-.246-.277l-.124-.147-.07.075c1.69-1.697 1.706-4.72.006-6.75-1.887-2.255-4.75-2.335-6.238-.699zM9.335 5.97c1.18 1.41 1.049 3.371.099 4.325l-.148.14c-.63.567-1.246.901 1.032 3.218 2.458 2.499 2.765 1.622 3.405.952 1.006-1.01 2.975-1.104 4.329.103 1.497 1.334 1.335 2.868.617 3.536-2.222 2.067-6.476.636-9.984-2.888-3.507-3.523-5.064-7.622-2.876-10.03.508-.558 2.101-1.057 3.526.644z" fill="currentColor" /></g></symbol>',24,24,!1,void 0),n_=(0,F.makeIcon)("Icon24VideocamOutline","videocam_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="videocam_outline_24"><path fill="currentColor" fill-rule="evenodd" d="M1 10.9c0-2.24 0-3.36.436-4.216a4 4 0 0 1 1.748-1.748C4.04 4.5 5.16 4.5 7.4 4.5h3.2c2.24 0 3.36 0 4.216.436a4 4 0 0 1 1.748 1.748c.155.305.255.643.32 1.053l.577-.414c.948-.68 1.422-1.02 1.785-1.15a2.8 2.8 0 0 1 3.65 1.874C23 8.418 23 9 23 10.167v4.02c0 1.04 0 1.56-.093 1.9a2.6 2.6 0 0 1-3.309 1.781c-.335-.109-.769-.395-1.637-.967l-1.067-.704c-.064.44-.167.798-.33 1.119a4 4 0 0 1-1.748 1.748c-.856.436-1.976.436-4.216.436H7.4c-2.24 0-3.36 0-4.216-.436a4 4 0 0 1-1.748-1.748C1 16.46 1 15.34 1 13.1v-2.2Zm6.4-4.6h3.2c1.15 0 1.904.001 2.48.049.556.045.787.124.919.19a2.2 2.2 0 0 1 .961.962c.067.132.146.363.191.918.048.577.049 1.331.049 2.481v2.2c0 1.15-.001 1.904-.048 2.48-.046.556-.125.787-.192.919a2.2 2.2 0 0 1-.961.961c-.132.067-.363.146-.918.191-.577.048-1.331.049-2.481.049H7.4c-1.15 0-1.904-.001-2.48-.049-.556-.045-.787-.124-.919-.19a2.2 2.2 0 0 1-.961-.962c-.067-.132-.146-.363-.191-.918C2.8 15.004 2.8 14.25 2.8 13.1v-2.2c0-1.15.001-1.904.049-2.48.045-.556.124-.787.19-.919a2.2 2.2 0 0 1 .962-.961c.132-.067.363-.146.918-.192C5.496 6.301 6.25 6.3 7.4 6.3Zm10.153 3.172.957-.686c.486-.348.808-.579 1.054-.741l.295-.18a1 1 0 0 1 1.302.663s.017.084.027.35c.012.296.012.692.012 1.29v4.02c0 .534 0 .883-.01 1.142a2.89 2.89 0 0 1-.022.288.8.8 0 0 1-1.004.541 2.852 2.852 0 0 1-.253-.14 33.487 33.487 0 0 1-.959-.62l-1.356-.895a247.905 247.905 0 0 1-.35-.237.7.7 0 0 1-.24-.446S17 13.422 17 13.398v-2.85l.005-.403a.7.7 0 0 1 .223-.434s.307-.226.325-.24Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0);var t_,a_=t(81536);!function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO",e[e.MESSAGE=2]="MESSAGE",e[e.DELETE=3]="DELETE"}(t_||(t_={}));var i_=function(e,n){void 0===n&&(n=0);var t="";if(n){var a=new Date(n);if((0,s.isDateToday)(a)){var i=(0,s.leadingZero)(a.getMinutes());t=a.getHours()+":"+i}else t=n?e(n,!1):""}return t},o_=function(e,n,t){return{text:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItem"},{children:[e,(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemText"},{children:n}),void 0)]}),void 0),onClick:t}},r_=(0,l.memo)((function(e){var n=e.index,t=e.call,a=e.onMenuItemClick,r=e.selectedOwnerId,c=void 0===r?0:r,d=Du((function(e){return e.profiles})),u=ze(),_=u.getLang,v=u.langShortDate,p=(0,Lu.getHistoryItemOwner)(t,d),f=p.member,h=p.chat,g=(0,l.useMemo)((function(){var e=t.type,r=t.items,l=t.started_at,c=t.finished_at,d="";l&&c&&(d=(0,s.formatDuration)(Math.floor((c-l)/1e3)));var u=function(e){if(void 0===e&&(e=0),!e)return{date:"",time:""};var n=new Date(e),t=n.getDate(),a=n.getMonth()+1,i=n.getFullYear(),o=n.getHours(),r=n.getMinutes();return{date:[(0,s.leadingZero)(t),(0,s.leadingZero)(a),i].join("."),time:[(0,s.leadingZero)(o),(0,s.leadingZero)(r)].join(":")}}(c),p=u.date,g=u.time,m=h?function(e,n,t,a){var i=t.title,o=void 0===i?"":i,r=t.photo_100,s=void 0===r?"":r,l=t.id,c=void 0===l?0:l,d=a.finished_at,u=void 0===d?0:d,_=c?"/im?sel=c"+c:"",v=e("calls_history_call_type_group_hint"),p=i_(n,u);return{title:o,href:_,hint:p?e("calls_history_call_type_group_time_hint").replace("{time}",p):"",photo:s,status:v}}(_,v,h,t):f?function(e,n,t,a){var r=t.name,l=void 0===r?"":r,c=t.photo,d=void 0===c?"":c,u=t.id,_=void 0===u?0:u,v=t.link,p=void 0===v?"":v,f=a.is_inbound,h=void 0!==f&&f,g=a.finished_at,m=void 0===g?0:g,A=a.reach_status,C=void 0===A?"":A,E=h?(0,o.jsx)(Ju,{className:"CallHistoryListItem--hintIcon"},void 0):(0,o.jsx)(Xu,{className:"CallHistoryListItem--hintIcon"},void 0),S=i_(n,m),I="",T=!1;return h?"CANCELLED_BY_INITIATOR"===C?(I=e("calls_history_status_inb_cancelled_by_initiator"),T=!0):I=e("REACHED"===C?"calls_history_status_inb_reached":"REJECTED_BY_RECEIVER"===C?"calls_history_status_inb_reject_by_receiver":"calls_history_status_inb"):"CANCELLED_BY_INITIATOR"===C?I=e("calls_history_status_out_cancelled_by_initiator"):"REACHED"===C?I=e("calls_history_status_out_reached"):"REJECTED_BY_RECEIVER"===C?(I=e("calls_history_status_out_reject_by_receiver"),T=!0):I=e("calls_history_status_out"),{title:l,href:p||"/id"+_,hint:(0,o.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("CallHistoryListItem",{"CallHistoryListItem--important":T})},{children:[E,e("calls_history_call_list_item_description").replace("%type",I).replace("%time",S)]}),void 0),photo:d,status:I}}(_,v,f,t):{},A=m.title,C=void 0===A?"":A,E=m.photo,S=void 0===E?"":E,I=m.href,T=void 0===I?"":I,x=m.hint,y=void 0===x?"":x,N=m.status,b=void 0===N?"":N;C+="merged"===e?" ("+(null==r?void 0:r.length)+")":"";var M=(0,Lu.getHistoryCallPeerId)(t),w=[],O=function(e){return function(){return a(t,e,n)}};return w.push({onClick:function(){},noHover:!0,text:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatus"},{children:[(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusFinishTime"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusDate"},{children:p}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusTime"},{children:g}),void 0)]}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusType"},{children:b}),void 0),!!d&&(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryListItem--dropdownItemStatusDuration"},{children:d}),void 0)]}),void 0)}),M&&(w.push(o_((0,o.jsx)(qu.default,{},void 0),_("calls_history_dropdown_item_message"),O(t_.MESSAGE))),w.push({separator:!0})),w.push(o_((0,o.jsx)($u.default,{},void 0),_("calls_history_dropdown_item_delete"),O(t_.DELETE))),{title:C,photo:S,href:T,hint:y,actions:w,peerId:M}}),[t]),m=g.title,A=g.photo,E=g.href,S=g.hint,I=g.actions,T=g.peerId;return f||h?(0,o.jsx)(Xa.default,(0,i.__assign)({className:"CallHistoryListItem",selectable:!1,canBeHovered:!1,aside:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryListItem--aside"},{children:[!!T&&!(null==h?void 0:h.left_or_kicked)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(C.default,(0,i.__assign)({marginTop:-7,position:"t",text:_("calls_history_join_with_audio")},{children:(0,o.jsx)(e_,{className:"CallHistoryScreen--friendsIcon CallHistoryScreen--friendsIconsPhone",onClick:function(){return a(t,t_.AUDIO,n,c)}},void 0)}),void 0),(0,o.jsx)(C.default,(0,i.__assign)({marginTop:-7,position:"t",text:_("calls_history_join_with_video")},{children:(0,o.jsx)(n_,{className:"CallHistoryScreen--friendsIcon",onClick:function(){return a(t,t_.VIDEO,n,c)}},void 0)}),void 0)]},void 0),(0,o.jsx)(ya.default,(0,i.__assign)({className:"CallHistoryListItem--asideMenu",trigger:"hover",align:"right",data:I},{children:(0,o.jsx)(a_.default,{className:"CallHistoryScreen--friendsIcon CallHistoryListItem--asidePointers"},void 0)}),void 0)]}),void 0)},{children:(0,o.jsx)(ui.default,{className:"CallHistoryListItem--entity",photo:A,title:m,href:E,description:S||_("calls_history_call_type_group_hint"),target:"_blank"},void 0)}),void 0):(0,o.jsx)(o.Fragment,{},void 0)})),s_=t(23985),l_=function(e){var n=e.calls,t=e.onMenuItemClick,a=e.stubText,r=e.hasMore,s=e.onLoadMore,l=e.selectedOwnerId,c=void 0===l?0:l;return(0,o.jsx)(s_.default,(0,i.__assign)({useWindowScroll:!0,hasMore:r,loadMore:s},{children:(0,o.jsxs)(Ja.default,(0,i.__assign)({className:"CallHistoryList",border:!1},{children:[n.map((function(e,n){return(0,o.jsx)(r_,{selectedOwnerId:c,onMenuItemClick:t,call:e,index:n},n)})),0===n.length&&(0,o.jsx)(ha.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:a}),void 0)]}),void 0)}),void 0)},c_=(0,l.createContext)({navigateToConvo:function(e){},navigateToProfile:function(e,n){}}),d_=function(){return(0,l.useContext)(c_)},u_=function(){var e=Du((function(e){return e.profiles})),n=Du((function(e){return e.joinLinks})),t=Ru(),a=d_().navigateToConvo,i=Ku().bridge,o=(0,l.useCallback)((function(o,r,s,l){var c;void 0===l&&(l=0);var u=(0,Lu.getHistoryCallPeerId)(o);if(r===t_.AUDIO||r===t_.VIDEO){if(i.isInActiveCall)return;var _=r===t_.VIDEO;if((0,M.isGroupCallByPeer)(u))if(u in n)i.joinCallByLink(n[u],void 0,_,d.CallStatSource.HISTORY,l);else{var v=(0,Lu.getHistoryItemOwner)(o,e).chat;(null==v?void 0:v.call_in_progress)&&(null===(c=null==v?void 0:v.call_in_progress)||void 0===c?void 0:c.join_link)?i.joinCallByLink(v.call_in_progress.join_link,void 0,_,d.CallStatSource.HISTORY,l):i.call(u,_,void 0,d.CallStatSource.HISTORY,l)}else i.call(u,_,void 0,d.CallStatSource.HISTORY,l)}else r===t_.MESSAGE?a(u):t((0,ju.dispatchDeleteCall)(s))}),[n,e,i]);return{onHistoryAction:o}},__=function(e){void 0===e&&(e="all");var n=(0,Gt.useIsMounted)(),t=Du((function(e){return e.historyCalls})),a=(0,c.useDispatch)(),o=Yu(),r=o.setLoading,s=o.loading,d=(0,i.__read)((0,l.useState)(!1),2),u=d[0],_=d[1],v=(0,i.__read)((0,l.useState)(0),2),p=v[0],f=v[1],h=(0,i.__read)((0,l.useState)(!1),2),g=h[0],m=h[1];(0,l.useEffect)((function(){r(!0),(0,ju.loadHistoryCalls)(a,25,p,0,e).then((function(e){var t,a;if(n())return _(null!==(t=e.has_more)&&void 0!==t&&t),f(null!==(a=e.next_from)&&void 0!==a?a:0),e})).then((function(e){e&&(0,ju.updateProfilesAndUrls)(a,[e]).then((function(e){m(!e)}))})).finally((function(){n()&&r(!1)}))}),[]);var A=function(t,i,o,r){return void 0===o&&(o=[]),void 0===r&&(r=!1),(0,ju.loadHistoryCalls)(a,25,t,i,e,o,r).then((function(e){var t,a;return!!n()&&(_(null!==(t=e.has_more)&&void 0!==t&&t),f(null!==(a=e.next_from)&&void 0!==a?a:0),e)})).then((function(e){return!!e&&(0,ju.updateProfilesAndUrls)(a,[e])}))};return{onShowMoreHistory:function(){return A(p,0,t)},loadHistory:A,loading:s,showMoreHistory:u,showLanding:g,setLoading:r}},v_=function(){var e=Du((function(e){return e.historyCalls})),n=ze().getLang,t=__("missed"),a=t.onShowMoreHistory,r=t.loading,s=t.showMoreHistory,l=u_().onHistoryAction;return r?(0,o.jsx)(Vu.default,{children:(0,o.jsx)(Sc.DivBlockSkeleton,{height:500},void 0)},void 0):(0,o.jsx)(Vu.default,(0,i.__assign)({title:n("calls_history_missed_list_header"),className:"CallHistoryScreen--content"},{children:(0,o.jsx)(l_,{calls:e,onMenuItemClick:l,stubText:n("calls_history_missed_list_stub"),hasMore:s,onLoadMore:a},void 0)}),void 0)},p_=t(25432),f_=t(60837),h_=function(e){var n=e.onChange,t=e.placeholder,a=e.className,r=(0,i.__read)((0,l.useState)(""),2),c=r[0],d=r[1];return(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("ui_search_new","ui_search",a)},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"ui_search_input_block"},{children:[(0,o.jsx)("button",(0,i.__assign)({className:"ui_search_button_search"},{children:(0,o.jsx)(f_.default,{},void 0)}),void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"ui_search_input_inner"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"ui_search_controls"},{children:!!c&&(0,o.jsx)("button",(0,i.__assign)({className:"ui_search_reset_button ui_search_button_control",onClick:function(){d(""),null==n||n("")}},{children:(0,o.jsx)(uu.default,{},void 0)}),void 0)}),void 0),(0,o.jsx)("form",(0,i.__assign)({onSubmit:function(e){e.preventDefault()}},{children:(0,o.jsx)("input",{type:"text",className:"ui_search_field",placeholder:t,value:c,onChange:function(e){e.preventDefault();var t=e.target.value;d(t),null==n||n(t)}},void 0)}),void 0)]}),void 0)]}),void 0)}),void 0)},g_=100;var m_=function(){var e=ze(),n=e.getLang,t=e.langShortDate,a=e.langNumeric,r=e.langSex,s=Du((function(e){return e.meId})),c=Yu(),u=c.setLoading,_=c.loading,v=Ku().bridge,p=(0,i.__read)((0,l.useState)([]),2),f=p[0],h=p[1],g=(0,i.__read)((0,l.useState)(!1),2),m=g[0],A=g[1],C=(0,i.__read)((0,l.useState)(0),2),E=C[0],S=C[1],I=(0,i.__read)((0,l.useState)(0),2),T=I[0],x=I[1],N=(0,i.__read)((0,l.useState)(""),2),b=N[0],M=N[1],w=(0,i.__read)((0,l.useState)(!1),2),O=w[0],P=w[1],k=(0,l.useRef)(null),L=Du((function(e){return!!e.config.enableNewSearchInput}));(0,l.useEffect)((function(){u(!0);(0,qe.getFriends)(100,E).then((function(e){var n=e.count,t=e.items;x(n);A(100<n),S(100);var a=t.map($e.normalizeUser);h(a)})).finally((function(){u(!1)}))}),[]);var D=(0,l.useMemo)((function(){return T>g_}),[T]);(0,l.useEffect)((function(){var e=b;if(D){if(e.length>=1&&!O)return k.current&&clearTimeout(k.current),k.current=setTimeout((function(){P(!0),(0,qe.friendsSearch)(s,e,50).then((function(e){var n=e.count,t=e.items;A(50<n),S(50);var a=t.map($e.normalizeUser);h(a)})).finally((function(){P(!1)}))}),1e3),function(){clearTimeout(k.current)};0===e.length&&(0,qe.getFriends)(g_,0).then((function(e){var n=e.count,t=e.items;A(100<n),S(100);var a=t.map($e.normalizeUser);h(a)}))}}),[b]);var R=(0,l.useCallback)((function(e,n){v.call(e,n,void 0,d.CallStatSource.HISTORY_FRIENDS_LIST)}),[]),j=(0,l.useCallback)((function(e){return e.name}),[]),B=(0,l.useCallback)((function(e){return e.peerId}),[]),U=y(f,j,B),H=b&&!D?U.search(b):f,V=(0,l.useCallback)((function(e){M(e.target.value)}),[]),G=function(e,s){var l,c,d,u,_,v,p,f="";return(null===(l=e.onlineInfo)||void 0===l?void 0:l.is_online)?f="Online":(null===(c=e.onlineInfo)||void 0===c?void 0:c.last_seen)?f=function(e,n,t,a){var i=Math.floor((Date.now()-a)/1e3);return i<60?e("global_just_now"):i<3600?n(Math.floor(i/60),"global_mins_ago",e("global_mins_ago",!0)):i<21600?n(Math.floor(i/3600),"global_hours_ago",e("global_hours_ago",!0)):t(a,!1)}(n,a,t,1e3*(null===(d=e.onlineInfo)||void 0===d?void 0:d.last_seen)):(null===(u=e.onlineInfo)||void 0===u?void 0:u.status)&&(f="recently"===(null===(_=e.onlineInfo)||void 0===_?void 0:_.status)?r(e.sex,"global_online_was_recently",n("global_online_was_recently",!0)):"last_week"===(null===(v=e.onlineInfo)||void 0===v?void 0:v.status)?r(e.sex,"global_online_was_week",n("global_online_was_week",!0)):r(e.sex,"global_online_long_ago",n("global_online_long_ago",!0))),(0,o.jsx)(Xa.default,(0,i.__assign)({selectable:!1,canBeHovered:!1,aside:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreen--friendsIcons"},{children:[(0,o.jsx)(e_,{className:"CallHistoryScreen--friendsIcon CallHistoryScreen--friendsIconsPhone",onClick:function(){return R(e.peerId,!1)}},void 0),(0,o.jsx)(n_,{className:"CallHistoryScreen--friendsIcon",onClick:function(){return R(e.peerId,!0)}},void 0)]}),void 0)},{children:(0,o.jsx)(ui.default,{size:"34",photo:(0,o.jsx)(p_.default,{id:s,photo:e.photo,title:e.name,isOnline:null===(p=e.onlineInfo)||void 0===p?void 0:p.is_online},void 0),title:e.name,href:e.link,description:f,target:"_blank"},void 0)}),s)};return _?(0,o.jsx)(Vu.default,{children:(0,o.jsx)(Sc.DivBlockSkeleton,{height:500},void 0)},void 0):(0,o.jsxs)(Vu.default,(0,i.__assign)({title:n("calls_page_menu_friends_calls"),className:"CallHistoryScreen--content"},{children:[!L&&(0,o.jsx)(si.BlockSearchInput,{className:"CallParticipantList__input",value:b,placeholder:n("global_search"),onChange:V,onInput:V,onPaste:V},void 0),L&&(0,o.jsx)(h_,{className:"CallParticipantList__input--new",placeholder:n("global_search"),onChange:M},void 0),(0,o.jsx)(s_.default,(0,i.__assign)({useWindowScroll:!0,hasMore:m,loadMore:function(){return b&&D?(0,qe.friendsSearch)(s,b,50,E).then((function(e){var n=e.count,t=e.items,a=E+50;A(a<n),S(a);var o=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(f),!1),(0,i.__read)(t.map($e.normalizeUser)),!1);return h(o),!0})):(0,qe.getFriends)(g_,E).then((function(e){var n=e.items,t=E+g_;A(t<T),S(t);var a=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(f),!1),(0,i.__read)(n.map($e.normalizeUser)),!1);return h(a),!0}))}},{children:(0,o.jsxs)(Ja.default,(0,i.__assign)({className:"CallHistoryList",border:!1},{children:[H.map((function(e,n){return G(e,n)})),0===H.length&&(0,o.jsx)(ha.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:n("calls_page_friends_not_found")}),void 0)]}),void 0)}),void 0)]}),void 0)},A_=t(80170);var C_=function(e){var n=e.call,t=e.onJoin,a=e.listItemBorder,r=void 0===a||a,s=Du((function(e){return e.profiles})),c=ze(),u=c.getLang,_=c.langNumeric,v=(0,Lu.getCurrentCallOwner)(n,s),p=v.member,f=v.chat,h=(0,l.useMemo)((function(){var e,t,a=f?function(e){var n=e.title,t=void 0===n?"":n,a=e.photo_100,i=void 0===a?"":a,o=e.id,r=void 0===o?0:o;return{title:t,photo:i,href:r?"/im?sel=c"+r:"",id:r}}(f):p?function(e){var n=e.name,t=void 0===n?"":n,a=e.photo,i=void 0===a?"":a,o=e.link,r=void 0===o?"":o,s=e.id,l=void 0===s?0:s;return{title:t,photo:i,href:r||"/im?sel=c"+l,id:l}}(p):{},o=a.id,r=void 0===o?0:o,l=a.title,c=void 0===l?"":l,d=a.photo,v=void 0===d?"":d,h=a.href,g=void 0===h?"":h,m=n.users_count,A=n.user_ids,C=n.join_link,E=void 0===C?"":C,S=n.caller_id,I=n.name;S&&(0,k.isParticipantGroup)(S)&&(c=I||c);var T=_(m,"calls_history_members_count",u("calls_history_members_count",m)).replace("%n",String(m)),x=A.slice(0,3),y=[];try{for(var N=(0,i.__values)(x),b=N.next();!b.done;b=N.next()){var M=b.value;M in s&&y.push((0,$e.getMemberForUserStack)(s[M]))}}catch(n){e={error:n}}finally{try{b&&!b.done&&(t=N.return)&&t.call(N)}finally{if(e)throw e.error}}return{id:r,title:c,photo:v,href:g,description:T,join_link:E,avatarItems:y}}),[f,n,p,s]),m=h.id,A=h.title,C=h.photo,E=h.href,S=h.description,I=h.avatarItems,T=h.join_link;return p||f?(0,o.jsx)(Xa.default,(0,i.__assign)({border:r,className:"CurrentCallsListItem",selectable:!1,canBeHovered:!1,aside:(0,o.jsxs)(o.Fragment,{children:[I.length>0&&(0,o.jsx)("div",(0,i.__assign)({className:"CurrentCallsListItem--avatarStack"},{children:(0,o.jsx)(A_.AvatarsStackNoSvg,{size:A_.AvatarsStackNoSvgSizes.SIZE_24,items:I},void 0)}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({size:"s",onClick:function(){return t(T,m,d.CallStatSource.HISTORY)}},{children:u("calls_history_join_call_button")}),void 0)]},void 0)},{children:(0,o.jsx)(ui.default,{photo:(0,o.jsx)(g.CallPhoto,{id:m,photo:C,alt:A,size:"34"},void 0),title:A,href:E,description:S,target:"_blank"},void 0)}),m):(0,o.jsx)(o.Fragment,{},void 0)},E_=function(e){var n=e.currentCalls,t=e.onJoin,a=e.listItemBorder,r=void 0===a||a;return n.length?(0,o.jsx)(Ja.default,(0,i.__assign)({border:!1},{children:n.map((function(e,n){return(0,o.jsx)(C_,{listItemBorder:r,call:e,onJoin:t},n)}))}),void 0):(0,o.jsx)(o.Fragment,{},void 0)},S_=function(){var e=Ru(),n=Du((function(e){return e.profiles})),t=Du((function(e){return e.currentCalls})),a=Du((function(e){return e.callsQueueResponse})),o=(0,i.__read)((0,l.useState)(!0),2),r=o[0],s=o[1],c=function(){s(!0),(0,ju.loadCurrentCalls)(e).then((function(n){(0,ju.updateProfilesAndUrls)(e,[n])})).finally((function(){s(!1)}))};return(0,l.useEffect)((function(){c()}),[]),(0,l.useEffect)((function(){var e;!!(null===(e=null==a?void 0:a.events)||void 0===e?void 0:e.some((function(e){var n;return"current_calls_update"===(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.type)})))&&c()}),[a]),{currentCallsBlockLoading:r,currentCalls:t,profiles:n}},I_=function(){var e=ze().getLang,n=Qu().onJoin,t=S_(),a=t.currentCallsBlockLoading,r=t.currentCalls,s=t.profiles,c=Yu().setLoading,d=(0,l.useMemo)((function(){return a?(0,o.jsx)(Vu.default,{children:(0,o.jsx)(Sc.DivBlockSkeleton,{height:300},void 0)},void 0):(0,o.jsxs)(Vu.default,(0,i.__assign)({title:e("calls_history_current_list_header"),className:"CallHistoryScreen--content CallHistoryScreen--currentCalls"},{children:[(0,o.jsx)(E_,{currentCalls:r,profiles:s,onJoin:n},void 0),0===r.length&&(0,o.jsx)(ha.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:e("calls_history_current_calls_list_stub")}),void 0)]}),void 0)}),[a,r]);return(0,l.useEffect)((function(){c(a)}),[a]),(0,o.jsx)(o.Fragment,{children:d},void 0)};const T_=(0,F.makeIcon)("Icon28ChainOutline","chain_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="chain_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="M12.59 16.83c-.39.39-1.03.39-1.42 0a5.003 5.003 0 0 1 0-7.07l5.24-5.24a5.003 5.003 0 0 1 7.07 0 5.003 5.003 0 0 1 0 7.07l-1.436 1.436a.999.999 0 0 1-1.414-1.41l1.43-1.436a2.982 2.982 0 0 0 0-4.24 2.982 2.982 0 0 0-4.24 0l-5.23 5.23a2.982 2.982 0 0 0 0 4.24c.41.39.41 1.03 0 1.42Zm2.82-5.66c.39-.39 1.03-.39 1.42 0a5.003 5.003 0 0 1 0 7.07l-5.24 5.24a5.003 5.003 0 0 1-7.07 0 5.003 5.003 0 0 1 0-7.07l1.431-1.431a1 1 0 0 1 1.414 0h.001c.39.392.39 1.025 0 1.415L5.94 17.82a2.982 2.982 0 0 0 0 4.24 2.982 2.982 0 0 0 4.24 0l5.23-5.23a2.982 2.982 0 0 0 0-4.24.973.973 0 0 1 0-1.42Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',28,28,!1,void 0),x_=(0,F.makeIcon)("Icon28ArrowUpRectangleOutline","arrow_up_rectangle_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg" id="arrow_up_rectangle_outline_28"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.07 4.801C6.164 4.216 7.243 4 9.691 4h8.616c2.448 0 3.527.216 4.622.801A5.465 5.465 0 0 1 25.2 7.07c.585 1.096.801 2.175.801 4.623v4.616c0 2.448-.216 3.527-.801 4.622A5.465 5.465 0 0 1 22.93 23.2c-1.095.585-2.174.801-4.622.801H9.692c-2.448 0-3.527-.216-4.623-.801a5.465 5.465 0 0 1-2.268-2.269C2.216 19.835 2 18.756 2 16.308v-4.616c0-2.448.216-3.527.801-4.623A5.466 5.466 0 0 1 5.07 4.801ZM9.691 6c-2.335 0-3.019.212-3.68.565a3.466 3.466 0 0 0-1.447 1.448C4.212 8.673 4 9.357 4 11.692v4.616c0 2.335.212 3.019.565 3.68a3.466 3.466 0 0 0 1.448 1.447c.66.353 1.344.565 3.679.565h8.616c2.335 0 3.019-.212 3.68-.565a3.467 3.467 0 0 0 1.447-1.448c.353-.66.565-1.344.565-3.679v-4.616c0-2.335-.212-3.019-.565-3.68a3.466 3.466 0 0 0-1.448-1.447C21.327 6.212 20.643 6 18.308 6H9.692Z" fill="currentColor" /><path d="M13 18a1 1 0 1 0 2 0v-5.586l1.293 1.293a1 1 0 0 0 1.414-1.414l-3-3a1 1 0 0 0-1.414 0l-3 3a1 1 0 1 0 1.414 1.414L13 12.414V18Z" fill="currentColor" /></symbol>',28,28,!1,void 0);var y_=function(e){var n=e.onCreateCallClick,t=ze().getLang;return(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreenLanding"},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreenLanding--content"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreenLanding--header"},{children:t("calls_screen_landing_header")}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreenLanding--subheader"},{children:t("calls_screen_landing_subheader")}),void 0),(0,o.jsxs)(Ja.default,(0,i.__assign)({className:"CallHistoryScreenLanding--list",border:!1},{children:[(0,o.jsx)(Xa.default,(0,i.__assign)({border:!1,chevron:!1,selectable:!1,icon:(0,o.jsx)(Tr,{},void 0)},{children:t("calls_screen_landing_feature_participants")}),void 0),(0,o.jsx)(Xa.default,(0,i.__assign)({border:!1,chevron:!1,selectable:!1,icon:(0,o.jsx)(T_,{},void 0)},{children:t("calls_screen_landing_feature_anon")}),void 0),(0,o.jsx)(Xa.default,(0,i.__assign)({border:!1,chevron:!1,selectable:!1,icon:(0,o.jsx)(x_,{},void 0)},{children:t("calls_screen_landing_feature_share")}),void 0)]}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({size:"l",className:"CallHistoryScreenLanding--createButton",onClick:function(){return n(no.CallStatSource.HISTORY_CREATE)}},{children:t("calls_current_calls_create_call_by_link")}),void 0)]}),void 0)}),void 0)};const N_=(0,F.makeIcon)("Icon28PhoneOutline","phone_outline_28","0 0 28 28",'<symbol viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="phone_outline_28"><g fill-rule="nonzero" fill="none"><path d="M0 0h28v28H0z" /><path d="m16.112 17.259-.734.734a.712.712 0 0 1-.75.166c-.73-.269-1.643-.95-2.74-2.047-1.095-1.096-1.778-2.01-2.045-2.74a.712.712 0 0 1 .164-.75l.736-.734c1.354-1.354 1.478-3.487.284-4.903l-.862-1.024c-.984-1.17-2.756-1.288-3.96-.264a3.319 3.319 0 0 0-.974 1.443 3.25 3.25 0 0 0-.159.752c-.44 3.272 1.137 6.707 4.733 10.303 3.596 3.596 7.03 5.174 10.303 4.733a3.318 3.318 0 0 0 2.195-1.134c1.024-1.202.905-2.976-.263-3.96l-1.025-.862c-1.417-1.192-3.55-1.067-4.903.287Zm-2.81-2.561c.525.523.982.92 1.35 1.191 2.124-2.123 5.428-2.317 7.652-.447l1.023.862c2.03 1.708 2.233 4.751.49 6.798-.896 1.036-2.156 1.687-3.442 1.808-3.982.536-7.987-1.303-11.984-5.3-3.997-3.998-5.837-8.004-5.31-11.896.036-.414.122-.822.257-1.22A5.33 5.33 0 0 1 4.91 4.174c2.037-1.732 5.079-1.53 6.785.5l.86 1.023c1.873 2.22 1.681 5.527-.4 7.608.227.413.624.87 1.148 1.394Z" fill="currentColor" /></g></symbol>',28,28,!1,void 0);var b_,M_=t(33483),w_=t(59247);!function(e){e[e.Preview=0]="Preview",e[e.Full=1]="Full"}(b_||(b_={}));var O_=function(e){var n=e.type,t=void 0===n?b_.Preview:n,a=e.forceUpdate,o=e.disabled,r=e.callerId,s=(0,Ae.useLang)().getLang,c=(0,w_.useLocale)().locale,d=(0,ud.usePromiseError)().handleError,u=(0,Gt.useIsMounted)(),_=(0,l.useRef)(),v=(0,i.__read)((0,l.useState)(),2),p=v[0],f=v[1],h=Ru(),g=Du((function(e){return e.scheduledCalls})),m=Du((function(e){return e.scheduledCallsPreview})),A=Du((function(e){return e.profiles}));(0,l.useEffect)((function(){if(null==p?void 0:p.size){var e=[];p.forEach((function(n){A[n]||e.push(n)})),e.length&&(0,qe.loadCallPeersByPeerIds)(e).then((function(e){if(u()){var n=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e.profiles||[]),!1),(0,i.__read)(e.groups||[]),!1);n.length&&(0,ju.loadProfiles)(h,n)}})).catch(d)}}),[p,A]);var C=(0,l.useCallback)((function(){if(!o){var e,n=new Date,a={grouped:1};switch(a.start_time=Math.round(n.valueOf()/1e3),r&&(a.caller_id=r),t){case b_.Full:a.finish_time=a.start_time+31536e3,e=k_;break;case b_.Preview:a.finish_time=a.start_time+604800,e=P_}e(h,{loading:!0}),(0,qe.messagesGetScheduledCalls)(a).then((function(t){if(u()){var a=(0,M_.mapCalls)({now:n,items:null==t?void 0:t.items,locale:c,getLang:s,groups:null==t?void 0:t.groups}),i=a.calls,o=a.callerIds,r=a.total;e(h,{items:i,total:r}),f(o)}})).catch(d).finally((function(){u()&&e(h,{loading:!1})})),_.current=function(){e(h)}}}),[t,o,r]);return(0,l.useEffect)((function(){return function(){var e;null===(e=_.current)||void 0===e||e.call(_)}}),[]),(0,l.useEffect)((function(){C()}),[t,a,r]),{scheduledCalls:g,scheduledCallsPreview:m,fetchData:C}};function P_(e,n){e({type:Ou.HistoryScreenActionTypes.SET_SCHEDULED_CALLS_PREVIEW,data:n})}function k_(e,n){e({type:Ou.HistoryScreenActionTypes.SET_SCHEDULED_CALLS,data:n})}var L_=t(32997),D_=function(e){var n=e.children;return(0,o.jsx)(Xa.default,(0,i.__assign)({className:"CallsScheduledRowBlockTitle",selectable:!1,canBeHovered:!1},{children:n}),void 0)},R_=t(767),j_=function(e){var n=e.text,t=e.href,a=e.className,r=e.onClick,l=e.rightIcon,c=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",(0,i.__assign)({className:"PageBlockShowMore__text"},{children:n}),void 0),l&&(0,o.jsx)("div",(0,i.__assign)({className:"PageBlockShowMore__icon"},{children:l}),void 0)]},void 0);return t?(0,o.jsx)(Zd.default,(0,i.__assign)({href:t,className:(0,s.classNames)("PageBlockShowMore",a),onClick:r},{children:c}),void 0):(0,o.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("PageBlockShowMore",a),onClick:r},{children:c}),void 0)},B_=function(e){var n,t,a=e.calls,r=e.loading,c=e.onLinkClick,d=e.skeletonHeight,u=e.ownerSelect,_=e.section,v=(0,Ae.useLang)().getLang,p=Ru(),f=(0,gd.useNotifier)().showText,h=Ku().bridge,g=d_().navigateToConvo,m=(0,i.__read)((0,l.useState)((function(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone})),1)[0],A=Du((function(e){return e.meId})),C=Du((function(e){return e.profiles[A]})),E=(0,dd.useCalendarEventDetails)({meParticipant:C}),S=(0,Gt.useIsMounted)(),I="scheduled"===_,T=function(e){var n=e.allCalls,t=e.isScheduledSection,a=(0,i.__read)((0,l.useState)(!1),2),o=a[0],r=a[1],c=(0,l.useCallback)((function(){r((function(e){return!e}))}),[]),d=(0,l.useMemo)((function(){var e,a;if((0,s.isUndefined)(n)||t||o||!n.total||n.total<=3||!Array.isArray(null==n?void 0:n.items))return n;var r=[],l=0;try{for(var c=(0,i.__values)(null==n?void 0:n.items),d=c.next();!d.done;d=c.next()){var u=d.value,_=u.calls,v=(0,i.__rest)(u,["calls"]);if(l>=3)break;var p=3-l,f=_.length<p?_:_.slice(0,p);r.push((0,i.__assign)((0,i.__assign)({},v),{calls:f})),l+=f.length}}catch(n){e={error:n}}finally{try{d&&!d.done&&(a=c.return)&&a.call(c)}finally{if(e)throw e.error}}return r.length?(0,i.__assign)((0,i.__assign)({},n),{items:r}):null}),[n,o]);return{isShowAll:o,toggleShowAll:c,calls:d}}({allCalls:a,isScheduledSection:I}),x=T.calls,y=T.isShowAll,N=T.toggleShowAll;(0,l.useEffect)((function(){C||(0,qe.loadChatMembers)(A).then((function(e){(null==e?void 0:e.profiles)&&S()&&(0,ju.loadProfiles)(p,e.profiles)}))}),[C,A]);var b=(0,l.useCallback)((function(e){h.joinCallByLink(e.join_link,void 0,!1,no.CallStatSource.HISTORY)}),[]),M=(0,l.useCallback)((function(e){e.vk_join_link&&(0,s.copyTextToClipboard)(e.vk_join_link).then((function(){f(v("calls_create_call_by_link_copied"))}))}),[v,f]),w=(0,l.useCallback)((function(e){var n,t,a,i,o={call_id:e.call_id,title:e.name||"",start:new Date(1e3*((null===(n=e.schedule)||void 0===n?void 0:n.time)||0)),timezone:m,duration:(null===(t=e.schedule)||void 0===t?void 0:t.duration)||0,join_link:e.vk_join_link||"",repeatRule:(0,Cd.mapRecurrenceRule)(null===(a=e.schedule)||void 0===a?void 0:a.recurrence_rule)};(null===(i=e.group)||void 0===i?void 0:i.name)&&(o.displayName=e.group.name),(0,s.copyTextToClipboard)(E.getDescription(o)).then((function(){f(v("calls_create_call_by_link_text_copied"))}))}),[E,v,f]),O=(0,l.useCallback)((function(e){p({type:Ou.HistoryScreenActionTypes.SET_SCHEDULED_EDITABLE_CALL,data:e}),p({type:Ou.HistoryScreenActionTypes.SET_POPUP,data:Ou.EHistoryScreenPopup.DeleteCalendarEvent})}),[]),P=(0,l.useCallback)((function(e){p({type:Ou.HistoryScreenActionTypes.SET_SCHEDULED_EDITABLE_CALL,data:e}),p({type:Ou.HistoryScreenActionTypes.SET_POPUP,data:Ou.EHistoryScreenPopup.EditCalendarEvent})}),[]),k=(0,l.useCallback)((function(){c&&c(event,"scheduled","calls?section=scheduled")}),[c]),L=(0,l.useCallback)((function(e){var n;(null===(n=e.chat)||void 0===n?void 0:n.peer_id)&&g(e.chat.peer_id)}),[g]),D=function(){var e;return I&&(null===(e=null==u?void 0:u.options)||void 0===e?void 0:e.length)?(0,o.jsx)(L_.default,(0,i.__assign)({className:"CallHistoryScreen--listHeaderSelector",disabled:r},u),void 0):c&&!I?(0,o.jsx)(Zd.default,(0,i.__assign)({className:"CallHistoryScreen--moreLink",href:"/calls?section=scheduled",onClick:k},{children:v("calls_show_all")}),void 0):void 0}(),R=!!(null===(n=null==x?void 0:x.items)||void 0===n?void 0:n.length),j=r&&!R,B=!r&&R,U=!(r||R||c&&!(null==u?void 0:u.value)),H=R||U||j,V=r&&R,G=B&&!I&&(null==a?void 0:a.total)&&a.total>3,F=y?v("calls_collapse"):v("calls_history_scheduled_calls_show_all").replace("{count}",((null==a?void 0:a.total)||0)-3);return H?(0,o.jsxs)(Vu.default,(0,i.__assign)({className:(0,s.classNames)("CallHistoryScreen--content",{"CallHistoryScreen--currentCalls":!j})},{children:[!j&&(0,o.jsx)(li.ListHeader,(0,i.__assign)({className:(0,s.classNames)("CallHistoryScreen--listHeader","HistoryScreenScheduledCalls__header",{"HistoryScreenScheduledCalls__header--standalone":I&&!U}),right:D},{children:v("calls_scheduled")}),void 0),j&&(0,o.jsx)(Sc.DivBlockSkeleton,{height:d||300},void 0),V&&(0,o.jsx)(ha.default,{children:(0,o.jsx)(Ge.default,{},void 0)},void 0),B&&(null===(t=null==x?void 0:x.items)||void 0===t?void 0:t.map((function(e,n){return(0,o.jsxs)("div",{children:[(0,o.jsx)(D_,{children:e.title},void 0),e.calls.map((function(t){return(0,o.jsx)(R_.ScheduledCallRow,{call:t,isToday:e.isToday,isTomorrow:e.isTomorrow,onCallEnter:b,onCallCopyLink:M,onCallCopyText:w,onCallDelete:O,onCallEdit:P,onCallMessage:L},t.call_id+"-"+n)}))]},e.title)}))),G&&(0,o.jsx)(j_,{text:F,onClick:N},void 0),U&&(0,o.jsx)(ha.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:v("calls_history_scheduled_calls_list_stub")}),void 0)]}),void 0):null},U_=function(e){var n=e.historyCalls,t=e.loading,a=e.historyBlockReloading,r=e.selectedOwnerId,s=e.ownerOptions,c=e.onGroupSelectChange,d=e.onHistoryAction,u=e.onShowMoreHistory,_=e.showMoreHistory,v=e.isShowList,p=(0,Ae.useLang)().getLang,f=(0,l.useMemo)((function(){return s.length>1?(0,o.jsx)(ur.default,{className:"CallHistoryScreen--listHeaderSelector",options:s,value:r,onChange:c},void 0):(0,o.jsx)(o.Fragment,{},void 0)}),[s]),h=(0,l.useMemo)((function(){return p(0===r?"calls_history_list_stub":"calls_history_list_groups_stub")}),[r]),g=!(t||a||v||n.length),m=p("calls_history_list_header");return(0,o.jsxs)(Vu.default,(0,i.__assign)({title:g?m:void 0},{children:[g&&(0,o.jsx)(ha.default,(0,i.__assign)({className:"CallHistoryList--stub"},{children:h}),void 0),t&&(0,o.jsx)(Sc.DivBlockSkeleton,{height:500},void 0),v&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(li.ListHeader,(0,i.__assign)({className:"CallHistoryScreen--listHeader",right:f},{children:m}),void 0),a&&(0,o.jsx)(ha.default,{children:(0,o.jsx)(Ge.default,{},void 0)},void 0),!a&&(0,o.jsx)(l_,{selectedOwnerId:r,calls:n,onMenuItemClick:d,stubText:h,hasMore:_,onLoadMore:u},void 0)]},void 0)]}),void 0)},H_=function(e){void 0===e&&(e={});var n=e.initialOptions,t=(0,i.__read)((0,l.useState)([]),2),a=t[0],o=t[1];return(0,l.useEffect)((function(){a.length||(0,qe.getGroupsForCall)().then((function(e){var t=e.count,a=e.items,i=n||[];t>0&&(a.forEach((function(e){var n=e.id,t=e.name,a=void 0===t?"":t;i.push({value:-n,label:a})})),o(i))}))}),[]),{ownerOptions:a}},V_=function(){var e=(0,Ae.useLang)().getLang,n=(0,c.useStore)(),t=Ru(),a=Du((function(e){return e.historyCalls})),o=Du((function(e){return e.joinLinks})),r=Du((function(e){return e.profiles})),s=Ku(),d=s.SDK,u=s.bridge,_=(0,i.__read)((0,l.useState)(!1),2),v=_[0],p=_[1],f=(0,i.__read)((0,l.useState)(0),2),h=f[0],g=f[1],m=u_().onHistoryAction,A=__("all"),C=A.onShowMoreHistory,E=A.loading,S=A.showMoreHistory,I=A.loadHistory,T=(0,l.useMemo)((function(){return[{value:0,label:e("calls_history_list_personal_option")}]}),[]),x=H_({initialOptions:T}).ownerOptions,y=(0,l.useCallback)((function(e){var a=Number(e.selected.value);p(!0),g(a),I(0,a,[],!0).then((function(e){p(!1),e&&Xr(d,u,n,a,t,!0)}))}),[r,o,a]),N=!E&&(a.length>0||h<0||0===h&&v);return{loading:E,historyCalls:a,historyBlockReloading:v,selectedOwnerId:h,ownerOptions:x,onGroupSelectChange:y,onHistoryAction:m,onShowMoreHistory:C,showMoreHistory:S,isShowList:N,isDisplayBlock:E||N||v}},G_=function(){var e=(0,l.useRef)(),n=Du((function(e){return e.callsQueueResponse}));return(0,l.useMemo)((function(){var t;return(null===(t=null==n?void 0:n.events)||void 0===t?void 0:t.some((function(e){var n;return"scheduled_calls_update"===(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.type)})))&&(e.current=Date.now()),e.current}),[n])},F_=function(e){var n=e.onMenuItemClick,t=Ru(),a=ze().getLang,r=Du((function(e){return e.profiles})),c=Du((function(e){return e.historyCalls})),u=O_({type:b_.Preview,forceUpdate:G_()}).scheduledCallsPreview,_=Qu(),v=_.onCreateCallClick,p=_.onJoin,f=S_(),h=f.currentCallsBlockLoading,g=f.currentCalls,m=(0,i.__read)((0,l.useState)(!1),2),A=m[0],C=m[1],E=(0,i.__read)((0,l.useState)([]),2),S=E[0],I=E[1],T=(0,i.__read)((0,l.useState)(!1),2),x=T[0],y=T[1],N=V_();(0,l.useEffect)((function(){C(!0),(0,qe.getFriends)(7).then((function(e){var n=e.items.map($e.normalizeUser);I(n)})).finally((function(){C(!1)}))}),[]);var b=(0,l.useCallback)((function(e,t,a){e.preventDefault(),n(t,a)}),[]),M=(0,l.useCallback)((function(e,n){return!(!e.ctrlKey&&!e.metaKey)||(e.preventDefault(),p("",n,d.CallStatSource.HISTORY_FRIENDS_LIST),!1)}),[]);return(0,l.useEffect)((function(){if(!N.loading){var e=!(h||g.length||N.loading||c.length||0!==N.selectedOwnerId);y(e),t((0,ju.dispatchSetShowCreateButton)(!e))}return function(){t((0,ju.dispatchSetShowCreateButton)(!0))}}),[h,g.length,N.loading,c.length,N.selectedOwnerId]),(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreen--content"},{children:[x&&(0,o.jsx)(Vu.default,(0,i.__assign)({className:(0,s.classNames)({"CallHistoryScreenLanding--pageBlock":!A&&0===S.length})},{children:(0,o.jsx)(y_,{onCreateCallClick:v},void 0)}),void 0),A&&(0,o.jsx)(Vu.default,{children:(0,o.jsx)(Sc.DivBlockSkeleton,{height:147},void 0)},void 0),!A&&S.length>0&&(0,o.jsxs)(Vu.default,{children:[(0,o.jsx)(li.ListHeader,(0,i.__assign)({className:"CallHistoryScreen--listHeader",right:(0,o.jsx)(Zd.default,(0,i.__assign)({href:"/calls?section=friends",onClick:function(){return b(event,"friends","calls?section=friends")},className:"CallHistoryScreen--moreLink"},{children:a("calls_history_show_all_friends_header_link")}),void 0)},{children:a("calls_history_friends_block_header")}),void 0),(0,o.jsx)("ul",(0,i.__assign)({className:"CallHistoryScreen--friendsList"},{children:S.map((function(e){return(0,o.jsx)("li",(0,i.__assign)({className:"CallHistoryScreen--friendsListItem"},{children:(0,o.jsx)("a",(0,i.__assign)({href:e.link,onClick:function(){return M(event,e.peerId)}},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallHistoryScreen--friendsListItemContent"},{children:[(0,o.jsx)(p_.default,{className:"CallHistoryScreen--friendsListItemPhoto",photo:e.photo,title:e.name},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreen--friendsListItemPhotoHoverIcon"},{children:(0,o.jsx)(N_,{fill:"white"},void 0)}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreen--friendsListItemName"},{children:e.firstName}),void 0)]}),void 0)}),void 0)}),e.id)}))}),void 0)]},void 0),h&&(0,o.jsx)(Vu.default,{children:(0,o.jsx)(Sc.DivBlockSkeleton,{height:300},void 0)},void 0),!h&&g.length>0&&(0,o.jsxs)(Vu.default,(0,i.__assign)({className:"CallHistoryScreen--currentCalls"},{children:[(0,o.jsx)(li.ListHeader,(0,i.__assign)({className:"CallHistoryScreen--listHeader",extra:g.length,right:g.length?(0,o.jsx)(Zd.default,(0,i.__assign)({onClick:function(){return b(event,"current","calls?section=current")},href:"/calls?section=current",className:"CallHistoryScreen--moreLink"},{children:a("calls_history_show_all_header_link")}),void 0):""},{children:a("calls_history_current_list_header")}),void 0),(0,o.jsx)(E_,{currentCalls:g.slice(0,5),profiles:r,onJoin:p},void 0)]}),void 0),(0,o.jsx)(B_,{calls:u,loading:null==u?void 0:u.loading,onLinkClick:b,skeletonHeight:300},void 0),N.isDisplayBlock&&(0,o.jsx)(U_,(0,i.__assign)({},N),void 0)]}),void 0)},Z_=t(95418),W_=function(){var e,n,t,a,i=Yu().setLoading,r=(e=(0,Ae.useLang)().getLang,n=Du((function(e){return e.meId})),t=(0,l.useMemo)((function(){return[{label:e("calls_all"),value:0},{label:e("calls_history_list_personal_option"),value:n}]}),[n]),a=H_({initialOptions:t}).ownerOptions,(0,Z_.useFormSelectValue)({options:a,initialValue:function(){return 0}})),s=O_({type:b_.Full,forceUpdate:G_(),callerId:r.value}).scheduledCalls;return(0,l.useEffect)((function(){i(!!(null==s?void 0:s.loading))}),[null==s?void 0:s.loading]),(0,o.jsx)(B_,{calls:s,loading:null==s?void 0:s.loading,skeletonHeight:500,section:"scheduled",ownerSelect:r},void 0)},z_=function(){var e=V_();return(0,o.jsx)(U_,(0,i.__assign)({},e),void 0)};const K_=(0,F.makeIcon)("Icon24Qr","qr_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="qr_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M19.5 19H21a.5.5 0 0 1 .5.5V21a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5ZM14 19h1.5a.5.5 0 0 1 .5.5V21a.5.5 0 0 1-.5.5H14a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5Zm2.75-2.75h1.5a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5Zm2.75-2.75H21a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5V14a.5.5 0 0 1 .5-.5Zm-5.5 0h1.5a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5H14a.5.5 0 0 1-.5-.5V14a.5.5 0 0 1 .5-.5ZM4.5 13h4a2.5 2.5 0 0 1 2.5 2.5v4A2.5 2.5 0 0 1 8.5 22h-4A2.5 2.5 0 0 1 2 19.5v-4A2.5 2.5 0 0 1 4.5 13Zm.25 1.75a1 1 0 0 0-1 1v3.5a1 1 0 0 0 1 1h3.5a1 1 0 0 0 1-1v-3.5a1 1 0 0 0-1-1h-3.5Zm1 1.5h1.5a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5ZM15.5 2h4A2.5 2.5 0 0 1 22 4.5v4a2.5 2.5 0 0 1-2.5 2.5h-4A2.5 2.5 0 0 1 13 8.5v-4A2.5 2.5 0 0 1 15.5 2Zm.25 1.75a1 1 0 0 0-1 1v3.5a1 1 0 0 0 1 1h3.5a1 1 0 0 0 1-1v-3.5a1 1 0 0 0-1-1h-3.5Zm1 1.5h1.5a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5ZM4.5 2h4A2.5 2.5 0 0 1 11 4.5v4A2.5 2.5 0 0 1 8.5 11h-4A2.5 2.5 0 0 1 2 8.5v-4A2.5 2.5 0 0 1 4.5 2Zm.25 1.75a1 1 0 0 0-1 1v3.5a1 1 0 0 0 1 1h3.5a1 1 0 0 0 1-1v-3.5a1 1 0 0 0-1-1h-3.5Zm1 1.5h1.5a.5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5h-1.5a.5.5 0 0 1-.5-.5v-1.5a.5.5 0 0 1 .5-.5Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0),Q_=(0,je.makeIcon)("Icon40AppStoreButtonRu","app_store_button_ru_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="app_store_button_ru_40"><path d="M40.228 17.293h2.295l4.745 12.313h-2.313l-1.155-3.26h-4.918l-1.156 3.26H35.5l4.728-12.313Zm-.76 7.416h3.762l-1.846-5.295h-.052L39.47 24.71Zm8.922-4.019h1.863v1.208h.034c.276-.518.662-.886 1.156-1.104a3.76 3.76 0 0 1 1.605-.345c.701 0 1.311.127 1.829.38.529.24.966.58 1.311 1.017.345.425.604.925.777 1.5a6.39 6.39 0 0 1 .258 1.845c0 .598-.08 1.179-.241 1.742a4.405 4.405 0 0 1-.708 1.5c-.31.426-.707.77-1.19 1.035-.483.253-1.053.38-1.708.38a4.39 4.39 0 0 1-.863-.087 3.431 3.431 0 0 1-.828-.241 3.674 3.674 0 0 1-.742-.431 2.66 2.66 0 0 1-.552-.638h-.035V32.9H48.39V20.69Zm6.866 4.467c0-.402-.051-.793-.155-1.173a3.08 3.08 0 0 0-.466-1 2.283 2.283 0 0 0-.776-.707 2.06 2.06 0 0 0-1.07-.276c-.828 0-1.455.287-1.88.862-.415.575-.622 1.34-.622 2.294 0 .448.052.868.155 1.259.115.38.282.707.5.983.22.276.478.494.777.655.31.161.667.242 1.07.242.449 0 .828-.092 1.139-.276.31-.184.563-.42.759-.707.207-.3.35-.633.431-1 .092-.38.138-.765.138-1.156Zm3.854-4.467h1.863v1.208h.035c.276-.518.661-.886 1.156-1.104a3.76 3.76 0 0 1 1.605-.345c.701 0 1.31.127 1.829.38.529.24.966.58 1.31 1.017.346.425.605.925.777 1.5a6.39 6.39 0 0 1 .26 1.845c0 .598-.081 1.179-.242 1.742a4.405 4.405 0 0 1-.708 1.5c-.31.426-.707.77-1.19 1.035-.484.253-1.053.38-1.709.38a4.39 4.39 0 0 1-.862-.087 3.43 3.43 0 0 1-.828-.241 3.674 3.674 0 0 1-.742-.431 2.657 2.657 0 0 1-.553-.638h-.034V32.9H59.11V20.69Zm6.867 4.467c0-.402-.052-.793-.155-1.173a3.084 3.084 0 0 0-.466-1 2.283 2.283 0 0 0-.776-.707 2.06 2.06 0 0 0-1.07-.276c-.828 0-1.455.287-1.881.862-.414.575-.621 1.34-.621 2.294 0 .448.052.868.155 1.259.115.38.282.707.5.983.22.276.478.494.777.655.31.161.667.242 1.07.242.448 0 .828-.092 1.139-.276.31-.184.563-.42.759-.707.207-.3.35-.633.431-1 .092-.38.138-.765.138-1.156Zm10.468.345c0 .471.08.874.241 1.207.161.333.386.61.673.828.288.207.616.362.984.465.38.092.788.138 1.225.138.471 0 .874-.051 1.207-.155.334-.115.604-.258.811-.431.208-.172.357-.368.45-.586.091-.23.137-.46.137-.69 0-.471-.11-.816-.328-1.035a1.72 1.72 0 0 0-.69-.483 13.31 13.31 0 0 0-1.535-.448 248.2 248.2 0 0 1-2.14-.57c-.53-.137-.972-.315-1.329-.534a3.322 3.322 0 0 1-.828-.758 2.771 2.771 0 0 1-.448-.88 3.76 3.76 0 0 1-.121-.948c0-.621.126-1.156.38-1.604.264-.46.609-.84 1.035-1.139a4.38 4.38 0 0 1 1.449-.655 6.123 6.123 0 0 1 1.64-.224 6.16 6.16 0 0 1 1.81.259A4.27 4.27 0 0 1 82.57 18a3.61 3.61 0 0 1 1.035 1.242c.253.483.38 1.046.38 1.69h-2.157c-.057-.793-.328-1.351-.81-1.673-.484-.333-1.1-.5-1.847-.5a3.65 3.65 0 0 0-.777.086 2.179 2.179 0 0 0-.724.259 1.585 1.585 0 0 0-.552.483c-.138.207-.207.465-.207.776 0 .437.132.782.396 1.035.276.24.633.425 1.07.551.046.012.225.064.535.156a79.013 79.013 0 0 1 2.209.586c.38.092.65.16.81.207.403.126.754.299 1.053.517.3.219.547.472.742.759.207.276.357.575.449.897.103.322.155.643.155.965 0 .69-.144 1.282-.431 1.777-.276.483-.645.88-1.105 1.19-.46.31-.983.534-1.57.672a7.244 7.244 0 0 1-1.794.224 7.39 7.39 0 0 1-1.985-.258 4.646 4.646 0 0 1-1.621-.794 3.9 3.9 0 0 1-1.105-1.362c-.276-.563-.42-1.224-.431-1.983h2.157Zm8.773-4.812H86.7v-2.673h1.967v2.674h1.778v1.465h-1.778v4.76c0 .207.006.385.018.535.023.149.063.276.12.379a.68.68 0 0 0 .294.241c.126.046.299.07.517.07h.415c.138-.012.276-.035.414-.07v1.518l-.639.069a5.78 5.78 0 0 1-.638.034c-.518 0-.938-.046-1.26-.138a1.86 1.86 0 0 1-.742-.43 1.658 1.658 0 0 1-.362-.725 6.002 6.002 0 0 1-.104-.983v-5.26h-1.483v-1.465Zm10.905 9.158c-.714 0-1.352-.115-1.916-.345a4.28 4.28 0 0 1-1.415-.983 4.34 4.34 0 0 1-.88-1.483 5.858 5.858 0 0 1-.293-1.897c0-.679.098-1.305.293-1.88.207-.575.5-1.07.88-1.483a4.075 4.075 0 0 1 1.415-.966c.564-.241 1.202-.362 1.916-.362.713 0 1.345.12 1.898.362.563.23 1.035.552 1.415.966.39.414.684.908.879 1.483a5.51 5.51 0 0 1 .311 1.88c0 .69-.104 1.322-.311 1.897a4.056 4.056 0 0 1-2.294 2.466c-.553.23-1.185.345-1.898.345Zm0-1.552c.437 0 .816-.092 1.138-.276.323-.184.587-.426.794-.725.207-.299.357-.632.449-1a4.308 4.308 0 0 0 0-2.294 2.834 2.834 0 0 0-.449-1 2.4 2.4 0 0 0-.794-.724c-.322-.184-.701-.276-1.138-.276-.438 0-.817.092-1.14.276a2.4 2.4 0 0 0-.793.724 3.08 3.08 0 0 0-.466 1 4.815 4.815 0 0 0 0 2.294c.104.368.259.701.466 1 .207.3.472.54.794.725.322.184.702.276 1.139.276Zm6.311-7.606h1.846v1.725h.035a2.06 2.06 0 0 1 .327-.707c.173-.23.374-.437.604-.62a3.06 3.06 0 0 1 .794-.466c.288-.116.581-.173.88-.173.23 0 .385.006.466.017l.276.035v1.897a4.936 4.936 0 0 0-.431-.052 2.514 2.514 0 0 0-.414-.035c-.334 0-.65.07-.949.207a2.056 2.056 0 0 0-.76.587 2.775 2.775 0 0 0-.517.948c-.127.38-.19.816-.19 1.31v4.243h-1.967V20.69Zm12.061 3.674a2.967 2.967 0 0 0-.208-.897 2.1 2.1 0 0 0-.448-.742 1.949 1.949 0 0 0-.69-.517 1.915 1.915 0 0 0-.898-.207c-.345 0-.661.063-.949.19a2.098 2.098 0 0 0-.724.5 2.562 2.562 0 0 0-.483.741 2.73 2.73 0 0 0-.19.932h4.59Zm-4.59 1.293c0 .345.046.678.138 1 .103.322.253.604.448.845.196.242.443.437.742.587.3.138.656.207 1.07.207.575 0 1.035-.121 1.381-.363.356-.253.621-.626.793-1.12h1.864a3.717 3.717 0 0 1-.535 1.293c-.253.38-.558.701-.915.966a3.893 3.893 0 0 1-1.207.569 4.57 4.57 0 0 1-1.381.207c-.701 0-1.323-.115-1.863-.345a3.94 3.94 0 0 1-1.381-.966 4.264 4.264 0 0 1-.845-1.483 6.197 6.197 0 0 1-.276-1.897c0-.632.098-1.23.293-1.794a4.703 4.703 0 0 1 .863-1.5 4.159 4.159 0 0 1 1.363-1.035c.529-.252 1.127-.379 1.794-.379.702 0 1.329.15 1.881.448.564.288 1.03.673 1.398 1.156a4.61 4.61 0 0 1 .794 1.673c.172.62.218 1.264.138 1.931h-6.557ZM38.974 13.574c-.43 0-.826-.051-1.19-.152a2.71 2.71 0 0 1-.947-.467 2.167 2.167 0 0 1-.615-.79c-.148-.318-.222-.697-.222-1.136h.917c.007.324.068.601.182.831.12.223.276.406.464.548.195.135.42.233.675.294.256.06.528.091.817.091.248 0 .48-.034.696-.101.215-.075.4-.176.554-.305a1.414 1.414 0 0 0 .514-1.105c0-.263-.05-.476-.151-.639a1.006 1.006 0 0 0-.403-.385 1.602 1.602 0 0 0-.575-.192 4.417 4.417 0 0 0-.686-.051c-.1 0-.215.003-.342.01a3.43 3.43 0 0 0-.303.01v-.79c.08.013.188.02.323.02h.322c.229 0 .437-.02.626-.061.194-.047.36-.122.494-.223a.977.977 0 0 0 .322-.396c.08-.169.121-.375.121-.618 0-.223-.044-.409-.13-.558a.913.913 0 0 0-.344-.355 1.411 1.411 0 0 0-.494-.202 2.63 2.63 0 0 0-.574-.061c-.531 0-.948.118-1.25.355-.303.23-.481.608-.535 1.135h-.917c.013-.385.09-.72.231-1.004a2.02 2.02 0 0 1 .585-.71 2.5 2.5 0 0 1 .847-.425c.33-.095.686-.142 1.069-.142.343 0 .662.04.958.122.302.074.564.192.786.355.222.162.397.368.524.618.128.243.192.534.192.872 0 .196-.034.378-.1.547a1.642 1.642 0 0 1-.273.457 1.75 1.75 0 0 1-.817.567v.03c.235.048.444.13.625.244a1.614 1.614 0 0 1 .726.913c.06.189.09.382.09.578a2.133 2.133 0 0 1-.645 1.47c-.221.23-.51.422-.866.578-.35.148-.777.223-1.28.223Zm5.437-.051a2.64 2.64 0 0 1-.665-.081 1.527 1.527 0 0 1-.555-.244 1.373 1.373 0 0 1-.373-.456 1.612 1.612 0 0 1-.13-.679c0-.297.05-.54.15-.73.101-.19.233-.341.394-.456.168-.122.356-.213.564-.274.215-.06.434-.111.656-.152.235-.047.457-.081.665-.101.215-.027.403-.061.565-.102a1.02 1.02 0 0 0 .383-.192c.094-.088.141-.213.141-.376a.833.833 0 0 0-.11-.456.682.682 0 0 0-.273-.263 1.055 1.055 0 0 0-.373-.122 2.701 2.701 0 0 0-.403-.03c-.363 0-.666.07-.908.212-.242.136-.373.396-.393.781h-.857a1.87 1.87 0 0 1 .202-.821 1.49 1.49 0 0 1 .484-.538c.201-.142.43-.243.685-.304.262-.06.541-.091.837-.091.235 0 .467.017.696.05.235.035.447.105.635.214.188.101.34.246.454.436.114.189.17.436.17.74v2.697c0 .202.011.351.031.446.027.094.108.142.242.142.06 0 .148-.017.262-.051v.67c-.148.087-.353.13-.615.13-.222 0-.4-.06-.534-.182-.128-.128-.192-.334-.192-.618-.235.284-.51.49-.826.618a2.73 2.73 0 0 1-1.009.183Zm.192-.75c.282 0 .524-.037.726-.112a1.65 1.65 0 0 0 .494-.294c.128-.122.222-.25.282-.385.06-.142.09-.274.09-.396v-.882a.94.94 0 0 1-.422.183c-.175.034-.36.064-.555.091l-.575.081c-.195.027-.37.075-.524.142a.975.975 0 0 0-.383.294c-.094.122-.141.29-.141.507a.77.77 0 0 0 .08.365.81.81 0 0 0 .222.233.98.98 0 0 0 .323.132c.12.027.248.04.383.04Zm3.903-4.603h3.569v.76h-2.712v4.481h-.857V8.17Zm4.384 0h.857v.71h.02c.141-.291.363-.5.665-.63.303-.134.636-.202.998-.202.404 0 .753.074 1.049.223.302.149.551.352.746.608.202.25.353.541.454.872.1.332.151.683.151 1.055 0 .378-.05.733-.151 1.064a2.438 2.438 0 0 1-.444.862 2.059 2.059 0 0 1-.746.578 2.375 2.375 0 0 1-1.038.213 2.528 2.528 0 0 1-.898-.172 2.04 2.04 0 0 1-.443-.244 1.498 1.498 0 0 1-.343-.395h-.02v2.697h-.857v-7.24Zm2.47 4.603c.289 0 .534-.058.736-.173.202-.115.363-.267.484-.456a1.99 1.99 0 0 0 .262-.649c.054-.243.08-.493.08-.75 0-.243-.033-.48-.1-.71a1.8 1.8 0 0 0-.293-.628 1.379 1.379 0 0 0-.504-.436 1.494 1.494 0 0 0-.715-.163c-.29 0-.535.058-.736.173a1.458 1.458 0 0 0-.494.456 1.907 1.907 0 0 0-.283.629 3.237 3.237 0 0 0 .01 1.47c.06.236.155.446.282.628.135.183.306.332.515.447.208.108.46.162.756.162Zm4.111 2.727c-.1 0-.202-.007-.302-.02a1.427 1.427 0 0 1-.293-.071v-.791l.242.081a.88.88 0 0 0 .262.04c.175 0 .316-.04.424-.121.107-.081.201-.2.282-.355l.353-.882-2.067-5.211h.968l1.522 4.288h.02l1.462-4.288h.908l-2.269 5.93c-.1.258-.201.474-.302.65a1.536 1.536 0 0 1-.323.426.963.963 0 0 1-.393.243 1.377 1.377 0 0 1-.494.081Zm6.523-1.977c-.692 0-1.233-.155-1.623-.466-.39-.311-.602-.754-.635-1.329h.867c.027.386.168.663.423.832.256.169.575.253.958.253.41 0 .726-.088.948-.263a.818.818 0 0 0 .332-.67c0-.263-.084-.47-.252-.618-.168-.149-.453-.223-.857-.223h-.695v-.7h.554c.303 0 .562-.06.777-.182.215-.129.322-.348.322-.66 0-.195-.094-.368-.282-.516-.181-.149-.454-.223-.817-.223a2.21 2.21 0 0 0-.463.05 1.33 1.33 0 0 0-.404.163.968.968 0 0 0-.302.294c-.08.121-.131.27-.151.446h-.867c.02-.325.097-.592.231-.801a1.51 1.51 0 0 1 .504-.507c.202-.129.43-.22.686-.274.255-.054.514-.081.776-.081.27 0 .521.027.757.081.235.054.44.142.614.264.182.115.323.26.424.436.108.175.161.385.161.628 0 .304-.087.551-.262.74a1.07 1.07 0 0 1-.575.355v.02c.121.02.242.061.363.122s.229.146.323.254c.094.101.172.23.232.385.06.149.09.324.09.527 0 .284-.06.53-.18.74-.122.21-.283.382-.485.517a2.246 2.246 0 0 1-.695.305 3.13 3.13 0 0 1-.797.1ZM69.28 8.17h.856v4.278l2.46-4.278h1.1v5.241h-.858V9.133l-2.46 4.278H69.28V8.17Zm7.071.76h-1.865v-.76h4.587v.76h-1.865v4.481h-.857v-4.48Zm5.725 4.593c-.416 0-.782-.068-1.098-.203a2.128 2.128 0 0 1-.777-.568 2.478 2.478 0 0 1-.474-.872 3.853 3.853 0 0 1-.15-1.105c0-.392.06-.753.18-1.085a2.67 2.67 0 0 1 .505-.871 2.38 2.38 0 0 1 .776-.568c.303-.135.632-.203.988-.203.464 0 .847.098 1.15.294.309.19.554.433.736.73.188.297.315.622.383.973.073.352.104.686.09 1.004h-3.901c-.007.23.02.45.08.66.06.202.158.384.293.547.134.155.305.28.514.375.208.094.454.142.736.142.363 0 .659-.085.887-.254.235-.169.39-.426.464-.77h.847c-.115.595-.367 1.04-.757 1.338-.39.29-.88.436-1.472.436Zm1.402-3.234a1.696 1.696 0 0 0-.141-.578 1.322 1.322 0 0 0-.313-.467 1.314 1.314 0 0 0-.463-.314 1.373 1.373 0 0 0-.585-.122c-.222 0-.424.041-.605.122a1.35 1.35 0 0 0-.454.314 1.513 1.513 0 0 0-.302.477 1.75 1.75 0 0 0-.131.568h2.994Zm4.803-2.119h2.41c.228 0 .447.017.655.05.215.034.407.098.575.193.168.088.302.216.403.385.101.17.151.386.151.65 0 .283-.067.513-.201.689a1.507 1.507 0 0 1-.565.436v.01c.303.06.541.203.716.425.181.224.272.51.272.862 0 .223-.04.43-.12.619a1.34 1.34 0 0 1-.323.486c-.142.136-.31.244-.504.325a1.77 1.77 0 0 1-.636.111h-2.833V8.17Zm2.672 4.511c.282 0 .494-.08.635-.243a.92.92 0 0 0 .222-.629.734.734 0 0 0-.232-.567c-.154-.142-.413-.213-.776-.213h-1.674v1.652h1.825ZM90.6 10.32c.37 0 .625-.068.766-.203a.693.693 0 0 0 .222-.537c0-.216-.07-.382-.212-.497-.14-.121-.4-.182-.776-.182h-1.472v1.42H90.6Zm-65.982 8.912a5.228 5.228 0 0 1 2.488-4.386 5.347 5.347 0 0 0-4.213-2.279c-1.772-.186-3.49 1.062-4.394 1.062-.92 0-2.312-1.043-3.808-1.012a5.609 5.609 0 0 0-4.722 2.881c-2.041 3.536-.518 8.734 1.437 11.593.978 1.4 2.121 2.964 3.618 2.908 1.464-.061 2.011-.934 3.778-.934 1.751 0 2.264.934 3.79.899 1.57-.025 2.561-1.406 3.506-2.82a11.57 11.57 0 0 0 1.602-3.266 5.05 5.05 0 0 1-3.081-4.646h-.001Zm-2.884-8.545A5.15 5.15 0 0 0 22.911 7a5.232 5.232 0 0 0-3.386 1.753 4.9 4.9 0 0 0-1.208 3.55 4.328 4.328 0 0 0 3.417-1.616Z" /></symbol>',126,40),Y_=(0,je.makeIcon)("Icon40AppStoreButtonEn","app_store_button_en_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="app_store_button_en_40"><path d="M40.228 17.793h2.295l4.745 12.313h-2.313l-1.155-3.26h-4.918l-1.156 3.26H35.5l4.728-12.313Zm-.76 7.415h3.762l-1.846-5.294h-.052l-1.863 5.294Zm8.922-4.018h1.863v1.207h.034c.276-.517.662-.885 1.156-1.104a3.76 3.76 0 0 1 1.605-.345c.701 0 1.311.127 1.829.38.529.241.966.58 1.311 1.017.345.426.604.926.777 1.5a6.39 6.39 0 0 1 .258 1.846c0 .598-.08 1.178-.241 1.742a4.405 4.405 0 0 1-.708 1.5c-.31.425-.707.77-1.19 1.035-.483.253-1.053.38-1.708.38a4.39 4.39 0 0 1-.863-.087 3.431 3.431 0 0 1-.828-.241 3.674 3.674 0 0 1-.742-.432 2.66 2.66 0 0 1-.552-.638h-.035v4.45H48.39V21.19Zm6.866 4.466a4.41 4.41 0 0 0-.155-1.172 3.08 3.08 0 0 0-.466-1 2.284 2.284 0 0 0-.776-.708 2.06 2.06 0 0 0-1.07-.275c-.828 0-1.455.287-1.88.862-.415.575-.622 1.34-.622 2.294 0 .448.052.867.155 1.258.115.38.282.707.5.983.22.276.478.495.777.656.31.16.667.241 1.07.241.449 0 .828-.092 1.139-.276.31-.184.563-.42.759-.707a2.79 2.79 0 0 0 .431-1 4.88 4.88 0 0 0 .138-1.155Zm3.854-4.466h1.863v1.207h.035c.276-.517.661-.885 1.156-1.104a3.76 3.76 0 0 1 1.605-.345c.701 0 1.31.127 1.829.38.529.241.966.58 1.31 1.017.346.426.605.926.777 1.5a6.39 6.39 0 0 1 .26 1.846c0 .598-.081 1.178-.242 1.742a4.405 4.405 0 0 1-.708 1.5c-.31.425-.707.77-1.19 1.035-.484.253-1.053.38-1.709.38a4.39 4.39 0 0 1-.862-.087 3.43 3.43 0 0 1-.828-.241 3.674 3.674 0 0 1-.742-.432 2.657 2.657 0 0 1-.553-.638h-.034v4.45H59.11V21.19Zm6.867 4.466c0-.402-.052-.793-.155-1.172a3.084 3.084 0 0 0-.466-1 2.284 2.284 0 0 0-.776-.708 2.06 2.06 0 0 0-1.07-.275c-.828 0-1.455.287-1.881.862-.414.575-.621 1.34-.621 2.294 0 .448.052.867.155 1.258.115.38.282.707.5.983.22.276.478.495.777.656.31.16.667.241 1.07.241.448 0 .828-.092 1.139-.276.31-.184.563-.42.759-.707a2.79 2.79 0 0 0 .431-1c.092-.38.138-.765.138-1.155Zm10.468.345c0 .472.08.874.241 1.207.161.334.386.61.673.828.288.207.616.362.984.466.38.092.788.138 1.225.138.471 0 .874-.052 1.207-.155a2.56 2.56 0 0 0 .811-.431 1.55 1.55 0 0 0 .45-.587c.091-.23.137-.46.137-.69 0-.471-.11-.816-.328-1.034a1.72 1.72 0 0 0-.69-.483 13.31 13.31 0 0 0-1.535-.449c-.576-.149-1.289-.339-2.14-.569-.53-.138-.972-.316-1.329-.534a3.325 3.325 0 0 1-.828-.759 2.771 2.771 0 0 1-.448-.88 3.734 3.734 0 0 1-.121-.948c0-.62.126-1.155.38-1.604a3.49 3.49 0 0 1 1.035-1.138 4.382 4.382 0 0 1 1.449-.655 6.124 6.124 0 0 1 1.64-.224 6.16 6.16 0 0 1 1.81.258 4.27 4.27 0 0 1 1.502.742 3.61 3.61 0 0 1 1.035 1.241c.253.483.38 1.047.38 1.69h-2.157c-.057-.793-.328-1.35-.81-1.672-.484-.334-1.1-.5-1.847-.5-.253 0-.512.028-.777.086a2.181 2.181 0 0 0-.724.258 1.585 1.585 0 0 0-.552.483c-.138.207-.207.466-.207.776 0 .437.132.782.396 1.035.276.241.633.425 1.07.552.046.011.225.063.535.155a79.013 79.013 0 0 1 2.209.586c.38.092.65.161.81.207.403.127.754.3 1.053.518.3.218.547.471.742.759.207.275.357.574.449.896.103.322.155.644.155.966 0 .69-.144 1.282-.431 1.776-.276.483-.645.88-1.105 1.19a4.71 4.71 0 0 1-1.57.673 7.244 7.244 0 0 1-1.794.224 7.39 7.39 0 0 1-1.985-.259 4.646 4.646 0 0 1-1.621-.793 3.9 3.9 0 0 1-1.105-1.363c-.276-.563-.42-1.224-.431-1.983h2.157Zm8.773-4.811H86.7v-2.673h1.967v2.673h1.778v1.466h-1.778v4.76c0 .206.006.385.018.534.023.15.063.276.12.38a.68.68 0 0 0 .294.24c.126.047.299.07.517.07h.415c.138-.012.276-.035.414-.07v1.518c-.219.023-.432.046-.639.07-.207.022-.42.034-.638.034-.518 0-.938-.046-1.26-.138a1.862 1.862 0 0 1-.742-.431 1.658 1.658 0 0 1-.362-.725 6 6 0 0 1-.104-.982v-5.26h-1.483V21.19Zm10.905 9.157c-.714 0-1.352-.115-1.916-.345a4.28 4.28 0 0 1-1.415-.983 4.341 4.341 0 0 1-.88-1.483 5.858 5.858 0 0 1-.293-1.897c0-.678.098-1.305.293-1.88.207-.574.5-1.069.88-1.483a4.075 4.075 0 0 1 1.415-.965c.564-.242 1.202-.363 1.916-.363.713 0 1.345.121 1.898.363.563.23 1.035.552 1.415.965.39.414.684.909.879 1.483a5.51 5.51 0 0 1 .311 1.88c0 .69-.104 1.322-.311 1.897a4.057 4.057 0 0 1-2.294 2.466c-.553.23-1.185.345-1.898.345Zm0-1.552c.437 0 .816-.092 1.138-.276a2.39 2.39 0 0 0 .794-.724c.207-.3.357-.633.449-1a4.308 4.308 0 0 0 0-2.294 2.834 2.834 0 0 0-.449-1 2.4 2.4 0 0 0-.794-.725c-.322-.183-.701-.275-1.138-.275-.438 0-.817.092-1.14.275a2.4 2.4 0 0 0-.793.725 3.08 3.08 0 0 0-.466 1 4.815 4.815 0 0 0 0 2.294c.104.367.259.7.466 1a2.4 2.4 0 0 0 .794.724c.322.184.702.276 1.139.276Zm6.311-7.605h1.846v1.724h.035a2.06 2.06 0 0 1 .327-.707c.173-.23.374-.436.604-.62a3.05 3.05 0 0 1 .794-.466c.288-.115.581-.172.88-.172.23 0 .385.005.466.017l.276.034v1.897a4.936 4.936 0 0 0-.431-.051 2.514 2.514 0 0 0-.414-.035c-.334 0-.65.069-.949.207a2.057 2.057 0 0 0-.76.586 2.78 2.78 0 0 0-.517.949c-.127.38-.19.816-.19 1.31v4.243h-1.967V21.19Zm12.061 3.673a2.967 2.967 0 0 0-.208-.897 2.1 2.1 0 0 0-.448-.741 1.95 1.95 0 0 0-.69-.518 1.915 1.915 0 0 0-.898-.206c-.345 0-.661.063-.949.19a2.1 2.1 0 0 0-.724.5 2.562 2.562 0 0 0-.483.74 2.731 2.731 0 0 0-.19.932h4.59Zm-4.59 1.294c0 .345.046.678.138 1 .103.322.253.603.448.845.196.241.443.437.742.586.3.138.656.207 1.07.207.575 0 1.035-.12 1.381-.362.356-.253.621-.627.793-1.121h1.864a3.717 3.717 0 0 1-.535 1.293 3.83 3.83 0 0 1-.915.966 3.893 3.893 0 0 1-1.207.57 4.57 4.57 0 0 1-1.381.206c-.701 0-1.323-.115-1.863-.345a3.94 3.94 0 0 1-1.381-.965 4.263 4.263 0 0 1-.845-1.484 6.196 6.196 0 0 1-.276-1.896c0-.633.098-1.23.293-1.794a4.702 4.702 0 0 1 .863-1.5 4.161 4.161 0 0 1 1.363-1.035c.529-.253 1.127-.38 1.794-.38.702 0 1.329.15 1.881.449.564.287 1.03.673 1.398 1.155a4.61 4.61 0 0 1 .794 1.673c.172.62.218 1.265.138 1.932h-6.557ZM39.007 6.315a2.827 2.827 0 0 1 3.005 3.17c0 2.039-1.103 3.21-3.005 3.21H36.7v-6.38h2.307Zm-1.315 5.478h1.204a2.008 2.008 0 0 0 2.106-2.295 2.009 2.009 0 0 0-1.238-2.137 2.015 2.015 0 0 0-.868-.145h-1.204v4.577Zm5.44-1.507a2.28 2.28 0 0 1 3.196-2.304 2.283 2.283 0 0 1 1.35 2.304 2.278 2.278 0 0 1-1.349 2.308 2.284 2.284 0 0 1-3.197-2.308Zm3.567 0c0-1.044-.47-1.655-1.293-1.655-.827 0-1.292.61-1.292 1.655 0 1.052.466 1.658 1.292 1.658.824 0 1.293-.61 1.293-1.658Zm7.02 2.41h-.986l-.996-3.547h-.076l-.992 3.547h-.977L48.364 7.88h.965l.863 3.675h.07l.992-3.675h.912l.99 3.675h.076l.86-3.675h.95l-1.323 4.816Zm2.44-4.816h.916v.765h.071a1.442 1.442 0 0 1 1.438-.858 1.569 1.569 0 0 1 1.668 1.791v3.118h-.95v-2.88c0-.773-.337-1.158-1.04-1.158a1.107 1.107 0 0 0-1.151 1.22v2.818h-.951V7.88ZM61.769 6h.95v6.696h-.95V6Zm2.273 4.286a2.28 2.28 0 0 1 3.197-2.304 2.283 2.283 0 0 1 1.349 2.304 2.28 2.28 0 0 1-2.273 2.502 2.286 2.286 0 0 1-2.168-1.564 2.28 2.28 0 0 1-.105-.938Zm3.567 0c0-1.044-.47-1.655-1.293-1.655-.826 0-1.291.61-1.291 1.655 0 1.052.465 1.658 1.291 1.658.824 0 1.293-.61 1.293-1.658Zm1.98 1.048c0-.867.646-1.367 1.793-1.438l1.305-.075v-.416c0-.508-.337-.795-.987-.795-.53 0-.898.194-1.004.535h-.92c.096-.827.875-1.358 1.968-1.358 1.208 0 1.89.601 1.89 1.618v3.29h-.916v-.676h-.075a1.62 1.62 0 0 1-1.447.756 1.457 1.457 0 0 1-1.607-1.441Zm3.098-.412v-.402l-1.177.075c-.664.044-.965.27-.965.694 0 .434.377.686.894.686a1.138 1.138 0 0 0 1.248-1.053Zm2.197-.636c0-1.522.783-2.486 2-2.486a1.59 1.59 0 0 1 1.478.845h.071V6h.951v6.696h-.911v-.761h-.075a1.674 1.674 0 0 1-1.514.84c-1.226 0-2-.964-2-2.49Zm.982 0c0 1.021.482 1.636 1.288 1.636.801 0 1.297-.624 1.297-1.632 0-1.004-.5-1.636-1.297-1.636-.8 0-1.288.619-1.288 1.632Zm7.453 0a2.28 2.28 0 0 1 3.197-2.304 2.283 2.283 0 0 1 1.349 2.304 2.281 2.281 0 0 1-3.198 2.308 2.281 2.281 0 0 1-1.348-2.308Zm3.567 0c0-1.044-.469-1.655-1.293-1.655-.826 0-1.291.61-1.291 1.655 0 1.052.465 1.658 1.291 1.658.824 0 1.293-.61 1.293-1.658ZM89.14 7.88h.915v.765h.071a1.442 1.442 0 0 1 1.438-.858 1.568 1.568 0 0 1 1.669 1.791v3.118h-.952v-2.88c0-.773-.336-1.158-1.04-1.158a1.106 1.106 0 0 0-1.15 1.22v2.818h-.951V7.88Zm9.467-1.199v1.221h1.044v.8h-1.044v2.477c0 .504.208.725.681.725.121 0 .242-.008.363-.022v.792c-.171.03-.344.046-.518.048-1.057 0-1.478-.372-1.478-1.3v-2.72h-.766v-.8h.766v-1.22h.952Zm2.343-.68h.943v2.653h.075a1.479 1.479 0 0 1 1.469-.863 1.586 1.586 0 0 1 1.66 1.796v3.109h-.952V9.82c0-.77-.359-1.159-1.031-1.159a1.122 1.122 0 0 0-.89.329 1.125 1.125 0 0 0-.323.892v2.813h-.951V6Zm9.693 5.394a1.959 1.959 0 0 1-2.089 1.393 2.186 2.186 0 0 1-2.226-2.485 2.224 2.224 0 0 1 2.222-2.516c1.341 0 2.15.915 2.15 2.428v.331h-3.403v.054a1.269 1.269 0 0 0 .767 1.276c.163.07.339.105.516.103a1.159 1.159 0 0 0 1.147-.584h.916Zm-3.346-1.552h2.434a1.166 1.166 0 0 0-1.186-1.248 1.23 1.23 0 0 0-1.248 1.248Z" /><path fill-rule="evenodd" d="M22.91 7a5.15 5.15 0 0 1-1.177 3.687 4.328 4.328 0 0 1-3.416 1.616 4.9 4.9 0 0 1 1.207-3.55A5.232 5.232 0 0 1 22.91 7Zm4.196 7.847a5.228 5.228 0 0 0-2.488 4.385 5.05 5.05 0 0 0 3.082 4.646 11.6 11.6 0 0 1-1.602 3.267c-.945 1.413-1.935 2.793-3.506 2.819-.747.017-1.25-.198-1.776-.422-.549-.234-1.12-.477-2.014-.477-.948 0-1.545.251-2.12.493-.498.21-.98.412-1.658.44-1.496.056-2.64-1.508-3.618-2.907-1.955-2.86-3.478-8.057-1.437-11.593a5.609 5.609 0 0 1 4.722-2.881c.848-.017 1.662.31 2.376.597.546.219 1.033.415 1.432.415.35 0 .825-.188 1.377-.408.87-.345 1.933-.767 3.017-.654a5.347 5.347 0 0 1 4.213 2.28Z" clip-rule="evenodd" /></symbol>',126,40),J_=(0,je.makeIcon)("Icon40GooglePlayButtonRu","google_play_button_ru_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="google_play_button_ru_40"><path d="M98.726 29.122h1.776V17.23h-1.776v11.892Zm15.999-7.609-2.036 5.157h-.062l-2.113-5.157h-1.913l3.169 7.207-1.806 4.009h1.852l4.884-11.216h-1.975Zm-10.074 6.259c-.582 0-1.393-.291-1.393-1.01 0-.918 1.01-1.27 1.883-1.27.78 0 1.148.168 1.623.398a2.154 2.154 0 0 1-2.113 1.882Zm.215-6.518c-1.286 0-2.619.566-3.171 1.82l1.578.658c.337-.658.964-.872 1.623-.872.919 0 1.853.55 1.868 1.53v.122c-.322-.184-1.011-.459-1.852-.459-1.7 0-3.43.934-3.43 2.677 0 1.593 1.393 2.617 2.954 2.617 1.195 0 1.853-.534 2.267-1.163h.061v.919h1.715v-4.56c0-2.111-1.577-3.29-3.613-3.29Zm-10.978 1.708h-2.526v-4.078h2.526c1.328 0 2.082 1.1 2.082 2.039 0 .922-.754 2.039-2.082 2.039Zm-.046-5.732h-4.256v11.892h1.776v-4.505h2.48c1.969 0 3.904-1.425 3.904-3.694 0-2.27-1.935-3.693-3.904-3.693ZM70.633 27.773c-1.227 0-2.254-1.026-2.254-2.436 0-1.425 1.027-2.468 2.254-2.468 1.213 0 2.162 1.043 2.162 2.468 0 1.41-.95 2.436-2.162 2.436Zm2.04-5.593h-.061c-.399-.475-1.166-.905-2.132-.905-2.025 0-3.88 1.778-3.88 4.062 0 2.268 1.855 4.03 3.88 4.03.966 0 1.733-.428 2.132-.919h.06v.582c0 1.55-.826 2.376-2.161 2.376-1.089 0-1.764-.782-2.04-1.44l-1.549.644c.445 1.073 1.626 2.39 3.589 2.39 2.085 0 3.85-1.226 3.85-4.215V21.52h-1.689v.66Zm2.913 6.942h1.78V17.23h-1.78v11.893Zm4.402-3.923c-.046-1.564 1.212-2.36 2.116-2.36.706 0 1.305.352 1.504.858l-3.62 1.502Zm5.521-1.349c-.338-.905-1.365-2.575-3.466-2.575-2.085 0-3.818 1.64-3.818 4.047 0 2.268 1.717 4.046 4.017 4.046 1.857 0 2.929-1.134 3.375-1.793l-1.38-.92c-.46.674-1.09 1.118-1.995 1.118-.904 0-1.549-.413-1.963-1.225l5.414-2.238-.184-.46Zm-43.13-1.333v1.717h4.11c-.123.965-.444 1.67-.935 2.16-.598.598-1.534 1.257-3.174 1.257-2.532 0-4.51-2.038-4.51-4.567 0-2.53 1.978-4.567 4.51-4.567 1.364 0 2.361.535 3.097 1.226l1.212-1.21c-1.028-.982-2.392-1.733-4.31-1.733-3.466 0-6.379 2.82-6.379 6.284s2.913 6.284 6.38 6.284c1.87 0 3.28-.614 4.385-1.763 1.135-1.134 1.488-2.727 1.488-4.015 0-.4-.03-.766-.093-1.073h-5.78Zm10.546 5.256c-1.226 0-2.285-1.01-2.285-2.451 0-1.456 1.06-2.453 2.285-2.453 1.227 0 2.286.997 2.286 2.453 0 1.44-1.06 2.451-2.286 2.451Zm0-6.498c-2.24 0-4.064 1.702-4.064 4.047 0 2.329 1.825 4.046 4.064 4.046 2.24 0 4.065-1.717 4.065-4.046 0-2.345-1.826-4.047-4.065-4.047Zm8.866 6.498c-1.227 0-2.285-1.01-2.285-2.451 0-1.456 1.058-2.453 2.285-2.453s2.285.997 2.285 2.453c0 1.44-1.058 2.451-2.285 2.451Zm0-6.498c-2.239 0-4.064 1.702-4.064 4.047 0 2.329 1.825 4.046 4.064 4.046s4.064-1.717 4.064-4.046c0-2.345-1.825-4.047-4.064-4.047Zm20.993-8.46c-.373-.255-.628-.63-.766-1.127l.836-.331c.071.309.211.551.418.729.207.176.451.265.733.265.303 0 .563-.096.778-.286a.906.906 0 0 0 .323-.708.869.869 0 0 0-.157-.502 1.088 1.088 0 0 0-.431-.36 1.342 1.342 0 0 0-.596-.132h-.489v-.795h.44c.298 0 .545-.082.744-.245a.805.805 0 0 0 .299-.658.767.767 0 0 0-.278-.605 1.02 1.02 0 0 0-.691-.24.923.923 0 0 0-.63.224 1.17 1.17 0 0 0-.355.53l-.803-.332a1.97 1.97 0 0 1 .633-.865c.307-.251.694-.377 1.163-.377.359 0 .678.07.957.211.278.141.496.335.654.58.157.246.235.523.235.832 0 .575-.25 1-.753 1.276v.05a1.7 1.7 0 0 1 .687.554c.177.244.265.539.265.887a1.7 1.7 0 0 1-.26.92 1.815 1.815 0 0 1-.716.65 2.187 2.187 0 0 1-1.019.235c-.442 0-.849-.127-1.221-.38Zm-6.379-5.682h.902v3.28l-.05 1.143h.05l2.658-4.423H81v5.93h-.903V9.7l.05-1.143h-.05l-2.699 4.505h-.993v-5.93Zm-4.926 5.077c.215 0 .405-.05.57-.15.166-.099.294-.23.381-.393a1.07 1.07 0 0 0-.951-1.586h-1.325v2.129h1.325Zm-2.236-5.077h.911v2.111h1.259c.37 0 .711.077 1.026.228.315.152.566.373.754.663.188.29.28.628.28 1.014 0 .387-.093.725-.28 1.015-.189.29-.44.512-.754.667a2.294 2.294 0 0 1-1.026.232h-2.17v-5.93Zm-3.51.861h-1.665v-.861H68.3v.861h-1.656v5.069h-.91V7.994Zm-3.387 2.7-.662-1.818-.223-.68h-.05l-.223.68-.663 1.818h1.821Zm-1.431-3.561h1.034l2.244 5.93H63.19l-.546-1.524h-2.418l-.546 1.524h-1.002l2.236-5.93Zm-3.941 3.288c-.37.326-.825.488-1.366.488-.359 0-.684-.073-.973-.22a1.643 1.643 0 0 1-.683-.633 1.869 1.869 0 0 1-.249-.977V7.133h.92v1.789c0 .359.104.636.314.832.21.196.492.294.844.294.481 0 .878-.187 1.193-.563V7.133h.902v5.93h-.902V10.42Zm-5.274.273-.662-1.818-.224-.68h-.05l-.223.68-.662 1.818h1.82Zm-1.433-3.561h1.036l2.243 5.93h-1.002l-.546-1.524h-2.417l-.547 1.524h-1.002l2.235-5.93Zm-7.401 0h.91v2.874h.05l2.36-2.874h1.142v.05l-2.5 2.964 2.633 2.866v.05H46.27l-2.442-2.717h-.05v2.716h-.91v-5.93ZM37.92 12.79a2.945 2.945 0 0 1-1.114-1.119 3.125 3.125 0 0 1-.406-1.573c0-.575.135-1.1.406-1.574.27-.475.641-.848 1.114-1.118.471-.27.994-.406 1.568-.406.889 0 1.62.323 2.194.97l-.637.62a2.08 2.08 0 0 0-.683-.546 1.97 1.97 0 0 0-.866-.183c-.403 0-.77.093-1.1.278a2.038 2.038 0 0 0-.787.787c-.194.34-.29.73-.29 1.172 0 .441.096.832.29 1.172.193.34.455.602.787.786.33.186.697.278 1.1.278.674 0 1.24-.279 1.698-.837l.654.63a3.026 3.026 0 0 1-2.36 1.068 3.097 3.097 0 0 1-1.569-.405Zm-19.462 5.663L9.17 9.693a2.142 2.142 0 0 1 3.063-.989l.006.003 10.426 6.018-4.208 3.728ZM9 11.015l8.408 8.368.032.034L9 28.336V11.015ZM11.132 31a2.13 2.13 0 0 1-1.965-1.3l9.302-9.26 4.25 4.232-10.472 6.016-.003.002-.031.018h-.001a2.126 2.126 0 0 1-1.08.292Zm8.283-11.5 4.227-4.208 4.41 2.545.015.01.023.013a2.117 2.117 0 0 1-.013 3.732l-.007.004-.006.004-4.386 2.52-4.263-4.62Z" /></symbol>',126,40),X_=(0,je.makeIcon)("Icon40GooglePlayButtonEn","google_play_button_en_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="google_play_button_en_40"><path fill-rule="evenodd" d="M42.296 24.277V22.55h5.914c.095.288.095.672.095 1.055 0 1.246-.381 2.876-1.526 4.026-1.145 1.246-2.48 1.821-4.388 1.821-3.434 0-6.391-2.875-6.391-6.326 0-3.451 2.957-6.327 6.391-6.327 1.908 0 3.244.767 4.293 1.726l-1.24 1.246c-.763-.671-1.813-1.246-3.148-1.246-2.48 0-4.484 2.012-4.484 4.6 0 2.589 1.908 4.602 4.484 4.602 1.621 0 2.575-.671 3.148-1.246.477-.48.858-1.247.954-2.205h-4.102Zm35.103 4.889h-1.813V17.184H77.4v11.982Zm12.21-11.982H93.9c2.003 0 3.911 1.438 3.911 3.738S95.903 24.66 93.9 24.66h-2.48v4.506h-1.813V17.184Zm9.158 11.982h1.812V17.184h-1.812v11.982Zm3.053-6.135c.477-1.246 1.812-1.822 3.148-1.822 2.003 0 3.624 1.247 3.815 3.356v4.6h-1.717v-.958h-.095c-.477.575-1.05 1.15-2.29 1.15-1.526 0-2.957-1.054-2.957-2.684 0-1.725 1.717-2.684 3.434-2.684.763 0 1.527.288 1.813.48v-.096c-.096-.959-.954-1.534-1.908-1.534-.668 0-1.24.192-1.622.863l-1.621-.671Zm10.969 3.642 2.003-5.176h1.908l-4.865 11.311h-1.812l1.812-4.026-3.148-7.285h1.908l2.099 5.176h.095Zm-27.186-2.78c-.382-.958-1.336-2.588-3.434-2.588-2.1 0-3.816 1.63-3.816 4.122 0 2.3 1.717 4.122 4.006 4.122 1.813 0 2.957-1.15 3.339-1.821l-1.335-.959c-.477.671-1.05 1.15-2.004 1.15s-1.526-.383-2.003-1.245l5.437-2.301-.19-.48Zm-12.878-1.725c-.477-.48-1.24-.959-2.194-.959-2.003 0-3.91 1.822-3.91 4.122 0 2.301 1.812 4.027 3.91 4.027.954 0 1.717-.48 2.099-.96h.095v.576c0 1.534-.858 2.396-2.194 2.396-1.05 0-1.812-.766-2.003-1.437l-1.526.67C67.479 31.659 68.623 33 70.626 33c2.1 0 3.816-1.246 3.816-4.218v-7.285h-1.717v.671Zm-15.072 3.26c0-2.397 1.812-4.123 4.102-4.123s4.102 1.63 4.102 4.122c0 2.397-1.813 4.122-4.102 4.122-2.29 0-4.102-1.821-4.102-4.122Zm-4.77-4.123c-2.289 0-4.101 1.726-4.101 4.122 0 2.3 1.812 4.122 4.102 4.122s4.102-1.725 4.102-4.122c0-2.492-1.813-4.122-4.102-4.122Zm38.539 1.63h2.575c1.24 0 2.004-1.054 2.099-2.109 0-.863-.763-2.013-2.099-2.013h-2.575v4.122Zm11.924 3.834c0 .767.859 1.055 1.431 1.055.954 0 1.908-.767 2.099-1.917l-.142-.058c-.416-.17-.794-.326-1.48-.326-.858 0-1.908.288-1.908 1.246Zm-23.277-1.534c0-1.533 1.24-2.396 2.099-2.396.668 0 1.335.384 1.526.863l-3.625 1.533Zm-11.733.096c0 1.438 1.05 2.493 2.29 2.493s2.194-1.055 2.194-2.493-.954-2.492-2.194-2.492-2.29 1.055-2.29 2.492Zm-6.58 2.493c-1.24 0-2.29-1.055-2.29-2.493s1.05-2.492 2.29-2.492 2.29.959 2.29 2.492c0 1.438-1.05 2.493-2.29 2.493ZM50.594 25.33c0 1.438 1.05 2.493 2.29 2.493s2.288-1.055 2.288-2.493c0-1.533-1.049-2.492-2.289-2.492-1.24 0-2.29 1.055-2.29 2.492Z" clip-rule="evenodd" /><path d="M64.258 13.2c-.83 0-1.53-.304-2.084-.901a3.146 3.146 0 0 1-.841-2.2c0-.873.283-1.612.841-2.198.551-.597 1.251-.901 2.082-.901.82 0 1.52.304 2.083.901.558.605.842 1.344.842 2.198-.01.875-.293 1.614-.842 2.197-.551.603-1.25.904-2.081.904Zm-24.703 0a2.83 2.83 0 0 1-2.093-.89c-.572-.588-.862-1.331-.862-2.209 0-.877.29-1.62.862-2.21a2.798 2.798 0 0 1 2.093-.889c.402 0 .794.084 1.169.254.368.165.668.39.89.665l.054.069-.62.636-.064-.079c-.35-.435-.818-.648-1.438-.648-.554 0-1.036.206-1.434.612-.4.409-.604.945-.604 1.593s.203 1.183.604 1.592c.398.406.88.612 1.434.612.59 0 1.086-.206 1.473-.612.228-.24.37-.574.42-.997h-1.987v-.894h2.84l.012.081c.02.15.041.306.041.45 0 .824-.238 1.492-.709 1.984-.535.583-1.235.88-2.081.88Zm32.845-.127h-.876l-2.683-4.488.023.808v3.678h-.876V7.129h1l.027.046 2.523 4.227-.023-.806V7.13h.885v5.944Zm-14.724 0h-.888v-5.05H55.25V7.13h3.963v.894h-1.539v5.05h.003Zm-3.15 0h-.885V7.13h.885v5.944Zm-4.974 0h-.885v-5.05h-1.54V7.13h3.964v.894h-1.54v5.05Zm-2.985-.01h-3.394V7.13h3.394v.894H44.06v1.631h2.262v.885H44.06v1.63h2.507v.895Zm16.257-1.379c.395.414.876.622 1.434.622a1.87 1.87 0 0 0 1.434-.622c.389-.406.585-.94.585-1.583s-.196-1.179-.583-1.583a1.92 1.92 0 0 0-1.434-.621 1.86 1.86 0 0 0-1.432.621c-.388.407-.585.94-.585 1.583s.194 1.179.58 1.583Zm-44.366 6.769L9.17 9.693a2.142 2.142 0 0 1 3.063-.989l.006.003 10.426 6.018-4.208 3.728ZM9 11.015l8.408 8.368.032.034L9 28.336V11.015ZM11.132 31a2.13 2.13 0 0 1-1.965-1.3l9.302-9.26 4.25 4.232-10.472 6.016-.003.002-.031.018h-.001a2.126 2.126 0 0 1-1.08.292Zm8.283-11.5 4.227-4.208 4.41 2.545.015.01.023.013a2.117 2.117 0 0 1-.013 3.732l-.007.004-.006.004-4.386 2.52-4.263-4.62Z" /></symbol>',126,40),q_=(0,je.makeIcon)("Icon40RustoreButtonRu","rustore_button_ru_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="rustore_button_ru_40"><path fill-rule="evenodd" d="M63.773 31.4c-1.115 0-2.099-.296-2.952-.89a4.345 4.345 0 0 1-1.689-2.428l1.98-.342c.33.604.699 1.055 1.108 1.351.41.285.933.428 1.57.428.591 0 1.075-.131 1.45-.394a1.29 1.29 0 0 0 .58-1.111c0-.343-.108-.628-.324-.856a2.423 2.423 0 0 0-.82-.581 14.447 14.447 0 0 0-1.313-.496 15.093 15.093 0 0 1-1.876-.736 3.67 3.67 0 0 1-1.263-1.077c-.341-.479-.512-1.095-.512-1.847 0-.696.171-1.3.512-1.813a3.38 3.38 0 0 1 1.416-1.198c.592-.273 1.257-.41 1.996-.41 1.047 0 1.945.274 2.696.821.75.547 1.28 1.3 1.586 2.258l-1.945.325c-.216-.49-.517-.867-.904-1.13-.386-.262-.841-.393-1.364-.393-.535 0-.984.126-1.348.377-.364.25-.546.604-.546 1.06 0 .342.102.627.307.855.216.228.489.416.819.565.33.148.773.319 1.33.513.763.262 1.388.519 1.877.77.49.25.904.615 1.245 1.094.353.479.53 1.089.53 1.83 0 .696-.188 1.306-.564 1.83-.364.525-.864.93-1.5 1.215-.627.273-1.32.41-2.082.41Zm-18.103-.171h2.406l-3.344-4.584c.899-.228 1.615-.667 2.15-1.317.546-.661.819-1.442.819-2.343 0-.741-.182-1.397-.546-1.967a3.65 3.65 0 0 0-1.519-1.351c-.648-.33-1.382-.496-2.2-.496H39v12.058h2.047v-4.43h1.45l3.173 4.43Zm-4.623-6.311v-3.866h2.389c.637 0 1.154.183 1.552.548.41.353.614.815.614 1.385 0 .57-.204 1.038-.614 1.403-.398.353-.915.53-1.552.53h-2.389Zm10.101 6.003c.512.32 1.08.479 1.706.479.535 0 1.035-.131 1.501-.393a3.19 3.19 0 0 0 1.126-1.112l.393 1.334h1.467v-8.894h-1.962v5.148c0 .627-.188 1.146-.563 1.557-.375.399-.847.598-1.416.598-.557 0-1.018-.2-1.382-.598-.352-.4-.529-.918-.529-1.557v-5.148h-1.962v5.37c0 .708.142 1.34.427 1.9.296.558.694.997 1.194 1.316Zm23.933.308.17-1.71h-1.825c-.66 0-.99-.331-.99-.992v-4.482h2.645v-1.71h-2.644V19.77h-1.468l-.494 2.565h-1.45v1.71h1.45v4.482c0 .878.25 1.55.75 2.018.5.456 1.234.684 2.201.684h1.655Zm5.948.171c-.91 0-1.73-.194-2.457-.581a4.415 4.415 0 0 1-1.689-1.642c-.398-.707-.597-1.506-.597-2.395 0-.89.199-1.682.597-2.377a4.257 4.257 0 0 1 1.689-1.642c.728-.4 1.547-.599 2.457-.599.91 0 1.723.2 2.44.599.727.387 1.29.935 1.688 1.642.41.695.614 1.488.614 2.377 0 .89-.204 1.688-.614 2.395a4.263 4.263 0 0 1-1.689 1.642c-.716.387-1.53.581-2.44.581Zm0-1.796c.796 0 1.444-.256 1.945-.77.5-.524.75-1.208.75-2.052 0-.844-.25-1.522-.75-2.035-.501-.525-1.15-.787-1.945-.787-.796 0-1.445.262-1.945.787-.5.513-.75 1.191-.75 2.035 0 .844.25 1.528.75 2.052.5.514 1.148.77 1.945.77Zm8.086-7.269h-1.467v8.894h1.962v-5.25c0-1.175.58-1.762 1.74-1.762h1.126l-.171-1.882h-.375c-.558 0-1.035.097-1.433.29-.387.195-.723.525-1.007.993l-.375-1.283ZM102.3 26.68c0 .172-.011.382-.034.633h-7.131c.09.696.375 1.255.853 1.676.477.41 1.086.616 1.825.616.5 0 .95-.097 1.348-.29.41-.195.722-.457.938-.787l1.843.307a3.645 3.645 0 0 1-1.655 1.899c-.774.445-1.638.667-2.593.667-.887 0-1.684-.194-2.389-.581a4.36 4.36 0 0 1-1.638-1.642c-.386-.707-.58-1.506-.58-2.395 0-.89.194-1.682.58-2.377a4.203 4.203 0 0 1 1.638-1.642c.705-.4 1.502-.599 2.389-.599.887 0 1.677.2 2.371.599a4.086 4.086 0 0 1 1.638 1.625c.398.684.597 1.448.597 2.291Zm-4.606-2.804a2.47 2.47 0 0 0-1.553.513c-.432.342-.728.803-.887 1.385h4.913a2.625 2.625 0 0 0-.92-1.368c-.433-.354-.95-.53-1.553-.53Z" clip-rule="evenodd" /><path d="M39 15.791v-2.715h.209a.792.792 0 0 0 .536-.189c.146-.132.269-.361.368-.686.106-.331.19-.789.249-1.372L40.74 7h4.343v6.076h1.044v2.695h-1.044v-1.76h-5.04v1.78H39Zm1.78-2.715h3.23V7.935h-2.306l-.288 2.953c-.06.604-.14 1.068-.24 1.393-.092.324-.224.573-.397.745v.05Zm8.572 1.064c-.49 0-.921-.112-1.292-.338a2.217 2.217 0 0 1-.855-.954c-.2-.418-.298-.909-.298-1.472 0-.557.099-1.041.298-1.452.199-.418.483-.736.855-.955.37-.225.801-.338 1.292-.338.49 0 .918.113 1.282.338.371.219.656.537.855.955.199.41.298.895.298 1.452 0 .563-.1 1.054-.298 1.472-.199.41-.484.729-.855.954-.364.226-.792.338-1.282.338Zm0-.875c.43 0 .769-.166 1.014-.497.245-.338.368-.802.368-1.392 0-.584-.123-1.041-.368-1.373-.245-.331-.583-.497-1.014-.497-.43 0-.769.166-1.014.497-.245.332-.368.79-.368 1.373 0 .59.123 1.054.368 1.392.245.331.583.497 1.014.497Zm5.92.875c-.497 0-.93-.112-1.302-.338a2.217 2.217 0 0 1-.855-.954c-.198-.418-.298-.905-.298-1.462 0-.557.1-1.045.298-1.462.2-.418.48-.736.845-.955.371-.225.809-.338 1.312-.338.557 0 1.028.136 1.412.408.391.265.646.646.765 1.143h-1.063c-.219-.45-.58-.676-1.084-.676-.45 0-.802.166-1.053.497-.246.332-.368.793-.368 1.383s.122 1.05.368 1.382c.251.331.606.497 1.063.497.279 0 .52-.066.726-.199a.97.97 0 0 0 .417-.567h1.064a1.98 1.98 0 0 1-.795 1.204c-.404.292-.888.437-1.452.437Zm5.535-.129h-1.024V9.635h-1.71V8.76h4.444v.875h-1.71v4.376Zm6.238-5.251h1.044l-1.929 5.65c-.145.424-.301.749-.467.974a1.348 1.348 0 0 1-.616.478c-.245.093-.57.139-.974.139h-.398v-.905h.427c.22 0 .391-.023.517-.07a.641.641 0 0 0 .308-.238 2.38 2.38 0 0 0 .249-.507l.05-.14-2.147-5.38h1.103l1.501 4.008h.05l1.282-4.008Zm3.147 5.251h-1.024v-5.25h4.294v5.25H72.44V9.635h-2.247v4.376Zm8.266-3.103V8.76h1.024v5.251h-1.024v-2.228h-2.326v2.228h-1.024v-5.25h1.024v2.147h2.326Zm4.814 3.232c-.49 0-.92-.112-1.292-.338a2.217 2.217 0 0 1-.855-.954c-.199-.418-.298-.909-.298-1.472 0-.557.1-1.041.298-1.452.199-.418.484-.736.855-.955.371-.225.802-.338 1.292-.338s.918.113 1.283.338c.37.219.656.537.854.955.2.41.299.895.299 1.452 0 .563-.1 1.054-.299 1.472-.198.41-.483.729-.854.954-.365.226-.792.338-1.283.338Zm0-.875c.431 0 .769-.166 1.014-.497.245-.338.368-.802.368-1.392 0-.584-.123-1.041-.368-1.373-.245-.331-.583-.497-1.014-.497-.43 0-.768.166-1.014.497-.245.332-.367.79-.367 1.373 0 .59.122 1.054.367 1.392.246.331.584.497 1.014.497Zm9.703-2.019c.617.213.925.627.925 1.243 0 .465-.169.836-.507 1.114-.338.272-.792.408-1.362.408h-2.356v-5.25h2.297c.53 0 .954.125 1.272.377.325.245.487.57.487.975a1.1 1.1 0 0 1-.199.656 1.26 1.26 0 0 1-.556.428v.05ZM90.7 9.586v1.312h1.253c.232 0 .414-.06.546-.179a.597.597 0 0 0 .21-.477.597.597 0 0 0-.21-.477c-.139-.12-.321-.18-.546-.18H90.7Zm1.312 3.6c.265 0 .474-.07.627-.21a.703.703 0 0 0 .238-.556.674.674 0 0 0-.238-.547c-.153-.14-.362-.209-.627-.209H90.7v1.522h1.312Z" /><path fill-rule="evenodd" d="M19.52 32c-5.43 0-8.146 0-9.833-1.688C8 28.625 8 25.91 8 20.48v-.96c0-5.43 0-8.146 1.687-9.833C11.374 8 14.089 8 19.52 8h.96c5.43 0 8.145 0 9.832 1.687C32 11.374 32 14.089 32 19.52v.96c0 5.43 0 8.145-1.688 9.832C28.625 32 25.91 32 20.48 32h-.96Zm5.387-8.453 1.622.405a1.162 1.162 0 0 0 1.447-1.122v-7.816c0-.663-.454-1.242-1.1-1.403l-4.652-1.162a1.162 1.162 0 0 0-1.446 1.123v1.409l-2.93-.732A1.162 1.162 0 0 0 16.4 15.37v1.41l-2.93-.733a1.162 1.162 0 0 0-1.447 1.123v7.815c0 .664.453 1.242 1.1 1.404l4.651 1.161a1.162 1.162 0 0 0 1.447-1.122v-7.804c0-.66-.417-1.042-.568-1.16a.07.07 0 0 1-.016-.093.082.082 0 0 1 .091-.033c.613.185 1.2.813 1.258 1.603l.202 5.969a.473.473 0 0 0 .317.43l1.646.411a1.162 1.162 0 0 0 1.447-1.123v-7.803c0-.66-.416-1.042-.567-1.159a.07.07 0 0 1-.016-.094.083.083 0 0 1 .091-.033c.613.185 1.2.813 1.258 1.603l.202 5.968a.47.47 0 0 0 .34.436Z" clip-rule="evenodd" /></symbol>',126,40),$_=(0,je.makeIcon)("Icon40RustoreButtonEn","rustore_button_en_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="rustore_button_en_40"><path fill-rule="evenodd" d="M63.773 31.4c-1.115 0-2.099-.296-2.952-.89a4.345 4.345 0 0 1-1.689-2.428l1.98-.342c.33.604.699 1.055 1.108 1.351.41.285.933.428 1.57.428.591 0 1.075-.131 1.45-.394a1.29 1.29 0 0 0 .58-1.111c0-.343-.108-.628-.324-.856a2.423 2.423 0 0 0-.82-.581 14.447 14.447 0 0 0-1.313-.496 15.093 15.093 0 0 1-1.876-.736 3.67 3.67 0 0 1-1.263-1.077c-.341-.479-.512-1.095-.512-1.847 0-.696.171-1.3.512-1.813a3.38 3.38 0 0 1 1.416-1.198c.592-.273 1.257-.41 1.996-.41 1.047 0 1.945.274 2.696.821.75.547 1.28 1.3 1.586 2.258l-1.945.325c-.216-.49-.517-.867-.904-1.13-.386-.262-.841-.393-1.364-.393-.535 0-.984.126-1.348.377-.364.25-.546.604-.546 1.06 0 .342.102.627.307.855.216.228.489.416.819.565.33.148.773.319 1.33.513.763.262 1.388.519 1.877.77.49.25.904.615 1.245 1.094.353.479.53 1.089.53 1.83 0 .696-.188 1.306-.564 1.83-.364.525-.864.93-1.5 1.215-.627.273-1.32.41-2.082.41Zm-18.103-.171h2.406l-3.344-4.584c.899-.228 1.615-.667 2.15-1.317.546-.661.819-1.442.819-2.343 0-.741-.182-1.397-.546-1.967a3.65 3.65 0 0 0-1.519-1.351c-.648-.33-1.382-.496-2.2-.496H39v12.058h2.047v-4.43h1.45l3.173 4.43Zm-4.623-6.311v-3.866h2.389c.637 0 1.154.183 1.552.548.41.353.614.815.614 1.385 0 .57-.204 1.038-.614 1.403-.398.353-.915.53-1.552.53h-2.389Zm10.101 6.003c.512.32 1.08.479 1.706.479.535 0 1.035-.131 1.501-.393a3.19 3.19 0 0 0 1.126-1.112l.393 1.334h1.467v-8.894h-1.962v5.148c0 .627-.188 1.146-.563 1.557-.375.399-.847.598-1.416.598-.557 0-1.018-.2-1.382-.598-.352-.4-.529-.918-.529-1.557v-5.148h-1.962v5.37c0 .708.142 1.34.427 1.9.296.558.694.997 1.194 1.316Zm23.933.308.17-1.71h-1.825c-.66 0-.99-.331-.99-.992v-4.482h2.645v-1.71h-2.644V19.77h-1.468l-.494 2.565h-1.45v1.71h1.45v4.482c0 .878.25 1.55.75 2.018.5.456 1.234.684 2.201.684h1.655Zm5.948.171c-.91 0-1.73-.194-2.457-.581a4.415 4.415 0 0 1-1.689-1.642c-.398-.707-.597-1.506-.597-2.395 0-.89.199-1.682.597-2.377a4.257 4.257 0 0 1 1.689-1.642c.728-.4 1.547-.599 2.457-.599.91 0 1.723.2 2.44.599.727.387 1.29.935 1.688 1.642.41.695.614 1.488.614 2.377 0 .89-.204 1.688-.614 2.395a4.263 4.263 0 0 1-1.689 1.642c-.716.387-1.53.581-2.44.581Zm0-1.796c.796 0 1.444-.256 1.945-.77.5-.524.75-1.208.75-2.052 0-.844-.25-1.522-.75-2.035-.501-.525-1.15-.787-1.945-.787-.796 0-1.445.262-1.945.787-.5.513-.75 1.191-.75 2.035 0 .844.25 1.528.75 2.052.5.514 1.148.77 1.945.77Zm8.086-7.269h-1.467v8.894h1.962v-5.25c0-1.175.58-1.762 1.74-1.762h1.126l-.171-1.882h-.375c-.558 0-1.035.097-1.433.29-.387.195-.723.525-1.007.993l-.375-1.283ZM102.3 26.68c0 .172-.011.382-.034.633h-7.131c.09.696.375 1.255.853 1.676.477.41 1.086.616 1.825.616.5 0 .95-.097 1.348-.29.41-.195.722-.457.938-.787l1.843.307a3.645 3.645 0 0 1-1.655 1.899c-.774.445-1.638.667-2.593.667-.887 0-1.684-.194-2.389-.581a4.36 4.36 0 0 1-1.638-1.642c-.386-.707-.58-1.506-.58-2.395 0-.89.194-1.682.58-2.377a4.203 4.203 0 0 1 1.638-1.642c.705-.4 1.502-.599 2.389-.599.887 0 1.677.2 2.371.599a4.086 4.086 0 0 1 1.638 1.625c.398.684.597 1.448.597 2.291Zm-4.606-2.804a2.47 2.47 0 0 0-1.553.513c-.432.342-.728.803-.887 1.385h4.913a2.625 2.625 0 0 0-.92-1.368c-.433-.354-.95-.53-1.553-.53Z" clip-rule="evenodd" /><path d="M45.403 14.371h-1.121l-.546-1.667H40.83l-.555 1.667h-1.092l2.48-6.994h1.34l2.4 6.994Zm-3.135-5.942-1.121 3.353h2.291l-1.09-3.353h-.08Zm6.504 5.942h-1.24l-1.766-5.238h1.082l1.3 4.147h.049l1.399-4.147h1.041l-1.865 5.238Zm4.825-5.367c.628 0 1.117.182 1.468.546.35.363.526.866.526 1.507v3.314h-.804l-.11-.565c-.495.463-1.05.694-1.666.694-.516 0-.932-.149-1.25-.446-.31-.298-.466-.695-.466-1.19 0-.523.195-.933.585-1.231.39-.298.913-.446 1.568-.446h1.12v-.14c0-.39-.088-.687-.267-.892-.172-.205-.42-.308-.744-.308-.205 0-.39.047-.556.14a.803.803 0 0 0-.367.386h-1.061c.119-.443.36-.78.724-1.012.37-.238.803-.357 1.3-.357Zm-1.27 3.81c0 .25.082.453.248.605.172.152.393.228.664.228.225 0 .457-.053.695-.159.238-.106.45-.245.635-.417v-1.11h-1.111c-.35 0-.629.075-.834.227a.745.745 0 0 0-.297.625Zm5.876 1.557H57.18V9.133h1.022v5.238Zm-.506-6.091a.63.63 0 0 1-.466-.179.63.63 0 0 1-.179-.466c0-.192.06-.344.179-.456A.63.63 0 0 1 57.697 7c.192 0 .344.06.456.179.12.112.179.264.179.456a.63.63 0 0 1-.179.466.598.598 0 0 1-.456.179Zm3.198 6.091h-1.021V7.179h1.021v7.192Zm3.695-5.367c.627 0 1.117.182 1.467.546.35.363.526.866.526 1.507v3.314h-.803l-.11-.565c-.496.463-1.051.694-1.666.694-.516 0-.933-.149-1.25-.446-.311-.298-.466-.695-.466-1.19 0-.523.195-.933.585-1.231.39-.298.913-.446 1.567-.446h1.121v-.14c0-.39-.089-.687-.268-.892-.172-.205-.42-.308-.744-.308-.205 0-.39.047-.555.14a.803.803 0 0 0-.367.386h-1.062c.12-.443.36-.78.724-1.012.37-.238.804-.357 1.3-.357Zm-1.27 3.81c0 .25.082.453.247.605.172.152.394.228.665.228a1.7 1.7 0 0 0 .694-.159c.239-.106.45-.245.635-.417v-1.11h-1.11c-.351 0-.63.075-.834.227a.744.744 0 0 0-.298.625Zm7.344-3.81c.443 0 .83.112 1.16.337.331.219.586.533.764.943.179.41.268.886.268 1.428 0 .55-.1 1.035-.297 1.459a2.34 2.34 0 0 1-.814.982c-.35.231-.757.347-1.22.347a2.062 2.062 0 0 1-1.439-.575l-.09.446h-.803V7.179h1.022v2.37c.443-.363.926-.545 1.449-.545Zm-.318 4.633c.456 0 .814-.172 1.072-.516.257-.344.386-.814.386-1.409 0-.569-.122-1.018-.367-1.349a1.147 1.147 0 0 0-.992-.506c-.41 0-.82.166-1.23.496v2.867c.337.278.715.417 1.131.417Zm4.894.734h-1.022V7.179h1.022v7.192Zm6.055-2.768c0 .053-.01.189-.03.407h-3.64c.032.529.171.936.416 1.22.251.278.598.417 1.041.417.232 0 .44-.043.626-.13a.829.829 0 0 0 .406-.386h1.052a1.864 1.864 0 0 1-.774 1.012c-.37.238-.823.357-1.36.357-.489 0-.918-.112-1.289-.337a2.233 2.233 0 0 1-.843-.953c-.198-.416-.298-.903-.298-1.458 0-.556.096-1.038.288-1.448.192-.417.463-.738.814-.963.357-.225.773-.337 1.25-.337.47 0 .88.106 1.23.317.357.212.631.516.823.913.192.39.288.847.288 1.37Zm-2.341-1.766c-.364 0-.658.126-.883.377-.225.245-.367.592-.427 1.042h2.629c-.053-.45-.195-.797-.427-1.042-.225-.251-.522-.377-.892-.377Zm7.239 4.534h-1.022V9.133h1.022v5.238Zm-.506-6.091a.63.63 0 0 1-.466-.179.63.63 0 0 1-.178-.466.6.6 0 0 1 .178-.456.63.63 0 0 1 .466-.179.6.6 0 0 1 .457.179.598.598 0 0 1 .178.456.63.63 0 0 1-.178.466.598.598 0 0 1-.457.179Zm4.618.724c.37 0 .694.086.972.258.284.172.506.42.665.744.158.317.238.691.238 1.121v3.244h-1.022v-3.214c0-.404-.1-.718-.298-.943-.192-.225-.463-.337-.813-.337-.41 0-.804.179-1.18.536v3.958h-1.023V9.133h.804l.1.516a3.24 3.24 0 0 1 .763-.486 1.98 1.98 0 0 1 .794-.159Z" /><path fill-rule="evenodd" d="M19.52 32c-5.43 0-8.146 0-9.833-1.688C8 28.625 8 25.91 8 20.48v-.96c0-5.43 0-8.146 1.687-9.833C11.374 8 14.089 8 19.52 8h.96c5.43 0 8.145 0 9.832 1.687C32 11.374 32 14.089 32 19.52v.96c0 5.43 0 8.145-1.688 9.832C28.625 32 25.91 32 20.48 32h-.96Zm5.387-8.453 1.622.405a1.162 1.162 0 0 0 1.447-1.122v-7.816c0-.663-.454-1.242-1.1-1.403l-4.652-1.162a1.162 1.162 0 0 0-1.446 1.123v1.409l-2.93-.732A1.162 1.162 0 0 0 16.4 15.37v1.41l-2.93-.733a1.162 1.162 0 0 0-1.447 1.123v7.815c0 .664.453 1.242 1.1 1.404l4.651 1.161a1.162 1.162 0 0 0 1.447-1.122v-7.804c0-.66-.417-1.042-.568-1.16a.07.07 0 0 1-.016-.093.082.082 0 0 1 .091-.033c.613.185 1.2.813 1.258 1.603l.202 5.969a.473.473 0 0 0 .317.43l1.646.411a1.162 1.162 0 0 0 1.447-1.123v-7.803c0-.66-.416-1.042-.567-1.159a.07.07 0 0 1-.016-.094.083.083 0 0 1 .091-.033c.613.185 1.2.813 1.258 1.603l.202 5.968a.47.47 0 0 0 .34.436Z" clip-rule="evenodd" /></symbol>',126,40);var ev;!function(e){e.APP_STORE="appStore",e.GOOGLE_PLAY="googlePlay",e.RU_STORE="ruStore"}(ev||(ev={}));var nv=function(e){var n=e.onClose,t=e.appMarket,a=ze().getLang,r=t===ev.APP_STORE?go.OS.IOS:go.OS.ANDROID;return(0,o.jsx)(pd.BaseModal,(0,i.__assign)({className:"CallsModalMobileAppDownloaded",onClose:n,enableCrossButton:!0,disableBodyScroll:!0},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallsModalMobileAppDownloaded__wrap"},{children:[(0,o.jsx)("div",{className:"CallsModalMobileAppDownloaded__device-img CallsModalMobileAppDownloaded__device-img-"+r},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsModalMobileAppDownloaded__qr"},{children:[(0,o.jsx)("div",{className:"CallsModalMobileAppDownloaded__qrImg CallsModalMobileAppDownloaded__qrImg-"+t},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsModalMobileAppDownload__title"},{children:function(){switch(r){case go.OS.IOS:return a("calls_application_for_ios");case go.OS.ANDROID:return a("calls_application_for_android")}}()}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsModalMobileAppDownload__text"},{children:a("calls_scan_qr_offer")}),void 0)]}),void 0)]}),void 0)}),void 0)},tv=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:134,height:28,fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsxs)("g",(0,i.__assign)({clipPath:"url(#a)"},{children:[(0,o.jsx)("path",{d:"M18.293 0C26.133 0 28 1.867 28 9.707v8.586C28 26.133 26.133 28 18.293 28H9.707C1.867 28 0 26.133 0 18.293V9.707C0 1.867 1.867 0 9.707 0h8.586Z",fill:"#07F"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M27.873 21.307A16.203 16.203 0 0 1 21.75 22.5c-3.256 0-6.29-.958-8.832-2.607a.633.633 0 0 0-.596-.049c-1.508.654-3.198 1-5.085 1.152-.535.043-.896-.524-.667-1.01.765-1.62 1.265-3.084 1.569-4.542a.6.6 0 0 0-.086-.446A16.174 16.174 0 0 1 5.5 6.25c0-2.166.424-4.233 1.193-6.123C7.583.038 8.583 0 9.707 0h8.586C26.133 0 28 1.867 28 9.707v8.586c0 1.123-.038 2.124-.127 3.014Z",fill:"#77BEFF"},void 0),(0,o.jsx)("path",{d:"M27.272 24.173c.297-.796.49-1.743.601-2.866A16.205 16.205 0 0 1 21.75 22.5c-3.256 0-6.29-.958-8.832-2.607a.633.633 0 0 0-.596-.049c-1.035.449-2.157.753-3.37.948l-.025.005a22.79 22.79 0 0 1-1.69.2c-.535.042-.896-.525-.667-1.011a25.215 25.215 0 0 0 .647-1.49l.003-.008a18.66 18.66 0 0 0 .919-3.044.6.6 0 0 0-.086-.446A16.174 16.174 0 0 1 5.5 6.25c0-2.166.424-4.233 1.193-6.123-1.123.112-2.07.304-2.866.6A18.746 18.746 0 0 0 3 6.25c0 3.422.919 6.635 2.524 9.4-.265 1.019-.654 2.081-1.214 3.268-.973 2.059.497 4.782 3.128 4.57 1.72-.139 3.384-.432 4.954-.987A18.675 18.675 0 0 0 21.75 25c1.919 0 3.774-.29 5.522-.827Z",fill:"#fff"},void 0),(0,o.jsx)("path",{d:"M14.701 5.32c-.37-.74-1.027-1.406-1.838-1.31a1.86 1.86 0 0 0-1.128.548c-.817.817-.936 2.238-.442 3.864.494 1.626 1.598 3.45 3.216 5.07 1.618 1.617 3.443 2.721 5.069 3.215 1.626.494 3.047.375 3.864-.442a1.86 1.86 0 0 0 .549-1.128c.095-.811-.57-1.468-1.311-1.838l-.824-.412a2.085 2.085 0 0 0-2.728.806.228.228 0 0 1-.323.074 16.542 16.542 0 0 1-2.51-2.062 16.538 16.538 0 0 1-2.062-2.51.228.228 0 0 1 .074-.323 2.085 2.085 0 0 0 .806-2.728L14.7 5.32Z",fill:"#fff"},void 0)]}),void 0),(0,o.jsx)("g",(0,i.__assign)({clipPath:"url(#b)",fill:"currentColor"},{children:(0,o.jsx)("path",{d:"M38.969 21.08h3.492l5.128-14.067h-2.535l-4.11 11.593h-.4l-3.97-11.593H34l4.969 14.068ZM60.702 21.08l-6.465-7.283 5.966-6.784H57.25L52.26 12.74h-.578V7.013h-2.395v14.068h2.395v-6.026h.598l5.268 6.026h3.153ZM73.52 13.797c1.258-.399 2.156-1.476 2.156-3.053 0-2.294-2.035-3.93-4.909-3.93-2.514 0-4.39 1.257-5.228 3.631l2.255.38c.519-1.098 1.517-1.817 2.913-1.817 1.457 0 2.554.779 2.554 1.916 0 1.157-1.137 1.936-2.733 1.936h-1.776v2.095h1.776c2.075 0 2.973.878 2.973 2.015 0 1.297-1.058 2.115-2.814 2.115-1.636 0-2.554-.698-3.192-2.015l-2.295.379c.579 2.275 2.654 3.831 5.507 3.831 3.313 0 5.248-1.856 5.248-4.21 0-1.756-1.137-2.834-2.434-3.273ZM85.286 15.693c.898-.419 1.477-1.117 1.477-2.195 0-1.636-1.497-2.793-3.652-2.793h-4.968V21.08h5.188c2.235 0 3.791-1.218 3.791-2.874a2.605 2.605 0 0 0-1.836-2.514ZM80.437 12.6h2.674c.798 0 1.357.479 1.357 1.138 0 .658-.559 1.117-1.357 1.117h-2.674V12.6Zm2.894 6.585h-2.894v-2.534h2.894c.898 0 1.496.519 1.496 1.277 0 .758-.598 1.257-1.496 1.257ZM94.16 21.28c3.252 0 5.547-2.235 5.547-5.387 0-3.153-2.295-5.388-5.547-5.388-3.253 0-5.548 2.235-5.548 5.388 0 3.152 2.295 5.387 5.548 5.387Zm0-2.095c-1.876 0-3.153-1.337-3.153-3.292 0-1.956 1.277-3.293 3.153-3.293 1.875 0 3.152 1.337 3.152 3.293 0 1.955-1.277 3.292-3.152 3.292ZM108.646 10.704v4.091h-4.649v-4.09h-2.295V21.08h2.295v-4.19h4.649v4.19h2.295V10.704h-2.295ZM119.975 21.08h3.013l-4.769-5.387 4.37-4.989h-2.734l-3.472 4.031h-.558v-4.03h-2.295V21.08h2.295v-4.13h.558l3.592 4.13ZM124.286 21.08h3.253l3.871-7.702h.319v7.703h2.195V10.704h-3.252l-3.871 7.703h-.32v-7.703h-2.195v10.377Z"},void 0)}),void 0),(0,o.jsxs)("defs",{children:[(0,o.jsx)("clipPath",(0,i.__assign)({id:"a"},{children:(0,o.jsx)("path",{fill:"#fff",d:"M0 0h28v28H0z"},void 0)}),void 0),(0,o.jsx)("clipPath",(0,i.__assign)({id:"b"},{children:(0,o.jsx)("path",{fill:"#fff",transform:"translate(34)",d:"M0 0h100v28H0z"},void 0)}),void 0)]},void 0)]}),void 0)},av=function(e){var n=(0,i.__rest)(e,[]);return(0,o.jsxs)("svg",(0,i.__assign)({width:134,height:28,fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},n,{children:[(0,o.jsxs)("g",(0,i.__assign)({clipPath:"url(#a)"},{children:[(0,o.jsxs)("g",(0,i.__assign)({clipPath:"url(#b)"},{children:[(0,o.jsx)("path",{d:"M18.293 0C26.133 0 28 1.867 28 9.707v8.586C28 26.133 26.133 28 18.293 28H9.707C1.867 28 0 26.133 0 18.293V9.707C0 1.867 1.867 0 9.707 0h8.586Z",fill:"#07F"},void 0),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M27.873 21.307A16.203 16.203 0 0 1 21.75 22.5c-3.256 0-6.29-.958-8.832-2.607a.633.633 0 0 0-.596-.049c-1.508.654-3.198 1-5.085 1.152-.535.043-.896-.524-.667-1.01.765-1.62 1.265-3.084 1.569-4.542a.6.6 0 0 0-.086-.446A16.174 16.174 0 0 1 5.5 6.25c0-2.166.424-4.233 1.193-6.123C7.583.038 8.583 0 9.707 0h8.586C26.133 0 28 1.867 28 9.707v8.586c0 1.123-.038 2.124-.127 3.014Z",fill:"#77BEFF"},void 0),(0,o.jsx)("path",{d:"M27.272 24.173c.297-.796.49-1.743.601-2.866A16.203 16.203 0 0 1 21.75 22.5c-3.256 0-6.29-.958-8.832-2.607a.633.633 0 0 0-.596-.049c-1.035.449-2.157.753-3.37.948l-.025.005a22.897 22.897 0 0 1-1.69.2c-.535.042-.896-.525-.667-1.011a25.164 25.164 0 0 0 .647-1.49l.003-.008c.412-1.05.711-2.048.919-3.044a.6.6 0 0 0-.086-.446A16.174 16.174 0 0 1 5.5 6.25c0-2.166.424-4.233 1.193-6.123-1.123.112-2.07.304-2.866.6A18.746 18.746 0 0 0 3 6.25c0 3.422.919 6.635 2.524 9.4-.265 1.019-.654 2.081-1.214 3.268-.973 2.059.497 4.782 3.128 4.57 1.72-.139 3.384-.432 4.954-.987A18.675 18.675 0 0 0 21.75 25c1.919 0 3.774-.29 5.522-.827Z",fill:"#fff"},void 0),(0,o.jsx)("path",{d:"M14.701 5.32c-.37-.74-1.027-1.406-1.838-1.31a1.86 1.86 0 0 0-1.128.548c-.817.817-.936 2.238-.442 3.864.494 1.626 1.598 3.45 3.216 5.07 1.618 1.617 3.443 2.721 5.069 3.215 1.626.494 3.047.375 3.864-.442a1.86 1.86 0 0 0 .549-1.128c.095-.811-.57-1.468-1.311-1.838l-.824-.412a2.085 2.085 0 0 0-2.728.806.228.228 0 0 1-.323.074 16.542 16.542 0 0 1-2.51-2.062 16.535 16.535 0 0 1-2.062-2.51.228.228 0 0 1 .074-.323 2.085 2.085 0 0 0 .806-2.728L14.7 5.32Z",fill:"#fff"},void 0)]}),void 0),(0,o.jsx)("g",(0,i.__assign)({clipPath:"url(#c)",fill:"currentColor"},{children:(0,o.jsx)("path",{d:"M38.969 21.08h3.492l5.128-14.067h-2.535l-4.11 11.593h-.4l-3.97-11.593H34l4.969 14.068ZM60.702 21.08l-6.465-7.283 5.966-6.784H57.25L52.26 12.74h-.578V7.013h-2.395V21.08h2.395v-6.027h.598l5.268 6.027h3.153ZM72.623 21.28c2.893 0 5.348-1.616 6.345-4.17l-2.374-.4c-.699 1.497-2.155 2.375-3.891 2.375-2.674 0-4.51-2.055-4.51-5.048 0-2.973 1.856-5.029 4.51-5.029 1.716 0 3.112.838 3.791 2.275l2.374-.399c-.957-2.514-3.332-4.07-6.245-4.07-4.03 0-6.924 3.012-6.924 7.223 0 4.23 2.893 7.243 6.924 7.243ZM85.004 10.505c-2.016 0-3.791 1.037-4.31 2.833l2.115.36c.32-.639 1.037-1.238 2.075-1.238 1.257 0 1.995.898 2.095 2.255h-2.235c-3.053 0-4.57 1.337-4.57 3.253 0 1.935 1.497 3.312 3.612 3.312 1.697 0 2.834-.978 3.333-1.836l.479 1.637h1.696v-5.827c0-3.013-1.636-4.75-4.29-4.75Zm-.679 8.84c-1.117 0-1.835-.58-1.835-1.477 0-.798.578-1.357 2.334-1.357H87c0 1.696-1.077 2.834-2.674 2.834ZM91.883 21.08h2.295V7.014h-2.295V21.08ZM96.969 21.08h2.295V7.014h-2.295V21.08ZM105.687 21.28c2.973 0 4.33-1.477 4.33-3.153 0-2.055-1.916-2.674-3.552-3.132-1.217-.34-2.275-.659-2.275-1.497 0-.678.758-1.038 1.616-1.038.958 0 1.676.5 2.056 1.357l2.135-.359c-.579-1.816-2.155-2.953-4.211-2.953-2.115 0-3.971.978-3.971 3.053 0 2.175 1.996 2.753 3.652 3.212 1.177.32 2.195.619 2.195 1.417 0 .818-.878 1.137-1.796 1.137-1.177 0-2.055-.558-2.394-1.536l-2.215.38c.439 1.915 2.075 3.112 4.43 3.112Z"},void 0)}),void 0)]}),void 0),(0,o.jsxs)("defs",{children:[(0,o.jsx)("clipPath",(0,i.__assign)({id:"a"},{children:(0,o.jsx)("path",{fill:"#fff",d:"M0 0h134v28H0z"},void 0)}),void 0),(0,o.jsx)("clipPath",(0,i.__assign)({id:"b"},{children:(0,o.jsx)("path",{fill:"#fff",d:"M0 0h28v28H0z"},void 0)}),void 0),(0,o.jsx)("clipPath",(0,i.__assign)({id:"c"},{children:(0,o.jsx)("path",{fill:"#fff",transform:"translate(34)",d:"M0 0h100v28H0z"},void 0)}),void 0)]},void 0)]}),void 0)},iv=function(e){return"ru"===e.lang?(0,o.jsx)(tv,{},void 0):(0,o.jsx)(av,{},void 0)};const ov=(0,F.makeIcon)("Icon16LogoApple","logo_apple_16","0 0 16 16",'<symbol viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" id="logo_apple_16"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.833 7.44c-.018-1.774 1.45-2.624 1.516-2.666-.825-1.204-2.11-1.369-2.568-1.388-1.093-.11-2.134.642-2.689.642-.553 0-1.41-.625-2.317-.609-1.192.018-2.29.691-2.904 1.755-1.239 2.143-.318 5.317.89 7.055.59.85 1.293 1.806 2.216 1.772.89-.036 1.225-.574 2.3-.574 1.076 0 1.378.574 2.319.556.957-.018 1.563-.867 2.149-1.72.677-.987.956-1.942.972-1.991-.02-.01-1.866-.714-1.884-2.832Zm-1.768-5.204c.49-.593.82-1.415.73-2.236-.706.029-1.561.469-2.068 1.06-.454.525-.852 1.363-.745 2.167.788.061 1.592-.4 2.083-.991Z" fill="currentColor" /></symbol>',16,16,!1,void 0),rv=(0,je.makeIcon)("Icon16LogoWindows","logo_windows_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="logo_windows_16"><path fill="currentColor" d="M2 8V3.677l5-.678V8H2Zm5.5 0H14V2l-6.5.903V8Zm-.5.5H2v3.823L7 13V8.5Zm.5 0v4.597L14 14V8.5H7.5Z" /></symbol>',16,16),sv=(0,je.makeIcon)("Icon16LogoLinux","logo_linux_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="logo_linux_16"><path fill="currentColor" d="M12.744 12.112c-.336-.26-.205-.835-.554-1.118.338-1.963-.61-3.693-1.739-4.802-.948-.93-.642-1.836-.642-2.62C9.809 2.322 9.27 1 7.639 1 5.896 1 5.418 2.388 5.401 3.18c-.042 1.903.403 2.398-.764 3.783-1.373 1.63-1.575 3.254-1.265 4.116-.145.161-.34.34-.706.487-1.01.42-.27 1.123-.549 1.622A.884.884 0 0 0 2 13.62c0 .437.364.816 1.026.76.893-.077 1.717.527 2.25.527.47 0 .856-.255 1.036-.607.842-.198 1.88-.173 2.721.034.151.403.56.666 1.016.666.997 0 1.189-1.079 2.332-1.444a.9.9 0 0 0 .619-.868c0-.227-.085-.444-.256-.576Zm-5.59-6.105c-.195 0-.356-.15-.611-.331-.323-.229-.65-.36-.647-.6 0-.166.231-.217.53-.398.322-.194.448-.391.764-.391.324 0 .422.156.862.337.432.18.734.25.734.451 0 .207-.453.355-.708.507-.375.22-.567.425-.924.425Zm1.018-3.042c.539.083.6.987.341 1.432l-.217-.085c.113-.317.11-.838-.266-.871-.239-.021-.393.28-.426.537a1.07 1.07 0 0 0-.32-.074c.039-.538.403-1.013.888-.939Zm-2.08.193c.413-.098.657.36.659.837l-.19.111c-.025-.2-.119-.523-.353-.454-.252.075-.21.632-.07.746l-.188.1c-.256-.413-.256-1.245.142-1.34ZM4.8 14.383c-1.2-.52-1.608-.402-1.837-.402-.475 0-.63-.338-.452-.657.152-.272.105-.556.068-.784-.058-.35-.068-.463.292-.614.498-.201.72-.461.884-.655.463-.547.93.313 1.314 1.079.249.496.738.748.89 1.298.138.508-.435 1.05-1.16.735Zm4.27-1.093c-.846.393-1.924.573-2.73.175-.12-.329-.31-.541-.515-.755.33-.082.574-.474.281-.868-.312-.42-.95-.714-1.595-1.19-.603-.445-.794-1.542.028-2.769-.4 1.087-.167 2.088.034 2.374.042-.576.09-1.539.915-2.692.416-.582.422-1.351.431-1.832l.379.248c.279.196.512.413.847.413.495 0 .769-.272 1.15-.498.15-.088.375-.176.564-.3.318 1.445 1.634 3.182 1.708 4.171.306-.601-.087-2.05-.087-2.05.515.75.556 1.375.578 2.142.36.14.747.506.782.989l-.15-.016c-.077-.537-1.593-1.324-1.73-.315-.726.106-.462 1.205-.608 1.918-.068.326-.192.584-.283.855Zm2.96-.024c-.601.222-1.008.693-1.287.985-.538.564-1.249.293-1.325-.234-.08-.563.22-.87.35-1.501.118-.576-.014-1.462.263-1.557.18 1.023 1.263.593 1.51.314.401 0 .435.13.525.488.056.225.133.414.353.636.255.26.177.661-.388.87ZM7.143 5.68c-.398 0-.696-.253-.938-.45-.124-.099.031-.283.155-.183.237.192.475.394.783.394.37 0 .698-.303 1.14-.47.152-.056.238.167.088.223-.43.162-.775.486-1.228.486Z" /></symbol>',16,16);var lv=function(e){var n=e.icon,t=e.text,a=e.onClick;return(0,o.jsxs)(_i.default,(0,i.__assign)({appearance:"secondary",className:"CallsAppDownloadBanner--bannerButton",onClick:a},{children:[t,(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerButtonIcon"},{children:n}),void 0)]}),void 0)},cv=function(){var e=function(){return mo("/calls?act=download_app&type=mac",d.DESKTOP_CALLS_FILENAME[go.OS.MAC],!0)},n=function(){return mo("/calls?act=download_app&type=windows",d.DESKTOP_CALLS_FILENAME[go.OS.WINDOWS],!0)},t=function(){return function(e){void 0===e&&(e=d.DESKTOP_CALLS_DOWNLOAD_PAGE);var n=document.createElement("a");n.target="_blank",n.href=e,document.body.appendChild(n),n.click(),n.remove()}("/calls?act=download_app&type=linux")},a=null,r=(0,o.jsx)(o.Fragment,{},void 0);switch(go.Platform.OS){case go.OS.WINDOWS:r=(0,o.jsx)(lv,{icon:(0,o.jsx)(rv,{},void 0),text:"Windows",onClick:n},void 0);break;case go.OS.MAC:r=(0,o.jsx)(lv,{icon:(0,o.jsx)(ov,{},void 0),text:"Mac",onClick:e},void 0);break;case go.OS.LINUX:r=(0,o.jsx)(lv,{icon:(0,o.jsx)(sv,{},void 0),text:"Linux",onClick:t},void 0);break;default:r=(0,o.jsx)(lv,{icon:(0,o.jsx)(rv,{},void 0),text:"Windows",onClick:n},void 0),a=(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerButtonsSecond"},{children:[(0,o.jsx)(lv,{icon:(0,o.jsx)(ov,{},void 0),text:"Mac",onClick:e},void 0),(0,o.jsx)(lv,{icon:(0,o.jsx)(sv,{},void 0),text:"Linux",onClick:t},void 0)]}),void 0)}return{mainButton:r,otherButtons:a}},dv=function(e){var n=e.link,t=e.storeIcon,a=e.onClick;return(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__row"},{children:[(0,o.jsx)(Zd.default,(0,i.__assign)({className:"CallsAppDownloadBanner__link",target:"_blank",href:n,rel:"noreferrer"},{children:t}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__qrLink",onClick:a},{children:(0,o.jsx)(K_,{},void 0)}),void 0)]}),void 0)},uv=function(e){var n=e.onCreateCall,t=ze().getLang,a=(0,w_.useLocale)().locale;return(0,o.jsx)(_u.Dropdown,(0,i.__assign)({className:"CallsAppDownloadBanner__dropdown",trigger:"hover",position:"l",dataJsx:function(){var e=(0,i.__read)(t("calls_dropdown_ios_download_disabled_v2").split("{link}"),2),a=e[0],r=e[1];return(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__dropdown__ctx CallsDropdownComponent__in"},{children:[(0,o.jsxs)("p",(0,i.__assign)({className:"CallsAppDownloadBanner__dropdown__desc"},{children:[a.trim()," ",(0,o.jsx)(Zd.default,(0,i.__assign)({target:"_blank",href:"https://calls.vk.com",rel:"noreferrer"},{children:"calls.vk.com"}),void 0),r?" "+r:""]}),void 0),(0,o.jsx)(_i.default,(0,i.__assign)({wide:!0,appearance:"primary",size:"s",onClick:function(){return n(no.CallStatSource.HISTORY_CREATE)}},{children:t("calls_dropdown_ios_call_from_web")}),void 0)]}),void 0)},marginLeft:-221,useFixedPosition:!0},{children:(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__row","data-platform":"ios"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__link","data-platform":"ios"},{children:vv(a)}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__qrLink","data-platform":"ios"},{children:(0,o.jsx)(K_,{},void 0)}),void 0)]}),void 0)}),void 0)},_v=(0,l.memo)((function(e){var n=e.onCreateCall,t=e.useDisabledAppStoreBtn,a=ze().getLang,r=(0,w_.useLocale)().locale,s=function(){var e=(0,i.__read)((0,l.useState)(!1),2),n=e[0],t=e[1],a=(0,l.useCallback)((function(){t(!1)}),[]);return{openedModal:n,openAppStoreModal:(0,l.useCallback)((function(){t(ev.APP_STORE)}),[]),openGooglePlayModal:(0,l.useCallback)((function(){t(ev.GOOGLE_PLAY)}),[]),openRuStoreModal:(0,l.useCallback)((function(){t(ev.RU_STORE)}),[]),closeModal:a}}(),c=s.openedModal,d=s.openAppStoreModal,u=s.openGooglePlayModal,_=s.openRuStoreModal,v=s.closeModal,p=cv(),f=p.mainButton,h=p.otherButtons;return(0,o.jsxs)(Vu.default,(0,i.__assign)({className:"CallsAppDownloadBanner--banner"},{children:[(0,o.jsx)(iv,{lang:r},void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerDesc"},{children:a("calls_history_desktop_banner_description")}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerSubDesc"},{children:a("calls_history_desktop_banner_sub_description")}),void 0),(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__device-text"},{children:a("calls_app_for_mobile")}),void 0),t&&(0,o.jsx)(uv,{onCreateCall:n},void 0),!t&&(0,o.jsx)(dv,{link:"https://apps.apple.com/app/id1612939275",storeIcon:vv(r),onClick:d},void 0),(0,o.jsx)(dv,{link:"https://play.google.com/store/apps/details?id=com.vk.calls",storeIcon:pv(r),onClick:u},void 0),(0,o.jsx)(dv,{link:"https://apps.rustore.ru/app/com.vk.calls",storeIcon:fv(r),onClick:_},void 0),(0,o.jsxs)("div",(0,i.__assign)({className:"CallsAppDownloadBanner--bannerButtons"},{children:[(0,o.jsx)("div",(0,i.__assign)({className:"CallsAppDownloadBanner__device-text"},{children:a("calls_app_for_desktop")}),void 0),f,h]}),void 0),c&&(0,o.jsx)(nv,{appMarket:c,onClose:v},void 0)]}),void 0)}));function vv(e){return"ru"===e?(0,o.jsx)(Q_,{},void 0):(0,o.jsx)(Y_,{},void 0)}function pv(e){return"ru"===e?(0,o.jsx)(J_,{},void 0):(0,o.jsx)(X_,{},void 0)}function fv(e){return"ru"===e?(0,o.jsx)(q_,{},void 0):(0,o.jsx)($_,{},void 0)}var hv=function(){var e=ze().getLang,n=Du((function(e){return e.showCreateCall})),t=function(e){var n=(0,l.useMemo)((function(){return{urlSection:new URLSearchParams(e.search).get("section")||""}}),[e]).urlSection,t=(0,i.__read)((0,l.useState)(n),2);return{section:t[0],setSection:t[1]}}(window.location),a=t.section,r=t.setSection,s=Qu(),c=s.onCreateCallClick,d=s.onPlanCalendarEvent,u=Yu(),_=u.loading,v=u.setLoading,p=(0,l.useMemo)((function(){return[{id:"",label:e("calls_page_menu_all_calls"),href:"calls",ref:(0,l.createRef)()},{id:"friends",label:e("calls_page_menu_friends_calls"),href:"calls?section=friends",ref:(0,l.createRef)()},{id:"sep1",separator:!0},{id:"current",label:e("calls_page_menu_current_calls"),href:"calls?section=current",ref:(0,l.createRef)()},{id:"scheduled",label:e("calls_scheduled"),href:"calls?section=scheduled",ref:(0,l.createRef)()},{id:"sep2",separator:!0},{id:Ou.HistoryScreenSections.HISTORY,label:e("calls_history"),href:"calls?section="+Ou.HistoryScreenSections.HISTORY,ref:(0,l.createRef)()},{id:"missed",label:e("calls_page_menu_miss_calls"),href:"calls?section=missed",ref:(0,l.createRef)()}]}),[e]),f=(0,l.useCallback)((function(e,n){return(0,ju.changeQuery)(n),r(e),v(!0),window.scrollTo({top:0}),Promise.resolve()}),[]),h=(0,l.useMemo)((function(){return a===Ou.HistoryScreenSections.MISS?(0,o.jsx)(v_,{},void 0):a===Ou.HistoryScreenSections.FRIENDS?(0,o.jsx)(m_,{},void 0):a===Ou.HistoryScreenSections.CURRENT?(0,o.jsx)(I_,{},void 0):a===Ou.HistoryScreenSections.HISTORY?(0,o.jsx)(z_,{},void 0):a===Ou.HistoryScreenSections.SCHEDULED?(0,o.jsx)(W_,{},void 0):(0,o.jsx)(F_,{onMenuItemClick:f},void 0)}),[a]);return(0,o.jsx)(Wu,(0,i.__assign)({showCreateCall:n,onCreateCallClick:c,activeMenuItem:a,menuItems:p,onMenuItemClick:f,loading:_,banner:(0,o.jsx)(_v,{onCreateCall:c},void 0),onPlanCalendarEvent:d},{children:h}),void 0)},gv=function(){var e=Ru(),n=Du((function(e){return e.error})),t=ze().getLang,a=function(){e((0,ju.dispatchSetError)(null))};return(0,o.jsx)(cs,{title:(0,o.jsxs)(o.Fragment,{children:[(null==n?void 0:n.title)||t("calls_oops")," "]},void 0),onClose:a,actionButtons:(0,o.jsx)(_i.default,(0,i.__assign)({onClick:a},{children:t("calls_close")}),void 0),text:(0,o.jsx)(o.Fragment,{children:null==n?void 0:n.text},void 0)},void 0)},mv=function(e){function n(n){var t=e.call(this,n)||this;return t.state={hasError:!1},t}return(0,i.__extends)(n,e),n.getDerivedStateFromError=function(){return{hasError:!0}},n.prototype.componentDidCatch=function(e,n){console.error("Call history crashed:",e,n)},n.prototype.render=function(){return this.state.hasError?(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreen--error"},{children:(0,o.jsx)(Vu.default,(0,i.__assign)({title:this.props.getLang("global_error")},{children:(0,o.jsx)("div",(0,i.__assign)({className:"CallHistoryScreen--errorContent"},{children:this.props.getLang("global_unexpected_error_try_later")}),void 0)}),void 0)}),void 0):this.props.children},n}(l.Component),Av=t(72382),Cv=t(75683),Ev=t(21333),Sv=function(){var e=(0,Gt.useIsMounted)(),n=Ru(),t=(0,Ae.useLang)().getLang,a=(0,ud.usePromiseError)().handleError,i=Qu().setPlannedCalendarEvent,r=(0,gd.useNotifier)().showText,c=(0,Ev.useFetchData)({cb:qe.messagesEditCall}),d=(0,Ev.useFetchData)({cb:qe.messagesDeleteScheduledCall}),u=(0,Sd.useSendStatsDataCallScheduled)().sendCallScheduled,_=Du((function(e){return e.scheduledEditableCall})),v=Du((function(e){return e.popup})),p=Du((function(e){return e.profiles[e.meId]})),f=Du((function(e){return _?e.profiles[_.caller_id||""]:void 0})),h=(0,l.useMemo)((function(){return(0,Cd.getUserSelectOptions)(f)}),[f]),g=(0,dd.useCalendarEventDetails)({meParticipant:p}).getDescription,m=(0,l.useCallback)((function(){n({type:Ou.HistoryScreenActionTypes.SET_POPUP})}),[]),A=(0,l.useCallback)((function(){n({type:Ou.HistoryScreenActionTypes.SET_POPUP,data:Ou.EHistoryScreenPopup.RescheduleCalendarEvent})}),[]),C=(0,l.useCallback)((function(n){if(_)return c.fetchData((0,Cd.mapFormData)(n,_)).then((function(){if(e()){var o=new Date(n.start),l={start:o,title:n.name,repeatRule:n.rrule,join_link:_.vk_join_link||"",call_id:_.call_id,duration:n.duration,displayName:n.displayName,timezone:n.timezone,repeatRuleEnd:n.recurrenceUntilTime},c=g(l);switch(l.description=c,(0,s.copyTextToClipboard)(c).then((function(){r(t("calls_create_call_by_link_text_copied"))})).catch(a),u({creatorId:_.caller_id,sharingChannel:n.calendar,isEdit:!0}),n.calendar){case Ed.ECalendar.Other:i(l);break;case Ed.ECalendar.Google:var d=(0,Cd.google)((0,Cd.mapGoogleIcsUrl)(l,t));(0,Cd.openLinkInNewTab)(d,o);break;case Ed.ECalendar.iCloud:case Ed.ECalendar.Outlook:d=(0,Cd.ics)((0,Cd.mapGoogleIcsUrl)(l,t));(0,Cd.openLinkInNewTab)(d,o,!1)}m()}})).catch(a)}),[_,c.fetchData]),E=(0,l.useCallback)((function(){_&&d.fetchData({call_id:_.call_id}).then(m)}),[_,d.fetchData]);return _?(0,o.jsxs)(o.Fragment,{children:[v===Ou.EHistoryScreenPopup.EditCalendarEvent&&(0,o.jsx)(Ad.ModalScheduleCall,{onClose:m,headerTitle:t("calls_edit_call_title"),onSubmit:C,call:_,loading:c.loading,myUserId:null==p?void 0:p.id,userSelectOptions:h},void 0),v===Ou.EHistoryScreenPopup.DeleteCalendarEvent&&(0,o.jsx)(Cv.ModalDeleteCall,{call:_,onClose:m,onSubmit:E,onReschedule:A,loading:d.loading},void 0),v===Ou.EHistoryScreenPopup.RescheduleCalendarEvent&&(0,o.jsx)(Av.ModalRescheduleCall,{call:_,onClose:m,onSubmit:C,loading:c.loading,myUserId:null==p?void 0:p.id,userSelectOptions:h},void 0)]},void 0):((0,Nr.handlePromiseError)("Пытаемся показать окно редактирования без выбранного звонка"),null)},Iv=t(68891);const Tv=function(){var e,n,t=ze().getLang,a=Du((function(e){return e.error})),r=Du((function(e){return e.deleteCallId})),s=Du((function(e){return e.popup}));return e=Ru(),n=Du((function(e){return e.meId})),(0,l.useEffect)((function(){var t=new Iv.CallsLongpoll(n,(function(n){e({type:Ou.HistoryScreenActionTypes.SET_CALLS_QUEUE_RESPONSE,data:n})}));return t.wait(),function(){t.destroy()}}),[n]),(0,o.jsxs)(mv,(0,i.__assign)({getLang:t},{children:[(0,o.jsx)(hv,{},void 0),r>=0&&(0,o.jsx)(Bu,{},void 0),null!==a&&(0,o.jsx)(gv,{},void 0),(0,Qe.hasIn)(s,Ou.EHistoryScreenPopup.DeleteCalendarEvent,Ou.EHistoryScreenPopup.EditCalendarEvent,Ou.EHistoryScreenPopup.RescheduleCalendarEvent)&&(0,o.jsx)(Sv,{},void 0)]}),void 0)};function xv(e){var n=e.actionStatCollector,t=e.saveStatlogEvents,a=e.langUtils,l=e.navigateToConvo,u=e.navigateToProfile,_=e.apiWrapperWithAuth,v=e.apiWrapper,p=e.callSounds,f=e.config,h=void 0===f?{isModalView:!0,withAnimation:!0,allowAddMembers:!1,debugLog:!1,streaming:!0,streamingPrivacy:!0,fullHD:!1,anonymPhoto:!0,incomingCall:!1,allowBanParticipant:!1,showFeedbackScreen:!1,enableVideoSlots:!1,videoSlotsCount:d.VIDEO_SLOTS_COUNT,browserWarnings:null,allowCallByName:!1,enableScreenTrack:!1,enableProducerScreenTrack:!1,allowWaitingHall:!1,allowPushToTalk:!1,badNetwork:!1,badNetworkP2P:!1,desktopAppNotification:!1,sferum:!1,lazyLoading:!1,enableDomainBender:!1,enableMultipleDevices:!1,enableP2PAudioRed:!1,enableServerAudioRed:!1,enableTranslationSplit:!1,enableMovieShare:!1,enableNavChangeCallCollapse:!1,enableParticipantListChunk:!1}:f,g=e.eventHandlers,m=e.streamUrlExtractor;return(0,Eu.setApiWrappers)(_,v),{initialized:!1,initializing:!1,eventHandlers:null!=g?g:{},init:function(e){var _,v=this,f=e.callPreview,A=e.callsCredentials,C=e.imHash,S=e.callsOkStaging,I=e.tabIsMaster,T=e.onBeforeCallStart,x=e.onAfterCallFinish,y=e.onError,b=e.toggles,O=void 0===b?{}:b,P=e.friends,k=e.isFriend,L=e.getFriends,D=e.pushToTalkEnabled;if(this.initialized)return this.initializing;if(!(null==A?void 0:A.me))return console.log("Calls were not initialized as there are no callsCredentials.me"),!1;this.initialized=!0,this.isFriend=k,this.getFriends=L;var R=(0,i.__assign)((0,i.__assign)({},h),O);if(!G.browser.isBrowserSupported()){var j=function(){var e=a.getLang("calls_unsupported_browser_error");return y&&y({msg:e}),(null==g?void 0:g.onError)&&g.onError(new Error(e)),console.error(e),Promise.resolve()};return this.call=j,this.startGroupCall=j,this.startCall=j,this.acceptCall=j,this.joinCallByLink=j,this.showJoinPopup=j,this.showCallByNamePopup=j,this.showCreateCallByLinkPopup=j,void(this.showPlanCalendarEventPopup=j)}this.id=window.vk&&window.vk.id||A.me.peerId;var B=I||function(){return!0},U=null!==(_=s.localStorage.getItem(d.VIDEO_RESOLUTION_STORAGE_KEY))&&void 0!==_?_:d.VideoResolutionTypes.SD;Ye.GlobalStore.setCallsStore((0,xu.createStore)(Nu,yu(A.me,C,f,{isDev:!!A.is_dev,token:A.secret,config:R,localVideoResolution:R.fullHD?U:U===d.VideoResolutionTypes.HD?d.VideoResolutionTypes.HD:d.VideoResolutionTypes.SD,friends:P||[],friendsCache:(0,$e.createFriendsCache)(P||[]),ipSettingEnabled:A.ip_setting_enabled,privacySettings:A.privacySettings,pushToTalkEnabled:D}),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()));var H=Ye.GlobalStore.getCallsStore();return this.collapseCall=function(){R.enableNavChangeCallCollapse&&(G.debugMessage(G.DebugMessageType.WARN,{message:"[external] bridge.collapseCall called"}),Wo({isModalView:h.isModalView,uiMode:H.getState().uiMode,changeUIMode:function(e){H.dispatch({type:d.E_ACTION.CHANGE_UI_MODE,mode:e})}}),H.dispatch({type:d.E_ACTION.MANAGEMENT,isOpen:!1}))},this.restoreCall=function(){H.dispatch({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.DEFAULT})},this.showStartCallModal=function(e,n,t){v.isInActiveCall||H.dispatch({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.START,peerId:e,joinLink:n,entryPoint:t})},this.setPlannedCalendarEvent=function(e){H.dispatch({type:d.E_ACTION.SET_PLANNED_CALENDAR_EVENT,data:e}),H.dispatch({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:d.POPUP_SHARE_PLANNED_CALL})},t&&Hr(t),n&&w.callStats.setActionStatCollector(n),r.render((0,o.jsx)(c.Provider,(0,i.__assign)({store:H},{children:(0,o.jsx)(E.LangContext.Provider,(0,i.__assign)({value:a},{children:(0,o.jsx)(N.ConfigContext.Provider,(0,i.__assign)({value:R},{children:(0,o.jsx)(Tu,{},void 0)}),void 0)}),void 0)}),void 0),yv("calls")),this.initializing=Kr(this,G,A,H,a.getLang,S).catch((function(){return!0})).then((function(){!function(e,n,t,a){var o=a.dispatch,r=function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];r.forEach((function(e){e.type===d.INCOMING_CALL&&(0,qe.logCallReceived)(e.payload.call_id)}));var l=a.getState();Su(l,o,e,r,t).then((function(){r.forEach((function(t){switch(t.type){case d.INCOMING_CALL:if(Iu(l,t))a.getState().ipSettingEnabled&&n.forceRelayPolicy(!t.payload.p2p_allowed),n.processPush(t.payload.call_id).then((function(){var e=JSON.parse((0,Di.decodeHTMLEntities)(t.payload.payload)),n=e.is_video?d.CallType.VIDEO:d.CallType.AUDIO,a=(0,Qe.getPeerIdFromLongpoll)(t.payload),r=(0,Qe.isGroupCallEvent)(t);a<0&&(r=e.with_join_link),o({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.INCOMING,peerId:a<0&&r?0:a,data:(0,i.__assign)((0,i.__assign)({},t.payload),{type:n,payload:e})}),Br({timeStart:Date.now(),startType:n}),w.callStats.logEvent({call_event_type:d.CallActionEventType.INCOMING_CALL_RECEIVED,session_id:t.payload.call_id,peer_id:a,is_group_call:r,reason:e.is_video?d.CallType.VIDEO:d.CallType.AUDIO})})).catch((function(n){if(e.eventHandlers.onError&&n&&e.eventHandlers.onError(n),e.debug)if("object"==typeof n){var t=n.hangup,a=n.message;console.error("Push process error",t,a)}else console.error("Push process error",n)}));else if(t.type===d.INCOMING_CALL){var r=function(n){e.eventHandlers.onError&&n&&e.eventHandlers.onError(new Error(n)),e.debug&&console.warn("Incoming push skipped:",n,t)};switch(!0){case!t.payload.call_id:r("old lib call");break;case l.mode===d.Mode.CALL||l.mode===d.Mode.INCOMING:r("already in a call"),n.processPush(t.payload.call_id).then((function(){e.eventHandlers.onError&&e.eventHandlers.onError(new Error("processPush was incorrect accepted with call_id: "+t.payload.call_id)),e.debug&&console.warn("processPush was incorrect accepted",t.payload.call_id)})).catch((function(n){e.eventHandlers.onError&&n&&e.eventHandlers.onError(n),e.debug&&console.warn("processPush rejected:",n,t.payload.call_id)}));break;default:r("reason of decline is unknown")}}break;case d.ADD_MESSAGE:var s=a.getState(),c=(0,Ri.isChatPeer)(s.peer),u=s.callData.callId;if(s.peer!==t.peerId||t.flags&d.FLAG_OUTBOUND||s.me===t.userId||o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:s.chatUnreadCount?s.chatUnreadCount+1:1}),c||!(0,M.isActiveGroupCallMessage)(t))return;var _=t.peerId;if(u===t.kludges.attach1_call_id)return sn(a.getState(),o,_);break;case d.READ_INBOUND:null!==t.chatUnreadCount&&a.getState().peer===t.peerId&&o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:t.unread,chatUpToMsgId:t.upToId});break;case d.SET_FLAGS:(s=a.getState()).peer===t.peerId&&null!==s.chatUpToMsgId&&t.messageId>s.chatUpToMsgId&&!(t.flags&d.FLAG_OUTBOUND)&&(t.flags&d.FLAG_DELETED||t.flags&d.FLAG_SPAM)&&o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:s.chatUnreadCount?s.chatUnreadCount-1:0});break;case d.DELETE_DIALOG:a.getState().peer===t.peerId&&o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:0,chatUpToMsgId:null});break;case d.EDIT_MESSAGE:case d.REPLACE_MESSAGE:(s=a.getState()).peer===t.peerId&&null!==s.chatUpToMsgId&&t.messageId>s.chatUpToMsgId&&t.kludges.is_expired&&o({type:d.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:s.chatUnreadCount?s.chatUnreadCount-1:0});break;case d.CONVERSATION_UPDATED:_=t.peerId;var v=t.updateType;if(a.getState().peer!==_)return;if(v!==d.MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED)return;void 0!==a.getState().callData.canFinishCall&&a.getState().callData.hasUrlLink||ln(a.getState(),o,_)}}))})).catch((function(n){e.eventHandlers.onError&&n&&e.eventHandlers.onError(n),e.debug&&console.error("Resource loading error",n),r.forEach((function(e){if(e.type===d.INCOMING_CALL){if(!Iu(l,e))return;o({type:d.E_ACTION.ERROR,text:t("calls_incoming_process_error"),handleType:d.ErrorHandleType.PROCESS,callId:e.payload.call_id})}}))}))};if(e.handleEvent=r,void 0!==window.Notifier){var s=window.Notifier.getLpInstance();s&&s.onData(r)}}(v,G,a.getLang,H);var e=yv("calls");r.unmountComponentAtNode(e),r.render((0,o.jsx)(c.Provider,(0,i.__assign)({store:H},{children:(0,o.jsx)(E.LangContext.Provider,(0,i.__assign)({value:a},{children:(0,o.jsx)(N.ConfigContext.Provider,(0,i.__assign)({value:R},{children:(0,o.jsx)(Cu,{bridge:v,SDK:G,tabIsMaster:B,onBeforeCallStart:T,onAfterCallFinish:x,callSounds:p,navigateToConvo:l,onHandCountChanged:null==g?void 0:g.onHandCountChanged,onSuccessFeedback:null==g?void 0:g.onSuccessFeedback,navigateToProfile:u,okPublicKey:A.key,config:R,streamUrlExtractor:m},void 0)}),void 0)}),void 0)}),void 0),e)})),this.initializing.catch((function(e){if(null==g?void 0:g.onError){var n=e?e.message||e.msg:"sdk did not send the reasons for the error",t=e?e.error:"";[401].includes(t)||g.onError(new Error("Could not init calls. "+n+": "+t))}console.error("Could not init calls",e.error,e)}))},showJoinScreen:function(e,s,l,c,d,u,_){void 0===_&&(_=!1);var v=Wr(c,g);if(!G.browser.isBrowserSupported())return v(a.getLang("calls_unsupported_browser_error"));Hr(t),w.callStats.setActionStatCollector(n);var p=e.callsAllowCallByName,f=e.callsAllowWaitingHall,m=document.querySelector(s),A=(0,i.__assign)((0,i.__assign)({},h),{allowCallByName:p,allowWaitingHall:f});r.render((0,o.jsx)(E.LangContext.Provider,(0,i.__assign)({value:a},{children:(0,o.jsx)(N.ConfigContext.Provider,(0,i.__assign)({value:A},{children:(0,o.jsx)(rs,(0,i.__assign)({},e,{withPopup:_,bridge:this,entryPoint:l,onError:v,okPublicKey:d,onClose:u}),void 0)}),void 0)}),void 0),m)},showHistoryScreen:function(e,n,s){var d,_;void 0===n&&(n={}),void 0===s&&(s=!0);var v=Wr(void 0,g);if(!G.browser.isBrowserSupported())return v(a.getLang("calls_unsupported_browser_error"));Hr(t);var p=(0,xu.createStore)(Pu,function(e,n){var t,a;return{meId:null!==(t=e.meId)&&void 0!==t?t:0,currentCalls:[],historyCalls:[],deleteCallId:-1,profiles:{},joinLinks:{},isDev:null!==(a=e.isDev)&&void 0!==a&&a,error:null,loading:!0,showCreateCall:!0,config:(0,i.__assign)((0,i.__assign)({},n),e.config||{})}}(n,h),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),f=document.querySelector(e),m={navigateToConvo:l,navigateToProfile:u},A={bridge:this,SDK:G};if(r.render((0,o.jsx)(c.Provider,(0,i.__assign)({store:p},{children:(0,o.jsx)(zu.Provider,(0,i.__assign)({value:A},{children:(0,o.jsx)(c_.Provider,(0,i.__assign)({value:m},{children:(0,o.jsx)(E.LangContext.Provider,(0,i.__assign)({value:a},{children:(0,o.jsx)(N.ConfigContext.Provider,(0,i.__assign)({value:h},{children:(0,o.jsx)(Tv,{},void 0)}),void 0)}),void 0)}),void 0)}),void 0)}),void 0),f),s){var C=document.querySelector("#l_ca");C&&C.classList.contains("AppLeftMenuWithNotify")&&C.classList.remove("AppLeftMenuWithNotify"),C&&C.classList.contains("AppLeftMenuWithNotifyBlueDot")&&C.classList.remove("AppLeftMenuWithNotifyBlueDot")}null===(_=null===(d=window.cur)||void 0===d?void 0:d.destroy)||void 0===_||_.push((function(){f&&r.unmountComponentAtNode(f)}))},debug:!1,setDebug:function(e){this.debug=e,G.debug(e)}}}function yv(e){var n=document.getElementById(e);if(n)return n;var t=document.createElement("section");return t.setAttribute("id",e),document.body.appendChild(t),t}}}]);try{stManager.done("dist/b3c52704711ff506ec36e9c85b864ca9.1535cf63f514b3e40bc5.js")}catch(e){}