(self.webpackChunkvk=self.webpackChunkvk||[]).push([[25077],{91047:(e,t,r)=>{"use strict";function i(e){return new Promise(((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)}))}function n(e,t){const r=indexedDB.open(e);r.onupgradeneeded=()=>r.result.createObjectStore(t);const n=i(r);return(e,r)=>n.then((i=>r(i.transaction(t,e).objectStore(t))))}let s;function a(){return s||(s=n("keyval-store","keyval")),s}function o(e,t=a()){return t("readonly",(t=>i(t.get(e))))}function c(e,t,r=a()){return r("readwrite",(r=>(r.put(t,e),i(r.transaction))))}function l(e,t=a()){return t("readwrite",(t=>(t.delete(e),i(t.transaction))))}function u(e=a()){return e("readwrite",(e=>(e.clear(),i(e.transaction))))}r.d(t,{clear:()=>u,createStore:()=>n,del:()=>l,get:()=>o,set:()=>c})},54921:(e,t,r)=>{"use strict";r.d(t,{STICKER_PACK_ICON:()=>o,STICKER_PACK_THUMB:()=>c,STICKER_IMAGE:()=>l,STICKER_ANIMATION:()=>u,DEFAULT_CACHE:()=>d,SAMPLE_RECIPIENT_ID:()=>_,ORDER_ERRORS:()=>n,ORDER_ITEM_ERRORS:()=>s});var i,n,s,a=r(49091),o={square_png:{id:"square.png",width:104,height:104},square_15x_png:{id:"square_1.5x.png",width:156,height:156},square_2x_png:{id:"square_2x.png",width:208,height:208},square_3x_png:{id:"square_3x.png",width:312,height:312},square_4x_png:{id:"square_4x.png",width:416,height:416}},c={"102_png":{id:"102.png",width:102,height:102,theme:a.Theme.LIGHT},"51_png":{id:"51.png",width:51,height:51,theme:a.Theme.LIGHT},"68_png":{id:"68.png",width:68,height:68,theme:a.Theme.LIGHT},"34_png":{id:"34.png",width:34,height:34,theme:a.Theme.LIGHT},"60_png":{id:"60.png",width:60,height:60,theme:a.Theme.LIGHT},"30_png":{id:"30.png",width:30,height:30,theme:a.Theme.LIGHT},"102b_png":{id:"102b.png",width:102,height:102,theme:a.Theme.DARK},"51b_png":{id:"51b.png",width:51,height:51,theme:a.Theme.DARK},"68b_png":{id:"68b.png",width:68,height:68,theme:a.Theme.DARK},"34b_png":{id:"34b.png",width:34,height:34,theme:a.Theme.DARK},"60b_png":{id:"60b.png",width:60,height:60,theme:a.Theme.DARK},"30b_png":{id:"30b.png",width:30,height:30,theme:a.Theme.DARK},"44_png":{id:"44.png",width:44,height:44},"22_png":{id:"22.png",width:22,height:22}},l={"64_png":{id:"64.png",width:64,height:64,theme:a.Theme.LIGHT},"128_png":{id:"128.png",width:128,height:128,theme:a.Theme.LIGHT},"256_png":{id:"256.png",width:256,height:256,theme:a.Theme.LIGHT},"352_png":{id:"352.png",width:352,height:352,theme:a.Theme.LIGHT},"512_png":{id:"512.png",width:512,height:512,theme:a.Theme.LIGHT},"64b_png":{id:"64b.png",width:64,height:64,theme:a.Theme.DARK},"128b_png":{id:"128b.png",width:128,height:128,theme:a.Theme.DARK},"256b_png":{id:"256b.png",width:256,height:256,theme:a.Theme.DARK},"352b_png":{id:"352b.png",width:352,height:352,theme:a.Theme.DARK},"512b_png":{id:"512b.png",width:512,height:512,theme:a.Theme.DARK}},u=((i={})[a.Theme.LIGHT]="animation.json",i[a.Theme.DARK]="animation.b.json",i),d={products:(0,a.createProductsMap)([]),productIdsQueue:new Set,productsPromise:void 0,productPromises:new Map,stickers:new Map},_=-1;!function(e){e.NOT_SIGNED_IN="not_signed_in",e.NO_VALID_ITEMS="no_valid_items"}(n||(n={})),function(e){e.DUPLICATE_PRODUCT="duplicate_product"}(s||(s={}))},49091:(e,t,r)=>{"use strict";var i;r.d(t,{Theme:()=>i,imageSizesIndex:()=>s,imageSizeCache:()=>a,createProductsMap:()=>o,UserProductStateKey:()=>n,isBasePack:()=>l,isStyleProduct:()=>u,isPackProduct:()=>d,ProductsByType:()=>_}),function(e){e.LIGHT="light",e.DARK="dark",e.DEFAULT="light"}(i||(i={}));var n,s=Symbol(),a=Symbol(),o=function(e){return new Map(e)};!function(e){e.IsNew="is_new"}(n||(n={}));var c,l=function(e){return void 0!==e.sticker_ids},u=function(e){return void 0!==e.base_id},d=function(e){return l(e)&&!u(e)};!function(e){e.Pack="pack",e.Style="style"}(c||(c={}));var _=function(){function e(e){var t=this;void 0===e&&(e=[]),this.pack=new Set,this.style=new Set,e.forEach((function(e){return t.add(e)}))}return e.prototype.add=function(e){e&&(d(e)?this.pack.add(e):u(e)&&this.style.add(e))},e.prototype.getPack=function(){return this.pack.values().next().value},e.prototype.getStyles=function(){return Array.from(this.style.values())},e.prototype.getCount=function(){return this.pack.size+this.style.size},e}();!function(){function e(e){var t=this;this.pack=[],this.style=[],e.forEach((function(e){return t.add(e)}))}e.prototype.add=function(e){var t=e.product;t&&(d(t)?this.pack.push(e):u(t)&&this.style.push(e))}}()},22377:(e,t,r)=>{"use strict";r.d(t,{getStickerImageUrl:()=>o,getStickerAnimationUrl:()=>c,getStickerPackIconUrl:()=>l,isSampleOrderItem:()=>u});var i=r(70655),n=r(49091),s=r(54921),a=function(e,t,r,i){void 0===i&&(i=n.Theme.DEFAULT);var s=window.devicePixelRatio,a=[t*=s,r*=s,i].toString(),o=e[n.imageSizeCache];if(o&&o.has(a)){var c=o.get(a);if(c)return c}o||(o=new Map,e[n.imageSizeCache]=o);var l=function(e){var t=e[n.imageSizesIndex];return t||(t=Object.values(e).sort((function(e,t){return e.width-t.width||e.height-t.height})),e[n.imageSizesIndex]=t),t}(e).filter((function(e){return!e.theme||e.theme===i})),u=l.find((function(e){return e.width>=t&&e.height>=r}))||l[l.length-1];return o.set(a,u),u};function o(e,t,r,o){var c,l,u;if(void 0===o&&(o=n.Theme.DEFAULT),null===(u=e.render)||void 0===u?void 0:u.images){var d=e.render.images;d.sort((function(e,t){return e.width-t.width||e.height-t.height}));var _=void 0;try{for(var g=(0,i.__values)(d),h=g.next();!h.done;h=g.next()){var f=h.value;if(f.width>=t&&f.height>=r){if(f.theme===o)return f.url;_=f}}}catch(e){c={error:e}}finally{try{h&&!h.done&&(l=g.return)&&l.call(g)}finally{if(c)throw c.error}}if(_)return _.url}return function(e,t){return e.image.base_url+"/"+t.id+(e.image.version?"?"+e.image.version:"")}(e,function(e,t,r){return void 0===r&&(r=n.Theme.DEFAULT),a(s.STICKER_IMAGE,e,t,r)}(t,r,o))}var c=function(e,t){return void 0===t&&(t=n.Theme.DEFAULT),e.animation?e.animation.base_url+"/"+s.STICKER_ANIMATION[t]+(e.animation.version?"?"+e.animation.version:""):""},l=function(e,t,r,i){return void 0===i&&(i=n.Theme.DEFAULT),function(e,t){return e.icon.base_url+"/"+t.id+(e.thumb.version?"?"+e.thumb.version:"")}(e,function(e,t,r){return void 0===r&&(r=n.Theme.DEFAULT),a(s.STICKER_PACK_ICON,e,t,r)}(t,r,i))},u=function(e){return e.recipient_id===s.SAMPLE_RECIPIENT_ID}},30304:(e,t,r)=>{"use strict";r.d(t,{moveStickersHintsToStickerPicker:()=>n});var i="StickersHints__marginTransition",n=function(e,t){var r=window.Emoji.opts[e];if(null==r?void 0:r.txt){var n=r.txt.parentNode.querySelector("._sticker_hints");if(n)if("none"!==getComputedStyle(n).getPropertyValue("display")){t&&(n.classList.add(i),requestAnimationFrame((function(){return n.classList.remove(i)}))),n.style.setProperty("margin-left","0px");var s=n.getBoundingClientRect().right;if(window.StickerPickerViewer){var a=window.StickerPickerViewer,o=a.isShown,c=a.isDown,l=a.viewWrapper;if(!o||!l||c)return;var u=-(s-l.getBoundingClientRect().left+10);n.style.setProperty("margin-left",u+"px")}}}}},65820:(e,t,r)=>{"use strict";r.d(t,{getCache:()=>l,updateCache:()=>u,getSticker:()=>d,getStickers:()=>_,getPackByStickerId:()=>h});var i=r(70655),n=r(93680),s=r(54921),a=r(49091),o=r(10835),c=r(26330),l=function(){if(!window.stickersCache){var e=c.default.get("stickers_cache");window.stickersCache=(0,i.__assign)((0,i.__assign)({},s.DEFAULT_CACHE),e)}return window.stickersCache},u=function(e){window.stickersCache=(0,i.__assign)((0,i.__assign)({},l()),e)},d=function(e){return l().stickers.get(e)},_=function(e){var t=l().stickers;return e.map((function(e){return t.get(e)}))},g=function(e){var t=d(e);if(!t||!t.pack_id)return null;var r=(0,o.getProductFromCache)(t.pack_id);return r&&(0,a.isBasePack)(r)?r:null},h=function(e){var t=g(e);return t?Promise.resolve(t):new Promise((function(t){n.ajax.post("stickers.php",{act:"get_products",sticker_ids:[e]},{onDone:function(r){(0,o.cacheProductsData)(r),t(g(e))},onFail:function(e){return console.error(e),t(null),!0}})}))}},99321:(e,t,r)=>{"use strict";r.d(t,{Cart:()=>c});var i=r(70655),n=r(93680),s=r(54722),a=r(54921),o=r(10835),c=function(){function e(e,t){void 0===t&&(t=[]),this.loadTimeout=null,this.loadCancellationToken=null,this.isGift=!1,this.onChange=null,this._order=null,this.setItems(e),this.recipientIds=new Set(t),this.recipients=new Map}return e.create=function(t,r){return void 0===r&&(r=[]),new e(t.map((function(e){return{product_id:e,amount:1}})),r)},e.prototype.copy=function(){var t=new e(this.getItems(),this.getRecipientIds());return t.setOrder(this.getOrder()),t},e.prototype.getItems=function(){return Array.from(this.items.values())},e.prototype.setItems=function(e){this.items=new Map(e.map((function(e){return[e.product_id,e]})))},e.prototype.loadItems=function(){var e=this,t=Array.from(this.items.keys());return(0,o.getProducts)(t).then((function(){var t,r;try{for(var n=(0,i.__values)(Array.from(e.items.values())),s=n.next();!s.done;s=n.next()){var a=s.value;a.product=(0,o.getProductFromCache)(a.product_id)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}}))},e.prototype.getProducts=function(){return(0,o.getProductsFromCache)(Array.from(this.items.keys()))},e.prototype.hasProduct=function(e){return this.items.has(e)},e.prototype.addProduct=function(e,t){if(void 0===t&&(t=!1),!this.hasProduct(e)){var r={product_id:e,amount:1};t?this.setItems((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(this.getItems()),!1),[r],!1)):this.setItems((0,i.__spreadArray)([r],(0,i.__read)(this.getItems()),!1)),this.onChange&&this.onChange()}},e.prototype.removeProduct=function(e){this.hasProduct(e)&&(this.items.delete(e),this.onChange&&this.onChange())},e.prototype.getRecipientIds=function(e){return void 0===e&&(e=!1),this.recipientIds.size?Array.from(this.recipientIds.values()):this.isGift&&e?[a.SAMPLE_RECIPIENT_ID]:[]},e.prototype.setRecipientIds=function(e){this.recipientIds=new Set(e)},e.prototype.hasRecipientId=function(e){return this.recipientIds.has(e)},e.prototype.addRecipientId=function(e){this.hasRecipientId(e)||(this.recipientIds.add(e),this.onChange&&this.onChange())},e.prototype.removeRecipientId=function(e){this.hasRecipientId(e)&&(this.recipientIds.delete(e),this.onChange&&this.onChange())},e.prototype.setOrder=function(e){var t,r;if(this._order=e,e){this.recipientIds.clear();try{for(var n=(0,i.__values)(e.items),s=n.next();!s.done;s=n.next()){var o=s.value;o.recipient_id!==a.SAMPLE_RECIPIENT_ID&&this.recipientIds.add(o.recipient_id)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}}},e.prototype.loadOrder=function(e){var t=e.items.map((function(e){return e.product_id}));return(0,o.getProducts)(t).then((function(t){return(0,i.__assign)((0,i.__assign)({},e),{items:e.items.map((function(e,r){return(0,i.__assign)((0,i.__assign)({},e),{product:t[r]})}))})}),(function(){return e}))},e.prototype.getOrder=function(){return this._order},e.prototype.getRecipientsMap=function(){return this.recipients},e.prototype.getRecipients=function(){return Array.from(this.recipients.values())},e.prototype.getRecipientById=function(e){return this.recipients.get(e)},e.prototype.addRecipients=function(e){this.recipients=new Map((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(this.getRecipients()),!1),(0,i.__read)(e),!1).map((function(e){return[e[0],e]})))},e.prototype.getJSON=function(){return JSON.stringify({items:this.getItems().map((function(e){return(0,i.__assign)((0,i.__assign)({},e),{product:void 0})})),recipient_ids:this.getRecipientIds(!0)})},e.prototype.isLoaded=function(){return null!==this.getOrder()},e.prototype.cancelLoad=function(){this.loadTimeout&&(window.clearTimeout(this.loadTimeout),this.loadTimeout=null),this.loadCancellationToken&&(this.loadCancellationToken.cancel(),this.loadCancellationToken=null)},e.prototype.load=function(e){var t=this;return void 0===e&&(e=!1),this.cancelLoad(),new Promise((function(r){t.loadTimeout=window.setTimeout((function(){t.loadCancellationToken=new s.AjaxCancellationToken,n.ajax.post("stickers.php",{act:"preview_products_order",cart:t.getJSON(),with_suggested_recipients:e?1:0},{cancellationToken:t.loadCancellationToken,onDone:function(e){(0,o.cacheProductsData)(e),Promise.all([t.loadItems(),t.loadOrder(e.order)]).then((function(n){var s=(0,i.__read)(n,2)[1];t.setOrder(s),e.recipients&&t.addRecipients(e.recipients),r(t)}),(function(){}))},onFail:function(e){return e&&window.__dev&&console.error(e),r(t),!0}})}),300)}))},e.prototype.order=function(e){var t=this;return void 0===e&&(e={}),new Promise((function(r){var s;n.ajax.post("stickers.php",{act:"order_products",cart:t.getJSON(),hash:e.hash||(null===(s=t.getOrder())||void 0===s?void 0:s.hash),message:e.message,is_private:e.is_private?1:0,ref:e.ref,gift_ref:e.gift_ref},{onDone:function(e){(0,o.cacheProductsData)(e),Promise.all([t.loadOrder(e.order),t.loadOrder(e.result)]).then((function(e){var n=(0,i.__read)(e,2),s=n[0],a=n[1];t.setOrder(s),r(a)}),(function(){}))},onFail:function(e){return e&&console.error(e),r(null),!0}})}))},e}()},69783:(e,t,r)=>{"use strict";r.d(t,{default:()=>d});var i=r(70655),n=r(85893),s=r(67294),a=r(44801),o=r(86067),c=r(83295),l=r(41650),u=function(e){var t=e.className,r=e.price,u=e.text,d=e.placeholder,_=(0,i.__rest)(e,["className","price","text","placeholder"]),g=(0,s.useMemo)((function(){if(r){var e;r.current!==r.regular&&r.regular&&(e=(0,n.jsx)("span",(0,i.__assign)({className:"StickersPriceButton__regular"},{children:r.current?r.regular:(0,o.langStr)((0,l.getLang)("purchases_stickers_n_for_m"),"%n","","%m",(0,l.getLang)("global_n_votes",r.regular))}),"regular"));var t=(0,n.jsx)("span",(0,i.__assign)({className:"StickersPriceButton__current"},{children:r.current?(0,l.getLang)("global_n_votes",r.current):(0,l.getLang)("purchases_for_free_btn").toLowerCase()}),"current");return u?u.split(/(\{regular_price\}|\{price\})/).map((function(r,s){return"{regular_price}"===r?e:"{price}"===r?t:r?(0,n.jsx)("span",(0,i.__assign)({className:"StickersPriceButton__label"},{children:r}),"label"+s):void 0})):[e,t]}return[d]}),[u,d,null==r?void 0:r.regular,null==r?void 0:r.current]);return(0,n.jsx)(a.Button,(0,i.__assign)({className:(0,c.classNames)("StickersPriceButton",t)},_,{children:g}),void 0)};u.defaultProps=(0,i.__assign)({},a.Button.defaultProps);const d=u},50134:(e,t,r)=>{"use strict";r.d(t,{useCart:()=>s});var i=r(70655),n=r(67294),s=function(e){var t=(0,i.__read)((0,n.useState)(e),2),r=t[0],s=t[1],a=(0,i.__read)((0,n.useState)(null),2),o=a[0],c=a[1],l=(0,n.useCallback)((function(){var e=r.load();c(e),e.then((function(t){s(t),c((function(t){return t===e?null:t}))}),(function(){}))}),[r]);return(0,n.useEffect)((function(){return r.onChange=l,r.isLoaded()||l(),function(){r.onChange=null,r.cancelLoad()}}),[r]),[r,null!==o]}},41576:(e,t,r)=>{"use strict";r.d(t,{previewSticker:()=>pe,previewStickerProduct:()=>ve});var i=r(70655),n=r(85893),s=r(73935),a=r(32773),o=r(54612),c=r(86067),l=r(49091),u=r(10835),d=r(65820),_=r(99321),g=r(86125),h=r(67294),f=r(44801),p=r(41650),v=r(13984),m=r(33024);const k=(0,r(63192).makeIcon)("Icon24Gift","gift_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="gift_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M21 10v2a1 1 0 0 1-1 1h-1v6.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 5 19.5V13h1-2a1 1 0 0 1-1-1v-2a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2Zm-8 3h6v2h-6v7h-2v-7H5v-2h6V8h2v5Zm-1-5C9 8 5.5 7 5.5 5.5s2-3 3.5-2.5c1 .333 2 2 3 5 1-3 2-4.667 3-5 1.5-.5 3.5 1 3.5 2.5S15 8 12 8Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0);var y=r(54921),S=r(48230),w=function(e){var t=(0,i.__read)(function(e){var t=(0,i.__read)((0,h.useState)({}),2)[1],r=(0,u.getProductFromCache)(e);return void 0===r?((0,u.getProduct)(e,!1).then((function(){return t({})}),(function(){})),[r,!0]):[r,!1]}(e),2),r=t[0],n=t[1];return r&&(0,l.isPackProduct)(r)?[r,n]:[void 0===r?void 0:null,n]},P=function(e){var t=(0,i.__read)((0,h.useState)({}),2)[1],r=(0,u.getProductsFromCache)(e);return r.some((function(e){return void 0===e}))?((0,u.getProducts)(e,!1).then((function(){return t({})}),(function(){})),[r,!0]):[r,!1]},x=function(e){var t,r,n=(0,i.__read)(P(e),2),s=n[0],a=n[1],o=[];try{for(var c=(0,i.__values)(s),u=c.next();!u.done;u=c.next()){var d=u.value;d&&(0,l.isStyleProduct)(d)&&o.push(d)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}return[o,a]};var L=r(50134),I="Invariant failed";const j=function(e,t){if(!e)throw new Error(I)};function N(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function b(){return b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},b.apply(this,arguments)}function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var T=new Map,R=new Map,M=new Map,A=0;function G(e,t,r){void 0===r&&(r={}),r.threshold||(r.threshold=0);var i=r,n=i.root,s=i.rootMargin,a=i.threshold;if(T.has(e)&&j(!1),e){var o=function(e){return e?M.has(e)?M.get(e):(A+=1,M.set(e,A.toString()),M.get(e)+"_"):""}(n)+(s?a.toString()+"_"+s:a.toString()),c=R.get(o);c||(c=new IntersectionObserver(D,r),o&&R.set(o,c));var l={callback:t,element:e,inView:!1,observerId:o,observer:c,thresholds:c.thresholds||(Array.isArray(a)?a:[a])};return T.set(e,l),c.observe(e),l}}function B(e){if(e){var t=T.get(e);if(t){var r=t.observerId,i=t.observer,n=i.root;i.unobserve(e);var s=!1,a=!1;r&&T.forEach((function(t,i){i!==e&&(t.observerId===r&&(s=!0,a=!0),t.observer.root===n&&(a=!0))})),!a&&n&&M.delete(n),i&&!s&&i.disconnect(),T.delete(e)}}}function D(e){e.forEach((function(e){var t=e.isIntersecting,r=e.intersectionRatio,i=e.target,n=T.get(i);if(n&&r>=0){var s=n.thresholds.some((function(e){return n.inView?r>e:r>=e}));void 0!==t&&(s=s&&t),n.inView=s,n.callback(s,e)}}))}var E=function(e){var t,r;function i(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return N(C(t=e.call.apply(e,[this].concat(i))||this),"state",{inView:!1,entry:void 0}),N(C(t),"node",null),N(C(t),"handleNode",(function(e){t.node&&(B(t.node),e||t.props.triggerOnce||t.setState({inView:!1,entry:void 0})),t.node=e||null,t.observeNode()})),N(C(t),"handleChange",(function(e,r){(e!==t.state.inView||e)&&t.setState({inView:e,entry:r}),t.props.onChange&&t.props.onChange(e,r)})),t}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n=i.prototype;return n.componentDidMount=function(){this.node||j(!1)},n.componentDidUpdate=function(e,t){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold||(B(this.node),this.observeNode()),t.inView!==this.state.inView&&this.state.inView&&this.props.triggerOnce&&(B(this.node),this.node=null)},n.componentWillUnmount=function(){this.node&&(B(this.node),this.node=null)},n.observeNode=function(){if(this.node){var e=this.props,t=e.threshold,r=e.root,i=e.rootMargin;G(this.node,this.handleChange,{threshold:t,root:r,rootMargin:i})}},n.render=function(){var e=this.state,t=e.inView,r=e.entry;if(!function(e){return"function"!=typeof e.children}(this.props))return this.props.children({inView:t,entry:r,ref:this.handleNode});var i=this.props,n=i.children,s=i.as,a=i.tag,o=(i.triggerOnce,i.threshold,i.root,i.rootMargin,i.onChange,function(e,t){if(null==e)return{};var r,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)r=s[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(i,["children","as","tag","triggerOnce","threshold","root","rootMargin","onChange"]));return(0,h.createElement)(s||a||"div",b({ref:this.handleNode},o),n)},i}(h.Component);N(E,"displayName","InView"),N(E,"defaultProps",{threshold:0,triggerOnce:!1});var O={inView:!1,entry:void 0};var H=r(83295),F=r(22377);const V=function(e){var t=e.className,r=e.sticker,s=e.theme,a=e.width,o=e.height,c=e.isInView,l=void 0===c||c,u=(0,h.useRef)(null),d=(0,F.getStickerImageUrl)(r,a,o,s);return(0,h.useLayoutEffect)((function(){u.current&&u.current.src!==d&&l&&(u.current.src=d)}),[l,d]),(0,n.jsx)("div",(0,i.__assign)({className:(0,H.classNames)("StickerImage",t),style:{width:a,height:o}},{children:(0,n.jsx)("img",{className:"StickerImage__image",ref:u},void 0)}),void 0)};var U=r(11248),z=r.n(U);const K=function(e){var t=e.className,r=e.sticker,s=e.theme,a=e.width,o=e.height,c=e.isInView,l=void 0===c||c,u=e.play,d=void 0!==u&&u,_=(0,h.useRef)(null),g=(0,i.__read)((0,h.useState)(null),2),f=g[0],p=g[1],v=(0,F.getStickerAnimationUrl)(r,s);return(0,h.useEffect)((function(){if(f&&f.isLoaded){var e=d&&l;e&&!f.playing&&(f.item.play(),p((0,i.__assign)((0,i.__assign)({},f),{playing:!0}))),!e&&f.playing&&(f.item.pause(),p((0,i.__assign)((0,i.__assign)({},f),{playing:!1})))}}),[f,d,l]),(0,h.useEffect)((function(){if(!f||f.url!==v)if(f&&f.item.destroy(),v&&l){var e=z().loadAnimation({container:_.current,path:v,renderer:"svg",autoplay:!1,loop:!0,rendererSettings:{className:"StickerAnimation__animation",progressiveLoad:!0,hideOnTransparent:!0}}),t={url:v,isLoaded:!1,item:e,playing:!1};e.addEventListener("DOMLoaded",(function(){p((0,i.__assign)((0,i.__assign)({},t),{isLoaded:!0}))})),p(t)}else p(null)}),[v,l]),(0,n.jsx)("div",{className:(0,H.classNames)("StickerAnimation",t),style:{width:a,height:o},ref:_},void 0)};const W=function(e){var t=e.className,r=e.sticker,s=e.theme,a=void 0===s?l.Theme.LIGHT:s,o=e.width,c=e.height,u=(0,i.__read)(function(e){void 0===e&&(e={});var t=(0,h.useRef)(),r=(0,h.useState)(O),i=r[0],n=r[1],s=(0,h.useCallback)((function(r){t.current&&B(t.current),r&&G(r,(function(t,i){n({inView:t,entry:i}),t&&e.triggerOnce&&B(r)}),e),t.current=r}),[e.threshold,e.root,e.rootMargin,e.triggerOnce]);return(0,h.useEffect)((function(){t.current||i===O||e.triggerOnce||n(O)})),[s,i.inView,i.entry]}({threshold:0}),2),d=u[0],_=u[1],g=void 0!==r.animation,f=(0,i.__read)((0,h.useState)(!1),2),p=f[0],v=f[1];return(0,n.jsx)("div",(0,i.__assign)({className:(0,H.classNames)("Sticker",t),ref:d,onMouseEnter:function(){v(!0)},onMouseLeave:function(){v(!1)}},{children:g?(0,n.jsx)(K,{sticker:r,theme:a,width:o,height:c,isInView:_,play:p},void 0):(0,n.jsx)(V,{sticker:r,theme:a,width:o,height:c,isInView:_},void 0)}),void 0)};var q=r(47560),Q=r(99940),$=r(79806),J={getOffset:function(){return{x:0,y:0}},scrollTo:function(){},scrollBy:function(){},onWheel:function(){},updateItems:function(){},hasPrev:!1,hasNext:!1,prev:function(){},next:function(){}};function X(e,t){switch(t.type){case"updateState":return(0,i.__assign)((0,i.__assign)({},e),t.state);case"updateNav":return t.hasPrev!==e.hasPrev||t.hasNext!==e.hasNext?(0,i.__assign)((0,i.__assign)({},e),{hasPrev:t.hasPrev,hasNext:t.hasNext}):e;default:throw new Error}}var Z=function(e){for(var t=Array.from(e.entries()),r=0;r<t.length;r++){var n=(0,i.__read)(t[r],2),s=n[0],a=n[1];if(a&&a.intersectionRatio)return a.intersectionRatio<1?s:t[r-1]?t[r-1][0]:null}return null},Y=function(e){for(var t=Array.from(e.entries()),r=t.length-1;r>=0;r--){var n=(0,i.__read)(t[r],2),s=n[0],a=n[1];if(a&&a.intersectionRatio)return a.intersectionRatio<1?s:t[r+1]?t[r+1][0]:null}return null};const ee=function(e){var t=(0,h.useRef)(null),r=(0,i.__read)((0,h.useReducer)(X,J),2),n=r[0],s=r[1],a=(0,h.useCallback)((function(e){s({type:"updateState",state:e})}),[s]),o=(0,h.useCallback)((function(r){if(t.current&&n.onMouseWheel&&t.current.removeEventListener("mousewheel",n.onMouseWheel),r){var o=r.querySelector(e.wrapperSelector);if(o){var c,l={x:0,y:0},u=new Map,d=function(t){var i=0;o.offsetWidth>r.offsetWidth&&(i=Math.max(0,Math.min(o.offsetWidth-r.offsetWidth,t.x)));var n=0;o.offsetHeight>r.offsetHeight&&(n=Math.max(0,Math.min(o.offsetHeight-r.offsetHeight,t.y))),o.style.transform="translate3d(-"+i+"px, -"+n+"px, 0)",o.style.transitionDuration=t.noTransition?"0s":"",l={x:i,y:n},e.onScroll&&e.onScroll(i,n)},_=function(e){d((0,i.__assign)((0,i.__assign)({},e),{x:l.x+e.x,y:l.y+e.y}))},g=function(e){e.deltaX&&e.preventDefault()};r.addEventListener("mousewheel",g),a((0,i.__assign)((0,i.__assign)({},n),{onMouseWheel:g,updateItems:function(){var t,n;c&&c.disconnect(),c=new IntersectionObserver((function(e){var t,r;try{for(var n=(0,i.__values)(e),a=n.next();!a.done;a=n.next()){var o=a.value;u.has(o.target)&&u.set(o.target,o)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}s({type:"updateNav",hasPrev:null!==Z(u),hasNext:null!==Y(u)})}),{root:r,threshold:[0,1]}),u.clear();try{for(var a=(0,i.__values)(r.querySelectorAll(e.itemSelector)),o=a.next();!o.done;o=a.next()){var l=o.value;u.set(l,null),c.observe(l)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},getOffset:function(){return l},scrollTo:d,scrollBy:_,onWheel:function(e){_({x:e.deltaX,y:e.deltaY,noTransition:!0})},prev:function(){var e=Z(u);if(e){var t=getComputedStyle(o),r=parseInt(t.paddingLeft)||0,i=parseInt(t.paddingTop)||0,n=o.getBoundingClientRect(),s=e.getBoundingClientRect();d({x:s.left-n.left-r,y:s.top-n.top-i})}},next:function(){var e=Y(u);if(e){var t=getComputedStyle(o),i=parseInt(t.paddingBottom)||0,n=parseInt(t.paddingRight)||0,s=r.getBoundingClientRect(),a=o.getBoundingClientRect(),c=e.getBoundingClientRect();d({x:c.left-a.left-s.width+c.width+n,y:c.top-a.top-s.height+c.height+i})}}}))}}t.current=r}),[e.wrapperSelector,e.itemSelector,e.onScroll]);return(0,h.useLayoutEffect)((function(){n.updateItems()})),(0,i.__assign)({ref:o},n)};var te=r(88420);const re=function(e){var t,r=e.className,s=e.style,a=e.isAdded,o=void 0!==a&&a,c=e.add,l=e.remove,u=e.gift,_=e.isActive,g=e.isSelected,h=e.select;t=s.is_new?s.title.trim().replace(/(^|\s)([^\s]+)$/,'$1<span class="StickerStylesMenuItem__titleLastWord">$2</span>'):s.title;var f=(0,d.getSticker)(s.style_sticker_ids[0]),m=function(e){return function(t){t.stopPropagation(),e()}};return(0,n.jsxs)("div",(0,i.__assign)({className:(0,H.classNames)("StickerStylesMenuItem",r,{"StickerStylesMenuItem--selected":Boolean(g),"StickerStylesMenuItem--added":Boolean(o),"StickerStylesMenuItem--new":s.is_new}),onClick:function(){h?h():o?l&&l():c&&c()}},{children:[f&&(0,n.jsx)(W,{className:"StickerStylesMenuItem__icon",sticker:f,width:100,height:100},void 0),(0,n.jsx)(v.default,(0,i.__assign)({element:"div",className:"StickerStylesMenuItem__title"},{children:t}),void 0),s.is_purchased?void 0===_?(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenuItem__notice"},{children:(0,p.getLang)("purchases_stickers_you_have_it")}),void 0):_&&(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenuItem__notice"},{children:(0,p.getLang)("purchases_stickers_active_style")}),void 0):s.price.purchase.regular?(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenuItem__price"},{children:(0,p.getLang)("global_n_votes",s.price.purchase.current)}),void 0):(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenuItem__price"},{children:(0,p.getLang)("purchases_for_free_btn")}),void 0),(c||l||u&&s.can_gift)&&(0,n.jsxs)("div",(0,i.__assign)({className:"StickerStylesMenuItem__actions"},{children:[o?l&&(0,n.jsx)(te.default,(0,i.__assign)({className:"StickerStylesMenuItem__remove",appearance:"secondary",size:"s",onClick:m(l)},{children:(0,p.getLang)("purchases_stickers_preview_remove_item")}),void 0):c&&(0,n.jsx)(te.default,(0,i.__assign)({className:"StickerStylesMenuItem__add",appearance:"primary",size:"s",onClick:m(c)},{children:(0,p.getLang)("purchases_stickers_preview_add_item")}),void 0),u&&s.can_gift&&(0,n.jsx)(te.default,(0,i.__assign)({className:"StickerStylesMenuItem__gift",size:"s",appearance:"primary",onClick:m(u)},{children:(0,n.jsx)(k,{width:20,height:20,className:"StickerStylesMenuItem__giftIcon"},void 0)}),void 0)]}),void 0)]}),void 0)};const ie=function(e){var t=e.className,r=e.styles,s=e.isLoading,a=e.isAdded,o=e.add,c=e.remove,l=e.gift,u=e.activeStyle,d=e.selectedStyle,_=e.select,g=ee({wrapperSelector:".StickerStylesMenu__wrapper",itemSelector:".StickerStylesMenu__item"});if(s)return(0,n.jsx)("section",(0,i.__assign)({className:(0,H.classNames)("StickerStylesMenu","StickerStylesMenu--loading",t)},{children:(0,n.jsx)(q.default,{className:"StickerStylesMenu__progress"},void 0)}),void 0);var h=[{title:(0,p.getLang)("purchases_stickers_purchased_styles"),styles:r.filter((function(e){return e.is_purchased&&!e.is_disabled}))},{title:(0,p.getLang)("purchases_stickers_other_styles"),styles:r.filter((function(e){return!e.is_purchased&&!e.is_disabled&&!e.is_hidden})),tooltip:(0,p.getLang)("purchases_stickers_styles_hint")}].filter((function(e){return e.styles.length}));return h.length?(0,n.jsxs)("section",(0,i.__assign)({className:(0,H.classNames)("StickerStylesMenu",t),ref:g.ref,onWheel:function(e){return g.onWheel(e)}},{children:[(0,n.jsx)("a",{className:(0,H.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--prev",{"StickerStylesMenu__nav--disabled":!g.hasPrev}),onClick:function(){return g.prev()}},void 0),(0,n.jsx)("a",{className:(0,H.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--next",{"StickerStylesMenu__nav--disabled":!g.hasNext}),onClick:function(){return g.next()}},void 0),(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenu__wrapper"},{children:h.map((function(e,t){return(0,n.jsxs)("section",(0,i.__assign)({className:"StickerStylesMenu__group"},{children:[(0,n.jsxs)("h2",(0,i.__assign)({className:"StickerStylesMenu__groupTitle"},{children:[e.title,e.tooltip&&(0,n.jsx)(Q.default,(0,i.__assign)({className:"StickerStylesMenu__groupTitleHint",text:e.tooltip,position:"b",align:"center",appearance:"light"},{children:(0,n.jsx)($.default,{className:"StickerStylesMenu__groupTitleHintIcon"},void 0)}),void 0)]}),void 0),(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenu__groupItems"},{children:e.styles.map((function(e){return(0,n.jsx)(re,{className:"StickerStylesMenu__item",style:e,isLoading:s,isAdded:a&&a(e),add:o&&function(){return o(e)},remove:c&&function(){return c(e)},gift:l&&function(){return l(e)},isActive:void 0===u?void 0:e===u,isSelected:void 0===d?void 0:e===d,select:_&&function(){return _(e)}},e.id)}))}),void 0)]}),t)}))}),void 0)]}),void 0):null};var ne=r(11417);const se=function(e){var t=e.className,r=e.product;if(!(0,l.isPackProduct)(r)&&!(0,l.isStyleProduct)(r))return null;var s=(0,d.getStickers)((0,l.isStyleProduct)(r)?r.style_sticker_ids:r.sticker_ids),a=ne.colorScheme.isDarkScheme()?l.Theme.DARK:l.Theme.LIGHT;return(0,n.jsx)("div",(0,i.__assign)({className:(0,H.classNames)("StickersProductPreview",t)},{children:(0,n.jsx)("ul",(0,i.__assign)({className:"StickersProductPreview__stickers"},{children:s.map((function(e){return e&&(0,n.jsx)(W,{className:"StickersProductPreview__sticker",sticker:e,width:128,height:128,theme:a},e.id)}))}),void 0)}),void 0)};const ae=function(e){var t=e.item,r=e.showHeader,s=void 0!==r&&r,a=e.remove;if(!t.product)return null;var o="";return(0,l.isPackProduct)(t.product)?o=(0,c.langStr)((0,p.getLang)("purchases_stickers_product_preview_title_pack"),"title",t.product.title):(0,l.isStyleProduct)(t.product)&&(o=(0,c.langStr)((0,p.getLang)("purchases_stickers_product_preview_title_style"),"title",t.product.title)),(0,n.jsxs)("div",(0,i.__assign)({className:"StickersCartItem"},{children:[s&&(0,n.jsxs)("div",(0,i.__assign)({className:"StickersCartItem__header"},{children:[(0,n.jsx)(v.default,(0,i.__assign)({element:"span",className:"StickersCartItem__title"},{children:o}),void 0),a&&(0,n.jsx)("span",(0,i.__assign)({className:"StickersCartItem__actions"},{children:(0,n.jsx)("button",(0,i.__assign)({className:"StickersCartItem__remove",onClick:function(){return a()}},{children:(0,p.getLang)("purchases_stickers_preview_remove_item")}),void 0)}),void 0)]}),void 0),(0,n.jsx)(se,{className:"StickersCartItem__preview",product:t.product},void 0)]}),void 0)};var oe=r(69783),ce=r(40060),le=r(59397);const ue=function(e){var t=e.pack,r=e.cart,s=e.options,a=s.recipientIds,u=void 0===a?[]:a,_=s.ref,I=s.gift_ref,j=e.closeBox,N=(0,i.__read)(w(t.id),1)[0];N&&(t=N);var b=(0,i.__read)(x(t.style_ids||[]),2),C=b[0],T=b[1],R=(0,i.__read)((0,L.useCart)((function(){return r})),2),M=R[0],A=R[1],G=(0,i.__read)(function(e){var t=(0,i.__read)(P(e.map((function(e){return e.product_id}))),2),r=t[0],n=t[1];return[(0,h.useMemo)((function(){return e.map((function(e,t){return(0,i.__assign)((0,i.__assign)({},e),{product:r[t]})}))}),[e]),n]}(M.getItems()),1),B=G[0],D=M.getProducts(),E=M.getOrder(),O=(0,d.getSticker)(t.sticker_ids[0]),H=function(e){var t,r;if(!e)return null;var n=[],s=[];try{for(var a=(0,i.__values)(e.items),o=a.next();!o.done;o=a.next()){var u=o.value,d=u.product,_=u.error;d&&!_&&((0,l.isPackProduct)(d)?n.push(u):(0,l.isStyleProduct)(d)&&s.push(u))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}var g=s.reduce((function(e,t){var r;return e+((null===(r=t.price)||void 0===r?void 0:r.current)||0)}),0);if(n.length){var h=n.reduce((function(e,t){var r;return e+((null===(r=t.price)||void 0===r?void 0:r.current)||0)}),0);return h?s.length?g?(0,c.langStr)((0,p.getLang)("purchases_stickers_order_summary_pack_for_styles_for",s.length),"pack_price",(0,p.getLang)("global_n_votes",h),"styles_num",s.length,"styles_price_sum",g):(0,c.langStr)((0,p.getLang)("purchases_stickers_order_summary_pack_for_styles_free",s.length),"pack_price",(0,p.getLang)("global_n_votes",h),"styles_num",s.length):(0,c.langStr)((0,p.getLang)("purchases_stickers_order_summary_pack_for"),"pack_price",(0,p.getLang)("global_n_votes",h)):s.length?g?(0,c.langStr)((0,p.getLang)("purchases_stickers_order_summary_pack_free_styles_for",s.length),"styles_num",s.length,"styles_price_sum",(0,p.getLang)("global_n_votes",g)):(0,c.langStr)((0,p.getLang)("purchases_stickers_order_summary_pack_free_styles_free",s.length),"styles_num",s.length):(0,c.langStr)((0,p.getLang)("purchases_stickers_order_summary_pack_free"))}if(s.length)return g?(0,c.langStr)((0,p.getLang)("purchases_stickers_order_summary_styles_for",s.length),"styles_num",s.length,"styles_price_sum",(0,p.getLang)("global_n_votes",g)):(0,c.langStr)((0,p.getLang)("purchases_stickers_order_summary_styles_free",s.length),"styles_num",s.length);return null}(E),F=!A&&E&&!E.error,V=(0,i.__read)((0,h.useState)(!1),2),U=V[0],z=V[1],K=null;if(E)if(E.error){if(E.error===y.ORDER_ERRORS.NOT_SIGNED_IN){K=(0,n.jsx)(f.Button,(0,i.__assign)({mode:"primary",size:"m",loading:A,onClick:function(){(0,g.showDoneBox)((0,p.getLang)("purchases_please_sign_in").replace(/\{link\}(.*?)\{\/link\}/,"<a href=\"/join\" onclick=\"return !showBox('join.php', { act: 'box', from: nav.strLoc }, {}, event)\">$1</a>"))}},{children:(0,p.getLang)("purchases_stickers_get_pack_btn")}),void 0)}else if(E.error===y.ORDER_ERRORS.NO_VALID_ITEMS){if(1===E.items.length){var q=E.items[0],Q=q.product,$=q.error;if(Q&&$!==y.ORDER_ITEM_ERRORS.DUPLICATE_PRODUCT&&Q.purchase_details){var J=Q.purchase_details,X=J.label,Z=J.title,Y=J.text,ee=J.button_title,te=J.button_url;K=(0,n.jsx)(f.Button,(0,i.__assign)({mode:"primary",size:"m",loading:A,onClick:function(){(0,o.showFastBox)(Z||(0,p.getLang)("purchases_stickers_catalog_purchase_details_title"),Y,te&&ee||null,te?function(){window.location.href=te}:null)}},{children:X||(0,p.getLang)("purchases_stickers_product_unavailable")}),void 0)}}if(!K){var re=!E.items.find((function(e){return e.error!==y.ORDER_ITEM_ERRORS.DUPLICATE_PRODUCT}));K=(0,n.jsx)(f.Button,(0,i.__assign)({mode:"secondary",size:"m",disabled:!0},{children:re?(0,p.getLang)("purchases_stickers_product_purchased"):(0,p.getLang)("purchases_stickers_product_unavailable")}),void 0)}}}else{var se=A||U;K=(0,n.jsx)(oe.default,{mode:"primary",size:"m",loading:se,disabled:se,price:E.price,text:E.price.current?(0,p.getLang)("purchases_stickers_buy_for"):(0,p.getLang)("purchases_stickers_get_for_free"),onClick:function(){U||(z(!0),M.order({ref:_,gift_ref:I}).then((function(e){z(!1),e&&!e.error&&(0,g.showDoneBox)((0,S.getPurchaseResult)(e))}),(function(){})))}},void 0)}var ue=!A&&void 0!==D.find((function(e){return null==e?void 0:e.can_gift})),de=B.reduce((function(e,t){return t.product&&t.product.copyright&&e.add(t.product.copyright),e}),new Set),_e=ne.colorScheme.isDarkScheme()?l.Theme.DARK:l.Theme.LIGHT;return(0,n.jsxs)("article",(0,i.__assign)({className:"StickerPackPreview"},{children:[(0,n.jsxs)("header",(0,i.__assign)({className:"StickerPackPreview__header"},{children:[(0,n.jsx)("a",(0,i.__assign)({className:"StickerPackPreview__close",onClick:j},{children:(0,n.jsx)(m.default,{},void 0)}),void 0),O&&(0,n.jsx)(W,{className:"StickerPackPreview__icon",sticker:O,theme:_e,width:128,height:128},void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerPackPreview__info"},{children:[(0,n.jsx)(v.default,(0,i.__assign)({element:"h1",className:"StickerPackPreview__title"},{children:t.title}),void 0),(0,n.jsx)(v.default,(0,i.__assign)({element:"div",className:"StickerPackPreview__author"},{children:t.author}),void 0),(0,n.jsx)(v.default,(0,i.__assign)({element:"div",className:"StickerPackPreview__description"},{children:t.description}),void 0)]}),void 0)]}),void 0),C.length>0&&(0,n.jsx)(ie,{className:"StickerPackPreview__styles",styles:C,isLoading:T,isAdded:function(e){return M.hasProduct(e.id)},add:function(e){return M.addProduct(e.id)},remove:function(e){return M.removeProduct(e.id)},gift:function(e){return t=e.id,void(0,ce.giftStickerProducts)([t],u);var t}},void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerPackPreview__footerContainer"},{children:[(0,n.jsx)("section",(0,i.__assign)({className:"StickerPackPreview__items"},{children:B.map((function(e){return(0,n.jsx)(ae,{item:e,showHeader:C.length>0,remove:e.product&&(0,l.isStyleProduct)(e.product)?function(){return M.removeProduct(e.product_id)}:void 0},e.product_id)}))}),void 0),de.size>0&&(0,n.jsx)("section",(0,i.__assign)({className:"StickerPackPreview__copyrights"},{children:Array.from(de).map((function(e,t){return(0,n.jsx)("div",(0,i.__assign)({className:"StickerPackPreview__copyright"},{children:(0,le.decodeHTMLEntities)(e)}),t)}))}),void 0),(0,n.jsxs)("footer",(0,i.__assign)({className:"StickerPackPreview__footer"},{children:[!A&&(F||ue)&&(0,n.jsx)("div",(0,i.__assign)({className:"StickerPackPreview__footerNote"},{children:H}),void 0),(0,n.jsxs)(f.ButtonGroup,{children:[ue&&(0,n.jsx)(f.Button,(0,i.__assign)({mode:"primary",size:"m",onClick:function(){return(e=M.copy()).setRecipientIds(u),void(0,ce.giftStickersCart)(e);var e},before:(0,n.jsx)(k,{width:20,height:20},void 0)},{children:(0,p.getLang)("purchases_stickers_gift")}),void 0),K]},void 0)]}),void 0)]}),void 0)]}),void 0)};var de=r(43927),_e=r(39664);const ge=function(e){var t=e.pack,r=e.options,s=e.closeBox,a=e.updateBox,o=(0,i.__read)(w(t.id),2),d=o[0],g=o[1];d&&(t=d);var m=(0,i.__read)(x(t.style_ids||[]),2),k=m[0],y=m[1],S=g||y;(0,h.useEffect)((function(){a()}),[S]);var P=(0,i.__assign)((0,i.__assign)({},t),{base_id:t.id,title:(0,p.getLang)("purchases_stickers_product_preview_title_base_pack"),style_sticker_ids:t.sticker_ids}),L=(0,i.__spreadArray)([P],(0,i.__read)(k),!1),I=L.find((function(e){return e&&e.is_active}))||P,j=(0,i.__read)((0,h.useState)(),2),N=j[0],b=j[1],C=N&&L.find((function(e){return e&&e.id===N})),T=function(e){b(e&&e.id)},R=C||I,M=R===P?(0,p.getLang)("purchases_stickers_product_preview_title_base_pack"):(0,c.langStr)((0,p.getLang)("purchases_stickers_product_preview_title_style"),"title",R.title);(0,h.useEffect)((function(){R.is_new&&(0,u.updateUserProductState)(R.id,l.UserProductStateKey.IsNew,0).finally((function(){}))}),[R,R.is_new]);var A=(0,i.__read)((0,h.useState)(!1),2),G=A[0],B=A[1],D=(0,i.__read)((0,h.useState)(!1),2),E=D[0],O=D[1];return(0,n.jsxs)("article",(0,i.__assign)({className:"StickerPackSettings"},{children:[(0,n.jsx)(de.ModalHeader,{className:"StickerPackSettings__header",title:t?(0,c.langStr)((0,p.getLang)("purchases_stickers_style_selection_for_pack"),"title",t.title):"",onClose:s},void 0),S?(0,n.jsx)("section",(0,i.__assign)({className:"StickerPackSettings__content StickerPackSettings__content--loading"},{children:(0,n.jsx)(_e.default,{size:24},void 0)}),void 0):(0,n.jsxs)(h.Fragment,{children:[L.length>0&&(0,n.jsx)(ie,{className:"StickerPackSettings__styles",styles:L,isLoading:y,activeStyle:I,selectedStyle:R,select:function(e){return T(e)}},void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerPackSettings__footerContainer"},{children:[(0,n.jsxs)("section",(0,i.__assign)({className:"StickerPackSettings__stylePreview"},{children:[(0,n.jsx)(v.default,(0,i.__assign)({element:"h2",className:"StickerPackSettings__stylePreviewTitle"},{children:M}),void 0),(0,n.jsx)(se,{product:R},void 0)]}),void 0),(0,n.jsx)("footer",(0,i.__assign)({className:"StickerPackSettings__footer"},{children:(0,n.jsxs)(f.ButtonGroup,{children:[R.can_gift&&(0,n.jsx)(f.Button,{mode:"secondary",size:"m",onClick:function(){return e=R.id,void(0,ce.giftStickerProducts)([e],r.recipientIds||[]);var e}},void 0),R.is_purchased?(0,n.jsx)(f.Button,(0,i.__assign)({mode:"primary",size:"m",disabled:R===I,loading:E,onClick:function(){return e=R,void(E||(O(!0),(0,u.activateProduct)(e).then((function(){O(!1),T(void 0)}),(function(){}))));var e}},{children:(0,p.getLang)("purchases_stickers_product_settings_save")}),void 0):(0,n.jsx)(oe.default,{className:"StickerPackSettings__buy",mode:"primary",size:"m",price:R.price.purchase,text:R.price.purchase.current?(0,p.getLang)("purchases_stickers_buy_for"):(0,p.getLang)("purchases_stickers_get_for_free"),loading:G,onClick:function(){return e=R,void(G||(B(!0),_.Cart.create([e.id]).load().then((function(e){return e.order()})).then((function(){B(!1)}),(function(){}))));var e}},void 0)]},void 0)}),void 0)]}),void 0)]},void 0)]}),void 0)};const he=function(e){var t=e.style,r=e.options.add,s=e.closeBox;return(0,n.jsxs)("article",(0,i.__assign)({className:"StickerStylePreview"},{children:[(0,n.jsx)(de.ModalHeader,{className:"StickerStylePreview__header",title:(0,c.langStr)((0,p.getLang)("purchases_stickers_stickers_of_style"),"title",t.title),onClose:s},void 0),(0,n.jsx)(se,{className:"StickerStylePreview__content",product:t},void 0),(0,n.jsxs)("footer",(0,i.__assign)({className:"StickerStylePreview__footer"},{children:[(0,n.jsx)(f.Button,(0,i.__assign)({mode:"tertiary",size:"m",onClick:s},{children:(0,p.getLang)("global_cancel")}),void 0),r&&(0,n.jsx)(f.Button,(0,i.__assign)({mode:"primary",size:"m",onClick:function(){return r(t)}},{children:(0,p.getLang)("purchases_stickers_preview_add_item")}),void 0)]}),void 0)]}),void 0)};var fe=new Map;function pe(e,t){var r=(0,g.showBoxLoader)();(0,d.getPackByStickerId)(e).then((function(e){!(0,g.isBoxLoadingCancelled)(r)&&e&&((0,g.hideBoxLoader)(),ve(e.id,t))}),(function(){}))}function ve(e,t){var r,d=(0,i.__assign)({},t);function h(){return null==r?void 0:r.bodyNode.querySelector(".StickersProductPreviewBox")}function f(){null==r||r.hide(),window.nav.objLoc[0].match(/^stickers\/(.*?)$/)&&window.nav.setLoc({0:"stickers"})}function p(){null==r||r.updateBoxCoords()}function v(e,t){var r=null,i=null;if((0,l.isPackProduct)(e))r=e.is_purchased&&(null==d?void 0:d.settings)?(0,n.jsx)(ge,{pack:e,options:d,closeBox:f,updateBox:p},void 0):(0,n.jsx)(ue,{pack:e,cart:t,options:d,closeBox:f,updateBox:p},void 0),i=e.name;else if((0,l.isStyleProduct)(e)){var o=(0,u.getProductFromCache)(e.base_id);if(o)return t.addProduct(o.id,!0),void v(o,t);r=(0,n.jsx)(he,{style:e,options:d,closeBox:f,updateBox:p},void 0),i=e.name}var c=h();if(c&&r&&(s.render((0,n.jsx)(a.AppRootProvider,{children:r},void 0),c),i)){var _=window.nav.objLoc[0].split("/");"stickers"===_[0]&&_[1]!==i&&window.nav.setLoc({0:"stickers/"+i})}}var m=(0,g.showBoxLoader)(!1),k=_.Cart.create([e]);return Promise.all([k.load(),window.stManager.add(["stickers.css"])]).then((function(t){var n=(0,i.__read)(t,1)[0];if(!(0,g.isBoxLoadingCancelled)(m)){(0,g.hideBoxLoader)();var a=(0,u.getProductFromCache)(e);a&&!a.is_disabled?((r=new o.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:640,onShow:function(){v(a,n),requestAnimationFrame((function(){p(),function(){if(fe.has(e)){var t=(0,g.getBoxLayerWrap)();t&&(t.scrollTop=fe.get(e)||0),fe.delete(e)}}()}))},onBeforeHide:function(){var t;(t=(0,g.getBoxLayerWrap)())&&fe.set(e,t.scrollTop)},onHideAttempt:function(){var e;return(e=h())&&s.unmountComponentAtNode(e),!0}})).content('<div class="StickersProductPreviewBox"></div>'),r.show()):(0,o.showFastBox)((0,c.getLang)("global_box_error_title"),(0,c.getLang)("purchases_stickers_product_not_found"))}}),(function(){})),{hide:f}}},10835:(e,t,r)=>{"use strict";r.d(t,{cacheProductsData:()=>a,getProductFromCache:()=>o,getProductsFromCache:()=>c,getProducts:()=>u,getProduct:()=>d,activateProduct:()=>_,updateUserProductState:()=>g});var i=r(70655),n=r(93680),s=r(65820),a=function(e,t){var r,n,a,o,c,l;void 0===t&&(t=[]);var u=(0,s.getCache)();if(e.stickers){var d=u.stickers;try{for(var _=(0,i.__values)(e.stickers),g=_.next();!g.done;g=_.next()){var h=g.value;d.has(h.id)?d.set(h.id,(0,i.__assign)((0,i.__assign)({},d.get(h.id)),h)):d.set(h.id,h)}}catch(e){r={error:e}}finally{try{g&&!g.done&&(n=_.return)&&n.call(_)}finally{if(r)throw r.error}}}if(e.products)try{for(var f=(0,i.__values)(e.products),p=f.next();!p.done;p=f.next()){var v=p.value;u.products.set(v.id,v),u.productPromises.delete(v.id)}}catch(e){a={error:e}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(a)throw a.error}}try{for(var m=(0,i.__values)(t),k=m.next();!k.done;k=m.next()){var y=k.value;u.products.has(y)||u.products.set(y,null),u.productPromises.delete(y)}}catch(e){c={error:e}}finally{try{k&&!k.done&&(l=m.return)&&l.call(m)}finally{if(c)throw c.error}}e.emoji&&window.Emoji&&window.Emoji.updateTabs(e.emoji.stickers,e.emoji.keywords,!0),(0,s.updateCache)(u)},o=function(e){return(0,s.getCache)().products.get(e)},c=function(e){var t=(0,s.getCache)().products;return e.map((function(e){return t.get(e)}))};var l=function(e){var t,r;if(!e.length)return Promise.resolve([]);var o,l=(0,s.getCache)(),u=l.productPromises,d=l.productIdsQueue,_=new Set;try{for(var g=(0,i.__values)(e),h=g.next();!h.done;h=g.next()){var f=h.value;if(u.has(f)){(p=u.get(f))&&_.add(p)}else{d.add(f);var p=(o=void 0,(o=(0,s.getCache)().productsPromise)||(o=new Promise((function(e){return setTimeout((function(){var t=(0,s.getCache)().productIdsQueue,r=Array.from(t);t.clear(),(0,s.updateCache)({productIdsQueue:t,productsPromise:void 0}),n.ajax.post("stickers.php",{act:"get_products",product_ids:r},{onDone:function(t){a(t,r),e([])},onFail:function(t){return console.error(t),a({},r),e([]),!0}})}),300)})),(0,s.updateCache)({productsPromise:o})),o);u.set(f,p),_.add(p)}}}catch(e){t={error:e}}finally{try{h&&!h.done&&(r=g.return)&&r.call(g)}finally{if(t)throw t.error}}return(0,s.updateCache)({productIdsQueue:d,productPromises:u}),Promise.all(_).then((function(){return c(e)}))},u=function(e,t){void 0===t&&(t=!0);var r=t?e.filter((function(e){return void 0===o(e)})):e;return r.length?l(r).then((function(){return c(e)})):Promise.resolve(c(e))},d=function(e,t){if(void 0===t&&(t=!0),t){var r=o(e);if(void 0!==r)return Promise.resolve(r)}return l([e]).then((function(){return o(e)}))},_=function(e){return new Promise((function(t){n.ajax.post("stickers.php",{act:"activate_product",product_id:e.id,hash:e.csrf_hash},{onDone:function(e){a(e),t()},onFail:function(e){return console.error(e),t(),!0}})}))},g=function(e,t,r,i){return void 0===i&&(i=!0),new Promise((function(s){n.ajax.post("stickers.php",{act:"update_user_product_state",product_ids:[e],key:t,value:r},{onDone:function(e){i&&a(e),s()},onFail:function(e){return console.error(e),s(),!0}})}))}},40060:(e,t,r)=>{"use strict";r.d(t,{giftStickerProducts:()=>A,giftStickersCart:()=>M});var i=r(70655),n=r(85893),s=r(73935),a=r(32773),o=r(54612),c=r(99321),l=r(48230),u=r(65820),d=r(67294),_=r(86125),g=r(86067),h=r(41650),f=r(43927),p=r(39664),v=r(73947),m=r(74041),k=r(79806),y=r(99940),S=r(49091),w=r(22377),P=r(50134),x=r(83295),L={s:56,m:96,l:168};const I=function(e){var t,r,s,a,o,c=e.order,l=e.forceValid,u=void 0!==l&&l,d=new Map,_=new Map;if(c)try{for(var g=(0,i.__values)(c.items),h=g.next();!h.done;h=g.next()){var f=h.value,p=f.product;p&&((0,S.isPackProduct)(p)?d.has(p)?null===(s=d.get(p))||void 0===s||s.push(f):d.set(p,[f]):(0,S.isStyleProduct)(p)&&(_.has(p)?null===(a=_.get(p))||void 0===a||a.push(f):_.set(p,[f])))}}catch(e){t={error:e}}finally{try{h&&!h.done&&(r=g.return)&&r.call(g)}finally{if(t)throw t.error}}var v=d.keys().next().value,m=(v?1:0)+_.size,k=m>1?m>2?"s":"m":"l",y=L[k],P=Array.from(_.entries());u||P.sort((function(e,t){var r=(0,i.__read)(e,2)[1];return(0,i.__read)(t,2)[1].filter((function(e){return!e.error})).length-r.filter((function(e){return!e.error})).length}));var I=P.slice(0,3),j=P.slice(3),N=!0;if(!u){var b=j.filter((function(e){return(0,i.__read)(e,2)[1].find((function(e){return!e.error}))}));b.length?j=b:N=!1}return(0,n.jsxs)("ul",(0,i.__assign)({className:"StickerProductsGiftIcons"},{children:[v&&(0,n.jsx)("li",{className:(0,x.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+k,"StickerProductsGiftIcons__icon--pack",{"StickerProductsGiftIcons__icon--invalid":!u&&!(null===(o=d.get(v))||void 0===o?void 0:o.find((function(e){return!e.error})))}),style:{backgroundImage:"url("+(0,w.getStickerPackIconUrl)(v,y,y)+")"}},v.id),I.map((function(e){var t=(0,i.__read)(e,2),r=t[0],s=t[1];return(0,n.jsx)("li",{className:(0,x.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+k,"StickerProductsGiftIcons__icon--style",{"StickerProductsGiftIcons__icon--invalid":!u&&!s.find((function(e){return!e.error}))}),style:{backgroundImage:"url("+(0,w.getStickerPackIconUrl)(r,y,y)+")"}},r.id)})),j.length?(0,n.jsxs)("li",(0,i.__assign)({className:(0,x.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+k,"StickerProductsGiftIcons__icon--more",{"StickerProductsGiftIcons__icon--invalid":!N})},{children:["+",j.length]}),"more"):null]}),void 0)};var j=r(13984),N=r(59397);function b(e){var t=e.getPack(),r=e.getStyles(),i="";return r.length&&(i=r.map((function(e){return(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_details_recipient_style_title"),"title",e.title)})).join(", ")),t?i?(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_details_recipient_pack_and_styles"),"pack_title",t.title,"style_titles",i):(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_details_recipient_pack"),"title",t.title):i?(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_details_recipient_styles"),"style_titles",i):null}const C=function(e){var t,r,s=e.order,a=e.recipients,o=function(e){var t,r;if(!e)return null;var n=e.items.filter((function(e){var t=e.product;return null==t?void 0:t.can_gift})),s=n.filter((function(e){return!e.error&&!(0,w.isSampleOrderItem)(e)}));s.length&&(n=s);var a=[],o=[];try{for(var c=(0,i.__values)(n),l=c.next();!l.done;l=c.next()){var u=l.value,d=u.product;d&&((0,S.isPackProduct)(d)?a.push(u):(0,S.isStyleProduct)(d)&&o.push(u))}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}var _=o.reduce((function(e,t){var r;return e+((null===(r=t.price)||void 0===r?void 0:r.current)||0)}),0);if(a.length){var f=a.reduce((function(e,t){var r;return e+((null===(r=t.price)||void 0===r?void 0:r.current)||0)}),0);return o.length?(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_details_summary_pack_with_styles",o.length),"pack_price_sum",(0,h.getLang)("global_n_votes",f),"styles_num",o.length,"styles_price_sum",(0,h.getLang)("global_n_votes",_)):(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_details_summary_pack"),"pack_price_sum",(0,h.getLang)("global_n_votes",f))}if(o.length)return(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_details_summary_styles",o.length),"styles_num",o.length,"styles_price_sum",(0,h.getLang)("global_n_votes",_));return null}(s),c=new Map;try{for(var l=(0,i.__values)(s.items),u=l.next();!u.done;u=l.next()){var _=u.value,f=_.error,p=_.product,v=_.recipient_id;if(!f){var m=a.get(v);if(m){var k=c.get(m);k||(k=new S.ProductsByType,c.set(m,k)),k.add(p)}}}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}var y=Array.from(c.entries()),P=(0,d.useRef)(null);return(0,d.useEffect)((function(){var e=P.current;e&&(e.style.maxHeight=e.getBoundingClientRect().bottom-22+"px")})),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerProductsGiftDetails",ref:P},{children:[o&&(0,n.jsx)(j.default,(0,i.__assign)({element:"p",className:"StickerProductsGiftDetails__summary"},{children:o}),void 0),y.length>0&&(0,n.jsx)("ul",(0,i.__assign)({className:"StickerProductsGiftDetails__recipients"},{children:y.map((function(e){var t=(0,i.__read)(e,2),r=t[0],s=t[1];return(0,n.jsxs)("li",(0,i.__assign)({className:"StickerProductsGiftDetails__recipient"},{children:[(0,n.jsx)(j.default,(0,i.__assign)({element:"div",className:"StickerProductsGiftDetails__recipientName"},{children:r[1]}),void 0),(0,n.jsx)("div",(0,i.__assign)({className:"StickerProductsGiftDetails__recipientProducts"},{children:(0,N.decodeHTMLEntities)(b(s)||"")}),void 0)]}),r[0])}))}),void 0)]}),void 0)};var T=r(69783);const R=function(e){var t=e.cart,r=e.options,s=r.ref,a=r.gift_ref,o=e.closeBox,c=e.updateBox,l=(0,i.__read)((0,P.useCart)(t),2),u=l[0],x=l[1],L=!u.isLoaded()&&x;(0,d.useEffect)((function(){c()}),[L]);var j=u.getRecipientIds(),b=u.getOrder(),R=b&&!b.error&&b.items.find((function(e){return!e.error&&!(0,w.isSampleOrderItem)(e)})),M=(0,i.__read)(function(e){var t,r,n;if(!e)return[null,null];try{for(var s=(0,i.__values)(e.items),a=s.next();!a.done;a=s.next()){var o=a.value.product;if(o&&(0,S.isPackProduct)(o)){n=o;break}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}var c=e.items.filter((function(e){var t=e.product;return null==t?void 0:t.can_gift})),l=c.filter((function(e){return!e.error&&!(0,w.isSampleOrderItem)(e)}));l.length&&(c=l);var u=new S.ProductsByType(c.map((function(e){return e.product}))),d=u.pack.values().next().value,_=Array.from(u.style),f="",p="";if(1===_.length)f=(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_title_1_style"),"title",_[0].title),d?p=(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_description_with_pack"),"title",d.title):n&&(p=(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_description_for_pack"),"title",n.title));else if(d){if(f=(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_title_pack"),"title",d.title),_.length)switch(_.length){case 2:p=(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_description_with_2_styles"),"title1",_[0].title,"title2",_[1].title);break;case 3:p=(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_description_with_3_styles"),"title1",_[0].title,"title2",_[1].title,"title3",_[2].title);break;case 4:p=(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_description_with_3_styles_and_1_more"),"title1",_[0].title,"title2",_[1].title,"title3",_[2].title);break;default:var v=_.length-3;p=(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_description_with_3_styles_and_n_more",v),"title1",_[0].title,"title2",_[1].title,"title3",_[2].title,"n",v)}}else if(_.length){switch(_.length){case 2:f=(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_title_2_styles"),"title1",_[0].title,"title2",_[1].title);break;case 3:f=(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_title_3_styles"),"title1",_[0].title,"title2",_[1].title,"title3",_[2].title);break;case 4:f=(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_title_3_styles_and_1_more"),"title1",_[0].title,"title2",_[1].title,"title3",_[2].title);break;default:v=_.length-3;f=(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_title_3_styles_and_n_more",v),"title1",_[0].title,"title2",_[1].title,"title3",_[2].title,"n",v)}n&&(p=(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_description_for_pack"),"title",n.title))}_.length?p+=" "+(0,h.getLang)("purchases_stickers_gift_description_styles"):p+=" "+(0,h.getLang)("purchases_stickers_gift_description");return[f,p]}(b),2),A=M[0],G=M[1],B=(0,i.__read)((0,d.useState)(null),2)[1];(0,d.useLayoutEffect)((function(){var e,t,r=u.getRecipients();if(B(window.WideDropdown.init("StickerProductsGiftRecipientsDropdown",{defaultItems:r,items:r,noResult:(0,h.getLang)("gifts_nobody_found"),introText:(0,h.getLang)("gifts_start_typing_recipient"),maxItems:20,onChange:function(e,t){1===e?u.addRecipientId(+t):u.removeRecipientId(+t)}})),j.length)try{for(var n=(0,i.__values)(j),s=n.next();!s.done;s=n.next()){var a=s.value,o=u.getRecipientById(a);o&&window.WideDropdown.select("StickerProductsGiftRecipientsDropdown",!1,o)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}else window.WideDropdown.focus("StickerProductsGiftRecipientsDropdown");return function(){window.WideDropdown.deinit("StickerProductsGiftRecipientsDropdown")}}),[L]);var D=(0,i.__read)((0,d.useState)(""),2),E=D[0],O=D[1],H=(0,i.__read)((0,d.useState)(!1),2),F=H[0],V=H[1],U=(0,i.__read)((0,d.useState)(!1),2),z=U[0],K=U[1],W=function(){z||(K(!0),u.order({message:E,is_private:F,ref:s,gift_ref:a}).then((function(e){K(!1),e&&!e.error&&((0,_.showDoneBox)(function(e,t){var r,n,s=new S.ProductsByType(e.items.filter((function(e){return!e.error})).map((function(e){return e.product}))),a=function(e){var t=e.getPack(),r=e.getStyles();if(t)return r.length?(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_result_products_pack_and_styles",r.length),"title",t.title,"styles_num",r.length):(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_result_products_pack"),"title",t.title);if(r.length)switch(r.length){case 1:return(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_result_products_1_style"),"title",r[0].title);case 2:return(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_result_products_2_styles"),"title1",r[0].title,"title2",r[1].title);case 3:return(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_result_products_3_styles"),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title);case 4:return(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_result_products_3_styles_and_1_more"),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title);default:var i=r.length-3;return(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_result_products_3_styles_and_n_more",i),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title,"n",i)}return null}(s);if(!a)return null;var o=new Set;try{for(var c=(0,i.__values)(e.items),l=c.next();!l.done;l=c.next()){var u=l.value,d=u.error,_=u.recipient_id;if(!d){var f=t(_);f&&o.add(f)}}}catch(e){r={error:e}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}var p=function(e,t){var r=Array.from(e.values());switch(r.length){case 0:return null;case 1:var i=1===t?(0,h.getLang)("purchases_stickers_gift_result_1_recipient_single",!0):(0,h.getLang)("purchases_stickers_gift_result_1_recipient_multiple",!0);return(0,g.langStr)((0,g.langSex)(r[0][7],i),"name",r[0][8]);case 2:return(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_result_2_recipients",t),"name1",r[0][8],"name2",r[1][8]);case 3:return(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_result_3_recipients",t),"name1",r[0][8],"name2",r[1][8],"name3",r[2][8]);case 4:return(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_result_4_recipients",t),"name1",r[0][8],"name2",r[1][8],"name3",r[2][8],"name4",r[3][8]);case 5:return(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_result_5_recipients",t),"name1",r[0][8],"name2",r[1][8],"name3",r[2][8],"name4",r[3][8],"name5",r[4][8]);default:var n=r.length-4;i=1===t?(0,h.getLang)("purchases_stickers_gift_result_4_recipients_and_n_more_single"):(0,h.getLang)("purchases_stickers_gift_result_4_recipients_and_n_more_multiple");return(0,g.langStr)(i,"name1",r[0][8],"name2",r[1][8],"name3",r[2][8],"name4",r[3][8],"n",n)}return null}(o,s.getCount());if(!p)return null;return(0,g.langStr)(p,"products",a)}(e,(function(e){return u.getRecipientById(e)}))),o())}),(function(){})))};return(0,d.useEffect)((function(){window.WideDropdown.disable("StickerProductsGiftRecipientsDropdown",z)}),[z]),(0,n.jsxs)("article",(0,i.__assign)({className:"StickerProductsGift"},{children:[(0,n.jsx)(f.ModalHeader,{className:"StickerProductsGift__header",title:(0,h.getLang)("purchases_stickers_gift_box_title"),onClose:o},void 0),L?(0,n.jsx)("section",(0,i.__assign)({className:"StickerProductsGift__content StickerProductsGift__content--loading"},{children:(0,n.jsx)(p.default,{size:24},void 0)}),void 0):(0,n.jsxs)(d.Fragment,{children:[(0,n.jsxs)("section",(0,i.__assign)({className:"StickerProductsGift__content"},{children:[(0,n.jsx)(I,{order:b,forceValid:!R},void 0),(0,n.jsx)("h1",(0,i.__assign)({className:"StickerProductsGift__productsTitle"},{children:(0,N.decodeHTMLEntities)(A||"")}),void 0),(0,n.jsx)("p",(0,i.__assign)({className:"StickerProductsGift__productsDescription"},{children:(0,N.decodeHTMLEntities)(G||"")}),void 0),b&&(0,n.jsxs)(d.Fragment,{children:[(0,n.jsxs)("dl",(0,i.__assign)({className:"StickerProductsGift__price"},{children:[(0,n.jsx)("dt",(0,i.__assign)({className:"StickerProductsGift__priceLabel"},{children:(0,h.getLang)("purchases_gift_price_label")}),void 0)," ",(0,n.jsx)("dd",(0,i.__assign)({className:"StickerProductsGift__priceValue"},{children:(0,h.getLang)("global_n_votes",b.price.current)}),void 0)]}),void 0),(0,n.jsx)("div",(0,i.__assign)({className:"StickerProductsGift__balance"},{children:(0,g.langStr)((0,h.getLang)("gifts_you_have_X_votes"),"votes",(0,h.getLang)("global_n_votes",b.balance))}),void 0)]},void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerProductsGift__recipients"},{children:[(0,n.jsx)("label",(0,i.__assign)({className:"StickerProductsGift__recipientsLabel",htmlFor:"StickerProductsGiftRecipientsInput"},{children:(0,h.getLang)("gifts_receiver")}),void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"wdd StickerProductsGift__recipientsDropdown",id:"StickerProductsGiftRecipientsDropdown"},{children:[(0,n.jsx)("div",{className:"fl_r wdd_arr"},void 0),(0,n.jsx)("input",{className:"wdd_text fl_l",id:"StickerProductsGiftRecipientsInput",placeholder:(0,h.getLang)("gifts_choose_recipients")},void 0)]}),void 0)]}),void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerProductsGift__message"},{children:[(0,n.jsx)("label",(0,i.__assign)({className:"StickerProductsGift__messageLabel",htmlFor:"StickerProductsGiftMessageInput"},{children:(0,h.getLang)("purchases_gift_your_message")}),void 0),(0,n.jsx)(v.default,{className:"StickerProductsGift__messageInput",id:"StickerProductsGiftMessageInput",value:E,onChange:function(e){return O(e.currentTarget.value)},onResize:function(){return c()},style:{height:80},disabled:z},void 0)]}),void 0),(0,n.jsx)(m.default,(0,i.__assign)({className:"StickerProductsGift__isPrivate",checked:F,disabled:z,onChange:function(){return V(!F)}},{children:(0,h.getLang)("gifts_receiver_only")}),void 0)]}),void 0),(0,n.jsxs)("footer",(0,i.__assign)({className:"StickerProductsGift__footer"},{children:[(0,n.jsx)("div",(0,i.__assign)({className:"StickerProductsGift__footerNote"},{children:!x&&b&&(0,n.jsxs)("div",(0,i.__assign)({className:"StickerProductsGift__details"},{children:[(0,h.getLang)("purchases_stickers_gift_details_label"),(0,n.jsx)(y.default,(0,i.__assign)({className:"StickerProductsGift__detailsTooltip",text:(0,n.jsx)(C,{order:b,recipients:u.getRecipientsMap()},void 0),position:"t",align:"center",appearance:"light"},{children:(0,n.jsx)(k.default,{className:"StickerProductsGift__detailsHintIcon"},void 0)}),void 0)]}),void 0)}),void 0),(0,n.jsx)("div",(0,i.__assign)({className:"StickerProductsGift__footerButtons"},{children:(0,n.jsx)(T.default,{className:"StickerProductsGift__gift",mode:R?"primary":"secondary",size:"m",loading:x||z,disabled:!R,price:null==b?void 0:b.price,text:R?(0,g.langStr)((0,h.getLang)("purchases_stickers_gift_send_for"),"price",(0,h.getLang)("global_n_votes",null==b?void 0:b.price.current)):(0,h.getLang)("purchases_stickers_gift_send"),onClick:function(){return W()}},void 0)}),void 0)]}),void 0)]},void 0)]}),void 0)};function M(e,t){var r;if((0,u.getCache)().productsGiftLock)return null;(0,u.updateCache)({productsGiftLock:!0});var c=(0,i.__assign)({},t);function d(){return null==r?void 0:r.bodyNode.querySelector(".StickersProductsGift")}function _(){null==r||r.hide()}function g(){null==r||r.updateBoxCoords()}return(0,l.showLoader)(),e.isGift=!0,Promise.all([e.load(!0),window.stManager.add(["stickers.css","wide_dd.js","wide_dd.css"])]).then((function(e){var t=(0,i.__read)(e,1)[0];(0,l.hideLoader)(),r=new o.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:450,onShow:function(){!function(e){var t=d();t&&s.render((0,n.jsx)(a.AppRootProvider,{children:(0,n.jsx)(R,{cart:e,options:c,closeBox:_,updateBox:g},void 0)},void 0),t)}(t),requestAnimationFrame((function(){g()}))},onHideAttempt:function(){var e;return(e=d())&&s.unmountComponentAtNode(e),!0},onHide:function(){(0,u.updateCache)({productsGiftLock:!1})}}),r.content('<div class="StickersProductsGift"></div>'),r.show()}),(function(){})),{hide:_}}function A(e,t,r){return void 0===t&&(t=[]),M(c.Cart.create(e,t),r)}},48230:(e,t,r)=>{"use strict";r.d(t,{getBoxLayerWrap:()=>u,showLoader:()=>d,hideLoader:()=>_,getPurchaseResult:()=>g,updateStickersFromQueue:()=>h});var i=r(86067),n=r(41650),s=r(11417),a=r(15544),o=r(86125),c=r(49091);function l(){return document.querySelector("#box_loader")}function u(){return document.querySelector("#box_layer_wrap")}function d(){var e=l();(0,o.boxRefreshCoords)(e),(0,a.show)(e),(0,a.show)(u())}function _(){(0,a.hide)(l())}function g(e){var t=new c.ProductsByType(e.items.filter((function(e){return!e.error})).map((function(e){return e.product}))),r=t.getPack(),s=t.getStyles();if(r)return s.length?(0,i.langStr)((0,n.getLang)("purchases_stickers_purchase_result_pack_and_styles",s.length),"pack_title",r.title,"n",s.length):(0,i.langStr)((0,n.getLang)("purchases_stickers_purchase_result_pack"),"title",r.title);if(s.length)switch(s.length){case 1:return(0,i.langStr)((0,n.getLang)("purchases_stickers_purchase_result_1_style"),"title",s[0].title);case 2:return(0,i.langStr)((0,n.getLang)("purchases_stickers_purchase_result_2_styles"),"title1",s[0].title,"title2",s[1].title);case 3:return(0,i.langStr)((0,n.getLang)("purchases_stickers_purchase_result_3_styles"),"title1",s[0].title,"title2",s[1].title,"title3",s[2].title);case 4:return(0,i.langStr)((0,n.getLang)("purchases_stickers_purchase_result_3_styles_and_1_more"),"title1",s[0].title,"title2",s[1].title,"title3",s[2].title);default:var a=s.length-3;return(0,i.langStr)((0,n.getLang)("purchases_stickers_purchase_result_3_styles_and_n_more",a),"title1",s[0].title,"title2",s[1].title,"title3",s[2].title,"n",a)}return null}function h(e){var t,r;t=e,r=s.colorScheme.isDarkScheme()?"data-src-dark":"data-src-light",t.querySelectorAll(".sticker_img["+r+"]").forEach((function(e){var t=e.getAttribute(r);t&&(e.src=t)}))}},75867:(e,t,r)=>{"use strict";r.d(t,{vmojiSubscribeToQueue:()=>s,vmojiPurchaseProduct:()=>a,vmojiGetAvatar:()=>o,vmojiGetStickerPacksRecommendationBlocks:()=>c,vmojiGetStickerPacksRecommendationBlock:()=>l,vmojiGetStickerPacks:()=>u,vmojiGetCharacterById:()=>d,vmojiSetAvatarState:()=>_,storeActivateProduct:()=>g,storeDeactivateProduct:()=>h,VmojiLangSection:()=>i,vmojiGetLangs:()=>f});var i,n=r(89798),s=function(){return(0,n.api)("vmoji.subscribeToQueue",{})},a=function(e,t){return void 0===t&&(t=!1),(0,n.api)("vmoji.purchaseProduct",{product_id:e,confirm:t?1:0})},o=function(e){var t={};return e&&Object.assign(t,{avatar_id:e}),(0,n.api)("vmoji.getAvatar",t)},c=function(e){return(0,n.api)("vmoji.getStickerPacksRecommendationBlocks",e)},l=function(e,t){var r={block_id:e};return t&&Object.assign(r,{count:t}),(0,n.api)("vmoji.getStickerPacksRecommendationBlock",r)},u=function(e){return(0,n.api)("vmoji.getStickerPacks",e)},d=function(e,t){return(0,n.api)("vmoji.getCharacterById",{character_id:e,with_stickers:t?1:0})},_=function(e,t){return(0,n.api)("vmoji.setAvatarState",{avatar_id:e,is_active:t?1:0})},g=function(e){return(0,n.api)("store.activateProduct",{type:"stickers",product_id:e})},h=function(e){return(0,n.api)("store.deactivateProduct",{type:"stickers",product_id:e})};!function(e){e.LAYER="layer",e.PURCHASE="purchase"}(i||(i={}));var f=function(e){return new Promise((function(t,r){window.ajax.post("al_vmoji.php",{act:"lang_keys",section:e},{onDone:function(){t()},onFail:function(){return r(),!1}})}))}}}]);try{stManager.done("dist/34070b9b70cb2bcd6cda415005720c20.79cfe159cc959d7cf57b.js")}catch(e){}